# Comparing `tmp/featurewiz-0.3.0.tar.gz` & `tmp/featurewiz-0.3.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "featurewiz-0.3.0.tar", last modified: Mon May  1 01:02:18 2023, max compression
+gzip compressed data, was "featurewiz-0.3.1.tar", last modified: Tue May 16 02:17:12 2023, max compression
```

## Comparing `featurewiz-0.3.0.tar` & `featurewiz-0.3.1.tar`

### file list

```diff
@@ -1,23 +1,23 @@
-drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-01 01:02:18.883497 featurewiz-0.3.0/
--rwxrwxrwx   0 ram       (1000) ram       (1000)    23066 2023-05-01 01:02:18.883497 featurewiz-0.3.0/PKG-INFO
--rwxrwxrwx   0 ram       (1000) ram       (1000)    20916 2023-04-22 13:32:42.000000 featurewiz-0.3.0/README.md
-drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-01 01:02:18.727240 featurewiz-0.3.0/featurewiz/
--rwxrwxrwx   0 ram       (1000) ram       (1000)     3507 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/__init__.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)      387 2023-05-01 00:55:26.000000 featurewiz-0.3.0/featurewiz/__version__.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)    18411 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/classify_method.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)    32382 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/databunch.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)     4414 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/encoders.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)   165432 2023-05-01 00:29:18.000000 featurewiz-0.3.0/featurewiz/featurewiz.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)    87877 2023-04-20 12:09:44.000000 featurewiz-0.3.0/featurewiz/ml_models.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)   109387 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/my_encoders.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)     2584 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/settings.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)    22089 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/stacking_models.py
--rwxrwxrwx   0 ram       (1000) ram       (1000)    14954 2023-03-29 13:07:17.000000 featurewiz-0.3.0/featurewiz/sulov_method.py
-drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-01 01:02:18.852240 featurewiz-0.3.0/featurewiz.egg-info/
--rwxrwxrwx   0 ram       (1000) ram       (1000)    23066 2023-05-01 01:02:18.000000 featurewiz-0.3.0/featurewiz.egg-info/PKG-INFO
--rwxrwxrwx   0 ram       (1000) ram       (1000)      468 2023-05-01 01:02:18.000000 featurewiz-0.3.0/featurewiz.egg-info/SOURCES.txt
--rwxrwxrwx   0 ram       (1000) ram       (1000)        1 2023-05-01 01:02:18.000000 featurewiz-0.3.0/featurewiz.egg-info/dependency_links.txt
--rwxrwxrwx   0 ram       (1000) ram       (1000)      289 2023-05-01 01:02:18.000000 featurewiz-0.3.0/featurewiz.egg-info/requires.txt
--rwxrwxrwx   0 ram       (1000) ram       (1000)       11 2023-05-01 01:02:18.000000 featurewiz-0.3.0/featurewiz.egg-info/top_level.txt
--rwxrwxrwx   0 ram       (1000) ram       (1000)       38 2023-05-01 01:02:18.883497 featurewiz-0.3.0/setup.cfg
--rwxrwxrwx   0 ram       (1000) ram       (1000)     1274 2023-05-01 00:54:26.000000 featurewiz-0.3.0/setup.py
+drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-16 02:17:12.184747 featurewiz-0.3.1/
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    23246 2023-05-16 02:17:12.180758 featurewiz-0.3.1/PKG-INFO
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    21082 2023-05-01 01:06:57.000000 featurewiz-0.3.1/README.md
+drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-16 02:17:12.048746 featurewiz-0.3.1/featurewiz/
+-rwxrwxrwx   0 ram       (1000) ram       (1000)     3563 2023-05-07 11:29:05.000000 featurewiz-0.3.1/featurewiz/__init__.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)      387 2023-05-06 20:33:06.000000 featurewiz-0.3.1/featurewiz/__version__.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    18411 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/classify_method.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    32382 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/databunch.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)     4414 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/encoders.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)   168809 2023-05-16 02:16:07.000000 featurewiz-0.3.1/featurewiz/featurewiz.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    87877 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/ml_models.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)   110950 2023-05-08 14:22:12.000000 featurewiz-0.3.1/featurewiz/my_encoders.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)     2584 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/settings.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    22089 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/stacking_models.py
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    14954 2023-05-02 11:13:48.000000 featurewiz-0.3.1/featurewiz/sulov_method.py
+drwxrwxrwx   0 ram       (1000) ram       (1000)        0 2023-05-16 02:17:12.156744 featurewiz-0.3.1/featurewiz.egg-info/
+-rwxrwxrwx   0 ram       (1000) ram       (1000)    23246 2023-05-16 02:17:11.000000 featurewiz-0.3.1/featurewiz.egg-info/PKG-INFO
+-rwxrwxrwx   0 ram       (1000) ram       (1000)      468 2023-05-16 02:17:11.000000 featurewiz-0.3.1/featurewiz.egg-info/SOURCES.txt
+-rwxrwxrwx   0 ram       (1000) ram       (1000)        1 2023-05-16 02:17:11.000000 featurewiz-0.3.1/featurewiz.egg-info/dependency_links.txt
+-rwxrwxrwx   0 ram       (1000) ram       (1000)      289 2023-05-16 02:17:11.000000 featurewiz-0.3.1/featurewiz.egg-info/requires.txt
+-rwxrwxrwx   0 ram       (1000) ram       (1000)       11 2023-05-16 02:17:11.000000 featurewiz-0.3.1/featurewiz.egg-info/top_level.txt
+-rwxrwxrwx   0 ram       (1000) ram       (1000)       38 2023-05-16 02:17:12.184747 featurewiz-0.3.1/setup.cfg
+-rwxrwxrwx   0 ram       (1000) ram       (1000)     1274 2023-05-09 10:55:09.000000 featurewiz-0.3.1/setup.py
```

### Comparing `featurewiz-0.3.0/PKG-INFO` & `featurewiz-0.3.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,27 @@
 Metadata-Version: 2.1
 Name: featurewiz
-Version: 0.3.0
+Version: 0.3.1
 Summary: Select Best Features from your data set - any size - now with XGBoost!
 Home-page: https://github.com/AutoViML/featurewiz
 Author: Ram Seshadri
 Author-email: rsesha2001@yahoo.com
 License: Apache License 2.0
 Description: # featurewiz
         `featurewiz` is a powerful feature selection library that has a number of features that make it stand out from the competition, including:
         <ol>
         <li>It provides one of the best automatic feature selection algorithms (Minimum Redundancy Maximum Relevance (MRMR)) described by wikipedia as: <a href="https://en.wikipedia.org/wiki/Minimum_redundancy_feature_selection">"The MRMR selection has been found to be more powerful than the maximum relevance feature selection"</a> such as Boruta.</li>
         <li>It selects the best number of un-correlated features that have maximum mutual information about the target without having to specify the number of features</li>
         <li>It is fast and easy to use, and comes with a number of helpful features, such as a built-in categorical-to-numeric encoder and a powerful feature engineering module</li>
         <li>It is well-documented, and it comes with a number of <a href="https://github.com/AutoViML/featurewiz/tree/main/examples">examples</a>.</li>
         <li>It is actively maintained, and it is regularly updated with new features and bug fixes.</li>
         </ol>
-        If you are looking for a single feature selection library, we would definitely recommend checking out featurewiz. It is a powerful tool that can help you to improve the performance of your machine learning models.
+        
+        ## Latest Updates
+        If you are looking for the latest and greatest updates about the library, we would definitely recommend checking out our <a href="https://github.com/AutoViML/featurewiz/blob/main/updates.md">updates page</a> often. It is a powerful tool that can help you improve the performance of your machine learning models with constant new capabilities from featurewiz.
         
         # Table of Contents
         <ul>
         <li><a href="#introduction">What is featurewiz</a></li>
         <li><a href="#working">How it works</a></li>
         <li><a href="#tips">Tips for using featurewiz</a></li>
         <li><a href="#install">How to install featurewiz</a></li>
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: featurewiz Version: 0.3.0 Summary: Select Best
+Metadata-Version: 2.1 Name: featurewiz Version: 0.3.1 Summary: Select Best
 Features from your data set - any size - now with XGBoost! Home-page: https://
 github.com/AutoViML/featurewiz Author: Ram Seshadri Author-email:
 rsesha2001@yahoo.com License: Apache License 2.0 Description: # featurewiz
 `featurewiz` is a powerful feature selection library that has a number of
 features that make it stand out from the competition, including:
    1. It provides one of the best automatic feature selection algorithms
       (Minimum Redundancy Maximum Relevance (MRMR)) described by wikipedia as:
@@ -13,17 +13,19 @@
       of features
    3. It is fast and easy to use, and comes with a number of helpful features,
       such as a built-in categorical-to-numeric encoder and a powerful feature
       engineering module
    4. It is well-documented, and it comes with a number of examples.
    5. It is actively maintained, and it is regularly updated with new features
       and bug fixes.
-If you are looking for a single feature selection library, we would definitely
-recommend checking out featurewiz. It is a powerful tool that can help you to
-improve the performance of your machine learning models. # Table of Contents
+## Latest Updates If you are looking for the latest and greatest updates about
+the library, we would definitely recommend checking out our updates_page often.
+It is a powerful tool that can help you improve the performance of your machine
+learning models with constant new capabilities from featurewiz. # Table of
+Contents
     * What_is_featurewiz
     * How_it_works
     * Tips_for_using_featurewiz
     * How_to_install_featurewiz
     * Usage
     * API
     * Additional_Tips
```

### Comparing `featurewiz-0.3.0/README.md` & `featurewiz-0.3.1/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -3,15 +3,17 @@
 <ol>
 <li>It provides one of the best automatic feature selection algorithms (Minimum Redundancy Maximum Relevance (MRMR)) described by wikipedia as: <a href="https://en.wikipedia.org/wiki/Minimum_redundancy_feature_selection">"The MRMR selection has been found to be more powerful than the maximum relevance feature selection"</a> such as Boruta.</li>
 <li>It selects the best number of un-correlated features that have maximum mutual information about the target without having to specify the number of features</li>
 <li>It is fast and easy to use, and comes with a number of helpful features, such as a built-in categorical-to-numeric encoder and a powerful feature engineering module</li>
 <li>It is well-documented, and it comes with a number of <a href="https://github.com/AutoViML/featurewiz/tree/main/examples">examples</a>.</li>
 <li>It is actively maintained, and it is regularly updated with new features and bug fixes.</li>
 </ol>
-If you are looking for a single feature selection library, we would definitely recommend checking out featurewiz. It is a powerful tool that can help you to improve the performance of your machine learning models.
+
+## Latest Updates
+If you are looking for the latest and greatest updates about the library, we would definitely recommend checking out our <a href="https://github.com/AutoViML/featurewiz/blob/main/updates.md">updates page</a> often. It is a powerful tool that can help you improve the performance of your machine learning models with constant new capabilities from featurewiz.
 
 # Table of Contents
 <ul>
 <li><a href="#introduction">What is featurewiz</a></li>
 <li><a href="#working">How it works</a></li>
 <li><a href="#tips">Tips for using featurewiz</a></li>
 <li><a href="#install">How to install featurewiz</a></li>
```

#### html2text {}

```diff
@@ -9,17 +9,19 @@
       of features
    3. It is fast and easy to use, and comes with a number of helpful features,
       such as a built-in categorical-to-numeric encoder and a powerful feature
       engineering module
    4. It is well-documented, and it comes with a number of examples.
    5. It is actively maintained, and it is regularly updated with new features
       and bug fixes.
-If you are looking for a single feature selection library, we would definitely
-recommend checking out featurewiz. It is a powerful tool that can help you to
-improve the performance of your machine learning models. # Table of Contents
+## Latest Updates If you are looking for the latest and greatest updates about
+the library, we would definitely recommend checking out our updates_page often.
+It is a powerful tool that can help you improve the performance of your machine
+learning models with constant new capabilities from featurewiz. # Table of
+Contents
     * What_is_featurewiz
     * How_it_works
     * Tips_for_using_featurewiz
     * How_to_install_featurewiz
     * Usage
     * API
     * Additional_Tips
```

### Comparing `featurewiz-0.3.0/featurewiz/__init__.py` & `featurewiz-0.3.1/featurewiz/__init__.py`

 * *Files 3% similar despite different names*

```diff
@@ -15,26 +15,26 @@
 from .featurewiz import FE_count_rows_for_all_columns_by_group
 from .featurewiz import FE_add_age_by_date_col, FE_split_add_column, FE_get_latest_values_based_on_date_column
 from .featurewiz import FE_capping_outliers_beyond_IQR_Range
 from .featurewiz import EDA_classify_and_return_cols_by_type, EDA_classify_features_for_deep_learning
 from .featurewiz import FE_create_categorical_feature_crosses, EDA_find_skewed_variables
 from .featurewiz import FE_kmeans_resampler, FE_find_and_cap_outliers, EDA_find_outliers
 from .featurewiz import split_data_n_ways, FE_concatenate_multiple_columns
-from .featurewiz import FE_discretize_numeric_variables
+from .featurewiz import FE_discretize_numeric_variables, reduce_mem_usage
 from .ml_models import simple_XGBoost_model, simple_LightGBM_model, complex_XGBoost_model, complex_LightGBM_model,data_transform
 from .my_encoders import My_LabelEncoder, Groupby_Aggregator, My_LabelEncoder_Pipe, Ranking_Aggregator, DateTime_Transformer
 from .my_encoders import Rare_Class_Combiner, Rare_Class_Combiner_Pipe, FE_create_time_series_features, Binning_Transformer
 from .my_encoders import Column_Names_Transformer, FE_convert_all_object_columns_to_numeric, Numeric_Transformer
 from .my_encoders import TS_Lagging_Transformer, TS_Fourier_Transformer, TS_Trend_Seasonality_Transformer
 from .my_encoders import TS_Lagging_Transformer_Pipe, TS_Fourier_Transformer_Pipe
 
 from .sulov_method import FE_remove_variables_using_SULOV_method
 from .featurewiz import FE_transform_numeric_columns_to_bins, FE_create_interaction_vars
 from .stacking_models import Stacking_Classifier, Blending_Regressor, Stacking_Regressor, stacking_models_list
-from .featurewiz import EDA_binning_numeric_column_displaying_bins
+from .featurewiz import EDA_binning_numeric_column_displaying_bins, FE_calculate_duration_from_timestamp
 from .featurewiz import FE_convert_mixed_datatypes_to_string, FE_drop_rows_with_infinity
 from .featurewiz import EDA_find_remove_columns_with_infinity, FE_split_list_into_columns
 from .featurewiz import EDA_remove_special_chars, FE_remove_commas_in_numerics
 from .featurewiz import EDA_randomly_select_rows_from_dataframe, remove_duplicate_cols_in_dataset
 
 from .featurewiz import FeatureWiz
 ################################################################################
```

### Comparing `featurewiz-0.3.0/featurewiz/classify_method.py` & `featurewiz-0.3.1/featurewiz/classify_method.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/databunch.py` & `featurewiz-0.3.1/featurewiz/databunch.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/encoders.py` & `featurewiz-0.3.1/featurewiz/encoders.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/featurewiz.py` & `featurewiz-0.3.1/featurewiz/featurewiz.py`

 * *Files 2% similar despite different names*

```diff
@@ -2536,7805 +2536,8016 @@
 00009e70: 6574 6865 7220 6361 7420 6f72 206e 756d  ether cat or num
 00009e80: 6572 6963 2021 0a20 2020 2023 2323 2323  eric !.    #####
 00009e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00009ea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00009eb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00009ec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00009ed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00009ee0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-00009ef0: 2073 7461 7274 5f74 696d 6520 3d20 7469   start_time = ti
-00009f00: 6d65 2e74 696d 6528 290a 2020 2020 6e5f  me.time().    n_
-00009f10: 7370 6c69 7473 203d 2035 0a20 2020 206d  splits = 5.    m
-00009f20: 6178 5f64 6570 7468 203d 2038 0a20 2020  ax_depth = 8.   
-00009f30: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00009f40: 2323 2323 2323 2320 2020 4920 4d20 5020  #######   I M P 
-00009f50: 4f20 5220 5420 4120 4e20 5420 2020 2044  O R T A N T    D
-00009f60: 2045 2046 2041 2055 204c 2054 2053 2023   E F A U L T S #
-00009f70: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00009f80: 2020 7375 6273 616d 706c 6520 3d20 2030    subsample =  0
-00009f90: 2e37 0a20 2020 2063 6f6c 5f73 7562 5f73  .7.    col_sub_s
-00009fa0: 616d 706c 6520 3d20 302e 370a 2020 2020  ample = 0.7.    
-00009fb0: 7465 7374 5f73 697a 6520 3d20 302e 320a  test_size = 0.2.
-00009fc0: 2020 2020 2370 7269 6e74 2827 7465 7374      #print('test
-00009fd0: 5f73 697a 6520 3d20 2573 2720 2574 6573  _size = %s' %tes
-00009fe0: 745f 7369 7a65 290a 2020 2020 7365 6564  t_size).    seed
-00009ff0: 203d 2031 0a20 2020 2065 6172 6c79 5f73   = 1.    early_s
-0000a000: 746f 7070 696e 6720 3d20 350a 2020 2020  topping = 5.    
-0000a010: 2323 2323 2323 2320 416c 6c20 7468 6520  ####### All the 
-0000a020: 6465 6661 756c 7420 7061 7261 6d65 7465  default paramete
-0000a030: 7273 2061 7265 2073 6574 2075 7020 6e6f  rs are set up no
-0000a040: 7720 2323 2323 2323 2323 230a 2020 2020  w #########.    
-0000a050: 6b66 203d 204b 466f 6c64 286e 5f73 706c  kf = KFold(n_spl
-0000a060: 6974 733d 6e5f 7370 6c69 7473 290a 2020  its=n_splits).  
-0000a070: 2020 2323 2323 2323 2323 2320 2020 2020    #########     
-0000a080: 4720 5020 5520 2020 2020 5020 5220 4f20  G P U     P R O 
-0000a090: 4320 4520 5320 5320 4920 4e20 4720 2020  C E S S I N G   
-0000a0a0: 2020 2042 2045 2047 2049 204e 2053 2020     B E G I N S  
-0000a0b0: 2020 2323 2323 2323 2323 2323 2323 0a20    ############. 
-0000a0c0: 2020 2023 2323 2323 2320 5468 6973 2069     ###### This i
-0000a0d0: 7320 7768 6572 6520 7765 2073 6574 2074  s where we set t
-0000a0e0: 6865 2043 5055 2061 6e64 2047 5055 2070  he CPU and GPU p
-0000a0f0: 6172 616d 6574 6572 7320 666f 7220 5847  arameters for XG
-0000a100: 426f 6f73 740a 2020 2020 4750 555f 6578  Boost.    GPU_ex
-0000a110: 6973 7473 203d 2063 6865 636b 5f69 665f  ists = check_if_
-0000a120: 4750 555f 6578 6973 7473 2876 6572 626f  GPU_exists(verbo
-0000a130: 7365 290a 2020 2020 6e5f 776f 726b 6572  se).    n_worker
-0000a140: 7320 3d20 6765 745f 6370 755f 776f 726b  s = get_cpu_work
-0000a150: 6572 5f63 6f75 6e74 2829 0a20 2020 2023  er_count().    #
-0000a160: 2323 2323 2020 2053 6574 2074 6865 2053  ####   Set the S
-0000a170: 636f 7269 6e67 2050 6172 616d 6574 6572  coring Parameter
-0000a180: 7320 6865 7265 2062 6173 6564 206f 6e20  s here based on 
-0000a190: 6561 6368 206d 6f64 656c 2061 6e64 2070  each model and p
-0000a1a0: 7265 6665 7265 6e63 6573 206f 6620 7573  references of us
-0000a1b0: 6572 2023 2323 0a20 2020 2063 7075 5f70  er ###.    cpu_p
-0000a1c0: 6172 616d 7320 3d20 7b7d 0a20 2020 2070  arams = {}.    p
-0000a1d0: 6172 616d 203d 207b 7d0a 2020 2020 6370  aram = {}.    cp
-0000a1e0: 755f 7472 6565 5f6d 6574 686f 6420 3d20  u_tree_method = 
-0000a1f0: 2768 6973 7427 0a20 2020 2074 7265 655f  'hist'.    tree_
-0000a200: 6d65 7468 6f64 203d 2027 6869 7374 270a  method = 'hist'.
-0000a210: 2020 2020 6e5f 6573 7469 6d61 746f 7273      n_estimators
-0000a220: 203d 2031 3030 0a20 2020 2063 7075 5f70   = 100.    cpu_p
-0000a230: 6172 616d 735b 276e 7468 7265 6164 275d  arams['nthread']
-0000a240: 203d 202d 310a 2020 2020 6370 755f 7061   = -1.    cpu_pa
-0000a250: 7261 6d73 5b27 7472 6565 5f6d 6574 686f  rams['tree_metho
-0000a260: 6427 5d20 3d20 2768 6973 7427 0a20 2020  d'] = 'hist'.   
-0000a270: 2063 7075 5f70 6172 616d 735b 2765 7461   cpu_params['eta
-0000a280: 275d 203d 2030 2e30 310a 2020 2020 6370  '] = 0.01.    cp
-0000a290: 755f 7061 7261 6d73 5b27 7375 6273 616d  u_params['subsam
-0000a2a0: 706c 6527 5d20 3d20 302e 350a 2020 2020  ple'] = 0.5.    
-0000a2b0: 6370 755f 7061 7261 6d73 5b27 6772 6f77  cpu_params['grow
-0000a2c0: 5f70 6f6c 6963 7927 5d20 3d20 2764 6570  _policy'] = 'dep
-0000a2d0: 7468 7769 7365 2720 2327 6c6f 7373 6775  thwise' #'lossgu
-0000a2e0: 6964 6527 0a20 2020 2063 7075 5f70 6172  ide'.    cpu_par
-0000a2f0: 616d 735b 276e 5f65 7374 696d 6174 6f72  ams['n_estimator
-0000a300: 7327 5d20 3d20 6e5f 6573 7469 6d61 746f  s'] = n_estimato
-0000a310: 7273 0a20 2020 2063 7075 5f70 6172 616d  rs.    cpu_param
-0000a320: 735b 276d 6178 5f64 6570 7468 275d 203d  s['max_depth'] =
-0000a330: 206d 6178 5f64 6570 7468 0a20 2020 2063   max_depth.    c
-0000a340: 7075 5f70 6172 616d 735b 276d 6178 5f6c  pu_params['max_l
-0000a350: 6561 7665 7327 5d20 3d20 300a 2020 2020  eaves'] = 0.    
-0000a360: 6370 755f 7061 7261 6d73 5b27 7665 7262  cpu_params['verb
-0000a370: 6f73 6974 7927 5d20 3d20 300a 2020 2020  osity'] = 0.    
-0000a380: 6370 755f 7061 7261 6d73 5b27 6770 755f  cpu_params['gpu_
-0000a390: 6964 275d 203d 2030 0a20 2020 2063 7075  id'] = 0.    cpu
-0000a3a0: 5f70 6172 616d 735b 2775 7064 6174 6572  _params['updater
-0000a3b0: 275d 203d 2027 6772 6f77 5f63 6f6c 6d61  '] = 'grow_colma
-0000a3c0: 6b65 7227 0a20 2020 2063 7075 5f70 6172  ker'.    cpu_par
-0000a3d0: 616d 735b 2770 7265 6469 6374 6f72 275d  ams['predictor']
-0000a3e0: 203d 2027 6370 755f 7072 6564 6963 746f   = 'cpu_predicto
-0000a3f0: 7227 0a20 2020 2063 7075 5f70 6172 616d  r'.    cpu_param
-0000a400: 735b 276e 756d 5f70 6172 616c 6c65 6c5f  s['num_parallel_
-0000a410: 7472 6565 275d 203d 2031 0a20 2020 2069  tree'] = 1.    i
-0000a420: 6620 4750 555f 6578 6973 7473 3a0a 2020  f GPU_exists:.  
-0000a430: 2020 2020 2020 7472 6565 5f6d 6574 686f        tree_metho
-0000a440: 6420 3d20 2767 7075 5f68 6973 7427 0a20  d = 'gpu_hist'. 
-0000a450: 2020 2020 2020 2070 6172 616d 5b27 6e74         param['nt
-0000a460: 6872 6561 6427 5d20 3d20 2d31 0a20 2020  hread'] = -1.   
-0000a470: 2020 2020 2070 6172 616d 5b27 7472 6565       param['tree
-0000a480: 5f6d 6574 686f 6427 5d20 3d20 2767 7075  _method'] = 'gpu
-0000a490: 5f68 6973 7427 0a20 2020 2020 2020 2070  _hist'.        p
-0000a4a0: 6172 616d 735b 2765 7461 275d 203d 2030  arams['eta'] = 0
-0000a4b0: 2e30 310a 2020 2020 2020 2020 7061 7261  .01.        para
-0000a4c0: 6d73 5b27 7375 6273 616d 706c 6527 5d20  ms['subsample'] 
-0000a4d0: 3d20 302e 350a 2020 2020 2020 2020 7061  = 0.5.        pa
-0000a4e0: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
-0000a4f0: 7927 5d20 3d20 2764 6570 7468 7769 7365  y'] = 'depthwise
-0000a500: 2720 2320 276c 6f73 7367 7569 6465 2720  ' # 'lossguide' 
-0000a510: 2320 0a20 2020 2020 2020 2070 6172 616d  # .        param
-0000a520: 5b27 6e5f 6573 7469 6d61 746f 7273 275d  ['n_estimators']
-0000a530: 203d 206e 5f65 7374 696d 6174 6f72 730a   = n_estimators.
-0000a540: 2020 2020 2020 2020 7061 7261 6d5b 276d          param['m
-0000a550: 6178 5f64 6570 7468 275d 203d 206d 6178  ax_depth'] = max
-0000a560: 5f64 6570 7468 0a20 2020 2020 2020 2070  _depth.        p
-0000a570: 6172 616d 5b27 6d61 785f 6c65 6176 6573  aram['max_leaves
-0000a580: 275d 203d 2030 0a20 2020 2020 2020 2070  '] = 0.        p
-0000a590: 6172 616d 5b27 7665 7262 6f73 6974 7927  aram['verbosity'
-0000a5a0: 5d20 3d20 300a 2020 2020 2020 2020 7061  ] = 0.        pa
-0000a5b0: 7261 6d5b 2767 7075 5f69 6427 5d20 3d20  ram['gpu_id'] = 
-0000a5c0: 300a 2020 2020 2020 2020 7061 7261 6d5b  0.        param[
-0000a5d0: 2775 7064 6174 6572 275d 203d 2027 6772  'updater'] = 'gr
-0000a5e0: 6f77 5f67 7075 5f68 6973 7427 2023 2770  ow_gpu_hist' #'p
-0000a5f0: 7275 6e65 270a 2020 2020 2020 2020 7061  rune'.        pa
-0000a600: 7261 6d5b 2770 7265 6469 6374 6f72 275d  ram['predictor']
-0000a610: 203d 2027 6770 755f 7072 6564 6963 746f   = 'gpu_predicto
-0000a620: 7227 0a20 2020 2020 2020 2070 6172 616d  r'.        param
-0000a630: 5b27 6e75 6d5f 7061 7261 6c6c 656c 5f74  ['num_parallel_t
-0000a640: 7265 6527 5d20 3d20 310a 2020 2020 2020  ree'] = 1.      
-0000a650: 2020 6770 7569 6420 3d20 300a 2020 2020    gpuid = 0.    
-0000a660: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
-0000a670: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000a680: 7428 2720 2020 2054 756e 696e 6720 5847  t('    Tuning XG
-0000a690: 426f 6f73 7420 7573 696e 6720 4750 5520  Boost using GPU 
-0000a6a0: 6879 7065 722d 7061 7261 6d65 7465 7273  hyper-parameters
-0000a6b0: 2e20 5468 6973 2077 696c 6c20 7461 6b65  . This will take
-0000a6c0: 2074 696d 652e 2e2e 2729 0a20 2020 2065   time...').    e
-0000a6d0: 6c73 653a 0a20 2020 2020 2020 2070 6172  lse:.        par
-0000a6e0: 616d 203d 2063 6f70 792e 6465 6570 636f  am = copy.deepco
-0000a6f0: 7079 2863 7075 5f70 6172 616d 7329 0a20  py(cpu_params). 
-0000a700: 2020 2020 2020 2067 7075 6964 203d 204e         gpuid = N
-0000a710: 6f6e 650a 2020 2020 2020 2020 6966 2076  one.        if v
-0000a720: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-0000a730: 2020 2020 7072 696e 7428 2720 2020 2054      print('    T
-0000a740: 756e 696e 6720 5847 426f 6f73 7420 7573  uning XGBoost us
-0000a750: 696e 6720 4350 5520 6879 7065 722d 7061  ing CPU hyper-pa
-0000a760: 7261 6d65 7465 7273 2e20 5468 6973 2077  rameters. This w
-0000a770: 696c 6c20 7461 6b65 2074 696d 652e 2e2e  ill take time...
-0000a780: 2729 0a20 2020 2023 2323 2323 2323 2323  ').    #########
-0000a790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00009ee0: 2323 2323 2323 2323 2323 2323 0a0a 2020  ############..  
+00009ef0: 2020 7374 6172 745f 7469 6d65 203d 2074    start_time = t
+00009f00: 696d 652e 7469 6d65 2829 0a20 2020 206e  ime.time().    n
+00009f10: 5f73 706c 6974 7320 3d20 350a 2020 2020  _splits = 5.    
+00009f20: 6d61 785f 6465 7074 6820 3d20 380a 2020  max_depth = 8.  
+00009f30: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00009f40: 2323 2323 2323 2323 2020 2049 204d 2050  ########   I M P
+00009f50: 204f 2052 2054 2041 204e 2054 2020 2020   O R T A N T    
+00009f60: 4420 4520 4620 4120 5520 4c20 5420 5320  D E F A U L T S 
+00009f70: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+00009f80: 2020 2073 7562 7361 6d70 6c65 203d 2020     subsample =  
+00009f90: 302e 370a 2020 2020 636f 6c5f 7375 625f  0.7.    col_sub_
+00009fa0: 7361 6d70 6c65 203d 2030 2e37 0a20 2020  sample = 0.7.   
+00009fb0: 2074 6573 745f 7369 7a65 203d 2030 2e32   test_size = 0.2
+00009fc0: 0a20 2020 2023 7072 696e 7428 2774 6573  .    #print('tes
+00009fd0: 745f 7369 7a65 203d 2025 7327 2025 7465  t_size = %s' %te
+00009fe0: 7374 5f73 697a 6529 0a20 2020 2073 6565  st_size).    see
+00009ff0: 6420 3d20 310a 2020 2020 6561 726c 795f  d = 1.    early_
+0000a000: 7374 6f70 7069 6e67 203d 2035 0a20 2020  stopping = 5.   
+0000a010: 2023 2323 2323 2323 2041 6c6c 2074 6865   ####### All the
+0000a020: 2064 6566 6175 6c74 2070 6172 616d 6574   default paramet
+0000a030: 6572 7320 6172 6520 7365 7420 7570 206e  ers are set up n
+0000a040: 6f77 2023 2323 2323 2323 2323 0a20 2020  ow #########.   
+0000a050: 206b 6620 3d20 4b46 6f6c 6428 6e5f 7370   kf = KFold(n_sp
+0000a060: 6c69 7473 3d6e 5f73 706c 6974 7329 0a20  lits=n_splits). 
+0000a070: 2020 2023 2323 2323 2323 2323 2020 2020     #########    
+0000a080: 2047 2050 2055 2020 2020 2050 2052 204f   G P U     P R O
+0000a090: 2043 2045 2053 2053 2049 204e 2047 2020   C E S S I N G  
+0000a0a0: 2020 2020 4220 4520 4720 4920 4e20 5320      B E G I N S 
+0000a0b0: 2020 2023 2323 2323 2323 2323 2323 230a     ############.
+0000a0c0: 2020 2020 2323 2323 2323 2054 6869 7320      ###### This 
+0000a0d0: 6973 2077 6865 7265 2077 6520 7365 7420  is where we set 
+0000a0e0: 7468 6520 4350 5520 616e 6420 4750 5520  the CPU and GPU 
+0000a0f0: 7061 7261 6d65 7465 7273 2066 6f72 2058  parameters for X
+0000a100: 4742 6f6f 7374 0a20 2020 2047 5055 5f65  GBoost.    GPU_e
+0000a110: 7869 7374 7320 3d20 6368 6563 6b5f 6966  xists = check_if
+0000a120: 5f47 5055 5f65 7869 7374 7328 7665 7262  _GPU_exists(verb
+0000a130: 6f73 6529 0a20 2020 206e 5f77 6f72 6b65  ose).    n_worke
+0000a140: 7273 203d 2067 6574 5f63 7075 5f77 6f72  rs = get_cpu_wor
+0000a150: 6b65 725f 636f 756e 7428 290a 2020 2020  ker_count().    
+0000a160: 2323 2323 2320 2020 5365 7420 7468 6520  #####   Set the 
+0000a170: 5363 6f72 696e 6720 5061 7261 6d65 7465  Scoring Paramete
+0000a180: 7273 2068 6572 6520 6261 7365 6420 6f6e  rs here based on
+0000a190: 2065 6163 6820 6d6f 6465 6c20 616e 6420   each model and 
+0000a1a0: 7072 6566 6572 656e 6365 7320 6f66 2075  preferences of u
+0000a1b0: 7365 7220 2323 230a 2020 2020 6370 755f  ser ###.    cpu_
+0000a1c0: 7061 7261 6d73 203d 207b 7d0a 2020 2020  params = {}.    
+0000a1d0: 7061 7261 6d20 3d20 7b7d 0a20 2020 2063  param = {}.    c
+0000a1e0: 7075 5f74 7265 655f 6d65 7468 6f64 203d  pu_tree_method =
+0000a1f0: 2027 6869 7374 270a 2020 2020 7472 6565   'hist'.    tree
+0000a200: 5f6d 6574 686f 6420 3d20 2768 6973 7427  _method = 'hist'
+0000a210: 0a20 2020 206e 5f65 7374 696d 6174 6f72  .    n_estimator
+0000a220: 7320 3d20 3130 300a 2020 2020 6370 755f  s = 100.    cpu_
+0000a230: 7061 7261 6d73 5b27 6e74 6872 6561 6427  params['nthread'
+0000a240: 5d20 3d20 2d31 0a20 2020 2063 7075 5f70  ] = -1.    cpu_p
+0000a250: 6172 616d 735b 2774 7265 655f 6d65 7468  arams['tree_meth
+0000a260: 6f64 275d 203d 2027 6869 7374 270a 2020  od'] = 'hist'.  
+0000a270: 2020 6370 755f 7061 7261 6d73 5b27 6574    cpu_params['et
+0000a280: 6127 5d20 3d20 302e 3031 0a20 2020 2063  a'] = 0.01.    c
+0000a290: 7075 5f70 6172 616d 735b 2773 7562 7361  pu_params['subsa
+0000a2a0: 6d70 6c65 275d 203d 2030 2e35 0a20 2020  mple'] = 0.5.   
+0000a2b0: 2063 7075 5f70 6172 616d 735b 2767 726f   cpu_params['gro
+0000a2c0: 775f 706f 6c69 6379 275d 203d 2027 6465  w_policy'] = 'de
+0000a2d0: 7074 6877 6973 6527 2023 276c 6f73 7367  pthwise' #'lossg
+0000a2e0: 7569 6465 270a 2020 2020 6370 755f 7061  uide'.    cpu_pa
+0000a2f0: 7261 6d73 5b27 6e5f 6573 7469 6d61 746f  rams['n_estimato
+0000a300: 7273 275d 203d 206e 5f65 7374 696d 6174  rs'] = n_estimat
+0000a310: 6f72 730a 2020 2020 6370 755f 7061 7261  ors.    cpu_para
+0000a320: 6d73 5b27 6d61 785f 6465 7074 6827 5d20  ms['max_depth'] 
+0000a330: 3d20 6d61 785f 6465 7074 680a 2020 2020  = max_depth.    
+0000a340: 6370 755f 7061 7261 6d73 5b27 6d61 785f  cpu_params['max_
+0000a350: 6c65 6176 6573 275d 203d 2030 0a20 2020  leaves'] = 0.   
+0000a360: 2063 7075 5f70 6172 616d 735b 2776 6572   cpu_params['ver
+0000a370: 626f 7369 7479 275d 203d 2030 0a20 2020  bosity'] = 0.   
+0000a380: 2063 7075 5f70 6172 616d 735b 2767 7075   cpu_params['gpu
+0000a390: 5f69 6427 5d20 3d20 300a 2020 2020 6370  _id'] = 0.    cp
+0000a3a0: 755f 7061 7261 6d73 5b27 7570 6461 7465  u_params['update
+0000a3b0: 7227 5d20 3d20 2767 726f 775f 636f 6c6d  r'] = 'grow_colm
+0000a3c0: 616b 6572 270a 2020 2020 6370 755f 7061  aker'.    cpu_pa
+0000a3d0: 7261 6d73 5b27 7072 6564 6963 746f 7227  rams['predictor'
+0000a3e0: 5d20 3d20 2763 7075 5f70 7265 6469 6374  ] = 'cpu_predict
+0000a3f0: 6f72 270a 2020 2020 6370 755f 7061 7261  or'.    cpu_para
+0000a400: 6d73 5b27 6e75 6d5f 7061 7261 6c6c 656c  ms['num_parallel
+0000a410: 5f74 7265 6527 5d20 3d20 310a 2020 2020  _tree'] = 1.    
+0000a420: 6966 2047 5055 5f65 7869 7374 733a 0a20  if GPU_exists:. 
+0000a430: 2020 2020 2020 2023 2323 2054 6869 7320         ### This 
+0000a440: 6861 7320 6265 656e 2066 6978 6564 2023  has been fixed #
+0000a450: 2323 0a20 2020 2020 2020 2074 7265 655f  ##.        tree_
+0000a460: 6d65 7468 6f64 203d 2027 6770 755f 6869  method = 'gpu_hi
+0000a470: 7374 270a 2020 2020 2020 2020 7061 7261  st'.        para
+0000a480: 6d5b 276e 7468 7265 6164 275d 203d 202d  m['nthread'] = -
+0000a490: 310a 2020 2020 2020 2020 7061 7261 6d5b  1.        param[
+0000a4a0: 2774 7265 655f 6d65 7468 6f64 275d 203d  'tree_method'] =
+0000a4b0: 2027 6770 755f 6869 7374 270a 2020 2020   'gpu_hist'.    
+0000a4c0: 2020 2020 7061 7261 6d5b 2765 7461 275d      param['eta']
+0000a4d0: 203d 2030 2e30 310a 2020 2020 2020 2020   = 0.01.        
+0000a4e0: 7061 7261 6d5b 2773 7562 7361 6d70 6c65  param['subsample
+0000a4f0: 275d 203d 2030 2e35 0a20 2020 2020 2020  '] = 0.5.       
+0000a500: 2070 6172 616d 5b27 6772 6f77 5f70 6f6c   param['grow_pol
+0000a510: 6963 7927 5d20 3d20 2764 6570 7468 7769  icy'] = 'depthwi
+0000a520: 7365 2720 2320 276c 6f73 7367 7569 6465  se' # 'lossguide
+0000a530: 2720 2320 0a20 2020 2020 2020 2070 6172  ' # .        par
+0000a540: 616d 5b27 6e5f 6573 7469 6d61 746f 7273  am['n_estimators
+0000a550: 275d 203d 206e 5f65 7374 696d 6174 6f72  '] = n_estimator
+0000a560: 730a 2020 2020 2020 2020 7061 7261 6d5b  s.        param[
+0000a570: 276d 6178 5f64 6570 7468 275d 203d 206d  'max_depth'] = m
+0000a580: 6178 5f64 6570 7468 0a20 2020 2020 2020  ax_depth.       
+0000a590: 2070 6172 616d 5b27 6d61 785f 6c65 6176   param['max_leav
+0000a5a0: 6573 275d 203d 2030 0a20 2020 2020 2020  es'] = 0.       
+0000a5b0: 2070 6172 616d 5b27 7665 7262 6f73 6974   param['verbosit
+0000a5c0: 7927 5d20 3d20 300a 2020 2020 2020 2020  y'] = 0.        
+0000a5d0: 7061 7261 6d5b 2767 7075 5f69 6427 5d20  param['gpu_id'] 
+0000a5e0: 3d20 300a 2020 2020 2020 2020 7061 7261  = 0.        para
+0000a5f0: 6d5b 2775 7064 6174 6572 275d 203d 2027  m['updater'] = '
+0000a600: 6772 6f77 5f67 7075 5f68 6973 7427 2023  grow_gpu_hist' #
+0000a610: 2770 7275 6e65 270a 2020 2020 2020 2020  'prune'.        
+0000a620: 7061 7261 6d5b 2770 7265 6469 6374 6f72  param['predictor
+0000a630: 275d 203d 2027 6770 755f 7072 6564 6963  '] = 'gpu_predic
+0000a640: 746f 7227 0a20 2020 2020 2020 2070 6172  tor'.        par
+0000a650: 616d 5b27 6e75 6d5f 7061 7261 6c6c 656c  am['num_parallel
+0000a660: 5f74 7265 6527 5d20 3d20 310a 2020 2020  _tree'] = 1.    
+0000a670: 2020 2020 6770 7569 6420 3d20 300a 2020      gpuid = 0.  
+0000a680: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
+0000a690: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000a6a0: 696e 7428 2720 2020 2054 756e 696e 6720  int('    Tuning 
+0000a6b0: 5847 426f 6f73 7420 7573 696e 6720 4750  XGBoost using GP
+0000a6c0: 5520 6879 7065 722d 7061 7261 6d65 7465  U hyper-paramete
+0000a6d0: 7273 2e20 5468 6973 2077 696c 6c20 7461  rs. This will ta
+0000a6e0: 6b65 2074 696d 652e 2e2e 2729 0a20 2020  ke time...').   
+0000a6f0: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
+0000a700: 6172 616d 203d 2063 6f70 792e 6465 6570  aram = copy.deep
+0000a710: 636f 7079 2863 7075 5f70 6172 616d 7329  copy(cpu_params)
+0000a720: 0a20 2020 2020 2020 2067 7075 6964 203d  .        gpuid =
+0000a730: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+0000a740: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
+0000a750: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+0000a760: 2054 756e 696e 6720 5847 426f 6f73 7420   Tuning XGBoost 
+0000a770: 7573 696e 6720 4350 5520 6879 7065 722d  using CPU hyper-
+0000a780: 7061 7261 6d65 7465 7273 2e20 5468 6973  parameters. This
+0000a790: 2077 696c 6c20 7461 6b65 2074 696d 652e   will take time.
+0000a7a0: 2e2e 2729 0a20 2020 2023 2323 2323 2323  ..').    #######
 0000a7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000a7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a7d0: 2323 2323 2323 2323 0a20 2020 2023 2323  ########.    ###
-0000a7e0: 2323 2323 2323 2323 2323 2020 2044 2045  ##########   D E
-0000a7f0: 2054 2045 2043 2054 2020 5349 4e47 4c45   T E C T  SINGLE
-0000a800: 204f 5220 4d55 4c54 492d 4c41 4245 4c20   OR MULTI-LABEL 
-0000a810: 5052 4f42 4c45 4d20 2020 2020 2023 2323  PROBLEM      ###
-0000a820: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0000a830: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+0000a7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a7e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a7f0: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
+0000a800: 2323 2323 2323 2323 2323 2323 2020 2044  ############   D
+0000a810: 2045 2054 2045 2043 2054 2020 5349 4e47   E T E C T  SING
+0000a820: 4c45 204f 5220 4d55 4c54 492d 4c41 4245  LE OR MULTI-LABE
+0000a830: 4c20 5052 4f42 4c45 4d20 2020 2020 2023  L PROBLEM      #
 0000a840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a850: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
 0000a860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000a870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a880: 2323 2323 0a20 2020 2069 6620 6973 696e  ####.    if isin
-0000a890: 7374 616e 6365 2874 6172 6765 742c 2073  stance(target, s
-0000a8a0: 7472 293a 0a20 2020 2020 2020 2074 6172  tr):.        tar
-0000a8b0: 6765 7420 3d20 5b74 6172 6765 745d 0a20  get = [target]. 
-0000a8c0: 2020 2020 2020 2073 6574 7469 6e67 732e         settings.
-0000a8d0: 6d75 6c74 695f 6c61 6265 6c20 3d20 4661  multi_label = Fa
-0000a8e0: 6c73 650a 2020 2020 656c 7365 3a0a 2020  lse.    else:.  
-0000a8f0: 2020 2020 2020 6966 206c 656e 2874 6172        if len(tar
-0000a900: 6765 7429 203c 3d20 313a 0a20 2020 2020  get) <= 1:.     
-0000a910: 2020 2020 2020 2073 6574 7469 6e67 732e         settings.
-0000a920: 6d75 6c74 695f 6c61 6265 6c20 3d20 4661  multi_label = Fa
-0000a930: 6c73 650a 2020 2020 2020 2020 656c 7365  lse.        else
-0000a940: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000a950: 7474 696e 6773 2e6d 756c 7469 5f6c 6162  ttings.multi_lab
-0000a960: 656c 203d 2054 7275 650a 2020 2020 2323  el = True.    ##
-0000a970: 2323 2059 6f75 206e 6565 6420 746f 206d  ## You need to m
-0000a980: 616b 6520 7375 7265 206f 6e6c 7920 5369  ake sure only Si
-0000a990: 6e67 6c65 204c 6162 656c 2070 726f 626c  ngle Label probl
-0000a9a0: 656d 7320 6172 6520 6861 6e64 6c65 6420  ems are handled 
-0000a9b0: 696e 2074 6172 6765 7420 656e 636f 6469  in target encodi
-0000a9c0: 6e67 210a 2020 2020 6966 2073 6574 7469  ng!.    if setti
-0000a9d0: 6e67 732e 6d75 6c74 695f 6c61 6265 6c3a  ngs.multi_label:
-0000a9e0: 0a20 2020 2020 2020 2069 6620 7665 7262  .        if verb
-0000a9f0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-0000aa00: 2070 7269 6e74 2827 5475 726e 696e 6720   print('Turning 
-0000aa10: 6f66 6620 5461 7267 6574 2065 6e63 6f64  off Target encod
-0000aa20: 696e 6720 666f 7220 6d75 6c74 692d 6c61  ing for multi-la
-0000aa30: 6265 6c20 7072 6f62 6c65 6d73 206c 696b  bel problems lik
-0000aa40: 6520 7468 6973 2064 6174 6120 7365 742e  e this data set.
-0000aa50: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
-0000aa60: 2070 7269 6e74 2827 2020 2020 7369 6e63   print('    sinc
-0000aa70: 6520 4665 6174 7572 6520 456e 6769 6e65  e Feature Engine
-0000aa80: 6572 696e 6720 6d6f 6475 6c65 2063 616e  ering module can
-0000aa90: 6e6f 7420 6861 6e64 6c65 204d 756c 7469  not handle Multi
-0000aaa0: 204c 6162 656c 2054 6172 6765 7473 2c20   Label Targets, 
-0000aab0: 7475 726e 6f66 6620 7461 7267 6574 5f65  turnoff target_e
-0000aac0: 6e63 5f63 6174 5f66 6561 7475 7265 7320  nc_cat_features 
-0000aad0: 746f 2046 616c 7365 2729 0a20 2020 2020  to False').     
-0000aae0: 2020 2074 6172 6765 745f 656e 635f 6361     target_enc_ca
-0000aaf0: 745f 6665 6174 7572 6573 203d 2046 616c  t_features = Fal
-0000ab00: 7365 0a20 2020 2065 6c73 653a 0a20 2020  se.    else:.   
-0000ab10: 2020 2020 2023 2320 4966 2074 6172 6765       ## If targe
-0000ab20: 7420 6973 2073 7065 6369 6669 6564 2069  t is specified i
-0000ab30: 6e20 6665 6174 7572 655f 6765 6e20 7468  n feature_gen th
-0000ab40: 656e 2075 7365 2069 7420 746f 2047 656e  en use it to Gen
-0000ab50: 6572 6174 6520 7461 7267 6574 2065 6e63  erate target enc
-0000ab60: 6f64 6564 2066 6561 7475 7265 730a 2020  oded features.  
-0000ab70: 2020 2020 2020 7461 7267 6574 5f65 6e63        target_enc
-0000ab80: 5f63 6174 5f66 6561 7475 7265 7320 3d20  _cat_features = 
-0000ab90: 2774 6172 6765 7427 2069 6e20 6665 6174  'target' in feat
-0000aba0: 7572 655f 6765 6e0a 2020 2020 2323 2323  ure_gen.    ####
-0000abb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000abc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000a8a0: 2323 2323 2323 0a20 2020 2069 6620 6973  ######.    if is
+0000a8b0: 696e 7374 616e 6365 2874 6172 6765 742c  instance(target,
+0000a8c0: 2073 7472 293a 0a20 2020 2020 2020 2074   str):.        t
+0000a8d0: 6172 6765 7420 3d20 5b74 6172 6765 745d  arget = [target]
+0000a8e0: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
+0000a8f0: 732e 6d75 6c74 695f 6c61 6265 6c20 3d20  s.multi_label = 
+0000a900: 4661 6c73 650a 2020 2020 656c 7365 3a0a  False.    else:.
+0000a910: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
+0000a920: 6172 6765 7429 203c 3d20 313a 0a20 2020  arget) <= 1:.   
+0000a930: 2020 2020 2020 2020 2073 6574 7469 6e67           setting
+0000a940: 732e 6d75 6c74 695f 6c61 6265 6c20 3d20  s.multi_label = 
+0000a950: 4661 6c73 650a 2020 2020 2020 2020 656c  False.        el
+0000a960: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000a970: 7365 7474 696e 6773 2e6d 756c 7469 5f6c  settings.multi_l
+0000a980: 6162 656c 203d 2054 7275 650a 2020 2020  abel = True.    
+0000a990: 2323 2323 2059 6f75 206e 6565 6420 746f  #### You need to
+0000a9a0: 206d 616b 6520 7375 7265 206f 6e6c 7920   make sure only 
+0000a9b0: 5369 6e67 6c65 204c 6162 656c 2070 726f  Single Label pro
+0000a9c0: 626c 656d 7320 6172 6520 6861 6e64 6c65  blems are handle
+0000a9d0: 6420 696e 2074 6172 6765 7420 656e 636f  d in target enco
+0000a9e0: 6469 6e67 210a 2020 2020 6966 2073 6574  ding!.    if set
+0000a9f0: 7469 6e67 732e 6d75 6c74 695f 6c61 6265  tings.multi_labe
+0000aa00: 6c3a 0a20 2020 2020 2020 2069 6620 7665  l:.        if ve
+0000aa10: 7262 6f73 653a 0a20 2020 2020 2020 2020  rbose:.         
+0000aa20: 2020 2070 7269 6e74 2827 5475 726e 696e     print('Turnin
+0000aa30: 6720 6f66 6620 5461 7267 6574 2065 6e63  g off Target enc
+0000aa40: 6f64 696e 6720 666f 7220 6d75 6c74 692d  oding for multi-
+0000aa50: 6c61 6265 6c20 7072 6f62 6c65 6d73 206c  label problems l
+0000aa60: 696b 6520 7468 6973 2064 6174 6120 7365  ike this data se
+0000aa70: 742e 2e2e 2729 0a20 2020 2020 2020 2020  t...').         
+0000aa80: 2020 2070 7269 6e74 2827 2020 2020 7369     print('    si
+0000aa90: 6e63 6520 4665 6174 7572 6520 456e 6769  nce Feature Engi
+0000aaa0: 6e65 6572 696e 6720 6d6f 6475 6c65 2063  neering module c
+0000aab0: 616e 6e6f 7420 6861 6e64 6c65 204d 756c  annot handle Mul
+0000aac0: 7469 204c 6162 656c 2054 6172 6765 7473  ti Label Targets
+0000aad0: 2c20 7475 726e 6f66 6620 7461 7267 6574  , turnoff target
+0000aae0: 5f65 6e63 5f63 6174 5f66 6561 7475 7265  _enc_cat_feature
+0000aaf0: 7320 746f 2046 616c 7365 2729 0a20 2020  s to False').   
+0000ab00: 2020 2020 2074 6172 6765 745f 656e 635f       target_enc_
+0000ab10: 6361 745f 6665 6174 7572 6573 203d 2046  cat_features = F
+0000ab20: 616c 7365 0a20 2020 2065 6c73 653a 0a20  alse.    else:. 
+0000ab30: 2020 2020 2020 2023 2320 4966 2074 6172         ## If tar
+0000ab40: 6765 7420 6973 2073 7065 6369 6669 6564  get is specified
+0000ab50: 2069 6e20 6665 6174 7572 655f 6765 6e20   in feature_gen 
+0000ab60: 7468 656e 2075 7365 2069 7420 746f 2047  then use it to G
+0000ab70: 656e 6572 6174 6520 7461 7267 6574 2065  enerate target e
+0000ab80: 6e63 6f64 6564 2066 6561 7475 7265 730a  ncoded features.
+0000ab90: 2020 2020 2020 2020 7461 7267 6574 5f65          target_e
+0000aba0: 6e63 5f63 6174 5f66 6561 7475 7265 7320  nc_cat_features 
+0000abb0: 3d20 2774 6172 6765 7427 2069 6e20 6665  = 'target' in fe
+0000abc0: 6174 7572 655f 6765 6e0a 2020 2020 2323  ature_gen.    ##
 0000abd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000abe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000abf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ac00: 2323 0a20 2020 2023 2323 2323 2323 2320  ##.    ######## 
-0000ac10: 2020 2020 4320 4c20 4120 5320 5320 4920      C L A S S I 
-0000ac20: 4620 5920 2020 2056 2041 2052 2049 2041  F Y    V A R I A
-0000ac30: 2042 204c 2045 2053 2020 2020 2020 2020   B L E S        
-0000ac40: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-0000ac50: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-0000ac60: 2020 2323 2323 2323 204e 6f77 2077 6520    ###### Now we 
-0000ac70: 6465 7465 6374 2074 6865 2076 6172 696f  detect the vario
-0000ac80: 7573 2074 7970 6573 206f 6620 7661 7269  us types of vari
-0000ac90: 6162 6c65 7320 746f 2073 6565 2068 6f77  ables to see how
-0000aca0: 2074 6f20 636f 6e76 6572 7420 7468 656d   to convert them
-0000acb0: 2074 6f20 6e75 6d65 7269 630a 2020 2020   to numeric.    
-0000acc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000acd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ace0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ac00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ac10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ac20: 2323 2323 0a20 2020 2023 2323 2323 2323  ####.    #######
+0000ac30: 2320 2020 2020 4320 4c20 4120 5320 5320  #     C L A S S 
+0000ac40: 4920 4620 5920 2020 2056 2041 2052 2049  I F Y    V A R I
+0000ac50: 2041 2042 204c 2045 2053 2020 2020 2020   A B L E S      
+0000ac60: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+0000ac70: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0000ac80: 2020 2020 2323 2323 2323 204e 6f77 2077      ###### Now w
+0000ac90: 6520 6465 7465 6374 2074 6865 2076 6172  e detect the var
+0000aca0: 696f 7573 2074 7970 6573 206f 6620 7661  ious types of va
+0000acb0: 7269 6162 6c65 7320 746f 2073 6565 2068  riables to see h
+0000acc0: 6f77 2074 6f20 636f 6e76 6572 7420 7468  ow to convert th
+0000acd0: 656d 2074 6f20 6e75 6d65 7269 630a 2020  em to numeric.  
+0000ace0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
 0000acf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000ad00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ad10: 2323 2323 2323 0a20 2020 2064 6174 655f  ######.    date_
-0000ad20: 636f 6c73 203d 2066 6561 7475 7265 735f  cols = features_
-0000ad30: 6469 6374 5b27 6461 7465 5f76 6172 7327  dict['date_vars'
-0000ad40: 5d0a 2020 2020 6966 206c 656e 2866 6561  ].    if len(fea
-0000ad50: 7475 7265 735f 6469 6374 5b27 6461 7465  tures_dict['date
-0000ad60: 5f76 6172 7327 5d29 203e 2030 3a0a 2020  _vars']) > 0:.  
-0000ad70: 2020 2020 2020 6461 7465 5f74 696d 655f        date_time_
-0000ad80: 7661 7273 203d 2063 6f70 792e 6465 6570  vars = copy.deep
-0000ad90: 636f 7079 2864 6174 655f 636f 6c73 290a  copy(date_cols).
-0000ada0: 2020 2020 2020 2020 2323 2323 2044 6f20          #### Do 
-0000adb0: 7468 6973 206f 6e6c 7920 6966 2064 6174  this only if dat
-0000adc0: 6520 7469 6d65 2063 6f6c 756d 6e73 2065  e time columns e
-0000add0: 7869 7374 2069 6e20 796f 7572 2064 6174  xist in your dat
-0000ade0: 6120 7365 7421 0a20 2020 2020 2020 2064  a set!.        d
-0000adf0: 6174 655f 636f 6c5f 6d61 7070 6572 7320  ate_col_mappers 
-0000ae00: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
-0000ae10: 2064 6174 655f 636f 6c20 696e 2064 6174   date_col in dat
-0000ae20: 655f 636f 6c73 3a0a 2020 2020 2020 2020  e_cols:.        
-0000ae30: 2020 2020 7072 696e 7428 2750 726f 6365      print('Proce
-0000ae40: 7373 696e 6720 2573 2063 6f6c 756d 6e20  ssing %s column 
-0000ae50: 666f 7220 6461 7465 2074 696d 6520 6665  for date time fe
-0000ae60: 6174 7572 6573 2e2e 2e2e 2720 2564 6174  atures....' %dat
-0000ae70: 655f 636f 6c29 0a20 2020 2020 2020 2020  e_col).         
-0000ae80: 2020 2064 6174 616e 616d 652c 2074 735f     dataname, ts_
-0000ae90: 6164 6473 203d 2046 455f 6372 6561 7465  adds = FE_create
-0000aea0: 5f74 696d 655f 7365 7269 6573 5f66 6561  _time_series_fea
-0000aeb0: 7475 7265 7328 6461 7461 6e61 6d65 2c20  tures(dataname, 
-0000aec0: 6461 7465 5f63 6f6c 290a 2020 2020 2020  date_col).      
-0000aed0: 2020 2020 2020 6461 7465 5f63 6f6c 5f6d        date_col_m
-0000aee0: 6170 7065 7220 3d20 6469 6374 285b 2878  apper = dict([(x
-0000aef0: 2c64 6174 655f 636f 6c29 2066 6f72 2078  ,date_col) for x
-0000af00: 2069 6e20 7473 5f61 6464 735d 290a 2020   in ts_adds]).  
-0000af10: 2020 2020 2020 2020 2020 6461 7465 5f63            date_c
-0000af20: 6f6c 5f6d 6170 7065 7273 2e75 7064 6174  ol_mappers.updat
-0000af30: 6528 6461 7465 5f63 6f6c 5f6d 6170 7065  e(date_col_mappe
-0000af40: 7229 0a20 2020 2020 2020 2020 2020 2023  r).            #
-0000af50: 7072 696e 7428 2720 2020 2041 6464 696e  print('    Addin
-0000af60: 6720 2564 2063 6f6c 756d 6e28 7329 2066  g %d column(s) f
-0000af70: 726f 6d20 6461 7465 2d74 696d 6520 636f  rom date-time co
-0000af80: 6c75 6d6e 2025 7320 696e 2074 7261 696e  lumn %s in train
-0000af90: 2720 2528 6c65 6e28 6461 7465 5f63 6f6c  ' %(len(date_col
-0000afa0: 5f61 6464 735f 7472 6169 6e29 2c64 6174  _adds_train),dat
-0000afb0: 655f 636f 6c29 290a 2020 2020 2020 2020  e_col)).        
-0000afc0: 2020 2020 2374 7261 696e 203d 2074 7261      #train = tra
-0000afd0: 696e 2e6a 6f69 6e28 6461 7465 5f64 665f  in.join(date_df_
-0000afe0: 7472 6169 6e2c 2072 7375 6666 6978 3d27  train, rsuffix='
-0000aff0: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
-0000b000: 6966 2069 7369 6e73 7461 6e63 6528 7465  if isinstance(te
-0000b010: 7374 5f64 6174 612c 7374 7229 206f 7220  st_data,str) or 
-0000b020: 7465 7374 5f64 6174 6120 6973 204e 6f6e  test_data is Non
-0000b030: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000b040: 2020 2023 2323 2064 6f20 6e6f 7468 696e     ### do nothin
-0000b050: 6720 2323 2323 0a20 2020 2020 2020 2020  g ####.         
-0000b060: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-0000b070: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000b080: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000b090: 696e 7428 2720 2020 2020 2020 2041 6464  int('        Add
-0000b0a0: 696e 6720 7361 6d65 2074 696d 6520 7365  ing same time se
-0000b0b0: 7269 6573 2066 6561 7475 7265 7320 746f  ries features to
-0000b0c0: 2074 6573 7420 6461 7461 2e2e 2e27 290a   test data...').
-0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0e0: 7465 7374 5f64 6174 612c 205f 203d 2046  test_data, _ = F
-0000b0f0: 455f 6372 6561 7465 5f74 696d 655f 7365  E_create_time_se
-0000b100: 7269 6573 5f66 6561 7475 7265 7328 7465  ries_features(te
-0000b110: 7374 5f64 6174 612c 2064 6174 655f 636f  st_data, date_co
-0000b120: 6c2c 2074 735f 6164 6473 290a 2020 2020  l, ts_adds).    
-0000b130: 2020 2020 2020 2020 2020 2020 2364 6174              #dat
-0000b140: 655f 636f 6c5f 6164 6473 5f74 6573 745f  e_col_adds_test_
-0000b150: 6461 7461 203d 206c 6566 745f 7375 6274  data = left_subt
-0000b160: 7261 6374 2864 6174 655f 6466 5f74 6573  ract(date_df_tes
-0000b170: 742e 636f 6c75 6d6e 732e 746f 6c69 7374  t.columns.tolist
-0000b180: 2829 2c64 6174 655f 636f 6c29 0a20 2020  (),date_col).   
-0000b190: 2020 2020 2020 2020 2020 2020 2023 2323               ###
-0000b1a0: 204e 6f77 2074 696d 6520 746f 2072 656d   Now time to rem
-0000b1b0: 6f76 6520 7468 6520 6461 7465 2074 696d  ove the date tim
-0000b1c0: 6520 636f 6c75 6d6e 2066 726f 6d20 616c  e column from al
-0000b1d0: 6c20 6675 7274 6865 7220 7072 6f63 6573  l further proces
-0000b1e0: 7369 6e67 2023 230a 2020 2020 2020 2020  sing ##.        
-0000b1f0: 2020 2020 2020 2020 2374 6573 7420 3d20          #test = 
-0000b200: 7465 7374 2e6a 6f69 6e28 6461 7465 5f64  test.join(date_d
-0000b210: 665f 7465 7374 2c20 7273 7566 6669 783d  f_test, rsuffix=
-0000b220: 2732 2729 0a20 2020 2023 2323 204e 6f77  '2').    ### Now
-0000b230: 2074 696d 6520 746f 2063 6f6e 7469 6e75   time to continu
-0000b240: 6520 7769 7468 206f 7572 2066 7572 7468  e with our furth
-0000b250: 6572 2070 726f 6365 7373 696e 6720 2323  er processing ##
-0000b260: 0a20 2020 2069 6463 6f6c 7320 3d20 6665  .    idcols = fe
-0000b270: 6174 7572 6573 5f64 6963 745b 2749 4463  atures_dict['IDc
-0000b280: 6f6c 7327 5d0a 2020 2020 6966 2069 7369  ols'].    if isi
-0000b290: 6e73 7461 6e63 6528 7465 7374 5f64 6174  nstance(test_dat
-0000b2a0: 612c 7374 7229 206f 7220 7465 7374 5f64  a,str) or test_d
-0000b2b0: 6174 6120 6973 204e 6f6e 653a 0a20 2020  ata is None:.   
-0000b2c0: 2020 2020 2070 6173 730a 2020 2020 656c       pass.    el
-0000b2d0: 7365 3a0a 2020 2020 2020 2020 7465 7374  se:.        test
-0000b2e0: 5f69 6473 203d 2074 6573 745f 6461 7461  _ids = test_data
-0000b2f0: 5b69 6463 6f6c 735d 0a20 2020 2074 7261  [idcols].    tra
-0000b300: 696e 5f69 6473 203d 2064 6174 616e 616d  in_ids = datanam
-0000b310: 655b 6964 636f 6c73 5d20 2323 2320 7468  e[idcols] ### th
-0000b320: 6973 2073 6176 6573 2074 6865 2049 4420  is saves the ID 
-0000b330: 636f 6c75 6d6e 7320 6f66 2064 6174 616e  columns of datan
-0000b340: 616d 650a 2020 2020 6966 2063 6174 5f76  ame.    if cat_v
-0000b350: 6172 733a 0a20 2020 2020 2020 2063 6f6c  ars:.        col
-0000b360: 735f 696e 5f62 6f74 6820 3d20 5b78 2066  s_in_both = [x f
-0000b370: 6f72 2078 2069 6e20 6361 745f 7661 7273  or x in cat_vars
-0000b380: 2069 6620 7820 696e 2066 6561 7475 7265   if x in feature
-0000b390: 735f 6469 6374 5b27 636f 6c73 5f64 656c  s_dict['cols_del
-0000b3a0: 6574 6527 5d5d 0a20 2020 2020 2020 2063  ete']].        c
-0000b3b0: 6174 5f76 6172 7320 3d20 6c65 6674 5f73  at_vars = left_s
-0000b3c0: 7562 7472 6163 7428 6361 745f 7661 7273  ubtract(cat_vars
-0000b3d0: 2c20 6665 6174 7572 6573 5f64 6963 745b  , features_dict[
-0000b3e0: 2763 6f6c 735f 6465 6c65 7465 275d 290a  'cols_delete']).
-0000b3f0: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-0000b400: 6f6c 735f 696e 5f62 6f74 6829 203e 2030  ols_in_both) > 0
-0000b410: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000b420: 696e 7428 2752 656d 6f76 696e 6720 2573  int('Removing %s
-0000b430: 2063 6f6c 756d 6e73 2873 2920 7768 6963   columns(s) whic
-0000b440: 6820 6172 6520 696e 2062 6f74 6820 636f  h are in both co
-0000b450: 6c73 2074 6f20 6265 2064 656c 6574 6564  ls to be deleted
-0000b460: 2061 6e64 2063 6174 2076 6172 7320 6769   and cat vars gi
-0000b470: 7665 6e20 6173 2069 6e70 7574 2720 2563  ven as input' %c
-0000b480: 6f6c 735f 696e 5f62 6f74 6829 0a20 2020  ols_in_both).   
-0000b490: 2063 6f6c 735f 746f 5f72 656d 6f76 6520   cols_to_remove 
-0000b4a0: 3d20 6665 6174 7572 6573 5f64 6963 745b  = features_dict[
-0000b4b0: 2763 6f6c 735f 6465 6c65 7465 275d 202b  'cols_delete'] +
-0000b4c0: 2069 6463 6f6c 7320 2b20 6665 6174 7572   idcols + featur
-0000b4d0: 6573 5f64 6963 745b 2764 6973 6372 6574  es_dict['discret
-0000b4e0: 655f 7374 7269 6e67 5f76 6172 7327 5d0a  e_string_vars'].
-0000b4f0: 2020 2020 7072 696e 7428 2752 656d 6f76      print('Remov
-0000b500: 696e 6720 2564 2063 6f6c 756d 6e73 2066  ing %d columns f
-0000b510: 726f 6d20 6675 7274 6865 7220 7072 6f63  rom further proc
-0000b520: 6573 7369 6e67 2073 696e 6365 2049 4420  essing since ID 
-0000b530: 6f72 206c 6f77 2069 6e66 6f72 6d61 7469  or low informati
-0000b540: 6f6e 2076 6172 6961 626c 6573 2720 256c  on variables' %l
-0000b550: 656e 2863 6f6c 735f 746f 5f72 656d 6f76  en(cols_to_remov
-0000b560: 6529 290a 2020 2020 7072 6564 7320 3d20  e)).    preds = 
-0000b570: 5b78 2066 6f72 2078 2069 6e20 6c69 7374  [x for x in list
-0000b580: 2864 6174 616e 616d 6529 2069 6620 7820  (dataname) if x 
-0000b590: 6e6f 7420 696e 2074 6172 6765 742b 636f  not in target+co
-0000b5a0: 6c73 5f74 6f5f 7265 6d6f 7665 5d0a 2020  ls_to_remove].  
-0000b5b0: 2020 2323 2320 2020 5468 6973 2069 7320    ###   This is 
-0000b5c0: 7768 6572 6520 7765 2073 6f72 7420 7468  where we sort th
-0000b5d0: 6520 636f 6c75 6d6e 7320 746f 206d 616b  e columns to mak
-0000b5e0: 6520 7375 7265 2074 6861 7420 7468 6520  e sure that the 
-0000b5f0: 6f72 6465 7220 6f66 2063 6f6c 756d 6e73  order of columns
-0000b600: 2064 6f65 736e 2774 206d 6174 7465 7220   doesn't matter 
-0000b610: 696e 2073 656c 6563 7469 6f6e 2023 2323  in selection ###
-0000b620: 2323 2323 2323 2323 0a20 2020 2023 7072  ########.    #pr
-0000b630: 6564 7320 3d20 6e70 2e73 6f72 7428 7072  eds = np.sort(pr
-0000b640: 6564 7329 0a20 2020 2069 6620 7665 7262  eds).    if verb
-0000b650: 6f73 653a 0a20 2020 2020 2020 2070 7269  ose:.        pri
-0000b660: 6e74 2827 2020 2020 4166 7465 7220 7265  nt('    After re
-0000b670: 6d6f 7669 6e67 2072 6564 756e 6461 6e74  moving redundant
-0000b680: 2076 6172 6961 626c 6573 2066 726f 6d20   variables from 
-0000b690: 6675 7274 6865 7220 7072 6f63 6573 7369  further processi
-0000b6a0: 6e67 2c20 6665 6174 7572 6573 206c 6566  ng, features lef
-0000b6b0: 7420 3d20 2564 2720 256c 656e 2870 7265  t = %d' %len(pre
-0000b6c0: 6473 2929 0a20 2020 206e 756d 7661 7273  ds)).    numvars
-0000b6d0: 203d 2064 6174 616e 616d 655b 7072 6564   = dataname[pred
-0000b6e0: 735d 2e73 656c 6563 745f 6474 7970 6573  s].select_dtypes
-0000b6f0: 2869 6e63 6c75 6465 203d 2027 6e75 6d62  (include = 'numb
-0000b700: 6572 2729 2e63 6f6c 756d 6e73 2e74 6f6c  er').columns.tol
-0000b710: 6973 7428 290a 2020 2020 6966 206c 656e  ist().    if len
-0000b720: 286e 756d 7661 7273 2920 3e20 6d61 785f  (numvars) > max_
-0000b730: 6e75 6d73 3a0a 2020 2020 2020 2020 6966  nums:.        if
-0000b740: 2066 6561 7475 7265 5f67 656e 3a0a 2020   feature_gen:.  
-0000b750: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000b760: 275c 6e57 6172 6e69 6e67 3a20 546f 6f20  '\nWarning: Too 
-0000b770: 6d61 6e79 2065 7874 7261 2066 6561 7475  many extra featu
-0000b780: 7265 7320 7769 6c6c 2062 6520 6765 6e65  res will be gene
-0000b790: 7261 7465 6420 6279 2066 6561 7475 7265  rated by feature
-0000b7a0: 7769 7a2e 2054 6869 7320 6d61 7920 7461  wiz. This may ta
-0000b7b0: 6b65 2074 696d 652e 2e2e 2729 0a20 2020  ke time...').   
-0000b7c0: 2069 6620 6361 745f 7661 7273 3a0a 2020   if cat_vars:.  
-0000b7d0: 2020 2020 2020 2323 2320 6966 2069 6e70        ### if inp
-0000b7e0: 7574 2069 7320 6769 7665 6e20 666f 7220  ut is given for 
-0000b7f0: 6361 745f 7661 7273 2c20 7573 6520 6974  cat_vars, use it
-0000b800: 210a 2020 2020 2020 2020 6361 7476 6172  !.        catvar
-0000b810: 7320 3d20 636f 7079 2e64 6565 7063 6f70  s = copy.deepcop
-0000b820: 7928 6361 745f 7661 7273 290a 2020 2020  y(cat_vars).    
-0000b830: 2020 2020 6e75 6d76 6172 7320 3d20 6c65      numvars = le
-0000b840: 6674 5f73 7562 7472 6163 7428 7072 6564  ft_subtract(pred
-0000b850: 732c 2063 6174 7661 7273 290a 2020 2020  s, catvars).    
-0000b860: 656c 7365 3a0a 2020 2020 2020 2020 6361  else:.        ca
-0000b870: 7476 6172 7320 3d20 6c65 6674 5f73 7562  tvars = left_sub
-0000b880: 7472 6163 7428 7072 6564 732c 206e 756d  tract(preds, num
-0000b890: 7661 7273 290a 2020 2020 6966 206c 656e  vars).    if len
-0000b8a0: 2863 6174 7661 7273 2920 3e20 6d61 785f  (catvars) > max_
-0000b8b0: 6361 7473 3a0a 2020 2020 2020 2020 6966  cats:.        if
-0000b8c0: 2066 6561 7475 7265 5f74 7970 653a 0a20   feature_type:. 
-0000b8d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000b8e0: 2827 5c6e 5761 726e 696e 673a 2054 6f6f  ('\nWarning: Too
-0000b8f0: 206d 616e 7920 6578 7472 6120 6665 6174   many extra feat
-0000b900: 7572 6573 2077 696c 6c20 6265 2067 656e  ures will be gen
-0000b910: 6572 6174 6564 2062 7920 6361 7465 676f  erated by catego
-0000b920: 7279 2065 6e63 6f64 696e 672e 2054 6869  ry encoding. Thi
-0000b930: 7320 6d61 7920 7461 6b65 2074 696d 652e  s may take time.
-0000b940: 2e2e 2729 0a20 2020 2023 2323 2323 2320  ..').    ###### 
-0000b950: 2020 4320 5220 4520 4120 5420 4920 4e20    C R E A T I N 
-0000b960: 4720 2020 2049 204e 2054 2058 204e 2020  G    I N T X N  
-0000b970: 5620 4120 5220 5320 2020 4620 5220 4f20  V A R S   F R O 
-0000b980: 4d20 2020 4320 4120 5420 2056 2041 2052  M   C A T  V A R
-0000b990: 2053 2023 2323 2323 2323 2323 2323 2323   S #############
-0000b9a0: 2323 2323 2323 2323 0a20 2020 2069 6620  ########.    if 
-0000b9b0: 6e70 2e77 6865 7265 2827 696e 7465 7261  np.where('intera
-0000b9c0: 6374 696f 6e73 2720 696e 2066 6561 7475  ctions' in featu
-0000b9d0: 7265 5f67 656e 2c54 7275 652c 2046 616c  re_gen,True, Fal
-0000b9e0: 7365 292e 746f 6c69 7374 2829 3a0a 2020  se).tolist():.  
-0000b9f0: 2020 2020 2020 6966 206c 656e 2863 6174        if len(cat
-0000ba00: 7661 7273 2920 3e20 313a 0a20 2020 2020  vars) > 1:.     
-0000ba10: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000ba20: 2020 2020 6e75 6d5f 636f 6d62 6f73 203d      num_combos =
-0000ba30: 206c 656e 286c 6973 7428 636f 6d62 696e   len(list(combin
-0000ba40: 6174 696f 6e73 2863 6174 7661 7273 2c32  ations(catvars,2
-0000ba50: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0000ba60: 7072 696e 7428 2741 6464 696e 6720 2573  print('Adding %s
-0000ba70: 2069 6e74 6572 6163 7469 6f6e 7320 6265   interactions be
-0000ba80: 7477 6565 6e20 6361 7465 676f 7269 6361  tween categorica
-0000ba90: 6c5f 7661 7273 2025 732e 2e2e 2720 2528  l_vars %s...' %(
-0000baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bac0: 206e 756d 5f63 6f6d 626f 732c 2063 6174   num_combos, cat
-0000bad0: 7661 7273 2929 0a20 2020 2020 2020 2020  vars)).         
-0000bae0: 2020 2064 6174 616e 616d 6520 3d20 4645     dataname = FE
-0000baf0: 5f63 7265 6174 655f 696e 7465 7261 6374  _create_interact
-0000bb00: 696f 6e5f 7661 7273 2864 6174 616e 616d  ion_vars(datanam
-0000bb10: 652c 2063 6174 7661 7273 290a 2020 2020  e, catvars).    
-0000bb20: 2020 2020 2020 2020 7472 6169 6e20 3d20          train = 
-0000bb30: 4645 5f63 7265 6174 655f 696e 7465 7261  FE_create_intera
-0000bb40: 6374 696f 6e5f 7661 7273 2874 7261 696e  ction_vars(train
-0000bb50: 2c20 6361 7476 6172 7329 0a20 2020 2020  , catvars).     
-0000bb60: 2020 2020 2020 2063 6174 7661 7273 203d         catvars =
-0000bb70: 206c 6566 745f 7375 6274 7261 6374 2864   left_subtract(d
-0000bb80: 6174 616e 616d 652e 636f 6c75 6d6e 732e  ataname.columns.
-0000bb90: 746f 6c69 7374 2829 2c20 6e75 6d76 6172  tolist(), numvar
-0000bba0: 7329 0a20 2020 2020 2020 2020 2020 2063  s).            c
-0000bbb0: 6174 7661 7273 203d 206c 6566 745f 7375  atvars = left_su
-0000bbc0: 6274 7261 6374 2863 6174 7661 7273 2c20  btract(catvars, 
-0000bbd0: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
-0000bbe0: 2020 2020 7072 6564 7320 3d20 206c 6566      preds =  lef
-0000bbf0: 745f 7375 6274 7261 6374 2864 6174 616e  t_subtract(datan
-0000bc00: 616d 652e 636f 6c75 6d6e 732e 746f 6c69  ame.columns.toli
-0000bc10: 7374 2829 2c20 7461 7267 6574 290a 2020  st(), target).  
-0000bc20: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000bc30: 2074 6573 745f 6461 7461 2069 7320 4e6f   test_data is No
-0000bc40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000bc50: 2020 2020 7465 7374 5f64 6174 6120 3d20      test_data = 
-0000bc60: 4645 5f63 7265 6174 655f 696e 7465 7261  FE_create_intera
-0000bc70: 6374 696f 6e5f 7661 7273 2874 6573 745f  ction_vars(test_
-0000bc80: 6461 7461 2c20 6361 7476 6172 7329 0a20  data, catvars). 
-0000bc90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000bca0: 6573 7420 3d20 4645 5f63 7265 6174 655f  est = FE_create_
-0000bcb0: 696e 7465 7261 6374 696f 6e5f 7661 7273  interaction_vars
-0000bcc0: 2874 6573 742c 2063 6174 7661 7273 290a  (test, catvars).
-0000bcd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000bce0: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-0000bcf0: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-0000bd00: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
-0000bd10: 696e 7465 7261 6374 696f 6e73 2063 7265  interactions cre
-0000bd20: 6174 6564 2066 6f72 2063 6174 6567 6f72  ated for categor
-0000bd30: 6963 616c 2076 6172 7320 7369 6e63 6520  ical vars since 
-0000bd40: 6e75 6d62 6572 206c 6573 7320 7468 616e  number less than
-0000bd50: 2032 2729 0a20 2020 2065 6c73 653a 0a20   2').    else:. 
-0000bd60: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-0000bd70: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0000bd80: 7269 6e74 2827 4e6f 2069 6e74 6572 6163  rint('No interac
-0000bd90: 7469 6f6e 7320 6372 6561 7465 6420 666f  tions created fo
-0000bda0: 7220 6361 7465 676f 7269 6361 6c20 7661  r categorical va
-0000bdb0: 7273 2073 696e 6365 2066 6561 7475 7265  rs since feature
-0000bdc0: 2065 6e67 6720 646f 6573 206e 6f74 2073   engg does not s
-0000bdd0: 7065 6369 6679 2069 7427 290a 2020 2020  pecify it').    
-0000bde0: 2323 2323 2320 4e6f 7720 7765 206e 6565  ##### Now we nee
-0000bdf0: 6420 746f 2072 652d 7365 7420 7468 6520  d to re-set the 
-0000be00: 6361 7476 6172 7320 6167 6169 6e20 7369  catvars again si
-0000be10: 6e63 6520 7765 2068 6176 6520 6372 6561  nce we have crea
-0000be20: 7465 6420 6e65 7720 6665 6174 7572 6573  ted new features
-0000be30: 2023 2323 2323 0a20 2020 2072 656d 5f76   #####.    rem_v
-0000be40: 6172 7320 3d20 636f 7079 2e64 6565 7063  ars = copy.deepc
-0000be50: 6f70 7928 6361 7476 6172 7329 0a20 2020  opy(catvars).   
-0000be60: 2023 2323 2323 2323 2323 2320 4e6f 7720   ########## Now 
-0000be70: 7765 206e 6565 6420 746f 2073 656c 6563  we need to selec
-0000be80: 7420 7468 6520 7269 6768 7420 6d6f 6465  t the right mode
-0000be90: 6c20 746f 2072 756e 2072 6570 6561 7465  l to run repeate
-0000bea0: 646c 7920 2323 2323 0a20 2020 2069 6620  dly ####.    if 
-0000beb0: 7365 7474 696e 6773 2e6d 6f64 656c 7479  settings.modelty
-0000bec0: 7065 2021 3d20 2752 6567 7265 7373 696f  pe != 'Regressio
-0000bed0: 6e27 3a0a 2020 2020 2020 2020 2323 2323  n':.        ####
-0000bee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ad10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ad20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ad30: 2323 2323 2323 2323 0a20 2020 2064 6174  ########.    dat
+0000ad40: 655f 636f 6c73 203d 2066 6561 7475 7265  e_cols = feature
+0000ad50: 735f 6469 6374 5b27 6461 7465 5f76 6172  s_dict['date_var
+0000ad60: 7327 5d0a 2020 2020 6966 206c 656e 2866  s'].    if len(f
+0000ad70: 6561 7475 7265 735f 6469 6374 5b27 6461  eatures_dict['da
+0000ad80: 7465 5f76 6172 7327 5d29 203e 2030 3a0a  te_vars']) > 0:.
+0000ad90: 2020 2020 2020 2020 6461 7465 5f74 696d          date_tim
+0000ada0: 655f 7661 7273 203d 2063 6f70 792e 6465  e_vars = copy.de
+0000adb0: 6570 636f 7079 2864 6174 655f 636f 6c73  epcopy(date_cols
+0000adc0: 290a 2020 2020 2020 2020 2323 2323 2044  ).        #### D
+0000add0: 6f20 7468 6973 206f 6e6c 7920 6966 2064  o this only if d
+0000ade0: 6174 6520 7469 6d65 2063 6f6c 756d 6e73  ate time columns
+0000adf0: 2065 7869 7374 2069 6e20 796f 7572 2064   exist in your d
+0000ae00: 6174 6120 7365 7421 0a20 2020 2020 2020  ata set!.       
+0000ae10: 2064 6174 655f 636f 6c5f 6d61 7070 6572   date_col_mapper
+0000ae20: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+0000ae30: 6f72 2064 6174 655f 636f 6c20 696e 2064  or date_col in d
+0000ae40: 6174 655f 636f 6c73 3a0a 2020 2020 2020  ate_cols:.      
+0000ae50: 2020 2020 2020 7072 696e 7428 2750 726f        print('Pro
+0000ae60: 6365 7373 696e 6720 2573 2063 6f6c 756d  cessing %s colum
+0000ae70: 6e20 666f 7220 6461 7465 2074 696d 6520  n for date time 
+0000ae80: 6665 6174 7572 6573 2e2e 2e2e 2720 2564  features....' %d
+0000ae90: 6174 655f 636f 6c29 0a20 2020 2020 2020  ate_col).       
+0000aea0: 2020 2020 2064 6174 616e 616d 652c 2074       dataname, t
+0000aeb0: 735f 6164 6473 203d 2046 455f 6372 6561  s_adds = FE_crea
+0000aec0: 7465 5f74 696d 655f 7365 7269 6573 5f66  te_time_series_f
+0000aed0: 6561 7475 7265 7328 6461 7461 6e61 6d65  eatures(dataname
+0000aee0: 2c20 6461 7465 5f63 6f6c 290a 2020 2020  , date_col).    
+0000aef0: 2020 2020 2020 2020 6461 7465 5f63 6f6c          date_col
+0000af00: 5f6d 6170 7065 7220 3d20 6469 6374 285b  _mapper = dict([
+0000af10: 2878 2c64 6174 655f 636f 6c29 2066 6f72  (x,date_col) for
+0000af20: 2078 2069 6e20 7473 5f61 6464 735d 290a   x in ts_adds]).
+0000af30: 2020 2020 2020 2020 2020 2020 6461 7465              date
+0000af40: 5f63 6f6c 5f6d 6170 7065 7273 2e75 7064  _col_mappers.upd
+0000af50: 6174 6528 6461 7465 5f63 6f6c 5f6d 6170  ate(date_col_map
+0000af60: 7065 7229 0a20 2020 2020 2020 2020 2020  per).           
+0000af70: 2023 7072 696e 7428 2720 2020 2041 6464   #print('    Add
+0000af80: 696e 6720 2564 2063 6f6c 756d 6e28 7329  ing %d column(s)
+0000af90: 2066 726f 6d20 6461 7465 2d74 696d 6520   from date-time 
+0000afa0: 636f 6c75 6d6e 2025 7320 696e 2074 7261  column %s in tra
+0000afb0: 696e 2720 2528 6c65 6e28 6461 7465 5f63  in' %(len(date_c
+0000afc0: 6f6c 5f61 6464 735f 7472 6169 6e29 2c64  ol_adds_train),d
+0000afd0: 6174 655f 636f 6c29 290a 2020 2020 2020  ate_col)).      
+0000afe0: 2020 2020 2020 2374 7261 696e 203d 2074        #train = t
+0000aff0: 7261 696e 2e6a 6f69 6e28 6461 7465 5f64  rain.join(date_d
+0000b000: 665f 7472 6169 6e2c 2072 7375 6666 6978  f_train, rsuffix
+0000b010: 3d27 3227 290a 2020 2020 2020 2020 2020  ='2').          
+0000b020: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000b030: 7465 7374 5f64 6174 612c 7374 7229 206f  test_data,str) o
+0000b040: 7220 7465 7374 5f64 6174 6120 6973 204e  r test_data is N
+0000b050: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b060: 2020 2020 2023 2323 2064 6f20 6e6f 7468       ### do noth
+0000b070: 696e 6720 2323 2323 0a20 2020 2020 2020  ing ####.       
+0000b080: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+0000b090: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0b0: 7072 696e 7428 2720 2020 2020 2020 2041  print('        A
+0000b0c0: 6464 696e 6720 7361 6d65 2074 696d 6520  dding same time 
+0000b0d0: 7365 7269 6573 2066 6561 7475 7265 7320  series features 
+0000b0e0: 746f 2074 6573 7420 6461 7461 2e2e 2e27  to test data...'
+0000b0f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b100: 2020 7465 7374 5f64 6174 612c 205f 203d    test_data, _ =
+0000b110: 2046 455f 6372 6561 7465 5f74 696d 655f   FE_create_time_
+0000b120: 7365 7269 6573 5f66 6561 7475 7265 7328  series_features(
+0000b130: 7465 7374 5f64 6174 612c 2064 6174 655f  test_data, date_
+0000b140: 636f 6c2c 2074 735f 6164 6473 290a 2020  col, ts_adds).  
+0000b150: 2020 2020 2020 2020 2020 2020 2020 2364                #d
+0000b160: 6174 655f 636f 6c5f 6164 6473 5f74 6573  ate_col_adds_tes
+0000b170: 745f 6461 7461 203d 206c 6566 745f 7375  t_data = left_su
+0000b180: 6274 7261 6374 2864 6174 655f 6466 5f74  btract(date_df_t
+0000b190: 6573 742e 636f 6c75 6d6e 732e 746f 6c69  est.columns.toli
+0000b1a0: 7374 2829 2c64 6174 655f 636f 6c29 0a20  st(),date_col). 
+0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000b1c0: 2323 204e 6f77 2074 696d 6520 746f 2072  ## Now time to r
+0000b1d0: 656d 6f76 6520 7468 6520 6461 7465 2074  emove the date t
+0000b1e0: 696d 6520 636f 6c75 6d6e 2066 726f 6d20  ime column from 
+0000b1f0: 616c 6c20 6675 7274 6865 7220 7072 6f63  all further proc
+0000b200: 6573 7369 6e67 2023 230a 2020 2020 2020  essing ##.      
+0000b210: 2020 2020 2020 2020 2020 2374 6573 7420            #test 
+0000b220: 3d20 7465 7374 2e6a 6f69 6e28 6461 7465  = test.join(date
+0000b230: 5f64 665f 7465 7374 2c20 7273 7566 6669  _df_test, rsuffi
+0000b240: 783d 2732 2729 0a20 2020 2023 2323 204e  x='2').    ### N
+0000b250: 6f77 2074 696d 6520 746f 2063 6f6e 7469  ow time to conti
+0000b260: 6e75 6520 7769 7468 206f 7572 2066 7572  nue with our fur
+0000b270: 7468 6572 2070 726f 6365 7373 696e 6720  ther processing 
+0000b280: 2323 0a20 2020 2069 6463 6f6c 7320 3d20  ##.    idcols = 
+0000b290: 6665 6174 7572 6573 5f64 6963 745b 2749  features_dict['I
+0000b2a0: 4463 6f6c 7327 5d0a 2020 2020 6966 2069  Dcols'].    if i
+0000b2b0: 7369 6e73 7461 6e63 6528 7465 7374 5f64  sinstance(test_d
+0000b2c0: 6174 612c 7374 7229 206f 7220 7465 7374  ata,str) or test
+0000b2d0: 5f64 6174 6120 6973 204e 6f6e 653a 0a20  _data is None:. 
+0000b2e0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000b2f0: 656c 7365 3a0a 2020 2020 2020 2020 7465  else:.        te
+0000b300: 7374 5f69 6473 203d 2074 6573 745f 6461  st_ids = test_da
+0000b310: 7461 5b69 6463 6f6c 735d 0a20 2020 2074  ta[idcols].    t
+0000b320: 7261 696e 5f69 6473 203d 2064 6174 616e  rain_ids = datan
+0000b330: 616d 655b 6964 636f 6c73 5d20 2323 2320  ame[idcols] ### 
+0000b340: 7468 6973 2073 6176 6573 2074 6865 2049  this saves the I
+0000b350: 4420 636f 6c75 6d6e 7320 6f66 2064 6174  D columns of dat
+0000b360: 616e 616d 650a 2020 2020 6966 2063 6174  aname.    if cat
+0000b370: 5f76 6172 733a 0a20 2020 2020 2020 2063  _vars:.        c
+0000b380: 6f6c 735f 696e 5f62 6f74 6820 3d20 5b78  ols_in_both = [x
+0000b390: 2066 6f72 2078 2069 6e20 6361 745f 7661   for x in cat_va
+0000b3a0: 7273 2069 6620 7820 696e 2066 6561 7475  rs if x in featu
+0000b3b0: 7265 735f 6469 6374 5b27 636f 6c73 5f64  res_dict['cols_d
+0000b3c0: 656c 6574 6527 5d5d 0a20 2020 2020 2020  elete']].       
+0000b3d0: 2063 6174 5f76 6172 7320 3d20 6c65 6674   cat_vars = left
+0000b3e0: 5f73 7562 7472 6163 7428 6361 745f 7661  _subtract(cat_va
+0000b3f0: 7273 2c20 6665 6174 7572 6573 5f64 6963  rs, features_dic
+0000b400: 745b 2763 6f6c 735f 6465 6c65 7465 275d  t['cols_delete']
+0000b410: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0000b420: 2863 6f6c 735f 696e 5f62 6f74 6829 203e  (cols_in_both) >
+0000b430: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000b440: 7072 696e 7428 2752 656d 6f76 696e 6720  print('Removing 
+0000b450: 2573 2063 6f6c 756d 6e73 2873 2920 7768  %s columns(s) wh
+0000b460: 6963 6820 6172 6520 696e 2062 6f74 6820  ich are in both 
+0000b470: 636f 6c73 2074 6f20 6265 2064 656c 6574  cols to be delet
+0000b480: 6564 2061 6e64 2063 6174 2076 6172 7320  ed and cat vars 
+0000b490: 6769 7665 6e20 6173 2069 6e70 7574 2720  given as input' 
+0000b4a0: 2563 6f6c 735f 696e 5f62 6f74 6829 0a20  %cols_in_both). 
+0000b4b0: 2020 2063 6f6c 735f 746f 5f72 656d 6f76     cols_to_remov
+0000b4c0: 6520 3d20 6665 6174 7572 6573 5f64 6963  e = features_dic
+0000b4d0: 745b 2763 6f6c 735f 6465 6c65 7465 275d  t['cols_delete']
+0000b4e0: 202b 2069 6463 6f6c 7320 2b20 6665 6174   + idcols + feat
+0000b4f0: 7572 6573 5f64 6963 745b 2764 6973 6372  ures_dict['discr
+0000b500: 6574 655f 7374 7269 6e67 5f76 6172 7327  ete_string_vars'
+0000b510: 5d0a 2020 2020 7072 696e 7428 2752 656d  ].    print('Rem
+0000b520: 6f76 696e 6720 2564 2063 6f6c 756d 6e73  oving %d columns
+0000b530: 2066 726f 6d20 6675 7274 6865 7220 7072   from further pr
+0000b540: 6f63 6573 7369 6e67 2073 696e 6365 2049  ocessing since I
+0000b550: 4420 6f72 206c 6f77 2069 6e66 6f72 6d61  D or low informa
+0000b560: 7469 6f6e 2076 6172 6961 626c 6573 2720  tion variables' 
+0000b570: 256c 656e 2863 6f6c 735f 746f 5f72 656d  %len(cols_to_rem
+0000b580: 6f76 6529 290a 2020 2020 7072 6564 7320  ove)).    preds 
+0000b590: 3d20 5b78 2066 6f72 2078 2069 6e20 6c69  = [x for x in li
+0000b5a0: 7374 2864 6174 616e 616d 6529 2069 6620  st(dataname) if 
+0000b5b0: 7820 6e6f 7420 696e 2074 6172 6765 742b  x not in target+
+0000b5c0: 636f 6c73 5f74 6f5f 7265 6d6f 7665 5d0a  cols_to_remove].
+0000b5d0: 2020 2020 2323 2320 2020 5468 6973 2069      ###   This i
+0000b5e0: 7320 7768 6572 6520 7765 2073 6f72 7420  s where we sort 
+0000b5f0: 7468 6520 636f 6c75 6d6e 7320 746f 206d  the columns to m
+0000b600: 616b 6520 7375 7265 2074 6861 7420 7468  ake sure that th
+0000b610: 6520 6f72 6465 7220 6f66 2063 6f6c 756d  e order of colum
+0000b620: 6e73 2064 6f65 736e 2774 206d 6174 7465  ns doesn't matte
+0000b630: 7220 696e 2073 656c 6563 7469 6f6e 2023  r in selection #
+0000b640: 2323 2323 2323 2323 2323 0a20 2020 2023  ##########.    #
+0000b650: 7072 6564 7320 3d20 6e70 2e73 6f72 7428  preds = np.sort(
+0000b660: 7072 6564 7329 0a20 2020 2069 6620 7665  preds).    if ve
+0000b670: 7262 6f73 653a 0a20 2020 2020 2020 2070  rbose:.        p
+0000b680: 7269 6e74 2827 2020 2020 4166 7465 7220  rint('    After 
+0000b690: 7265 6d6f 7669 6e67 2072 6564 756e 6461  removing redunda
+0000b6a0: 6e74 2076 6172 6961 626c 6573 2066 726f  nt variables fro
+0000b6b0: 6d20 6675 7274 6865 7220 7072 6f63 6573  m further proces
+0000b6c0: 7369 6e67 2c20 6665 6174 7572 6573 206c  sing, features l
+0000b6d0: 6566 7420 3d20 2564 2720 256c 656e 2870  eft = %d' %len(p
+0000b6e0: 7265 6473 2929 0a20 2020 206e 756d 7661  reds)).    numva
+0000b6f0: 7273 203d 2064 6174 616e 616d 655b 7072  rs = dataname[pr
+0000b700: 6564 735d 2e73 656c 6563 745f 6474 7970  eds].select_dtyp
+0000b710: 6573 2869 6e63 6c75 6465 203d 2027 6e75  es(include = 'nu
+0000b720: 6d62 6572 2729 2e63 6f6c 756d 6e73 2e74  mber').columns.t
+0000b730: 6f6c 6973 7428 290a 2020 2020 6966 206c  olist().    if l
+0000b740: 656e 286e 756d 7661 7273 2920 3e20 6d61  en(numvars) > ma
+0000b750: 785f 6e75 6d73 3a0a 2020 2020 2020 2020  x_nums:.        
+0000b760: 6966 2066 6561 7475 7265 5f67 656e 3a0a  if feature_gen:.
+0000b770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000b780: 7428 275c 6e57 6172 6e69 6e67 3a20 546f  t('\nWarning: To
+0000b790: 6f20 6d61 6e79 2065 7874 7261 2066 6561  o many extra fea
+0000b7a0: 7475 7265 7320 7769 6c6c 2062 6520 6765  tures will be ge
+0000b7b0: 6e65 7261 7465 6420 6279 2066 6561 7475  nerated by featu
+0000b7c0: 7265 7769 7a2e 2054 6869 7320 6d61 7920  rewiz. This may 
+0000b7d0: 7461 6b65 2074 696d 652e 2e2e 2729 0a20  take time...'). 
+0000b7e0: 2020 2069 6620 6361 745f 7661 7273 3a0a     if cat_vars:.
+0000b7f0: 2020 2020 2020 2020 2323 2320 6966 2069          ### if i
+0000b800: 6e70 7574 2069 7320 6769 7665 6e20 666f  nput is given fo
+0000b810: 7220 6361 745f 7661 7273 2c20 7573 6520  r cat_vars, use 
+0000b820: 6974 210a 2020 2020 2020 2020 6361 7476  it!.        catv
+0000b830: 6172 7320 3d20 636f 7079 2e64 6565 7063  ars = copy.deepc
+0000b840: 6f70 7928 6361 745f 7661 7273 290a 2020  opy(cat_vars).  
+0000b850: 2020 2020 2020 6e75 6d76 6172 7320 3d20        numvars = 
+0000b860: 6c65 6674 5f73 7562 7472 6163 7428 7072  left_subtract(pr
+0000b870: 6564 732c 2063 6174 7661 7273 290a 2020  eds, catvars).  
+0000b880: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000b890: 6361 7476 6172 7320 3d20 6c65 6674 5f73  catvars = left_s
+0000b8a0: 7562 7472 6163 7428 7072 6564 732c 206e  ubtract(preds, n
+0000b8b0: 756d 7661 7273 290a 2020 2020 6966 206c  umvars).    if l
+0000b8c0: 656e 2863 6174 7661 7273 2920 3e20 6d61  en(catvars) > ma
+0000b8d0: 785f 6361 7473 3a0a 2020 2020 2020 2020  x_cats:.        
+0000b8e0: 6966 2066 6561 7475 7265 5f74 7970 653a  if feature_type:
+0000b8f0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000b900: 6e74 2827 5c6e 5761 726e 696e 673a 2054  nt('\nWarning: T
+0000b910: 6f6f 206d 616e 7920 6578 7472 6120 6665  oo many extra fe
+0000b920: 6174 7572 6573 2077 696c 6c20 6265 2067  atures will be g
+0000b930: 656e 6572 6174 6564 2062 7920 6361 7465  enerated by cate
+0000b940: 676f 7279 2065 6e63 6f64 696e 672e 2054  gory encoding. T
+0000b950: 6869 7320 6d61 7920 7461 6b65 2074 696d  his may take tim
+0000b960: 652e 2e2e 2729 0a20 2020 2023 2323 2323  e...').    #####
+0000b970: 2320 2020 4320 5220 4520 4120 5420 4920  #   C R E A T I 
+0000b980: 4e20 4720 2020 2049 204e 2054 2058 204e  N G    I N T X N
+0000b990: 2020 5620 4120 5220 5320 2020 4620 5220    V A R S   F R 
+0000b9a0: 4f20 4d20 2020 4320 4120 5420 2056 2041  O M   C A T  V A
+0000b9b0: 2052 2053 2023 2323 2323 2323 2323 2323   R S ###########
+0000b9c0: 2323 2323 2323 2323 2323 0a20 2020 2069  ##########.    i
+0000b9d0: 6620 6e70 2e77 6865 7265 2827 696e 7465  f np.where('inte
+0000b9e0: 7261 6374 696f 6e73 2720 696e 2066 6561  ractions' in fea
+0000b9f0: 7475 7265 5f67 656e 2c54 7275 652c 2046  ture_gen,True, F
+0000ba00: 616c 7365 292e 746f 6c69 7374 2829 3a0a  alse).tolist():.
+0000ba10: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+0000ba20: 6174 7661 7273 2920 3e20 313a 0a20 2020  atvars) > 1:.   
+0000ba30: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0000ba40: 2020 2020 2020 6e75 6d5f 636f 6d62 6f73        num_combos
+0000ba50: 203d 206c 656e 286c 6973 7428 636f 6d62   = len(list(comb
+0000ba60: 696e 6174 696f 6e73 2863 6174 7661 7273  inations(catvars
+0000ba70: 2c32 2929 290a 2020 2020 2020 2020 2020  ,2))).          
+0000ba80: 2020 7072 696e 7428 2741 6464 696e 6720    print('Adding 
+0000ba90: 2573 2069 6e74 6572 6163 7469 6f6e 7320  %s interactions 
+0000baa0: 6265 7477 6565 6e20 6361 7465 676f 7269  between categori
+0000bab0: 6361 6c5f 7661 7273 2025 732e 2e2e 2720  cal_vars %s...' 
+0000bac0: 2528 0a20 2020 2020 2020 2020 2020 2020  %(.             
+0000bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bae0: 2020 206e 756d 5f63 6f6d 626f 732c 2063     num_combos, c
+0000baf0: 6174 7661 7273 2929 0a20 2020 2020 2020  atvars)).       
+0000bb00: 2020 2020 2064 6174 616e 616d 6520 3d20       dataname = 
+0000bb10: 4645 5f63 7265 6174 655f 696e 7465 7261  FE_create_intera
+0000bb20: 6374 696f 6e5f 7661 7273 2864 6174 616e  ction_vars(datan
+0000bb30: 616d 652c 2063 6174 7661 7273 290a 2020  ame, catvars).  
+0000bb40: 2020 2020 2020 2020 2020 7472 6169 6e20            train 
+0000bb50: 3d20 4645 5f63 7265 6174 655f 696e 7465  = FE_create_inte
+0000bb60: 7261 6374 696f 6e5f 7661 7273 2874 7261  raction_vars(tra
+0000bb70: 696e 2c20 6361 7476 6172 7329 0a20 2020  in, catvars).   
+0000bb80: 2020 2020 2020 2020 2063 6174 7661 7273           catvars
+0000bb90: 203d 206c 6566 745f 7375 6274 7261 6374   = left_subtract
+0000bba0: 2864 6174 616e 616d 652e 636f 6c75 6d6e  (dataname.column
+0000bbb0: 732e 746f 6c69 7374 2829 2c20 6e75 6d76  s.tolist(), numv
+0000bbc0: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
+0000bbd0: 2063 6174 7661 7273 203d 206c 6566 745f   catvars = left_
+0000bbe0: 7375 6274 7261 6374 2863 6174 7661 7273  subtract(catvars
+0000bbf0: 2c20 7461 7267 6574 290a 2020 2020 2020  , target).      
+0000bc00: 2020 2020 2020 7072 6564 7320 3d20 206c        preds =  l
+0000bc10: 6566 745f 7375 6274 7261 6374 2864 6174  eft_subtract(dat
+0000bc20: 616e 616d 652e 636f 6c75 6d6e 732e 746f  aname.columns.to
+0000bc30: 6c69 7374 2829 2c20 7461 7267 6574 290a  list(), target).
+0000bc40: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000bc50: 6f74 2074 6573 745f 6461 7461 2069 7320  ot test_data is 
+0000bc60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000bc70: 2020 2020 2020 7465 7374 5f64 6174 6120        test_data 
+0000bc80: 3d20 4645 5f63 7265 6174 655f 696e 7465  = FE_create_inte
+0000bc90: 7261 6374 696f 6e5f 7661 7273 2874 6573  raction_vars(tes
+0000bca0: 745f 6461 7461 2c20 6361 7476 6172 7329  t_data, catvars)
+0000bcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bcc0: 2074 6573 7420 3d20 4645 5f63 7265 6174   test = FE_creat
+0000bcd0: 655f 696e 7465 7261 6374 696f 6e5f 7661  e_interaction_va
+0000bce0: 7273 2874 6573 742c 2063 6174 7661 7273  rs(test, catvars
+0000bcf0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000bd00: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0000bd10: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0000bd20: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
+0000bd30: 6f20 696e 7465 7261 6374 696f 6e73 2063  o interactions c
+0000bd40: 7265 6174 6564 2066 6f72 2063 6174 6567  reated for categ
+0000bd50: 6f72 6963 616c 2076 6172 7320 7369 6e63  orical vars sinc
+0000bd60: 6520 6e75 6d62 6572 206c 6573 7320 7468  e number less th
+0000bd70: 616e 2032 2729 0a20 2020 2065 6c73 653a  an 2').    else:
+0000bd80: 0a20 2020 2020 2020 2069 6620 7665 7262  .        if verb
+0000bd90: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
+0000bda0: 2070 7269 6e74 2827 4e6f 2069 6e74 6572   print('No inter
+0000bdb0: 6163 7469 6f6e 7320 6372 6561 7465 6420  actions created 
+0000bdc0: 666f 7220 6361 7465 676f 7269 6361 6c20  for categorical 
+0000bdd0: 7661 7273 2073 696e 6365 2066 6561 7475  vars since featu
+0000bde0: 7265 2065 6e67 6720 646f 6573 206e 6f74  re engg does not
+0000bdf0: 2073 7065 6369 6679 2069 7427 290a 2020   specify it').  
+0000be00: 2020 2323 2323 2320 4e6f 7720 7765 206e    ##### Now we n
+0000be10: 6565 6420 746f 2072 652d 7365 7420 7468  eed to re-set th
+0000be20: 6520 6361 7476 6172 7320 6167 6169 6e20  e catvars again 
+0000be30: 7369 6e63 6520 7765 2068 6176 6520 6372  since we have cr
+0000be40: 6561 7465 6420 6e65 7720 6665 6174 7572  eated new featur
+0000be50: 6573 2023 2323 2323 0a20 2020 2072 656d  es #####.    rem
+0000be60: 5f76 6172 7320 3d20 636f 7079 2e64 6565  _vars = copy.dee
+0000be70: 7063 6f70 7928 6361 7476 6172 7329 0a20  pcopy(catvars). 
+0000be80: 2020 2023 2323 2323 2323 2323 2320 4e6f     ########## No
+0000be90: 7720 7765 206e 6565 6420 746f 2073 656c  w we need to sel
+0000bea0: 6563 7420 7468 6520 7269 6768 7420 6d6f  ect the right mo
+0000beb0: 6465 6c20 746f 2072 756e 2072 6570 6561  del to run repea
+0000bec0: 7465 646c 7920 2323 2323 0a20 2020 2069  tedly ####.    i
+0000bed0: 6620 7365 7474 696e 6773 2e6d 6f64 656c  f settings.model
+0000bee0: 7479 7065 2021 3d20 2752 6567 7265 7373  type != 'Regress
+0000bef0: 696f 6e27 3a0a 2020 2020 2020 2020 2323  ion':.        ##
 0000bf00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000bf10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bf20: 2323 2323 2323 0a20 2020 2020 2020 2023  ######.        #
-0000bf30: 2323 2323 2323 2323 2323 2020 204c 2041  ##########   L A
-0000bf40: 2042 2045 204c 2020 2020 4520 4e20 4320   B E L    E N C 
-0000bf50: 4f20 4420 4920 4e20 4720 2020 4f20 4620  O D I N G   O F 
-0000bf60: 2020 5420 4120 5220 4720 4520 5420 2020    T A R G E T   
-0000bf70: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
-0000bf80: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0000bf90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bfa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bf20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bf30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bf40: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
+0000bf50: 2023 2323 2323 2323 2323 2323 2020 204c   ###########   L
+0000bf60: 2041 2042 2045 204c 2020 2020 4520 4e20   A B E L    E N 
+0000bf70: 4320 4f20 4420 4920 4e20 4720 2020 4f20  C O D I N G   O 
+0000bf80: 4620 2020 5420 4120 5220 4720 4520 5420  F   T A R G E T 
+0000bf90: 2020 2323 2323 2323 2323 230a 2020 2020    #########.    
+0000bfa0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
 0000bfb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000bfc0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-0000bfd0: 2020 2020 2023 2323 2054 6869 7320 6973       ### This is
-0000bfe0: 2074 6f20 636f 6e76 6572 7420 7468 6520   to convert the 
-0000bff0: 7461 7267 6574 206c 6162 656c 7320 746f  target labels to
-0000c000: 2070 726f 7065 7220 6e75 6d65 7269 6320   proper numeric 
-0000c010: 636f 6c75 6d6e 7320 2323 2323 2323 0a20  columns ######. 
-0000c020: 2020 2020 2020 2074 6172 6765 745f 636f         target_co
-0000c030: 6e76 6572 7369 6f6e 5f66 6c61 6720 3d20  nversion_flag = 
-0000c040: 4661 6c73 650a 2020 2020 2020 2020 6361  False.        ca
-0000c050: 745f 7461 7267 6574 7320 3d20 6461 7461  t_targets = data
-0000c060: 6e61 6d65 5b74 6172 6765 745d 2e73 656c  name[target].sel
-0000c070: 6563 745f 6474 7970 6573 2869 6e63 6c75  ect_dtypes(inclu
-0000c080: 6465 3d27 6f62 6a65 6374 2729 2e63 6f6c  de='object').col
-0000c090: 756d 6e73 2e74 6f6c 6973 7428 2920 2b20  umns.tolist() + 
-0000c0a0: 6461 7461 6e61 6d65 5b74 6172 6765 745d  dataname[target]
-0000c0b0: 2e73 656c 6563 745f 6474 7970 6573 2869  .select_dtypes(i
-0000c0c0: 6e63 6c75 6465 3d27 6361 7465 676f 7279  nclude='category
-0000c0d0: 2729 2e63 6f6c 756d 6e73 2e74 6f6c 6973  ').columns.tolis
-0000c0e0: 7428 290a 2020 2020 2020 2020 636f 7079  t().        copy
-0000c0f0: 5f74 6172 6765 7473 203d 2063 6f70 792e  _targets = copy.
-0000c100: 6465 6570 636f 7079 2874 6172 6765 7473  deepcopy(targets
-0000c110: 290a 2020 2020 2020 2020 666f 7220 6561  ).        for ea
-0000c120: 6368 5f74 6172 6765 7420 696e 2063 6f70  ch_target in cop
-0000c130: 795f 7461 7267 6574 733a 0a20 2020 2020  y_targets:.     
-0000c140: 2020 2020 2020 2020 2020 2069 6620 6361             if ca
-0000c150: 745f 7461 7267 6574 7320 6f72 2073 6f72  t_targets or sor
-0000c160: 7465 6428 6e70 2e75 6e69 7175 6528 6461  ted(np.unique(da
-0000c170: 7461 6e61 6d65 5b65 6163 685f 7461 7267  taname[each_targ
-0000c180: 6574 5d2e 7661 6c75 6573 2929 5b30 5d20  et].values))[0] 
-0000c190: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
-0000c1a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000c1b0: 2720 2020 2074 6172 6765 7420 6c61 6265  '    target labe
-0000c1c0: 6c73 206e 6565 6420 746f 2062 6520 636f  ls need to be co
-0000c1d0: 6e76 6572 7465 642e 2e2e 2729 0a20 2020  nverted...').   
-0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1f0: 2074 6172 6765 745f 636f 6e76 6572 7369   target_conversi
-0000c200: 6f6e 5f66 6c61 6720 3d20 5472 7565 0a20  on_flag = True. 
-0000c210: 2020 2020 2020 2023 2323 2063 6865 636b         ### check
-0000c220: 2069 6620 7468 6579 2061 7265 206e 6f74   if they are not
-0000c230: 2073 7461 7274 696e 6720 6672 6f6d 207a   starting from z
-0000c240: 6572 6f20 2323 2323 2323 2323 2323 2323  ero ############
-0000c250: 2323 2323 2323 0a20 2020 2020 2020 2063  ######.        c
-0000c260: 6f70 795f 7461 7267 6574 7320 3d20 636f  opy_targets = co
-0000c270: 7079 2e64 6565 7063 6f70 7928 7461 7267  py.deepcopy(targ
-0000c280: 6574 290a 2020 2020 2020 2020 666f 7220  et).        for 
-0000c290: 6561 6368 5f74 6172 6765 7420 696e 2063  each_target in c
-0000c2a0: 6f70 795f 7461 7267 6574 733a 0a20 2020  opy_targets:.   
-0000c2b0: 2020 2020 2020 2020 2069 6620 7461 7267           if targ
-0000c2c0: 6574 5f63 6f6e 7665 7273 696f 6e5f 666c  et_conversion_fl
-0000c2d0: 6167 3a0a 2020 2020 2020 2020 2020 2020  ag:.            
-0000c2e0: 2020 2020 6d6c 6220 3d20 4d79 5f4c 6162      mlb = My_Lab
-0000c2f0: 656c 456e 636f 6465 7228 290a 2020 2020  elEncoder().    
-0000c300: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000c310: 6e61 6d65 5b65 6163 685f 7461 7267 6574  name[each_target
-0000c320: 5d20 3d20 6d6c 622e 6669 745f 7472 616e  ] = mlb.fit_tran
-0000c330: 7366 6f72 6d28 6461 7461 6e61 6d65 5b65  sform(dataname[e
-0000c340: 6163 685f 7461 7267 6574 5d29 0a20 2020  ach_target]).   
-0000c350: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0000c360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c370: 2020 2020 2020 2323 2041 6674 6572 2063        ## After c
-0000c380: 6f6e 7665 7274 696e 6720 7472 6169 6e2c  onverting train,
-0000c390: 206a 7573 7420 6c6f 6164 2069 7420 696e   just load it in
-0000c3a0: 746f 2064 6173 6b20 6167 6169 6e20 2323  to dask again ##
-0000c3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c3c0: 2020 2020 2074 7261 696e 5b65 6163 685f       train[each_
-0000c3d0: 7461 7267 6574 5d20 3d20 6464 2e66 726f  target] = dd.fro
-0000c3e0: 6d5f 7061 6e64 6173 2864 6174 616e 616d  m_pandas(datanam
-0000c3f0: 655b 6561 6368 5f74 6172 6765 745d 2c20  e[each_target], 
-0000c400: 6e70 6172 7469 7469 6f6e 733d 6e5f 776f  npartitions=n_wo
-0000c410: 726b 6572 7329 0a20 2020 2020 2020 2020  rkers).         
-0000c420: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c440: 2020 2070 7269 6e74 2827 436f 756c 6420     print('Could 
-0000c450: 6e6f 7420 636f 6e76 6572 7420 6461 736b  not convert dask
-0000c460: 2064 6174 6166 7261 6d65 2074 6172 6765   dataframe targe
-0000c470: 7420 696e 746f 206e 756d 6572 6963 2e20  t into numeric. 
-0000c480: 4368 6563 6b20 796f 7572 2069 6e70 7574  Check your input
-0000c490: 2e20 436f 6e74 696e 7569 6e67 2e2e 2e27  . Continuing...'
-0000c4a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c4b0: 2020 6966 2074 6573 745f 6461 7461 2069    if test_data i
-0000c4c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4e0: 6966 2065 6163 685f 7461 7267 6574 2069  if each_target i
-0000c4f0: 6e20 7465 7374 5f64 6174 612e 636f 6c75  n test_data.colu
-0000c500: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
-0000c510: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-0000c520: 745f 6461 7461 5b65 6163 685f 7461 7267  t_data[each_targ
-0000c530: 6574 5d20 3d20 6d6c 622e 7472 616e 7366  et] = mlb.transf
-0000c540: 6f72 6d28 7465 7374 5f64 6174 615b 6561  orm(test_data[ea
-0000c550: 6368 5f74 6172 6765 745d 290a 2020 2020  ch_target]).    
-0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c570: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000bfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bfe0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+0000bff0: 2020 2020 2020 2023 2323 2054 6869 7320         ### This 
+0000c000: 6973 2074 6f20 636f 6e76 6572 7420 7468  is to convert th
+0000c010: 6520 7461 7267 6574 206c 6162 656c 7320  e target labels 
+0000c020: 746f 2070 726f 7065 7220 6e75 6d65 7269  to proper numeri
+0000c030: 6320 636f 6c75 6d6e 7320 2323 2323 2323  c columns ######
+0000c040: 0a20 2020 2020 2020 2074 6172 6765 745f  .        target_
+0000c050: 636f 6e76 6572 7369 6f6e 5f66 6c61 6720  conversion_flag 
+0000c060: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000c070: 6361 745f 7461 7267 6574 7320 3d20 6461  cat_targets = da
+0000c080: 7461 6e61 6d65 5b74 6172 6765 745d 2e73  taname[target].s
+0000c090: 656c 6563 745f 6474 7970 6573 2869 6e63  elect_dtypes(inc
+0000c0a0: 6c75 6465 3d27 6f62 6a65 6374 2729 2e63  lude='object').c
+0000c0b0: 6f6c 756d 6e73 2e74 6f6c 6973 7428 2920  olumns.tolist() 
+0000c0c0: 2b20 6461 7461 6e61 6d65 5b74 6172 6765  + dataname[targe
+0000c0d0: 745d 2e73 656c 6563 745f 6474 7970 6573  t].select_dtypes
+0000c0e0: 2869 6e63 6c75 6465 3d27 6361 7465 676f  (include='catego
+0000c0f0: 7279 2729 2e63 6f6c 756d 6e73 2e74 6f6c  ry').columns.tol
+0000c100: 6973 7428 290a 2020 2020 2020 2020 636f  ist().        co
+0000c110: 7079 5f74 6172 6765 7473 203d 2063 6f70  py_targets = cop
+0000c120: 792e 6465 6570 636f 7079 2874 6172 6765  y.deepcopy(targe
+0000c130: 7473 290a 2020 2020 2020 2020 666f 7220  ts).        for 
+0000c140: 6561 6368 5f74 6172 6765 7420 696e 2063  each_target in c
+0000c150: 6f70 795f 7461 7267 6574 733a 0a20 2020  opy_targets:.   
+0000c160: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000c170: 6361 745f 7461 7267 6574 7320 6f72 2073  cat_targets or s
+0000c180: 6f72 7465 6428 6e70 2e75 6e69 7175 6528  orted(np.unique(
+0000c190: 6461 7461 6e61 6d65 5b65 6163 685f 7461  dataname[each_ta
+0000c1a0: 7267 6574 5d2e 7661 6c75 6573 2929 5b30  rget].values))[0
+0000c1b0: 5d20 213d 2030 3a0a 2020 2020 2020 2020  ] != 0:.        
+0000c1c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000c1d0: 7428 2720 2020 2074 6172 6765 7420 6c61  t('    target la
+0000c1e0: 6265 6c73 206e 6565 6420 746f 2062 6520  bels need to be 
+0000c1f0: 636f 6e76 6572 7465 642e 2e2e 2729 0a20  converted...'). 
+0000c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c210: 2020 2074 6172 6765 745f 636f 6e76 6572     target_conver
+0000c220: 7369 6f6e 5f66 6c61 6720 3d20 5472 7565  sion_flag = True
+0000c230: 0a20 2020 2020 2020 2023 2323 2063 6865  .        ### che
+0000c240: 636b 2069 6620 7468 6579 2061 7265 206e  ck if they are n
+0000c250: 6f74 2073 7461 7274 696e 6720 6672 6f6d  ot starting from
+0000c260: 207a 6572 6f20 2323 2323 2323 2323 2323   zero ##########
+0000c270: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
+0000c280: 2063 6f70 795f 7461 7267 6574 7320 3d20   copy_targets = 
+0000c290: 636f 7079 2e64 6565 7063 6f70 7928 7461  copy.deepcopy(ta
+0000c2a0: 7267 6574 290a 2020 2020 2020 2020 666f  rget).        fo
+0000c2b0: 7220 6561 6368 5f74 6172 6765 7420 696e  r each_target in
+0000c2c0: 2063 6f70 795f 7461 7267 6574 733a 0a20   copy_targets:. 
+0000c2d0: 2020 2020 2020 2020 2020 2069 6620 7461             if ta
+0000c2e0: 7267 6574 5f63 6f6e 7665 7273 696f 6e5f  rget_conversion_
+0000c2f0: 666c 6167 3a0a 2020 2020 2020 2020 2020  flag:.          
+0000c300: 2020 2020 2020 6d6c 6220 3d20 4d79 5f4c        mlb = My_L
+0000c310: 6162 656c 456e 636f 6465 7228 290a 2020  abelEncoder().  
+0000c320: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0000c330: 7461 6e61 6d65 5b65 6163 685f 7461 7267  taname[each_targ
+0000c340: 6574 5d20 3d20 6d6c 622e 6669 745f 7472  et] = mlb.fit_tr
+0000c350: 616e 7366 6f72 6d28 6461 7461 6e61 6d65  ansform(dataname
+0000c360: 5b65 6163 685f 7461 7267 6574 5d29 0a20  [each_target]). 
+0000c370: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000c380: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000c390: 2020 2020 2020 2020 2323 2041 6674 6572          ## After
+0000c3a0: 2063 6f6e 7665 7274 696e 6720 7472 6169   converting trai
+0000c3b0: 6e2c 206a 7573 7420 6c6f 6164 2069 7420  n, just load it 
+0000c3c0: 696e 746f 2064 6173 6b20 6167 6169 6e20  into dask again 
+0000c3d0: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
+0000c3e0: 2020 2020 2020 2074 7261 696e 5b65 6163         train[eac
+0000c3f0: 685f 7461 7267 6574 5d20 3d20 6464 2e66  h_target] = dd.f
+0000c400: 726f 6d5f 7061 6e64 6173 2864 6174 616e  rom_pandas(datan
+0000c410: 616d 655b 6561 6368 5f74 6172 6765 745d  ame[each_target]
+0000c420: 2c20 6e70 6172 7469 7469 6f6e 733d 6e5f  , npartitions=n_
+0000c430: 776f 726b 6572 7329 0a20 2020 2020 2020  workers).       
+0000c440: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+0000c450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c460: 2020 2020 2070 7269 6e74 2827 436f 756c       print('Coul
+0000c470: 6420 6e6f 7420 636f 6e76 6572 7420 6461  d not convert da
+0000c480: 736b 2064 6174 6166 7261 6d65 2074 6172  sk dataframe tar
+0000c490: 6765 7420 696e 746f 206e 756d 6572 6963  get into numeric
+0000c4a0: 2e20 4368 6563 6b20 796f 7572 2069 6e70  . Check your inp
+0000c4b0: 7574 2e20 436f 6e74 696e 7569 6e67 2e2e  ut. Continuing..
+0000c4c0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+0000c4d0: 2020 2020 6966 2074 6573 745f 6461 7461      if test_data
+0000c4e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 6966 2065 6163 685f 7461 7267 6574    if each_target
+0000c510: 2069 6e20 7465 7374 5f64 6174 612e 636f   in test_data.co
+0000c520: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
+0000c530: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000c540: 6573 745f 6461 7461 5b65 6163 685f 7461  est_data[each_ta
+0000c550: 7267 6574 5d20 3d20 6d6c 622e 7472 616e  rget] = mlb.tran
+0000c560: 7366 6f72 6d28 7465 7374 5f64 6174 615b  sform(test_data[
+0000c570: 6561 6368 5f74 6172 6765 745d 290a 2020  each_target]).  
 0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c590: 2020 2020 2023 2320 4166 7465 7220 636f       ## After co
-0000c5a0: 6e76 6572 7469 6e67 2074 6573 742c 206a  nverting test, j
-0000c5b0: 7573 7420 6c6f 6164 2069 7420 696e 746f  ust load it into
-0000c5c0: 2064 6173 6b20 6167 6169 6e20 2323 0a20   dask again ##. 
-0000c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5e0: 2020 2020 2020 2020 2020 2074 6573 745b             test[
-0000c5f0: 6561 6368 5f74 6172 6765 745d 203d 2064  each_target] = d
-0000c600: 642e 6672 6f6d 5f70 616e 6461 7328 7465  d.from_pandas(te
-0000c610: 7374 5f64 6174 615b 6561 6368 5f74 6172  st_data[each_tar
-0000c620: 6765 745d 2c20 6e70 6172 7469 7469 6f6e  get], npartition
-0000c630: 733d 6e5f 776f 726b 6572 7329 0a20 2020  s=n_workers).   
-0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c650: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+0000c590: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5b0: 2020 2020 2020 2023 2320 4166 7465 7220         ## After 
+0000c5c0: 636f 6e76 6572 7469 6e67 2074 6573 742c  converting test,
+0000c5d0: 206a 7573 7420 6c6f 6164 2069 7420 696e   just load it in
+0000c5e0: 746f 2064 6173 6b20 6167 6169 6e20 2323  to dask again ##
+0000c5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c600: 2020 2020 2020 2020 2020 2020 2074 6573               tes
+0000c610: 745b 6561 6368 5f74 6172 6765 745d 203d  t[each_target] =
+0000c620: 2064 642e 6672 6f6d 5f70 616e 6461 7328   dd.from_pandas(
+0000c630: 7465 7374 5f64 6174 615b 6561 6368 5f74  test_data[each_t
+0000c640: 6172 6765 745d 2c20 6e70 6172 7469 7469  arget], npartiti
+0000c650: 6f6e 733d 6e5f 776f 726b 6572 7329 0a20  ons=n_workers). 
 0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c670: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000c680: 436f 756c 6420 6e6f 7420 636f 6e76 6572  Could not conver
-0000c690: 7420 6461 736b 2064 6174 6166 7261 6d65  t dask dataframe
-0000c6a0: 2074 6172 6765 7420 696e 746f 206e 756d   target into num
-0000c6b0: 6572 6963 2e20 4368 6563 6b20 796f 7572  eric. Check your
-0000c6c0: 2069 6e70 7574 2e20 436f 6e74 696e 7569   input. Continui
-0000c6d0: 6e67 2e2e 2e27 290a 2020 2020 2020 2020  ng...').        
-0000c6e0: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-0000c6f0: 6f6d 706c 6574 6564 206c 6162 656c 2065  ompleted label e
-0000c700: 6e63 6f64 696e 6720 6f66 2074 6172 6765  ncoding of targe
-0000c710: 7420 7661 7269 6162 6c65 203d 2025 7327  t variable = %s'
-0000c720: 2025 6561 6368 5f74 6172 6765 7429 0a20   %each_target). 
-0000c730: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c740: 7269 6e74 2827 486f 7720 6d6f 6465 6c20  rint('How model 
-0000c750: 7072 6564 6963 7469 6f6e 7320 6e65 6564  predictions need
-0000c760: 2074 6f20 6265 2074 7261 6e73 666f 726d   to be transform
-0000c770: 6564 2066 6f72 2025 733a 5c6e 5c74 2573  ed for %s:\n\t%s
-0000c780: 2720 2528 6561 6368 5f74 6172 6765 742c  ' %(each_target,
-0000c790: 206d 6c62 2e69 6e76 6572 7365 5f74 7261   mlb.inverse_tra
-0000c7a0: 6e73 666f 726d 6572 2929 0a0a 2020 2020  nsformer))..    
-0000c7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c670: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000c6a0: 2827 436f 756c 6420 6e6f 7420 636f 6e76  ('Could not conv
+0000c6b0: 6572 7420 6461 736b 2064 6174 6166 7261  ert dask datafra
+0000c6c0: 6d65 2074 6172 6765 7420 696e 746f 206e  me target into n
+0000c6d0: 756d 6572 6963 2e20 4368 6563 6b20 796f  umeric. Check yo
+0000c6e0: 7572 2069 6e70 7574 2e20 436f 6e74 696e  ur input. Contin
+0000c6f0: 7569 6e67 2e2e 2e27 290a 2020 2020 2020  uing...').      
+0000c700: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000c710: 2743 6f6d 706c 6574 6564 206c 6162 656c  'Completed label
+0000c720: 2065 6e63 6f64 696e 6720 6f66 2074 6172   encoding of tar
+0000c730: 6765 7420 7661 7269 6162 6c65 203d 2025  get variable = %
+0000c740: 7327 2025 6561 6368 5f74 6172 6765 7429  s' %each_target)
+0000c750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c760: 2070 7269 6e74 2827 486f 7720 6d6f 6465   print('How mode
+0000c770: 6c20 7072 6564 6963 7469 6f6e 7320 6e65  l predictions ne
+0000c780: 6564 2074 6f20 6265 2074 7261 6e73 666f  ed to be transfo
+0000c790: 726d 6564 2066 6f72 2025 733a 5c6e 5c74  rmed for %s:\n\t
+0000c7a0: 2573 2720 2528 6561 6368 5f74 6172 6765  %s' %(each_targe
+0000c7b0: 742c 206d 6c62 2e69 6e76 6572 7365 5f74  t, mlb.inverse_t
+0000c7c0: 7261 6e73 666f 726d 6572 2929 0a0a 2020  ransformer))..  
+0000c7d0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
 0000c7e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c7f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c800: 2323 2323 2323 0a20 2020 2023 2323 2323  ######.    #####
-0000c810: 2320 2020 2042 2045 2046 204f 2052 2045  #    B E F O R E
-0000c820: 2020 2020 5520 5320 4920 4e20 4720 2020      U S I N G   
-0000c830: 2044 2041 2054 2041 2042 2055 204e 2043   D A T A B U N C
-0000c840: 2048 2020 4320 4820 4520 4320 4b20 2323   H  C H E C K ##
-0000c850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c860: 230a 2020 2020 2323 2323 2323 2323 2323  #.    ##########
+0000c800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c820: 2323 2323 2323 2323 0a20 2020 2023 2323  ########.    ###
+0000c830: 2323 2320 2020 2042 2045 2046 204f 2052  ###    B E F O R
+0000c840: 2045 2020 2020 5520 5320 4920 4e20 4720   E    U S I N G 
+0000c850: 2020 2044 2041 2054 2041 2042 2055 204e     D A T A B U N
+0000c860: 2043 2048 2020 4320 4820 4520 4320 4b20   C H  C H E C K 
 0000c870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c880: 2323 230a 2020 2020 2323 2323 2323 2323  ###.    ########
 0000c890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000c8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c8b0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-0000c8c0: 2023 2320 4265 666f 7265 2075 7369 6e67   ## Before using
-0000c8d0: 2044 6174 6142 756e 6368 2063 6865 636b   DataBunch check
-0000c8e0: 2069 6620 6365 7274 6169 6e20 656e 636f   if certain enco
-0000c8f0: 6465 7273 2077 6f72 6b20 7769 7468 2063  ders work with c
-0000c900: 6572 7461 696e 206b 696e 6420 6f66 2064  ertain kind of d
-0000c910: 6174 6121 0a20 2020 2069 6620 6665 6174  ata!.    if feat
-0000c920: 7572 655f 7479 7065 3a0a 2020 2020 2020  ure_type:.      
-0000c930: 2020 6669 6e61 6c5f 6361 745f 656e 636f    final_cat_enco
-0000c940: 6465 7273 203d 2066 6561 7475 7265 5f74  ders = feature_t
-0000c950: 7970 650a 2020 2020 656c 7365 3a0a 2020  ype.    else:.  
-0000c960: 2020 2020 2020 6669 6e61 6c5f 6361 745f        final_cat_
-0000c970: 656e 636f 6465 7273 203d 205b 5d0a 2020  encoders = [].  
-0000c980: 2020 6966 2073 6574 7469 6e67 732e 6d6f    if settings.mo
-0000c990: 6465 6c74 7970 6520 3d3d 2027 4d75 6c74  deltype == 'Mult
-0000c9a0: 695f 436c 6173 7369 6669 6361 7469 6f6e  i_Classification
-0000c9b0: 273a 0a20 2020 2020 2020 2023 2323 2079  ':.        ### y
-0000c9c0: 6f75 206d 7573 7420 7075 7420 6120 506f  ou must put a Po
-0000c9d0: 6c79 6e6f 6d69 616c 2057 7261 7070 6572  lynomial Wrapper
-0000c9e0: 206f 6e20 7468 6520 6361 745f 656e 636f   on the cat_enco
-0000c9f0: 6465 7220 696e 2063 6173 6520 7468 6520  der in case the 
-0000ca00: 6d6f 6465 6c20 6973 206d 756c 7469 2d63  model is multi-c
-0000ca10: 6c61 7373 0a20 2020 2020 2020 2069 6620  lass.        if 
-0000ca20: 6669 6e61 6c5f 6361 745f 656e 636f 6465  final_cat_encode
-0000ca30: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000ca40: 6669 6e61 6c5f 6361 745f 656e 636f 6465  final_cat_encode
-0000ca50: 7273 203d 205b 506f 6c79 6e6f 6d69 616c  rs = [Polynomial
-0000ca60: 5772 6170 7065 7228 7829 2066 6f72 2078  Wrapper(x) for x
-0000ca70: 2069 6e20 6669 6e61 6c5f 6361 745f 656e   in final_cat_en
-0000ca80: 636f 6465 7273 2069 6620 7820 696e 2073  coders if x in s
-0000ca90: 6574 7469 6e67 732e 7461 7267 6574 5f65  ettings.target_e
-0000caa0: 6e63 6f64 6572 735f 6e61 6d65 735d 0a20  ncoders_names]. 
-0000cab0: 2020 2065 6c69 6620 7365 7474 696e 6773     elif settings
-0000cac0: 2e6d 6f64 656c 7479 7065 203d 3d20 2752  .modeltype == 'R
-0000cad0: 6567 7265 7373 696f 6e27 3a0a 2020 2020  egression':.    
-0000cae0: 2020 2020 6966 2066 696e 616c 5f63 6174      if final_cat
-0000caf0: 5f65 6e63 6f64 6572 733a 0a20 2020 2020  _encoders:.     
-0000cb00: 2020 2020 2020 2069 6620 2757 4f45 456e         if 'WOEEn
-0000cb10: 636f 6465 7227 2069 6e20 6669 6e61 6c5f  coder' in final_
-0000cb20: 6361 745f 656e 636f 6465 7273 3a0a 2020  cat_encoders:.  
-0000cb30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000cb40: 696e 7428 2752 656d 6f76 696e 6720 574f  int('Removing WO
-0000cb50: 4545 6e63 6f64 6572 2066 726f 6d20 6c69  EEncoder from li
-0000cb60: 7374 206f 6620 656e 636f 6465 7273 2073  st of encoders s
-0000cb70: 696e 6365 2069 7420 6361 6e6e 6f74 2062  ince it cannot b
-0000cb80: 6520 7573 6564 2066 6f72 2074 6869 7320  e used for this 
-0000cb90: 5265 6772 6573 7369 6f6e 2070 726f 626c  Regression probl
-0000cba0: 656d 2e27 290a 2020 2020 2020 2020 2020  em.').          
-0000cbb0: 2020 6669 6e61 6c5f 6361 745f 656e 636f    final_cat_enco
-0000cbc0: 6465 7273 203d 205b 7820 666f 7220 7820  ders = [x for x 
-0000cbd0: 696e 2066 696e 616c 5f63 6174 5f65 6e63  in final_cat_enc
-0000cbe0: 6f64 6572 7320 6966 2078 2021 3d20 2757  oders if x != 'W
-0000cbf0: 4f45 456e 636f 6465 7227 205d 0a20 2020  OEEncoder' ].   
-0000cc00: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-0000cc10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cc20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c8d0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+0000c8e0: 2020 2023 2320 4265 666f 7265 2075 7369     ## Before usi
+0000c8f0: 6e67 2044 6174 6142 756e 6368 2063 6865  ng DataBunch che
+0000c900: 636b 2069 6620 6365 7274 6169 6e20 656e  ck if certain en
+0000c910: 636f 6465 7273 2077 6f72 6b20 7769 7468  coders work with
+0000c920: 2063 6572 7461 696e 206b 696e 6420 6f66   certain kind of
+0000c930: 2064 6174 6121 0a20 2020 2069 6620 6665   data!.    if fe
+0000c940: 6174 7572 655f 7479 7065 3a0a 2020 2020  ature_type:.    
+0000c950: 2020 2020 6669 6e61 6c5f 6361 745f 656e      final_cat_en
+0000c960: 636f 6465 7273 203d 2066 6561 7475 7265  coders = feature
+0000c970: 5f74 7970 650a 2020 2020 656c 7365 3a0a  _type.    else:.
+0000c980: 2020 2020 2020 2020 6669 6e61 6c5f 6361          final_ca
+0000c990: 745f 656e 636f 6465 7273 203d 205b 5d0a  t_encoders = [].
+0000c9a0: 2020 2020 6966 2073 6574 7469 6e67 732e      if settings.
+0000c9b0: 6d6f 6465 6c74 7970 6520 3d3d 2027 4d75  modeltype == 'Mu
+0000c9c0: 6c74 695f 436c 6173 7369 6669 6361 7469  lti_Classificati
+0000c9d0: 6f6e 273a 0a20 2020 2020 2020 2023 2323  on':.        ###
+0000c9e0: 2079 6f75 206d 7573 7420 7075 7420 6120   you must put a 
+0000c9f0: 506f 6c79 6e6f 6d69 616c 2057 7261 7070  Polynomial Wrapp
+0000ca00: 6572 206f 6e20 7468 6520 6361 745f 656e  er on the cat_en
+0000ca10: 636f 6465 7220 696e 2063 6173 6520 7468  coder in case th
+0000ca20: 6520 6d6f 6465 6c20 6973 206d 756c 7469  e model is multi
+0000ca30: 2d63 6c61 7373 0a20 2020 2020 2020 2069  -class.        i
+0000ca40: 6620 6669 6e61 6c5f 6361 745f 656e 636f  f final_cat_enco
+0000ca50: 6465 7273 3a0a 2020 2020 2020 2020 2020  ders:.          
+0000ca60: 2020 6669 6e61 6c5f 6361 745f 656e 636f    final_cat_enco
+0000ca70: 6465 7273 203d 205b 506f 6c79 6e6f 6d69  ders = [Polynomi
+0000ca80: 616c 5772 6170 7065 7228 7829 2066 6f72  alWrapper(x) for
+0000ca90: 2078 2069 6e20 6669 6e61 6c5f 6361 745f   x in final_cat_
+0000caa0: 656e 636f 6465 7273 2069 6620 7820 696e  encoders if x in
+0000cab0: 2073 6574 7469 6e67 732e 7461 7267 6574   settings.target
+0000cac0: 5f65 6e63 6f64 6572 735f 6e61 6d65 735d  _encoders_names]
+0000cad0: 0a20 2020 2065 6c69 6620 7365 7474 696e  .    elif settin
+0000cae0: 6773 2e6d 6f64 656c 7479 7065 203d 3d20  gs.modeltype == 
+0000caf0: 2752 6567 7265 7373 696f 6e27 3a0a 2020  'Regression':.  
+0000cb00: 2020 2020 2020 6966 2066 696e 616c 5f63        if final_c
+0000cb10: 6174 5f65 6e63 6f64 6572 733a 0a20 2020  at_encoders:.   
+0000cb20: 2020 2020 2020 2020 2069 6620 2757 4f45           if 'WOE
+0000cb30: 456e 636f 6465 7227 2069 6e20 6669 6e61  Encoder' in fina
+0000cb40: 6c5f 6361 745f 656e 636f 6465 7273 3a0a  l_cat_encoders:.
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 7072 696e 7428 2752 656d 6f76 696e 6720  print('Removing 
+0000cb70: 574f 4545 6e63 6f64 6572 2066 726f 6d20  WOEEncoder from 
+0000cb80: 6c69 7374 206f 6620 656e 636f 6465 7273  list of encoders
+0000cb90: 2073 696e 6365 2069 7420 6361 6e6e 6f74   since it cannot
+0000cba0: 2062 6520 7573 6564 2066 6f72 2074 6869   be used for thi
+0000cbb0: 7320 5265 6772 6573 7369 6f6e 2070 726f  s Regression pro
+0000cbc0: 626c 656d 2e27 290a 2020 2020 2020 2020  blem.').        
+0000cbd0: 2020 2020 6669 6e61 6c5f 6361 745f 656e      final_cat_en
+0000cbe0: 636f 6465 7273 203d 205b 7820 666f 7220  coders = [x for 
+0000cbf0: 7820 696e 2066 696e 616c 5f63 6174 5f65  x in final_cat_e
+0000cc00: 6e63 6f64 6572 7320 6966 2078 2021 3d20  ncoders if x != 
+0000cc10: 2757 4f45 456e 636f 6465 7227 205d 0a20  'WOEEncoder' ]. 
+0000cc20: 2020 2023 2323 2323 2323 2323 2323 2323     #############
 0000cc30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000cc40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cc50: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
-0000cc60: 2323 2020 2020 4620 4520 4120 5420 5520  ##    F E A T U 
-0000cc70: 5220 4520 2020 2045 204e 2047 2047 2020  R E    E N G G  
-0000cc80: 2020 5520 5320 4920 4e20 4720 2020 2044    U S I N G    D
-0000cc90: 2041 2054 2041 2042 2055 204e 2043 2048   A T A B U N C H
-0000cca0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0000ccb0: 2323 2323 230a 2020 2020 2323 2323 2323  #####.    ######
-0000ccc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000ccd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cc50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cc60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cc70: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+0000cc80: 2323 2323 2020 2020 4620 4520 4120 5420  ####    F E A T 
+0000cc90: 5520 5220 4520 2020 2045 204e 2047 2047  U R E    E N G G
+0000cca0: 2020 2020 5520 5320 4920 4e20 4720 2020      U S I N G   
+0000ccb0: 2044 2041 2054 2041 2042 2055 204e 2043   D A T A B U N C
+0000ccc0: 2048 2020 2323 2323 2323 2323 2323 2323   H  ############
+0000ccd0: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
 0000cce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000ccf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000cd00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000cd10: 0a20 2020 2069 6620 6665 6174 7572 655f  .    if feature_
-0000cd20: 6765 6e20 6f72 2066 6561 7475 7265 5f74  gen or feature_t
-0000cd30: 7970 653a 0a20 2020 2020 2020 2069 6620  ype:.        if 
-0000cd40: 6973 696e 7374 616e 6365 2874 6573 745f  isinstance(test_
-0000cd50: 6461 7461 2c20 7374 7229 206f 7220 7465  data, str) or te
-0000cd60: 7374 5f64 6174 6120 6973 204e 6f6e 653a  st_data is None:
-0000cd70: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000cd80: 6e74 2827 2020 2020 5374 6172 7469 6e67  nt('    Starting
-0000cd90: 2066 6561 7475 7265 2065 6e67 696e 6565   feature enginee
-0000cda0: 7269 6e67 2e2e 2e53 696e 6365 206e 6f20  ring...Since no 
-0000cdb0: 7465 7374 2064 6174 6120 6973 2067 6976  test data is giv
-0000cdc0: 656e 2c20 7370 6c69 7474 696e 6720 7472  en, splitting tr
-0000cdd0: 6169 6e20 696e 746f 2074 776f 2e2e 2e27  ain into two...'
-0000cde0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000cdf0: 2073 6574 7469 6e67 732e 6d75 6c74 695f   settings.multi_
-0000ce00: 6c61 6265 6c3a 0a20 2020 2020 2020 2020  label:.         
-0000ce10: 2020 2020 2020 2023 2323 2069 6620 6974         ### if it
-0000ce20: 2069 7320 6120 6d75 6c74 695f 6c61 6265   is a multi_labe
-0000ce30: 6c20 7072 6f62 6c65 6d2c 206c 6561 7665  l problem, leave
-0000ce40: 2074 6172 6765 7420 6173 2069 7420 6973   target as it is
-0000ce50: 202d 2061 206c 6973 7421 0a20 2020 2020   - a list!.     
-0000ce60: 2020 2020 2020 2020 2020 2058 5f74 7261             X_tra
-0000ce70: 696e 2c20 585f 7465 7374 2c20 795f 7472  in, X_test, y_tr
-0000ce80: 6169 6e2c 2079 5f74 6573 7420 3d20 7472  ain, y_test = tr
-0000ce90: 6169 6e5f 7465 7374 5f73 706c 6974 2864  ain_test_split(d
-0000cea0: 6174 616e 616d 655b 7072 6564 735d 2c0a  ataname[preds],.
-0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cd20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cd30: 2323 0a20 2020 2069 6620 6665 6174 7572  ##.    if featur
+0000cd40: 655f 6765 6e20 6f72 2066 6561 7475 7265  e_gen or feature
+0000cd50: 5f74 7970 653a 0a20 2020 2020 2020 2069  _type:.        i
+0000cd60: 6620 6973 696e 7374 616e 6365 2874 6573  f isinstance(tes
+0000cd70: 745f 6461 7461 2c20 7374 7229 206f 7220  t_data, str) or 
+0000cd80: 7465 7374 5f64 6174 6120 6973 204e 6f6e  test_data is Non
+0000cd90: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0000cda0: 7269 6e74 2827 2020 2020 5374 6172 7469  rint('    Starti
+0000cdb0: 6e67 2066 6561 7475 7265 2065 6e67 696e  ng feature engin
+0000cdc0: 6565 7269 6e67 2e2e 2e53 696e 6365 206e  eering...Since n
+0000cdd0: 6f20 7465 7374 2064 6174 6120 6973 2067  o test data is g
+0000cde0: 6976 656e 2c20 7370 6c69 7474 696e 6720  iven, splitting 
+0000cdf0: 7472 6169 6e20 696e 746f 2074 776f 2e2e  train into two..
+0000ce00: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+0000ce10: 6966 2073 6574 7469 6e67 732e 6d75 6c74  if settings.mult
+0000ce20: 695f 6c61 6265 6c3a 0a20 2020 2020 2020  i_label:.       
+0000ce30: 2020 2020 2020 2020 2023 2323 2069 6620           ### if 
+0000ce40: 6974 2069 7320 6120 6d75 6c74 695f 6c61  it is a multi_la
+0000ce50: 6265 6c20 7072 6f62 6c65 6d2c 206c 6561  bel problem, lea
+0000ce60: 7665 2074 6172 6765 7420 6173 2069 7420  ve target as it 
+0000ce70: 6973 202d 2061 206c 6973 7421 0a20 2020  is - a list!.   
+0000ce80: 2020 2020 2020 2020 2020 2020 2058 5f74               X_t
+0000ce90: 7261 696e 2c20 585f 7465 7374 2c20 795f  rain, X_test, y_
+0000cea0: 7472 6169 6e2c 2079 5f74 6573 7420 3d20  train, y_test = 
+0000ceb0: 7472 6169 6e5f 7465 7374 5f73 706c 6974  train_test_split
+0000cec0: 2864 6174 616e 616d 655b 7072 6564 735d  (dataname[preds]
+0000ced0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cef0: 6461 7461 6e61 6d65 5b74 6172 6765 745d  dataname[target]
-0000cf00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf10: 2020 6461 7461 6e61 6d65 5b74 6172 6765    dataname[targe
+0000cf20: 745d 2c0a 2020 2020 2020 2020 2020 2020  t],.            
 0000cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf40: 2020 7465 7374 5f73 697a 653d 302e 322c    test_size=0.2,
-0000cf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf60: 2020 2020 7465 7374 5f73 697a 653d 302e      test_size=0.
+0000cf70: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
 0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 2072 616e 646f 6d5f 7374 6174 653d 5241   random_state=RA
-0000cfa0: 4e44 4f4d 5f53 4545 4429 0a20 2020 2020  NDOM_SEED).     
-0000cfb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000cfc0: 2020 2020 2020 2020 2020 2020 2023 2323               ###
-0000cfd0: 2069 6620 6974 206e 6f74 2061 206d 756c   if it not a mul
-0000cfe0: 7469 5f6c 6162 656c 2070 726f 626c 656d  ti_label problem
-0000cff0: 2c20 6d61 6b65 2074 6172 6765 7420 6173  , make target as
-0000d000: 2074 6172 6765 745b 305d 0a20 2020 2020   target[0].     
-0000d010: 2020 2020 2020 2020 2020 2058 5f74 7261             X_tra
-0000d020: 696e 2c20 585f 7465 7374 2c20 795f 7472  in, X_test, y_tr
-0000d030: 6169 6e2c 2079 5f74 6573 7420 3d20 7472  ain, y_test = tr
-0000d040: 6169 6e5f 7465 7374 5f73 706c 6974 2864  ain_test_split(d
-0000d050: 6174 616e 616d 655b 7072 6564 735d 2c0a  ataname[preds],.
-0000d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000d0a0: 6e61 6d65 5b74 6172 6765 745b 305d 5d2c  name[target[0]],
-0000d0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0e0: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-0000d0f0: 745f 7369 7a65 3d30 2e32 2c0a 2020 2020  t_size=0.2,.    
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfb0: 2020 2072 616e 646f 6d5f 7374 6174 653d     random_state=
+0000cfc0: 5241 4e44 4f4d 5f53 4545 4429 0a20 2020  RANDOM_SEED).   
+0000cfd0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000cff0: 2323 2069 6620 6974 206e 6f74 2061 206d  ## if it not a m
+0000d000: 756c 7469 5f6c 6162 656c 2070 726f 626c  ulti_label probl
+0000d010: 656d 2c20 6d61 6b65 2074 6172 6765 7420  em, make target 
+0000d020: 6173 2074 6172 6765 745b 305d 0a20 2020  as target[0].   
+0000d030: 2020 2020 2020 2020 2020 2020 2058 5f74               X_t
+0000d040: 7261 696e 2c20 585f 7465 7374 2c20 795f  rain, X_test, y_
+0000d050: 7472 6169 6e2c 2079 5f74 6573 7420 3d20  train, y_test = 
+0000d060: 7472 6169 6e5f 7465 7374 5f73 706c 6974  train_test_split
+0000d070: 2864 6174 616e 616d 655b 7072 6564 735d  (dataname[preds]
+0000d080: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0b0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0000d0c0: 7461 6e61 6d65 5b74 6172 6765 745b 305d  taname[target[0]
+0000d0d0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d100: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000d110: 6573 745f 7369 7a65 3d30 2e32 2c0a 2020  est_size=0.2,.  
 0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d130: 2020 2020 2020 2020 7261 6e64 6f6d 5f73          random_s
-0000d140: 7461 7465 3d52 414e 444f 4d5f 5345 4544  tate=RANDOM_SEED
-0000d150: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000d160: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000d170: 7428 2720 2020 2053 7461 7274 696e 6720  t('    Starting 
-0000d180: 6665 6174 7572 6520 656e 6769 6e65 6572  feature engineer
-0000d190: 696e 672e 2e2e 5369 6e63 6520 7465 7374  ing...Since test
-0000d1a0: 2064 6174 6120 6973 2067 6976 656e 2c20   data is given, 
-0000d1b0: 7573 696e 6720 7472 6169 6e20 616e 6420  using train and 
-0000d1c0: 7465 7374 2e2e 2e27 290a 2020 2020 2020  test...').      
-0000d1d0: 2020 2020 2020 585f 7472 6169 6e20 3d20        X_train = 
-0000d1e0: 6461 7461 6e61 6d65 5b70 7265 6473 5d0a  dataname[preds].
-0000d1f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000d200: 6574 7469 6e67 732e 6d75 6c74 695f 6c61  ettings.multi_la
-0000d210: 6265 6c3a 0a20 2020 2020 2020 2020 2020  bel:.           
-0000d220: 2020 2020 2079 5f74 7261 696e 203d 2064       y_train = d
-0000d230: 6174 616e 616d 655b 7461 7267 6574 5d0a  ataname[target].
-0000d240: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d250: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d260: 2020 795f 7472 6169 6e20 3d20 6461 7461    y_train = data
-0000d270: 6e61 6d65 5b74 6172 6765 745b 305d 5d0a  name[target[0]].
-0000d280: 2020 2020 2020 2020 2020 2020 585f 7465              X_te
-0000d290: 7374 203d 2074 6573 745f 6461 7461 5b70  st = test_data[p
-0000d2a0: 7265 6473 5d0a 2020 2020 2020 2020 2020  reds].          
-0000d2b0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000d2c0: 2020 2020 2020 2079 5f74 6573 7420 3d20         y_test = 
-0000d2d0: 7465 7374 5f64 6174 615b 7461 7267 6574  test_data[target
-0000d2e0: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
-0000d2f0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-0000d300: 2020 2020 2020 795f 7465 7374 203d 204e        y_test = N
-0000d310: 6f6e 650a 2020 2020 2020 2020 585f 7472  one.        X_tr
-0000d320: 6169 6e5f 696e 6465 7820 3d20 585f 7472  ain_index = X_tr
-0000d330: 6169 6e2e 696e 6465 780a 2020 2020 2020  ain.index.      
-0000d340: 2020 585f 7465 7374 5f69 6e64 6578 203d    X_test_index =
-0000d350: 2058 5f74 6573 742e 696e 6465 780a 2020   X_test.index.  
-0000d360: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
-0000d370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d150: 2020 2020 2020 2020 2020 7261 6e64 6f6d            random
+0000d160: 5f73 7461 7465 3d52 414e 444f 4d5f 5345  _state=RANDOM_SE
+0000d170: 4544 290a 2020 2020 2020 2020 656c 7365  ED).        else
+0000d180: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000d190: 696e 7428 2720 2020 2053 7461 7274 696e  int('    Startin
+0000d1a0: 6720 6665 6174 7572 6520 656e 6769 6e65  g feature engine
+0000d1b0: 6572 696e 672e 2e2e 5369 6e63 6520 7465  ering...Since te
+0000d1c0: 7374 2064 6174 6120 6973 2067 6976 656e  st data is given
+0000d1d0: 2c20 7573 696e 6720 7472 6169 6e20 616e  , using train an
+0000d1e0: 6420 7465 7374 2e2e 2e27 290a 2020 2020  d test...').    
+0000d1f0: 2020 2020 2020 2020 585f 7472 6169 6e20          X_train 
+0000d200: 3d20 6461 7461 6e61 6d65 5b70 7265 6473  = dataname[preds
+0000d210: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0000d220: 2073 6574 7469 6e67 732e 6d75 6c74 695f   settings.multi_
+0000d230: 6c61 6265 6c3a 0a20 2020 2020 2020 2020  label:.         
+0000d240: 2020 2020 2020 2079 5f74 7261 696e 203d         y_train =
+0000d250: 2064 6174 616e 616d 655b 7461 7267 6574   dataname[target
+0000d260: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+0000d270: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d280: 2020 2020 795f 7472 6169 6e20 3d20 6461      y_train = da
+0000d290: 7461 6e61 6d65 5b74 6172 6765 745b 305d  taname[target[0]
+0000d2a0: 5d0a 2020 2020 2020 2020 2020 2020 585f  ].            X_
+0000d2b0: 7465 7374 203d 2074 6573 745f 6461 7461  test = test_data
+0000d2c0: 5b70 7265 6473 5d0a 2020 2020 2020 2020  [preds].        
+0000d2d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d2e0: 2020 2020 2020 2020 2079 5f74 6573 7420           y_test 
+0000d2f0: 3d20 7465 7374 5f64 6174 615b 7461 7267  = test_data[targ
+0000d300: 6574 5d0a 2020 2020 2020 2020 2020 2020  et].            
+0000d310: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0000d320: 2020 2020 2020 2020 795f 7465 7374 203d          y_test =
+0000d330: 204e 6f6e 650a 2020 2020 2020 2020 585f   None.        X_
+0000d340: 7472 6169 6e5f 696e 6465 7820 3d20 585f  train_index = X_
+0000d350: 7472 6169 6e2e 696e 6465 780a 2020 2020  train.index.    
+0000d360: 2020 2020 585f 7465 7374 5f69 6e64 6578      X_test_index
+0000d370: 203d 2058 5f74 6573 742e 696e 6465 780a   = X_test.index.
+0000d380: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000d390: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
 0000d3a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000d3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d3c0: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
-0000d3d0: 2023 2323 2323 2320 4361 7465 676f 7279   ###### Category
-0000d3e0: 5f45 6e63 6f64 6572 7320 646f 6573 206e  _Encoders does n
-0000d3f0: 6f74 2077 6f72 6b20 7769 7468 2044 6173  ot work with Das
-0000d400: 6b20 2d20 736f 2064 6f6e 2774 2073 656e  k - so don't sen
-0000d410: 6420 696e 2044 6173 6b20 6461 7461 6672  d in Dask datafr
-0000d420: 616d 6573 2074 6f20 4461 7461 4275 6e63  ames to DataBunc
-0000d430: 6821 0a20 2020 2020 2020 2023 2323 2323  h!.        #####
-0000d440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d3c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d3d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d3f0: 2323 230a 2020 2020 2020 2020 2323 2323  ###.        ####
+0000d400: 2323 2043 6174 6567 6f72 795f 456e 636f  ## Category_Enco
+0000d410: 6465 7273 2064 6f65 7320 6e6f 7420 776f  ders does not wo
+0000d420: 726b 2077 6974 6820 4461 736b 202d 2073  rk with Dask - s
+0000d430: 6f20 646f 6e27 7420 7365 6e64 2069 6e20  o don't send in 
+0000d440: 4461 736b 2064 6174 6166 7261 6d65 7320  Dask dataframes 
+0000d450: 746f 2044 6174 6142 756e 6368 210a 2020  to DataBunch!.  
+0000d460: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
 0000d470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000d480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000d490: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-0000d4a0: 2020 2020 2020 6461 7461 5f74 7570 6c65        data_tuple
-0000d4b0: 203d 2044 6174 6142 756e 6368 2858 5f74   = DataBunch(X_t
-0000d4c0: 7261 696e 3d58 5f74 7261 696e 2c0a 2020  rain=X_train,.  
-0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4e0: 2020 795f 7472 6169 6e3d 795f 7472 6169    y_train=y_trai
-0000d4f0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0000d500: 2020 2020 2020 2058 5f74 6573 743d 585f         X_test=X_
-0000d510: 7465 7374 2c20 2320 6265 2073 7572 6520  test, # be sure 
-0000d520: 746f 2073 7065 6369 6679 2058 5f74 6573  to specify X_tes
-0000d530: 742c 2062 6563 6175 7365 2074 6865 2065  t, because the e
-0000d540: 6e63 6f64 6572 206e 6565 6473 2061 6c6c  ncoder needs all
-0000d550: 2064 6174 6173 6574 2074 6f20 776f 726b   dataset to work
-0000d560: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d570: 2020 2020 2020 6361 745f 6665 6174 7572        cat_featur
-0000d580: 6573 203d 2063 6174 7661 7273 2c0a 2020  es = catvars,.  
+0000d490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d4c0: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
+0000d4d0: 2064 6174 615f 7475 706c 6520 3d20 4461   data_tuple = Da
+0000d4e0: 7461 4275 6e63 6828 585f 7472 6169 6e3d  taBunch(X_train=
+0000d4f0: 585f 7472 6169 6e2c 0a20 2020 2020 2020  X_train,.       
+0000d500: 2020 2020 2020 2020 2020 2020 2079 5f74               y_t
+0000d510: 7261 696e 3d79 5f74 7261 696e 2c0a 2020  rain=y_train,.  
+0000d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d530: 2020 585f 7465 7374 3d58 5f74 6573 742c    X_test=X_test,
+0000d540: 2023 2062 6520 7375 7265 2074 6f20 7370   # be sure to sp
+0000d550: 6563 6966 7920 585f 7465 7374 2c20 6265  ecify X_test, be
+0000d560: 6361 7573 6520 7468 6520 656e 636f 6465  cause the encode
+0000d570: 7220 6e65 6564 7320 616c 6c20 6461 7461  r needs all data
+0000d580: 7365 7420 746f 2077 6f72 6b2e 0a20 2020  set to work..   
 0000d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5a0: 2020 636c 6561 6e5f 616e 645f 656e 636f    clean_and_enco
-0000d5b0: 645f 6461 7461 3d54 7275 652c 0a20 2020  d_data=True,.   
-0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5d0: 2063 6174 5f65 6e63 6f64 6572 5f6e 616d   cat_encoder_nam
-0000d5e0: 6573 3d66 696e 616c 5f63 6174 5f65 6e63  es=final_cat_enc
-0000d5f0: 6f64 6572 732c 2023 2066 696e 616c 206c  oders, # final l
-0000d600: 6973 7420 6f66 2045 6e63 6f64 6572 7320  ist of Encoders 
-0000d610: 7365 6c65 6374 6564 0a20 2020 2020 2020  selected.       
-0000d620: 2020 2020 2020 2020 2020 2020 2063 6c65               cle
-0000d630: 616e 5f6e 616e 3d54 7275 652c 2023 2066  an_nan=True, # f
-0000d640: 696c 6c6e 616e 0a20 2020 2020 2020 2020  illnan.         
-0000d650: 2020 2020 2020 2020 2020 206e 756d 5f67             num_g
-0000d660: 656e 6572 6174 6f72 5f66 6561 7475 7265  enerator_feature
-0000d670: 733d 6e70 2e77 6865 7265 2827 696e 7465  s=np.where('inte
-0000d680: 7261 6374 696f 6e73 2720 696e 2066 6561  ractions' in fea
-0000d690: 7475 7265 5f67 656e 2c54 7275 652c 2046  ture_gen,True, F
-0000d6a0: 616c 7365 292e 746f 6c69 7374 2829 2c20  alse).tolist(), 
-0000d6b0: 2320 4765 6e65 7261 7465 2069 6e74 6572  # Generate inter
-0000d6c0: 6163 7469 6f6e 204e 756d 2046 6561 7475  action Num Featu
-0000d6d0: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-0000d6e0: 2020 2020 2020 2020 6772 6f75 705f 6765          group_ge
-0000d6f0: 6e65 7261 746f 725f 6665 6174 7572 6573  nerator_features
-0000d700: 3d6e 702e 7768 6572 6528 2767 726f 7570  =np.where('group
-0000d710: 6279 2720 696e 2066 6561 7475 7265 5f67  by' in feature_g
-0000d720: 656e 2c54 7275 652c 2046 616c 7365 292e  en,True, False).
-0000d730: 746f 6c69 7374 2829 2c20 2320 4765 6e65  tolist(), # Gene
-0000d740: 7261 7465 2067 726f 7570 6279 2046 6561  rate groupby Fea
-0000d750: 7475 7265 730a 2020 2020 2020 2020 2020  tures.          
-0000d760: 2020 2020 2020 2020 2020 7461 7267 6574            target
-0000d770: 5f65 6e63 5f63 6174 5f66 6561 7475 7265  _enc_cat_feature
-0000d780: 733d 7461 7267 6574 5f65 6e63 5f63 6174  s=target_enc_cat
-0000d790: 5f66 6561 7475 7265 732c 2320 4765 6e65  _features,# Gene
-0000d7a0: 7261 7465 2074 6172 6765 7420 656e 636f  rate target enco
-0000d7b0: 6465 6420 6665 6174 7572 6573 0a20 2020  ded features.   
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7d0: 206e 6f72 6d61 6c69 7a61 7469 6f6e 3d46   normalization=F
-0000d7e0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0000d7f0: 2020 2020 2020 2020 2020 7261 6e64 6f6d            random
-0000d800: 5f73 7461 7465 3d52 414e 444f 4d5f 5345  _state=RANDOM_SE
-0000d810: 4544 2c0a 2020 2020 2020 2020 2020 2020  ED,.            
-0000d820: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d830: 2020 2323 2323 204e 6f77 2079 6f75 2063    #### Now you c
-0000d840: 616e 2070 726f 6365 7373 2074 6865 2074  an process the t
-0000d850: 7570 6c65 2074 6869 7320 7761 7920 2323  uple this way ##
-0000d860: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-0000d870: 6966 2074 7970 6528 795f 7472 6169 6e29  if type(y_train)
-0000d880: 203d 3d20 6461 736b 2e64 6174 6166 7261   == dask.datafra
-0000d890: 6d65 2e63 6f72 652e 4461 7461 4672 616d  me.core.DataFram
-0000d8a0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0000d8b0: 2323 2073 696e 6365 2079 5f74 7261 696e  ## since y_train
-0000d8c0: 2069 7320 6461 736b 2064 6620 616e 6420   is dask df and 
-0000d8d0: 6461 7461 5f74 7570 6c65 2e58 5f74 7261  data_tuple.X_tra
-0000d8e0: 696e 2069 7320 6120 7061 6e64 6173 2064  in is a pandas d
-0000d8f0: 662c 2079 6f75 2063 616e 2774 206d 6572  f, you can't mer
-0000d900: 6765 2074 6865 6d2e 0a20 2020 2020 2020  ge them..       
-0000d910: 2020 2020 2079 5f74 7261 696e 203d 2079       y_train = y
-0000d920: 5f74 7261 696e 2e63 6f6d 7075 7465 2829  _train.compute()
-0000d930: 2020 2323 2320 7265 6d65 6d62 6572 2079    ### remember y
-0000d940: 6f75 2066 6972 7374 2068 6176 6520 746f  ou first have to
-0000d950: 2063 6f6e 7665 7274 2074 6865 6d20 746f   convert them to
-0000d960: 2061 2070 616e 6461 7320 6466 0a20 2020   a pandas df.   
-0000d970: 2020 2020 2064 6174 6131 203d 2070 642e       data1 = pd.
-0000d980: 636f 6e63 6174 285b 6461 7461 5f74 7570  concat([data_tup
-0000d990: 6c65 2e58 5f74 7261 696e 2c20 795f 7472  le.X_train, y_tr
-0000d9a0: 6169 6e5d 2c20 6178 6973 3d31 2920 2323  ain], axis=1) ##
-0000d9b0: 2320 6461 7461 5f74 7570 6c65 2064 6f65  # data_tuple doe
-0000d9c0: 7320 6e6f 7420 6861 7665 2061 2079 5f74  s not have a y_t
-0000d9d0: 7261 696e 2c20 7265 6d65 6d62 6572 210a  rain, remember!.
-0000d9e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000d9f0: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-0000da00: 6573 745f 6461 7461 2c20 7374 7229 206f  est_data, str) o
-0000da10: 7220 7465 7374 5f64 6174 6120 6973 204e  r test_data is N
-0000da20: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000da30: 2023 2323 2053 696e 6365 2079 6f75 2068   ### Since you h
-0000da40: 6176 6520 646f 6e65 2061 2074 7261 696e  ave done a train
-0000da50: 5f74 6573 745f 7370 6c69 7420 7573 696e  _test_split usin
-0000da60: 6720 7261 6e64 6f6d 697a 6564 2073 706c  g randomized spl
-0000da70: 6974 2c20 796f 7520 6e65 6564 2074 6f20  it, you need to 
-0000da80: 7075 7420 6974 2062 6163 6b20 6167 6169  put it back agai
-0000da90: 6e2e 0a20 2020 2020 2020 2020 2020 2069  n..            i
-0000daa0: 6620 7479 7065 2879 5f74 6573 7429 203d  f type(y_test) =
-0000dab0: 3d20 6461 736b 2e64 6174 6166 7261 6d65  = dask.dataframe
-0000dac0: 2e63 6f72 652e 4461 7461 4672 616d 653a  .core.DataFrame:
-0000dad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dae0: 2023 2323 2073 696e 6365 2079 5f74 7261   ### since y_tra
-0000daf0: 696e 2069 7320 6461 736b 2064 6620 616e  in is dask df an
-0000db00: 6420 6461 7461 5f74 7570 6c65 2e58 5f74  d data_tuple.X_t
-0000db10: 7261 696e 2069 7320 6120 7061 6e64 6173  rain is a pandas
-0000db20: 2064 662c 2079 6f75 2063 616e 2774 206d   df, you can't m
-0000db30: 6572 6765 2074 6865 6d2e 0a20 2020 2020  erge them..     
-0000db40: 2020 2020 2020 2020 2020 2079 5f74 6573             y_tes
-0000db50: 7420 3d20 795f 7465 7374 2e63 6f6d 7075  t = y_test.compu
-0000db60: 7465 2829 2020 2323 2320 7265 6d65 6d62  te()  ### rememb
-0000db70: 6572 2079 6f75 2066 6972 7374 2068 6176  er you first hav
-0000db80: 6520 746f 2063 6f6e 7665 7274 2074 6865  e to convert the
-0000db90: 6d20 746f 2061 2070 616e 6461 7320 6466  m to a pandas df
-0000dba0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0000dbb0: 6132 203d 2070 642e 636f 6e63 6174 285b  a2 = pd.concat([
-0000dbc0: 6461 7461 5f74 7570 6c65 2e58 5f74 6573  data_tuple.X_tes
-0000dbd0: 742c 2079 5f74 6573 745d 2c20 6178 6973  t, y_test], axis
-0000dbe0: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
-0000dbf0: 6461 7461 6e61 6d65 203d 2064 6174 6131  dataname = data1
-0000dc00: 2e61 7070 656e 6428 6461 7461 3229 0a20  .append(data2). 
-0000dc10: 2020 2020 2020 2020 2020 2023 2323 2053             ### S
-0000dc20: 6f6d 6574 696d 6573 2074 6865 7265 2061  ometimes there a
-0000dc30: 7265 2064 7570 6c69 6361 7465 2076 616c  re duplicate val
-0000dc40: 7565 7320 696e 2069 6e64 6578 2077 6865  ues in index whe
-0000dc50: 6e20 796f 7520 6170 7065 6e64 2e20 536f  n you append. So
-0000dc60: 206a 7573 7420 7265 6d6f 7665 2064 7570   just remove dup
-0000dc70: 6c69 6361 7465 7320 6865 7265 0a20 2020  licates here.   
-0000dc80: 2020 2020 2020 2020 2064 6174 616e 616d           datanam
-0000dc90: 6520 3d20 6461 7461 6e61 6d65 5b7e 6461  e = dataname[~da
-0000dca0: 7461 6e61 6d65 2e69 6e64 6578 2e64 7570  taname.index.dup
-0000dcb0: 6c69 6361 7465 6428 295d 0a20 2020 2020  licated()].     
-0000dcc0: 2020 2020 2020 2064 6174 616e 616d 6520         dataname 
-0000dcd0: 3d20 6461 7461 6e61 6d65 2e72 6569 6e64  = dataname.reind
-0000dce0: 6578 2874 7261 696e 5f69 6e64 6578 290a  ex(train_index).
-0000dcf0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000dd00: 7428 2720 2020 2043 6f6d 706c 6574 6564  t('    Completed
-0000dd10: 2066 6561 7475 7265 2065 6e67 696e 6565   feature enginee
-0000dd20: 7269 6e67 2e20 5368 6170 6520 6f66 2054  ring. Shape of T
-0000dd30: 7261 696e 2028 7769 7468 2074 6172 6765  rain (with targe
-0000dd40: 7429 203d 2025 7327 2025 2864 6174 616e  t) = %s' %(datan
-0000dd50: 616d 652e 7368 6170 652c 2929 0a20 2020  ame.shape,)).   
-0000dd60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000dd70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000dd80: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0000dd90: 7970 6528 795f 7465 7374 2920 3d3d 2064  ype(y_test) == d
-0000dda0: 6173 6b2e 6461 7461 6672 616d 652e 636f  ask.dataframe.co
-0000ddb0: 7265 2e44 6174 6146 7261 6d65 3a0a 2020  re.DataFrame:.  
-0000ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddd0: 2020 2323 2320 7369 6e63 6520 795f 7472    ### since y_tr
-0000dde0: 6169 6e20 6973 2064 6173 6b20 6466 2061  ain is dask df a
-0000ddf0: 6e64 2064 6174 615f 7475 706c 652e 585f  nd data_tuple.X_
-0000de00: 7472 6169 6e20 6973 2061 2070 616e 6461  train is a panda
-0000de10: 7320 6466 2c20 796f 7520 6361 6e27 7420  s df, you can't 
-0000de20: 6d65 7267 6520 7468 656d 2e0a 2020 2020  merge them..    
-0000de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de40: 795f 7465 7374 203d 2079 5f74 6573 742e  y_test = y_test.
-0000de50: 636f 6d70 7574 6528 2920 2023 2323 2072  compute()  ### r
-0000de60: 656d 656d 6265 7220 796f 7520 6669 7273  emember you firs
-0000de70: 7420 6861 7665 2074 6f20 636f 6e76 6572  t have to conver
-0000de80: 7420 7468 656d 2074 6f20 6120 7061 6e64  t them to a pand
-0000de90: 6173 2064 660a 2020 2020 2020 2020 2020  as df.          
-0000dea0: 2020 2020 2020 7465 7374 5f64 6174 6120        test_data 
-0000deb0: 3d20 7064 2e63 6f6e 6361 7428 5b64 6174  = pd.concat([dat
-0000dec0: 615f 7475 706c 652e 585f 7465 7374 2c20  a_tuple.X_test, 
-0000ded0: 795f 7465 7374 5d2c 2061 7869 733d 3129  y_test], axis=1)
-0000dee0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0000def0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0000df00: 2020 2020 2074 6573 745f 6461 7461 203d       test_data =
-0000df10: 2063 6f70 792e 6465 6570 636f 7079 2864   copy.deepcopy(d
-0000df20: 6174 615f 7475 706c 652e 585f 7465 7374  ata_tuple.X_test
-0000df30: 290a 2020 2020 2020 2020 2020 2020 2323  ).            ##
-0000df40: 2320 536f 6d65 7469 6d65 7320 7468 6572  # Sometimes ther
-0000df50: 6520 6172 6520 6475 706c 6963 6174 6520  e are duplicate 
-0000df60: 7661 6c75 6573 2069 6e20 696e 6465 7820  values in index 
-0000df70: 7768 656e 2079 6f75 2061 7070 656e 642e  when you append.
-0000df80: 2053 6f20 6a75 7374 2072 656d 6f76 6520   So just remove 
-0000df90: 6475 706c 6963 6174 6573 2068 6572 650a  duplicates here.
-0000dfa0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000dfb0: 5f64 6174 6120 3d20 7465 7374 5f64 6174  _data = test_dat
-0000dfc0: 615b 7e74 6573 745f 6461 7461 2e69 6e64  a[~test_data.ind
-0000dfd0: 6578 2e64 7570 6c69 6361 7465 6428 295d  ex.duplicated()]
-0000dfe0: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
-0000dff0: 745f 6461 7461 203d 2074 6573 745f 6461  t_data = test_da
-0000e000: 7461 2e72 6569 6e64 6578 2874 6573 745f  ta.reindex(test_
-0000e010: 696e 6465 7829 0a20 2020 2020 2020 2020  index).         
-0000e020: 2020 2064 6174 616e 616d 6520 3d20 636f     dataname = co
-0000e030: 7079 2e64 6565 7063 6f70 7928 6461 7461  py.deepcopy(data
-0000e040: 3129 0a20 2020 2020 2020 2020 2020 2070  1).            p
-0000e050: 7269 6e74 2827 2020 2020 436f 6d70 6c65  rint('    Comple
-0000e060: 7465 6420 6665 6174 7572 6520 656e 6769  ted feature engi
-0000e070: 6e65 6572 696e 672e 2053 6861 7065 206f  neering. Shape o
-0000e080: 6620 5465 7374 2028 7769 7468 2074 6172  f Test (with tar
-0000e090: 6765 7429 203d 2025 7327 2025 2874 6573  get) = %s' %(tes
-0000e0a0: 745f 6461 7461 2e73 6861 7065 2c29 290a  t_data.shape,)).
-0000e0b0: 2020 2020 2020 2020 2323 2323 2323 2323          ########
-0000e0c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e0d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e0e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000d5a0: 2063 6174 5f66 6561 7475 7265 7320 3d20   cat_features = 
+0000d5b0: 6361 7476 6172 732c 0a20 2020 2020 2020  catvars,.       
+0000d5c0: 2020 2020 2020 2020 2020 2020 2063 6c65               cle
+0000d5d0: 616e 5f61 6e64 5f65 6e63 6f64 5f64 6174  an_and_encod_dat
+0000d5e0: 613d 5472 7565 2c0a 2020 2020 2020 2020  a=True,.        
+0000d5f0: 2020 2020 2020 2020 2020 2020 6361 745f              cat_
+0000d600: 656e 636f 6465 725f 6e61 6d65 733d 6669  encoder_names=fi
+0000d610: 6e61 6c5f 6361 745f 656e 636f 6465 7273  nal_cat_encoders
+0000d620: 2c20 2320 6669 6e61 6c20 6c69 7374 206f  , # final list o
+0000d630: 6620 456e 636f 6465 7273 2073 656c 6563  f Encoders selec
+0000d640: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+0000d650: 2020 2020 2020 2020 636c 6561 6e5f 6e61          clean_na
+0000d660: 6e3d 5472 7565 2c20 2320 6669 6c6c 6e61  n=True, # fillna
+0000d670: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0000d680: 2020 2020 2020 6e75 6d5f 6765 6e65 7261        num_genera
+0000d690: 746f 725f 6665 6174 7572 6573 3d6e 702e  tor_features=np.
+0000d6a0: 7768 6572 6528 2769 6e74 6572 6163 7469  where('interacti
+0000d6b0: 6f6e 7327 2069 6e20 6665 6174 7572 655f  ons' in feature_
+0000d6c0: 6765 6e2c 5472 7565 2c20 4661 6c73 6529  gen,True, False)
+0000d6d0: 2e74 6f6c 6973 7428 292c 2023 2047 656e  .tolist(), # Gen
+0000d6e0: 6572 6174 6520 696e 7465 7261 6374 696f  erate interactio
+0000d6f0: 6e20 4e75 6d20 4665 6174 7572 6573 0a20  n Num Features. 
+0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d710: 2020 2067 726f 7570 5f67 656e 6572 6174     group_generat
+0000d720: 6f72 5f66 6561 7475 7265 733d 6e70 2e77  or_features=np.w
+0000d730: 6865 7265 2827 6772 6f75 7062 7927 2069  here('groupby' i
+0000d740: 6e20 6665 6174 7572 655f 6765 6e2c 5472  n feature_gen,Tr
+0000d750: 7565 2c20 4661 6c73 6529 2e74 6f6c 6973  ue, False).tolis
+0000d760: 7428 292c 2023 2047 656e 6572 6174 6520  t(), # Generate 
+0000d770: 6772 6f75 7062 7920 4665 6174 7572 6573  groupby Features
+0000d780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d790: 2020 2020 2074 6172 6765 745f 656e 635f       target_enc_
+0000d7a0: 6361 745f 6665 6174 7572 6573 3d74 6172  cat_features=tar
+0000d7b0: 6765 745f 656e 635f 6361 745f 6665 6174  get_enc_cat_feat
+0000d7c0: 7572 6573 2c23 2047 656e 6572 6174 6520  ures,# Generate 
+0000d7d0: 7461 7267 6574 2065 6e63 6f64 6564 2066  target encoded f
+0000d7e0: 6561 7475 7265 730a 2020 2020 2020 2020  eatures.        
+0000d7f0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0000d800: 616c 697a 6174 696f 6e3d 4661 6c73 652c  alization=False,
+0000d810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d820: 2020 2020 2072 616e 646f 6d5f 7374 6174       random_stat
+0000d830: 653d 5241 4e44 4f4d 5f53 4545 442c 0a20  e=RANDOM_SEED,. 
+0000d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d850: 2020 2029 0a20 2020 2020 2020 2023 2323     ).        ###
+0000d860: 2320 4e6f 7720 796f 7520 6361 6e20 7072  # Now you can pr
+0000d870: 6f63 6573 7320 7468 6520 7475 706c 6520  ocess the tuple 
+0000d880: 7468 6973 2077 6179 2023 2323 2323 2323  this way #######
+0000d890: 2323 0a20 2020 2020 2020 2069 6620 7479  ##.        if ty
+0000d8a0: 7065 2879 5f74 7261 696e 2920 3d3d 2064  pe(y_train) == d
+0000d8b0: 6173 6b2e 6461 7461 6672 616d 652e 636f  ask.dataframe.co
+0000d8c0: 7265 2e44 6174 6146 7261 6d65 3a0a 2020  re.DataFrame:.  
+0000d8d0: 2020 2020 2020 2020 2020 2323 2320 7369            ### si
+0000d8e0: 6e63 6520 795f 7472 6169 6e20 6973 2064  nce y_train is d
+0000d8f0: 6173 6b20 6466 2061 6e64 2064 6174 615f  ask df and data_
+0000d900: 7475 706c 652e 585f 7472 6169 6e20 6973  tuple.X_train is
+0000d910: 2061 2070 616e 6461 7320 6466 2c20 796f   a pandas df, yo
+0000d920: 7520 6361 6e27 7420 6d65 7267 6520 7468  u can't merge th
+0000d930: 656d 2e0a 2020 2020 2020 2020 2020 2020  em..            
+0000d940: 795f 7472 6169 6e20 3d20 795f 7472 6169  y_train = y_trai
+0000d950: 6e2e 636f 6d70 7574 6528 2920 2023 2323  n.compute()  ###
+0000d960: 2072 656d 656d 6265 7220 796f 7520 6669   remember you fi
+0000d970: 7273 7420 6861 7665 2074 6f20 636f 6e76  rst have to conv
+0000d980: 6572 7420 7468 656d 2074 6f20 6120 7061  ert them to a pa
+0000d990: 6e64 6173 2064 660a 2020 2020 2020 2020  ndas df.        
+0000d9a0: 6461 7461 3120 3d20 7064 2e63 6f6e 6361  data1 = pd.conca
+0000d9b0: 7428 5b64 6174 615f 7475 706c 652e 585f  t([data_tuple.X_
+0000d9c0: 7472 6169 6e2c 2079 5f74 7261 696e 5d2c  train, y_train],
+0000d9d0: 2061 7869 733d 3129 2023 2323 2064 6174   axis=1) ### dat
+0000d9e0: 615f 7475 706c 6520 646f 6573 206e 6f74  a_tuple does not
+0000d9f0: 2068 6176 6520 6120 795f 7472 6169 6e2c   have a y_train,
+0000da00: 2072 656d 656d 6265 7221 0a20 2020 2020   remember!.     
+0000da10: 2020 200a 2020 2020 2020 2020 6966 2069     .        if i
+0000da20: 7369 6e73 7461 6e63 6528 7465 7374 5f64  sinstance(test_d
+0000da30: 6174 612c 2073 7472 2920 6f72 2074 6573  ata, str) or tes
+0000da40: 745f 6461 7461 2069 7320 4e6f 6e65 3a0a  t_data is None:.
+0000da50: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
+0000da60: 5369 6e63 6520 796f 7520 6861 7665 2064  Since you have d
+0000da70: 6f6e 6520 6120 7472 6169 6e5f 7465 7374  one a train_test
+0000da80: 5f73 706c 6974 2075 7369 6e67 2072 616e  _split using ran
+0000da90: 646f 6d69 7a65 6420 7370 6c69 742c 2079  domized split, y
+0000daa0: 6f75 206e 6565 6420 746f 2070 7574 2069  ou need to put i
+0000dab0: 7420 6261 636b 2061 6761 696e 2e0a 2020  t back again..  
+0000dac0: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
+0000dad0: 6528 795f 7465 7374 2920 3d3d 2064 6173  e(y_test) == das
+0000dae0: 6b2e 6461 7461 6672 616d 652e 636f 7265  k.dataframe.core
+0000daf0: 2e44 6174 6146 7261 6d65 3a0a 2020 2020  .DataFrame:.    
+0000db00: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
+0000db10: 7369 6e63 6520 795f 7472 6169 6e20 6973  since y_train is
+0000db20: 2064 6173 6b20 6466 2061 6e64 2064 6174   dask df and dat
+0000db30: 615f 7475 706c 652e 585f 7472 6169 6e20  a_tuple.X_train 
+0000db40: 6973 2061 2070 616e 6461 7320 6466 2c20  is a pandas df, 
+0000db50: 796f 7520 6361 6e27 7420 6d65 7267 6520  you can't merge 
+0000db60: 7468 656d 2e0a 2020 2020 2020 2020 2020  them..          
+0000db70: 2020 2020 2020 795f 7465 7374 203d 2079        y_test = y
+0000db80: 5f74 6573 742e 636f 6d70 7574 6528 2920  _test.compute() 
+0000db90: 2023 2323 2072 656d 656d 6265 7220 796f   ### remember yo
+0000dba0: 7520 6669 7273 7420 6861 7665 2074 6f20  u first have to 
+0000dbb0: 636f 6e76 6572 7420 7468 656d 2074 6f20  convert them to 
+0000dbc0: 6120 7061 6e64 6173 2064 660a 2020 2020  a pandas df.    
+0000dbd0: 2020 2020 2020 2020 6461 7461 3220 3d20          data2 = 
+0000dbe0: 7064 2e63 6f6e 6361 7428 5b64 6174 615f  pd.concat([data_
+0000dbf0: 7475 706c 652e 585f 7465 7374 2c20 795f  tuple.X_test, y_
+0000dc00: 7465 7374 5d2c 2061 7869 733d 3129 0a20  test], axis=1). 
+0000dc10: 2020 2020 2020 2020 2020 2064 6174 616e             datan
+0000dc20: 616d 6520 3d20 6461 7461 312e 6170 7065  ame = data1.appe
+0000dc30: 6e64 2864 6174 6132 290a 2020 2020 2020  nd(data2).      
+0000dc40: 2020 2020 2020 2323 2320 536f 6d65 7469        ### Someti
+0000dc50: 6d65 7320 7468 6572 6520 6172 6520 6475  mes there are du
+0000dc60: 706c 6963 6174 6520 7661 6c75 6573 2069  plicate values i
+0000dc70: 6e20 696e 6465 7820 7768 656e 2079 6f75  n index when you
+0000dc80: 2061 7070 656e 642e 2053 6f20 6a75 7374   append. So just
+0000dc90: 2072 656d 6f76 6520 6475 706c 6963 6174   remove duplicat
+0000dca0: 6573 2068 6572 650a 2020 2020 2020 2020  es here.        
+0000dcb0: 2020 2020 6461 7461 6e61 6d65 203d 2064      dataname = d
+0000dcc0: 6174 616e 616d 655b 7e64 6174 616e 616d  ataname[~datanam
+0000dcd0: 652e 696e 6465 782e 6475 706c 6963 6174  e.index.duplicat
+0000dce0: 6564 2829 5d0a 2020 2020 2020 2020 2020  ed()].          
+0000dcf0: 2020 6461 7461 6e61 6d65 203d 2064 6174    dataname = dat
+0000dd00: 616e 616d 652e 7265 696e 6465 7828 7472  aname.reindex(tr
+0000dd10: 6169 6e5f 696e 6465 7829 0a20 2020 2020  ain_index).     
+0000dd20: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+0000dd30: 2020 436f 6d70 6c65 7465 6420 6665 6174    Completed feat
+0000dd40: 7572 6520 656e 6769 6e65 6572 696e 672e  ure engineering.
+0000dd50: 2053 6861 7065 206f 6620 5472 6169 6e20   Shape of Train 
+0000dd60: 2877 6974 6820 7461 7267 6574 2920 3d20  (with target) = 
+0000dd70: 2573 2720 2528 6461 7461 6e61 6d65 2e73  %s' %(dataname.s
+0000dd80: 6861 7065 2c29 290a 2020 2020 2020 2020  hape,)).        
+0000dd90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000dda0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000ddb0: 2020 2020 2020 2069 6620 7479 7065 2879         if type(y
+0000ddc0: 5f74 6573 7429 203d 3d20 6461 736b 2e64  _test) == dask.d
+0000ddd0: 6174 6166 7261 6d65 2e63 6f72 652e 4461  ataframe.core.Da
+0000dde0: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+0000ddf0: 2020 2020 2020 2020 2020 2020 2023 2323               ###
+0000de00: 2073 696e 6365 2079 5f74 7261 696e 2069   since y_train i
+0000de10: 7320 6461 736b 2064 6620 616e 6420 6461  s dask df and da
+0000de20: 7461 5f74 7570 6c65 2e58 5f74 7261 696e  ta_tuple.X_train
+0000de30: 2069 7320 6120 7061 6e64 6173 2064 662c   is a pandas df,
+0000de40: 2079 6f75 2063 616e 2774 206d 6572 6765   you can't merge
+0000de50: 2074 6865 6d2e 0a20 2020 2020 2020 2020   them..         
+0000de60: 2020 2020 2020 2020 2020 2079 5f74 6573             y_tes
+0000de70: 7420 3d20 795f 7465 7374 2e63 6f6d 7075  t = y_test.compu
+0000de80: 7465 2829 2020 2323 2320 7265 6d65 6d62  te()  ### rememb
+0000de90: 6572 2079 6f75 2066 6972 7374 2068 6176  er you first hav
+0000dea0: 6520 746f 2063 6f6e 7665 7274 2074 6865  e to convert the
+0000deb0: 6d20 746f 2061 2070 616e 6461 7320 6466  m to a pandas df
+0000dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ded0: 2074 6573 745f 6461 7461 203d 2070 642e   test_data = pd.
+0000dee0: 636f 6e63 6174 285b 6461 7461 5f74 7570  concat([data_tup
+0000def0: 6c65 2e58 5f74 6573 742c 2079 5f74 6573  le.X_test, y_tes
+0000df00: 745d 2c20 6178 6973 3d31 290a 2020 2020  t], axis=1).    
+0000df10: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df30: 7465 7374 5f64 6174 6120 3d20 636f 7079  test_data = copy
+0000df40: 2e64 6565 7063 6f70 7928 6461 7461 5f74  .deepcopy(data_t
+0000df50: 7570 6c65 2e58 5f74 6573 7429 0a20 2020  uple.X_test).   
+0000df60: 2020 2020 2020 2020 2023 2323 2053 6f6d           ### Som
+0000df70: 6574 696d 6573 2074 6865 7265 2061 7265  etimes there are
+0000df80: 2064 7570 6c69 6361 7465 2076 616c 7565   duplicate value
+0000df90: 7320 696e 2069 6e64 6578 2077 6865 6e20  s in index when 
+0000dfa0: 796f 7520 6170 7065 6e64 2e20 536f 206a  you append. So j
+0000dfb0: 7573 7420 7265 6d6f 7665 2064 7570 6c69  ust remove dupli
+0000dfc0: 6361 7465 7320 6865 7265 0a20 2020 2020  cates here.     
+0000dfd0: 2020 2020 2020 2074 6573 745f 6461 7461         test_data
+0000dfe0: 203d 2074 6573 745f 6461 7461 5b7e 7465   = test_data[~te
+0000dff0: 7374 5f64 6174 612e 696e 6465 782e 6475  st_data.index.du
+0000e000: 706c 6963 6174 6564 2829 5d0a 2020 2020  plicated()].    
+0000e010: 2020 2020 2020 2020 7465 7374 5f64 6174          test_dat
+0000e020: 6120 3d20 7465 7374 5f64 6174 612e 7265  a = test_data.re
+0000e030: 696e 6465 7828 7465 7374 5f69 6e64 6578  index(test_index
+0000e040: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+0000e050: 7461 6e61 6d65 203d 2063 6f70 792e 6465  taname = copy.de
+0000e060: 6570 636f 7079 2864 6174 6131 290a 2020  epcopy(data1).  
+0000e070: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000e080: 2720 2020 2043 6f6d 706c 6574 6564 2066  '    Completed f
+0000e090: 6561 7475 7265 2065 6e67 696e 6565 7269  eature engineeri
+0000e0a0: 6e67 2e20 5368 6170 6520 6f66 2054 6573  ng. Shape of Tes
+0000e0b0: 7420 2877 6974 6820 7461 7267 6574 2920  t (with target) 
+0000e0c0: 3d20 2573 2720 2528 7465 7374 5f64 6174  = %s' %(test_dat
+0000e0d0: 612e 7368 6170 652c 2929 0a20 2020 2020  a.shape,)).     
+0000e0e0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
 0000e0f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e110: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
-0000e120: 2020 2323 2323 2323 2054 7261 696e 2061    ###### Train a
-0000e130: 6e64 2054 6573 7420 6172 6520 6375 7272  nd Test are curr
-0000e140: 656e 746c 7920 7061 6e64 6173 2064 6174  ently pandas dat
-0000e150: 6120 6672 616d 6573 2065 7665 6e20 6966  a frames even if
-0000e160: 2064 6173 6b5f 7867 626f 6f73 745f 666c   dask_xgboost_fl
-0000e170: 6167 2069 7320 5472 7565 2023 2323 2323  ag is True #####
-0000e180: 2323 230a 2020 2020 2020 2020 2323 2323  ###.        ####
-0000e190: 2323 2020 2054 6861 7420 6973 2062 6563  ##   That is bec
-0000e1a0: 6175 7365 2077 6520 636f 6d62 696e 6564  ause we combined
-0000e1b0: 2074 6865 6d20 6166 7465 7220 6665 6174   them after feat
-0000e1c0: 7572 6520 656e 6767 2074 6f20 7573 696e  ure engg to usin
-0000e1d0: 6720 4361 7465 676f 7279 5f45 6e63 6f64  g Category_Encod
-0000e1e0: 6572 7320 2023 2323 2323 2323 230a 2020  ers  ########.  
-0000e1f0: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
-0000e200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e140: 2323 2323 0a20 2020 2020 2020 2023 2323  ####.        ###
+0000e150: 2323 2320 5472 6169 6e20 616e 6420 5465  ### Train and Te
+0000e160: 7374 2061 7265 2063 7572 7265 6e74 6c79  st are currently
+0000e170: 2070 616e 6461 7320 6461 7461 2066 7261   pandas data fra
+0000e180: 6d65 7320 6576 656e 2069 6620 6461 736b  mes even if dask
+0000e190: 5f78 6762 6f6f 7374 5f66 6c61 6720 6973  _xgboost_flag is
+0000e1a0: 2054 7275 6520 2323 2323 2323 2323 0a20   True ########. 
+0000e1b0: 2020 2020 2020 2023 2323 2323 2320 2020         ######   
+0000e1c0: 5468 6174 2069 7320 6265 6361 7573 6520  That is because 
+0000e1d0: 7765 2063 6f6d 6269 6e65 6420 7468 656d  we combined them
+0000e1e0: 2061 6674 6572 2066 6561 7475 7265 2065   after feature e
+0000e1f0: 6e67 6720 746f 2075 7369 6e67 2043 6174  ngg to using Cat
+0000e200: 6567 6f72 795f 456e 636f 6465 7273 2020  egory_Encoders  
+0000e210: 2323 2323 2323 2323 0a20 2020 2020 2020  ########.       
+0000e220: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
 0000e230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e250: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-0000e260: 7072 6564 7320 3d20 5b78 2066 6f72 2078  preds = [x for x
-0000e270: 2069 6e20 6c69 7374 2864 6174 616e 616d   in list(datanam
-0000e280: 6529 2069 6620 7820 6e6f 7420 696e 2074  e) if x not in t
-0000e290: 6172 6765 745d 0a20 2020 2020 2020 206e  arget].        n
-0000e2a0: 756d 7661 7273 203d 2064 6174 616e 616d  umvars = datanam
-0000e2b0: 655b 7072 6564 735d 2e73 656c 6563 745f  e[preds].select_
-0000e2c0: 6474 7970 6573 2869 6e63 6c75 6465 203d  dtypes(include =
-0000e2d0: 2027 6e75 6d62 6572 2729 2e63 6f6c 756d   'number').colum
-0000e2e0: 6e73 2e74 6f6c 6973 7428 290a 2020 2020  ns.tolist().    
-0000e2f0: 2020 2020 6966 2063 6174 5f76 6172 733a      if cat_vars:
-0000e300: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
-0000e310: 2320 6966 2063 6174 5f76 6172 7320 696e  # if cat_vars in
-0000e320: 7075 7420 6973 2067 6976 656e 2c20 7573  put is given, us
-0000e330: 6520 6974 210a 2020 2020 2020 2020 2020  e it!.          
-0000e340: 2020 6361 7476 6172 7320 3d20 636f 7079    catvars = copy
-0000e350: 2e64 6565 7063 6f70 7928 6361 745f 7661  .deepcopy(cat_va
-0000e360: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
-0000e370: 6e75 6d76 6172 7320 3d20 6c65 6674 5f73  numvars = left_s
-0000e380: 7562 7472 6163 7428 7072 6564 732c 2063  ubtract(preds, c
-0000e390: 6174 7661 7273 290a 2020 2020 2020 2020  atvars).        
-0000e3a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000e3b0: 2020 6361 7476 6172 7320 3d20 6c65 6674    catvars = left
-0000e3c0: 5f73 7562 7472 6163 7428 7072 6564 732c  _subtract(preds,
-0000e3d0: 206e 756d 7661 7273 290a 2020 2020 2323   numvars).    ##
-0000e3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e3f0: 2323 2323 2020 2049 204d 2050 204f 2052  ####   I M P O R
-0000e400: 2054 2041 204e 2054 2023 2323 2323 2323   T A N T #######
-0000e410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e430: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
-0000e440: 2323 2054 6869 7320 746f 705f 6e75 6d20  ## This top_num 
-0000e450: 6465 6369 6465 7320 686f 7720 6d61 6e79  decides how many
-0000e460: 2074 6f70 5f6e 2066 6561 7475 7265 7320   top_n features 
-0000e470: 5847 4220 7365 6c65 6374 7320 696e 2065  XGB selects in e
-0000e480: 6163 6820 6974 6572 6174 696f 6e2e 0a20  ach iteration.. 
-0000e490: 2020 2023 2323 2320 2054 6865 7265 2061     ####  There a
-0000e4a0: 2074 6f74 616c 206f 6620 3520 6974 6572   total of 5 iter
-0000e4b0: 6174 696f 6e73 2e20 4865 6e63 6520 3578  ations. Hence 5x
-0000e4c0: 3130 206d 6561 6e73 206d 6178 696d 756d  10 means maximum
-0000e4d0: 2035 3020 6665 6174 7572 6573 2077 696c   50 features wil
-0000e4e0: 6c20 6265 2073 656c 6563 7465 642e 0a20  l be selected.. 
-0000e4f0: 2020 2023 2323 2323 2020 4966 2074 6865     #####  If the
-0000e500: 7265 2061 7265 206d 6f72 6520 7468 616e  re are more than
-0000e510: 2035 3020 7661 7269 6162 6c65 732c 2074   50 variables, t
-0000e520: 6865 6e20 6d61 7869 6d75 6d20 3235 2520  hen maximum 25% 
-0000e530: 6f66 2069 7473 2076 6172 6961 626c 6573  of its variables
-0000e540: 2077 696c 6c20 6265 2073 656c 6563 7465   will be selecte
-0000e550: 640a 2020 2020 6966 206c 656e 2870 7265  d.    if len(pre
-0000e560: 6473 2920 3c3d 2035 303a 0a20 2020 2020  ds) <= 50:.     
-0000e570: 2020 2023 746f 705f 6e75 6d20 3d20 3130     #top_num = 10
-0000e580: 0a20 2020 2020 2020 2074 6f70 5f6e 756d  .        top_num
-0000e590: 203d 2069 6e74 286d 6178 2832 2c20 6c65   = int(max(2, le
-0000e5a0: 6e28 7072 6564 7329 2a30 2e32 3529 290a  n(preds)*0.25)).
-0000e5b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000e5c0: 2020 2323 2320 7468 6520 6d61 7869 6d75    ### the maximu
-0000e5d0: 6d20 6e75 6d62 6572 206f 6620 7661 7269  m number of vari
-0000e5e0: 6162 6c65 7320 7769 6c6c 2032 3525 206f  ables will 25% o
-0000e5f0: 6620 7072 6564 7320 7768 6963 6820 6d65  f preds which me
-0000e600: 616e 7320 7765 2064 6976 6964 6520 6279  ans we divide by
-0000e610: 2035 2061 6e64 2067 6574 2035 2520 6865   5 and get 5% he
-0000e620: 7265 0a20 2020 2020 2020 2023 2323 2054  re.        ### T
-0000e630: 6865 2066 6976 6520 6974 6572 6174 696f  he five iteratio
-0000e640: 6e73 2072 6573 756c 7420 696e 2031 3025  ns result in 10%
-0000e650: 2062 6569 6e67 2063 686f 7365 6e20 696e   being chosen in
-0000e660: 2065 6163 6820 6974 6572 6174 696f 6e2e   each iteration.
-0000e670: 2048 656e 6365 206d 6178 2035 3025 206f   Hence max 50% o
-0000e680: 6620 7661 7269 6162 6c65 7321 0a20 2020  f variables!.   
-0000e690: 2020 2020 2074 6f70 5f6e 756d 203d 2069       top_num = i
-0000e6a0: 6e74 286c 656e 2870 7265 6473 292a 302e  nt(len(preds)*0.
-0000e6b0: 3230 290a 2020 2020 2323 2323 2323 2323  20).    ########
-0000e6c0: 2323 2323 2323 2323 2323 2323 2323 2020  ##############  
-0000e6d0: 2049 204d 2050 204f 2052 2054 2041 204e   I M P O R T A N
-0000e6e0: 2054 2023 2323 2323 2323 2323 2323 2323   T #############
-0000e6f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e710: 230a 2020 2020 696d 706f 7274 616e 745f  #.    important_
-0000e720: 6361 7473 203d 2063 6f70 792e 6465 6570  cats = copy.deep
-0000e730: 636f 7079 2863 6174 7661 7273 290a 2020  copy(catvars).  
-0000e740: 2020 6461 7461 5f64 696d 203d 2069 6e74    data_dim = int
-0000e750: 2828 6c65 6e28 6461 7461 6e61 6d65 292a  ((len(dataname)*
-0000e760: 6461 7461 6e61 6d65 2e73 6861 7065 5b31  dataname.shape[1
-0000e770: 5d29 2f31 6536 290a 2020 2020 2323 2323  ])/1e6).    ####
-0000e780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e280: 2323 0a20 2020 2020 2020 2070 7265 6473  ##.        preds
+0000e290: 203d 205b 7820 666f 7220 7820 696e 206c   = [x for x in l
+0000e2a0: 6973 7428 6461 7461 6e61 6d65 2920 6966  ist(dataname) if
+0000e2b0: 2078 206e 6f74 2069 6e20 7461 7267 6574   x not in target
+0000e2c0: 5d0a 2020 2020 2020 2020 6e75 6d76 6172  ].        numvar
+0000e2d0: 7320 3d20 6461 7461 6e61 6d65 5b70 7265  s = dataname[pre
+0000e2e0: 6473 5d2e 7365 6c65 6374 5f64 7479 7065  ds].select_dtype
+0000e2f0: 7328 696e 636c 7564 6520 3d20 276e 756d  s(include = 'num
+0000e300: 6265 7227 292e 636f 6c75 6d6e 732e 746f  ber').columns.to
+0000e310: 6c69 7374 2829 0a20 2020 2020 2020 2069  list().        i
+0000e320: 6620 6361 745f 7661 7273 3a0a 2020 2020  f cat_vars:.    
+0000e330: 2020 2020 2020 2020 2323 2323 2069 6620          #### if 
+0000e340: 6361 745f 7661 7273 2069 6e70 7574 2069  cat_vars input i
+0000e350: 7320 6769 7665 6e2c 2075 7365 2069 7421  s given, use it!
+0000e360: 0a20 2020 2020 2020 2020 2020 2063 6174  .            cat
+0000e370: 7661 7273 203d 2063 6f70 792e 6465 6570  vars = copy.deep
+0000e380: 636f 7079 2863 6174 5f76 6172 7329 0a20  copy(cat_vars). 
+0000e390: 2020 2020 2020 2020 2020 206e 756d 7661             numva
+0000e3a0: 7273 203d 206c 6566 745f 7375 6274 7261  rs = left_subtra
+0000e3b0: 6374 2870 7265 6473 2c20 6361 7476 6172  ct(preds, catvar
+0000e3c0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
+0000e3d0: 0a20 2020 2020 2020 2020 2020 2063 6174  .            cat
+0000e3e0: 7661 7273 203d 206c 6566 745f 7375 6274  vars = left_subt
+0000e3f0: 7261 6374 2870 7265 6473 2c20 6e75 6d76  ract(preds, numv
+0000e400: 6172 7329 0a20 2020 2023 2323 2323 2323  ars).    #######
+0000e410: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+0000e420: 2020 4920 4d20 5020 4f20 5220 5420 4120    I M P O R T A 
+0000e430: 4e20 5420 2323 2323 2323 2323 2323 2323  N T ############
+0000e440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e460: 2323 0a20 2020 2023 2323 2323 2320 5468  ##.    ###### Th
+0000e470: 6973 2074 6f70 5f6e 756d 2064 6563 6964  is top_num decid
+0000e480: 6573 2068 6f77 206d 616e 7920 746f 705f  es how many top_
+0000e490: 6e20 6665 6174 7572 6573 2058 4742 2073  n features XGB s
+0000e4a0: 656c 6563 7473 2069 6e20 6561 6368 2069  elects in each i
+0000e4b0: 7465 7261 7469 6f6e 2e0a 2020 2020 2323  teration..    ##
+0000e4c0: 2323 2020 5468 6572 6520 6120 746f 7461  ##  There a tota
+0000e4d0: 6c20 6f66 2035 2069 7465 7261 7469 6f6e  l of 5 iteration
+0000e4e0: 732e 2048 656e 6365 2035 7831 3020 6d65  s. Hence 5x10 me
+0000e4f0: 616e 7320 6d61 7869 6d75 6d20 3530 2066  ans maximum 50 f
+0000e500: 6561 7475 7265 7320 7769 6c6c 2062 6520  eatures will be 
+0000e510: 7365 6c65 6374 6564 2e0a 2020 2020 2323  selected..    ##
+0000e520: 2323 2320 2049 6620 7468 6572 6520 6172  ###  If there ar
+0000e530: 6520 6d6f 7265 2074 6861 6e20 3530 2076  e more than 50 v
+0000e540: 6172 6961 626c 6573 2c20 7468 656e 206d  ariables, then m
+0000e550: 6178 696d 756d 2032 3525 206f 6620 6974  aximum 25% of it
+0000e560: 7320 7661 7269 6162 6c65 7320 7769 6c6c  s variables will
+0000e570: 2062 6520 7365 6c65 6374 6564 0a20 2020   be selected.   
+0000e580: 2069 6620 6c65 6e28 7072 6564 7329 203c   if len(preds) <
+0000e590: 3d20 3530 3a0a 2020 2020 2020 2020 2374  = 50:.        #t
+0000e5a0: 6f70 5f6e 756d 203d 2031 300a 2020 2020  op_num = 10.    
+0000e5b0: 2020 2020 746f 705f 6e75 6d20 3d20 696e      top_num = in
+0000e5c0: 7428 6d61 7828 322c 206c 656e 2870 7265  t(max(2, len(pre
+0000e5d0: 6473 292a 302e 3235 2929 0a20 2020 2065  ds)*0.25)).    e
+0000e5e0: 6c73 653a 0a20 2020 2020 2020 2023 2323  lse:.        ###
+0000e5f0: 2074 6865 206d 6178 696d 756d 206e 756d   the maximum num
+0000e600: 6265 7220 6f66 2076 6172 6961 626c 6573  ber of variables
+0000e610: 2077 696c 6c20 3235 2520 6f66 2070 7265   will 25% of pre
+0000e620: 6473 2077 6869 6368 206d 6561 6e73 2077  ds which means w
+0000e630: 6520 6469 7669 6465 2062 7920 3520 616e  e divide by 5 an
+0000e640: 6420 6765 7420 3525 2068 6572 650a 2020  d get 5% here.  
+0000e650: 2020 2020 2020 2323 2320 5468 6520 6669        ### The fi
+0000e660: 7665 2069 7465 7261 7469 6f6e 7320 7265  ve iterations re
+0000e670: 7375 6c74 2069 6e20 3130 2520 6265 696e  sult in 10% bein
+0000e680: 6720 6368 6f73 656e 2069 6e20 6561 6368  g chosen in each
+0000e690: 2069 7465 7261 7469 6f6e 2e20 4865 6e63   iteration. Henc
+0000e6a0: 6520 6d61 7820 3530 2520 6f66 2076 6172  e max 50% of var
+0000e6b0: 6961 626c 6573 210a 2020 2020 2020 2020  iables!.        
+0000e6c0: 746f 705f 6e75 6d20 3d20 696e 7428 6c65  top_num = int(le
+0000e6d0: 6e28 7072 6564 7329 2a30 2e32 3029 0a20  n(preds)*0.20). 
+0000e6e0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+0000e6f0: 2323 2323 2323 2323 2320 2020 4920 4d20  #########   I M 
+0000e700: 5020 4f20 5220 5420 4120 4e20 5420 2323  P O R T A N T ##
+0000e710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e730: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+0000e740: 2069 6d70 6f72 7461 6e74 5f63 6174 7320   important_cats 
+0000e750: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0000e760: 6361 7476 6172 7329 0a20 2020 2064 6174  catvars).    dat
+0000e770: 615f 6469 6d20 3d20 696e 7428 286c 656e  a_dim = int((len
+0000e780: 2864 6174 616e 616d 6529 2a64 6174 616e  (dataname)*datan
+0000e790: 616d 652e 7368 6170 655b 315d 292f 3165  ame.shape[1])/1e
+0000e7a0: 3629 0a20 2020 2023 2323 2323 2323 2323  6).    #########
 0000e7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e7d0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-0000e7e0: 2023 2323 2323 2323 2323 2323 2320 2020   ############   
-0000e7f0: 2020 5320 2020 5520 204c 2020 4f20 2020    S   U  L  O   
-0000e800: 5620 2020 2020 2020 4d20 2020 4520 2020  V       M   E   
-0000e810: 5420 2020 4820 2020 4f20 2044 2020 2020  T   H   O  D    
-0000e820: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0000e830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e840: 230a 2020 2020 2323 2323 2049 6620 7468  #.    #### If th
-0000e850: 6520 6461 7461 2064 696d 656e 7369 6f6e  e data dimension
-0000e860: 2069 7320 6c65 7373 2074 6861 6e20 356f   is less than 5o
-0000e870: 204d 696c 6c69 6f6e 2074 6865 6e20 646f   Million then do
-0000e880: 2053 554c 4f56 202d 206f 7468 6572 7769   SULOV - otherwi
-0000e890: 7365 2073 6b69 7020 6974 2120 2323 2323  se skip it! ####
-0000e8a0: 2323 2323 230a 2020 2020 2323 2323 2323  #####.    ######
-0000e8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e7d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e7e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e7f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e800: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
+0000e810: 2323 2323 2323 2323 2020 2020 2053 2020  ########     S  
+0000e820: 2055 2020 4c20 204f 2020 2056 2020 2020   U  L  O   V    
+0000e830: 2020 204d 2020 2045 2020 2054 2020 2048     M   E   T   H
+0000e840: 2020 204f 2020 4420 2020 2020 2023 2323     O  D      ###
+0000e850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e860: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+0000e870: 2023 2323 2320 4966 2074 6865 2064 6174   #### If the dat
+0000e880: 6120 6469 6d65 6e73 696f 6e20 6973 206c  a dimension is l
+0000e890: 6573 7320 7468 616e 2035 6f20 4d69 6c6c  ess than 5o Mill
+0000e8a0: 696f 6e20 7468 656e 2064 6f20 5355 4c4f  ion then do SULO
+0000e8b0: 5620 2d20 6f74 6865 7277 6973 6520 736b  V - otherwise sk
+0000e8c0: 6970 2069 7421 2023 2323 2323 2323 2323  ip it! #########
+0000e8d0: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
 0000e8e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000e8f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e900: 2323 2323 2323 2323 2323 0a20 2020 2063  ##########.    c
-0000e910: 6f6c 735f 7769 7468 5f69 6e66 696e 6974  ols_with_infinit
-0000e920: 7920 3d20 4544 415f 6669 6e64 5f72 656d  y = EDA_find_rem
-0000e930: 6f76 655f 636f 6c75 6d6e 735f 7769 7468  ove_columns_with
-0000e940: 5f69 6e66 696e 6974 7928 6461 7461 6e61  _infinity(datana
-0000e950: 6d65 290a 2020 2020 2320 6669 7273 7420  me).    # first 
-0000e960: 796f 7520 6d75 7374 2064 726f 7020 726f  you must drop ro
-0000e970: 7773 2074 6861 7420 6861 7665 2069 6e66  ws that have inf
-0000e980: 2069 6e20 7468 656d 2023 2323 230a 2020   in them ####.  
-0000e990: 2020 6966 2063 6f6c 735f 7769 7468 5f69    if cols_with_i
-0000e9a0: 6e66 696e 6974 793a 0a20 2020 2020 2020  nfinity:.       
-0000e9b0: 2070 7269 6e74 2827 4472 6f70 7065 6420   print('Dropped 
-0000e9c0: 2564 2063 6f6c 756d 6e73 2077 6869 6368  %d columns which
-0000e9d0: 2063 6f6e 7461 696e 2069 6e66 696e 6974   contain infinit
-0000e9e0: 7920 696e 2064 6174 6173 6574 2720 256c  y in dataset' %l
-0000e9f0: 656e 2863 6f6c 735f 7769 7468 5f69 6e66  en(cols_with_inf
-0000ea00: 696e 6974 7929 290a 2020 2020 2020 2020  inity)).        
-0000ea10: 2364 6174 616e 616d 6520 3d20 4645 5f64  #dataname = FE_d
-0000ea20: 726f 705f 726f 7773 5f77 6974 685f 696e  rop_rows_with_in
-0000ea30: 6669 6e69 7479 2864 6174 616e 616d 652c  finity(dataname,
-0000ea40: 2063 6f6c 735f 7769 7468 5f69 6e66 696e   cols_with_infin
-0000ea50: 6974 792c 2066 696c 6c5f 7661 6c75 653d  ity, fill_value=
-0000ea60: 5472 7565 290a 2020 2020 2020 2020 6461  True).        da
-0000ea70: 7461 6e61 6d65 203d 2064 6174 616e 616d  taname = datanam
-0000ea80: 652e 6472 6f70 2863 6f6c 735f 7769 7468  e.drop(cols_with
-0000ea90: 5f69 6e66 696e 6974 792c 2061 7869 733d  _infinity, axis=
-0000eaa0: 3129 0a20 2020 2020 2020 2070 7269 6e74  1).        print
-0000eab0: 2827 2573 2720 2563 6f6c 735f 7769 7468  ('%s' %cols_with
-0000eac0: 5f69 6e66 696e 6974 7929 0a20 2020 2020  _infinity).     
-0000ead0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000eae0: 2874 6573 745f 6461 7461 2c73 7472 2920  (test_data,str) 
-0000eaf0: 6f72 2074 6573 745f 6461 7461 2069 7320  or test_data is 
-0000eb00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000eb10: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
-0000eb20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000eb30: 2074 6573 745f 6461 7461 203d 2074 6573   test_data = tes
-0000eb40: 745f 6461 7461 2e64 726f 7028 636f 6c73  t_data.drop(cols
-0000eb50: 5f77 6974 685f 696e 6669 6e69 7479 2c20  _with_infinity, 
-0000eb60: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
-0000eb70: 2020 2020 7072 696e 7428 2720 2020 2020      print('     
-0000eb80: 6472 6f70 7065 6420 2573 2063 6f6c 756d  dropped %s colum
-0000eb90: 6e73 2077 6974 6820 696e 6669 6e69 7479  ns with infinity
-0000eba0: 2066 726f 6d20 7465 7374 2064 6174 612e   from test data.
-0000ebb0: 2e2e 2720 256c 656e 2863 6f6c 735f 7769  ..' %len(cols_wi
-0000ebc0: 7468 5f69 6e66 696e 6974 7929 290a 2020  th_infinity)).  
-0000ebd0: 2020 2020 2020 6e75 6d76 6172 7320 3d20        numvars = 
-0000ebe0: 6c65 6674 5f73 7562 7472 6163 7428 6e75  left_subtract(nu
-0000ebf0: 6d76 6172 732c 2063 6f6c 735f 7769 7468  mvars, cols_with
-0000ec00: 5f69 6e66 696e 6974 7929 0a20 2020 2020  _infinity).     
-0000ec10: 2020 2070 7269 6e74 2827 2020 2020 206e     print('     n
-0000ec20: 756d 6572 6963 2066 6561 7475 7265 7320  umeric features 
-0000ec30: 6c65 6674 203d 2025 7327 2025 6c65 6e28  left = %s' %len(
-0000ec40: 6e75 6d76 6172 7329 290a 2020 2020 2323  numvars)).    ##
-0000ec50: 2323 2323 2320 2054 6869 7320 6973 2077  #####  This is w
-0000ec60: 6865 7265 2079 6f75 2073 7461 7274 2074  here you start t
-0000ec70: 6865 2053 554c 4f56 2070 726f 6365 7373  he SULOV process
-0000ec80: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-0000ec90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000eca0: 2323 2320 2020 200a 2020 2020 7374 6172  ###    .    star
-0000ecb0: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
-0000ecc0: 696d 6528 290a 2020 2020 6966 206c 656e  ime().    if len
-0000ecd0: 286e 756d 7661 7273 2920 3e20 3120 616e  (numvars) > 1 an
-0000ece0: 6420 6e6f 7420 736b 6970 5f73 756c 6f76  d not skip_sulov
-0000ecf0: 3a0a 2020 2020 2020 2020 6966 2064 6174  :.        if dat
-0000ed00: 615f 6469 6d20 3c20 3530 3a0a 2020 2020  a_dim < 50:.    
-0000ed10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000ed20: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-0000ed30: 616c 5f6c 6973 7420 3d20 4645 5f72 656d  al_list = FE_rem
-0000ed40: 6f76 655f 7661 7269 6162 6c65 735f 7573  ove_variables_us
-0000ed50: 696e 675f 5355 4c4f 565f 6d65 7468 6f64  ing_SULOV_method
-0000ed60: 2864 6174 616e 616d 652c 6e75 6d76 6172  (dataname,numvar
-0000ed70: 732c 7365 7474 696e 6773 2e6d 6f64 656c  s,settings.model
-0000ed80: 7479 7065 2c74 6172 6765 742c 0a20 2020  type,target,.   
-0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eda0: 2020 2020 2020 2020 2020 636f 7272 5f6c            corr_l
-0000edb0: 696d 6974 2c76 6572 626f 7365 2c20 6461  imit,verbose, da
-0000edc0: 736b 5f78 6762 6f6f 7374 5f66 6c61 6729  sk_xgboost_flag)
-0000edd0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0000ede0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0000edf0: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
-0000ee00: 5355 4c4f 5620 6d65 7468 6f64 2069 7320  SULOV method is 
-0000ee10: 6572 726f 7269 6e67 2e20 436f 6e74 696e  erroring. Contin
-0000ee20: 7569 6e67 202e 2e2e 2729 0a20 2020 2020  uing ...').     
-0000ee30: 2020 2020 2020 2020 2020 2066 696e 616c             final
-0000ee40: 5f6c 6973 7420 3d20 636f 7079 2e64 6565  _list = copy.dee
-0000ee50: 7063 6f70 7928 6e75 6d76 6172 7329 0a20  pcopy(numvars). 
-0000ee60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000ee70: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000ee80: 6e74 2827 2020 2020 5275 6e6e 696e 6720  nt('    Running 
-0000ee90: 5355 4c4f 5620 6f6e 2073 6d61 6c6c 6572  SULOV on smaller
-0000eea0: 2064 6174 6173 6574 2073 616d 706c 6520   dataset sample 
-0000eeb0: 7369 6e63 6520 6461 7461 2073 697a 6520  since data size 
-0000eec0: 2573 206d 203e 2035 3020 6d2e 2043 6f6e  %s m > 50 m. Con
-0000eed0: 7469 6e75 696e 6720 2e2e 2e27 2025 696e  tinuing ...' %in
-0000eee0: 7428 6461 7461 5f64 696d 2929 0a20 2020  t(data_dim)).   
-0000eef0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ef00: 7365 7474 696e 6773 2e6d 6f64 656c 7479  settings.modelty
-0000ef10: 7065 2021 3d20 2752 6567 7265 7373 696f  pe != 'Regressio
-0000ef20: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-0000ef30: 2020 2020 2020 2020 6461 7461 5f74 656d          data_tem
-0000ef40: 7020 3d20 6461 7461 6e61 6d65 2e73 616d  p = dataname.sam
-0000ef50: 706c 6528 6e3d 3130 3030 302c 2072 6570  ple(n=10000, rep
-0000ef60: 6c61 6365 3d54 7275 652c 2072 616e 646f  lace=True, rando
-0000ef70: 6d5f 7374 6174 653d 3939 290a 2020 2020  m_state=99).    
-0000ef80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000ef90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000efa0: 2020 2020 2020 6461 7461 5f74 656d 7020        data_temp 
-0000efb0: 3d20 6461 7461 6e61 6d65 5b3a 3130 3030  = dataname[:1000
-0000efc0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-0000efd0: 2020 2066 696e 616c 5f6c 6973 7420 3d20     final_list = 
-0000efe0: 4645 5f72 656d 6f76 655f 7661 7269 6162  FE_remove_variab
-0000eff0: 6c65 735f 7573 696e 675f 5355 4c4f 565f  les_using_SULOV_
-0000f000: 6d65 7468 6f64 2864 6174 615f 7465 6d70  method(data_temp
-0000f010: 2c6e 756d 7661 7273 2c73 6574 7469 6e67  ,numvars,setting
-0000f020: 732e 6d6f 6465 6c74 7970 652c 7461 7267  s.modeltype,targ
-0000f030: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f050: 2063 6f72 725f 6c69 6d69 742c 7665 7262   corr_limit,verb
-0000f060: 6f73 652c 2064 6173 6b5f 7867 626f 6f73  ose, dask_xgboos
-0000f070: 745f 666c 6167 290a 2020 2020 2020 2020  t_flag).        
-0000f080: 2020 2020 2020 2020 6465 6c20 6461 7461          del data
-0000f090: 5f74 656d 700a 2020 2020 656c 6966 2073  _temp.    elif s
-0000f0a0: 6b69 705f 7375 6c6f 763a 0a20 2020 2020  kip_sulov:.     
-0000f0b0: 2020 2070 7269 6e74 2827 2020 2020 536b     print('    Sk
-0000f0c0: 6970 7069 6e67 2053 554c 4f56 206d 6574  ipping SULOV met
-0000f0d0: 686f 642e 2043 6f6e 7469 6e75 696e 6720  hod. Continuing 
-0000f0e0: 2e2e 2e27 290a 2020 2020 2020 2020 6669  ...').        fi
-0000f0f0: 6e61 6c5f 6c69 7374 203d 2063 6f70 792e  nal_list = copy.
-0000f100: 6465 6570 636f 7079 286e 756d 7661 7273  deepcopy(numvars
-0000f110: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-0000f120: 2020 2020 7072 696e 7428 2720 2020 2053      print('    S
-0000f130: 6b69 7070 696e 6720 5355 4c4f 5620 6d65  kipping SULOV me
-0000f140: 7468 6f64 2073 696e 6365 2074 6865 7265  thod since there
-0000f150: 2061 7265 206e 6f20 636f 6e74 696e 756f   are no continuo
-0000f160: 7573 2076 6172 732e 2043 6f6e 7469 6e75  us vars. Continu
-0000f170: 696e 6720 2e2e 2e27 290a 2020 2020 2020  ing ...').      
-0000f180: 2020 6669 6e61 6c5f 6c69 7374 203d 2063    final_list = c
-0000f190: 6f70 792e 6465 6570 636f 7079 286e 756d  opy.deepcopy(num
-0000f1a0: 7661 7273 290a 2020 2020 2323 2323 2323  vars).    ######
-0000f1b0: 2320 5468 6973 2069 7320 7768 6572 6520  # This is where 
-0000f1c0: 796f 7520 6472 6177 2068 6f77 2066 6561  you draw how fea
-0000f1d0: 7475 7265 7769 7a20 776f 726b 7320 7768  turewiz works wh
-0000f1e0: 656e 2074 6865 2076 6572 626f 7365 203d  en the verbose =
-0000f1f0: 2032 2023 2323 2323 2323 2323 2323 0a20   2 ###########. 
-0000f200: 2020 2070 7269 6e74 2827 5469 6d65 2074     print('Time t
-0000f210: 616b 656e 2066 6f72 2053 554c 4f56 206d  aken for SULOV m
-0000f220: 6574 686f 6420 3d20 2530 2e30 6620 7365  ethod = %0.0f se
-0000f230: 636f 6e64 7327 2025 2874 696d 652e 7469  conds' %(time.ti
-0000f240: 6d65 2829 2d73 7461 7274 5f74 696d 6531  me()-start_time1
-0000f250: 2929 0a20 2020 2023 2323 2320 4e6f 7720  )).    #### Now 
-0000f260: 7765 2063 7265 6174 6520 696e 7465 7261  we create intera
-0000f270: 6374 696f 6e20 7661 7269 6162 6c65 7320  ction variables 
-0000f280: 6265 7477 6565 6e20 6361 7465 676f 7269  between categori
-0000f290: 6361 6c20 6665 6174 7572 6573 2023 2323  cal features ###
-0000f2a0: 2323 2323 230a 2020 2020 6966 2076 6572  #####.    if ver
-0000f2b0: 626f 7365 3a0a 2020 2020 2020 2020 7072  bose:.        pr
-0000f2c0: 696e 7428 2720 2020 2041 6464 696e 6720  int('    Adding 
-0000f2d0: 2573 2063 6174 6567 6f72 6963 616c 2076  %s categorical v
-0000f2e0: 6172 6961 626c 6573 2074 6f20 7265 6475  ariables to redu
-0000f2f0: 6365 6420 6e75 6d65 7269 6320 7661 7269  ced numeric vari
-0000f300: 6162 6c65 7320 206f 6620 2564 2720 2528  ables  of %d' %(
-0000f310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f330: 206c 656e 2869 6d70 6f72 7461 6e74 5f63   len(important_c
-0000f340: 6174 7329 2c6c 656e 2866 696e 616c 5f6c  ats),len(final_l
-0000f350: 6973 7429 2929 0a20 2020 2069 6620 2069  ist))).    if  i
-0000f360: 7369 6e73 7461 6e63 6528 6669 6e61 6c5f  sinstance(final_
-0000f370: 6c69 7374 2c6e 702e 6e64 6172 7261 7929  list,np.ndarray)
-0000f380: 3a0a 2020 2020 2020 2020 6669 6e61 6c5f  :.        final_
-0000f390: 6c69 7374 203d 2066 696e 616c 5f6c 6973  list = final_lis
-0000f3a0: 742e 746f 6c69 7374 2829 0a20 2020 2070  t.tolist().    p
-0000f3b0: 7265 6473 203d 2066 696e 616c 5f6c 6973  reds = final_lis
-0000f3c0: 742b 696d 706f 7274 616e 745f 6361 7473  t+important_cats
-0000f3d0: 0a20 2020 2069 6620 7665 7262 6f73 6520  .    if verbose 
-0000f3e0: 616e 6420 6c65 6e28 7072 6564 7329 203c  and len(preds) <
-0000f3f0: 3d20 3330 3a0a 2020 2020 2020 2020 7072  = 30:.        pr
-0000f400: 696e 7428 2746 696e 616c 206c 6973 7420  int('Final list 
-0000f410: 6f66 2073 656c 6563 7465 6420 2573 2076  of selected %s v
-0000f420: 6172 7320 6166 7465 7220 5355 4c4f 5620  ars after SULOV 
-0000f430: 3d20 2573 2720 2528 6c65 6e28 7072 6564  = %s' %(len(pred
-0000f440: 7329 2c20 7072 6564 7329 290a 2020 2020  s), preds)).    
-0000f450: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
-0000f460: 696e 7428 2746 696e 616c 6c79 2025 7320  int('Finally %s 
-0000f470: 7661 7273 2073 656c 6563 7465 6420 6166  vars selected af
-0000f480: 7465 7220 5355 4c4f 5627 2025 286c 656e  ter SULOV' %(len
-0000f490: 2870 7265 6473 2929 290a 2020 2020 2323  (preds))).    ##
-0000f4a0: 2323 2323 2359 6f75 206d 7573 7420 636f  #####You must co
-0000f4b0: 6e76 6572 7420 6361 7465 676f 7279 2076  nvert category v
-0000f4c0: 6172 6961 626c 6573 2069 6e74 6f20 696e  ariables into in
-0000f4d0: 7465 6765 7273 2023 2323 2323 2323 2323  tegers #########
-0000f4e0: 2323 2323 2323 2020 2020 0a20 2020 2070  ######    .    p
-0000f4f0: 7269 6e74 2827 436f 6e76 6572 7469 6e67  rint('Converting
-0000f500: 2061 6c6c 2066 6561 7475 7265 7320 746f   all features to
-0000f510: 206e 756d 6572 6963 2062 6566 6f72 6520   numeric before 
-0000f520: 7365 6e64 696e 6720 746f 2058 4742 6f6f  sending to XGBoo
-0000f530: 7374 2e2e 2e27 290a 2020 2020 6966 2069  st...').    if i
-0000f540: 7369 6e73 7461 6e63 6528 7461 7267 6574  sinstance(target
-0000f550: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-0000f560: 6461 7461 6e61 6d65 203d 2064 6174 616e  dataname = datan
-0000f570: 616d 655b 7072 6564 732b 5b74 6172 6765  ame[preds+[targe
-0000f580: 745d 5d0a 2020 2020 656c 7365 3a0a 2020  t]].    else:.  
-0000f590: 2020 2020 2020 6461 7461 6e61 6d65 203d        dataname =
-0000f5a0: 2064 6174 616e 616d 655b 7072 6564 732b   dataname[preds+
-0000f5b0: 7461 7267 6574 5d0a 2020 2020 0a20 2020  target].    .   
-0000f5c0: 2069 6620 6e6f 7420 7465 7374 5f64 6174   if not test_dat
-0000f5d0: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
-0000f5e0: 2020 2074 6573 745f 6461 7461 203d 2074     test_data = t
-0000f5f0: 6573 745f 6461 7461 5b70 7265 6473 5d0a  est_data[preds].
-0000f600: 2020 2020 6966 206c 656e 2869 6d70 6f72      if len(impor
-0000f610: 7461 6e74 5f63 6174 7329 203e 2030 3a0a  tant_cats) > 0:.
-0000f620: 2020 2020 2020 2020 6461 7461 6e61 6d65          dataname
-0000f630: 2c20 7465 7374 5f64 6174 612c 2065 7272  , test_data, err
-0000f640: 6f72 5f63 6f6c 756d 6e73 203d 2046 455f  or_columns = FE_
-0000f650: 636f 6e76 6572 745f 616c 6c5f 6f62 6a65  convert_all_obje
-0000f660: 6374 5f63 6f6c 756d 6e73 5f74 6f5f 6e75  ct_columns_to_nu
-0000f670: 6d65 7269 6328 6461 7461 6e61 6d65 2c20  meric(dataname, 
-0000f680: 2074 6573 745f 6461 7461 2c20 7072 6564   test_data, pred
-0000f690: 7329 0a20 2020 2020 2020 2069 6d70 6f72  s).        impor
-0000f6a0: 7461 6e74 5f63 6174 7320 3d20 6c65 6674  tant_cats = left
-0000f6b0: 5f73 7562 7472 6163 7428 696d 706f 7274  _subtract(import
-0000f6c0: 616e 745f 6361 7473 2c20 6572 726f 725f  ant_cats, error_
-0000f6d0: 636f 6c75 6d6e 7329 0a20 2020 2020 2020  columns).       
-0000f6e0: 2069 6620 6c65 6e28 6572 726f 725f 636f   if len(error_co
-0000f6f0: 6c75 6d6e 7329 203e 2030 3a0a 2020 2020  lumns) > 0:.    
-0000f700: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0000f710: 2020 2072 656d 6f76 696e 6720 2573 206f     removing %s o
-0000f720: 626a 6563 7420 636f 6c75 6d6e 7320 7468  bject columns th
-0000f730: 6174 2063 6f75 6c64 206e 6f74 2062 6520  at could not be 
-0000f740: 636f 6e76 6572 7465 6420 746f 206e 756d  converted to num
-0000f750: 6572 6963 2720 256c 656e 2865 7272 6f72  eric' %len(error
-0000f760: 5f63 6f6c 756d 6e73 2929 0a20 2020 2020  _columns)).     
-0000f770: 2020 2020 2020 2070 7265 6473 203d 206c         preds = l
-0000f780: 6973 7428 7365 7428 7072 6564 7329 2d73  ist(set(preds)-s
-0000f790: 6574 2865 7272 6f72 5f63 6f6c 756d 6e73  et(error_columns
-0000f7a0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-0000f7b0: 6174 616e 616d 652e 6472 6f70 2865 7272  ataname.drop(err
-0000f7c0: 6f72 5f63 6f6c 756d 6e73 2c20 6178 6973  or_columns, axis
-0000f7d0: 3d31 2c20 696e 706c 6163 653d 5472 7565  =1, inplace=True
-0000f7e0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000f7f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000f800: 7428 2720 2020 2074 6865 7265 2077 6572  t('    there wer
-0000f810: 6520 6e6f 206d 6978 6564 2064 6174 6120  e no mixed data 
-0000f820: 7479 7065 7320 6f72 206f 626a 6563 7420  types or object 
-0000f830: 636f 6c75 6d6e 7320 7468 6174 2065 7272  columns that err
-0000f840: 6f72 6564 2e20 4461 7461 2069 7320 616c  ored. Data is al
-0000f850: 6c20 6e75 6d65 7269 632e 2e2e 2729 0a20  l numeric...'). 
-0000f860: 2020 2020 2020 2070 7269 6e74 2827 5368         print('Sh
-0000f870: 6170 6520 6f66 2074 7261 696e 2064 6174  ape of train dat
-0000f880: 6120 6166 7465 7220 6164 6469 6e67 206d  a after adding m
-0000f890: 6973 7369 6e67 2076 616c 7565 7320 666c  issing values fl
-0000f8a0: 6167 7320 3d20 2573 2720 2528 6461 7461  ags = %s' %(data
-0000f8b0: 6e61 6d65 2e73 6861 7065 2c29 2029 0a20  name.shape,) ). 
-0000f8c0: 2020 2020 2020 2070 7265 6473 203d 205b         preds = [
-0000f8d0: 7820 666f 7220 7820 696e 206c 6973 7428  x for x in list(
-0000f8e0: 6461 7461 6e61 6d65 2920 6966 2078 206e  dataname) if x n
-0000f8f0: 6f74 2069 6e20 7461 7267 6574 735d 0a20  ot in targets]. 
-0000f900: 2020 2020 2020 2069 6620 6e6f 7420 7465         if not te
-0000f910: 7374 5f64 6174 6120 6973 204e 6f6e 653a  st_data is None:
-0000f920: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
-0000f930: 745f 6461 7461 2e64 726f 7028 6572 726f  t_data.drop(erro
-0000f940: 725f 636f 6c75 6d6e 732c 2061 7869 733d  r_columns, axis=
-0000f950: 312c 2069 6e70 6c61 6365 3d54 7275 6529  1, inplace=True)
-0000f960: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000f970: 6e74 2827 2020 2020 5368 6170 6520 6f66  nt('    Shape of
-0000f980: 2074 6573 7420 6461 7461 2061 6674 6572   test data after
-0000f990: 2061 6464 696e 6720 6d69 7373 696e 6720   adding missing 
-0000f9a0: 7661 6c75 6573 2066 6c61 6773 2020 3d20  values flags  = 
-0000f9b0: 2573 2720 2528 7465 7374 5f64 6174 612e  %s' %(test_data.
-0000f9c0: 7368 6170 652c 2920 290a 2020 2020 6966  shape,) ).    if
-0000f9d0: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-0000f9e0: 2020 7072 696e 7428 2723 2323 2323 2323    print('#######
-0000f9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e930: 2323 2323 230a 2020 2020 0a20 2020 2063  #####.    .    c
+0000e940: 6f6c 735f 7769 7468 5f69 6e66 696e 6974  ols_with_infinit
+0000e950: 7920 3d20 4544 415f 6669 6e64 5f72 656d  y = EDA_find_rem
+0000e960: 6f76 655f 636f 6c75 6d6e 735f 7769 7468  ove_columns_with
+0000e970: 5f69 6e66 696e 6974 7928 6461 7461 6e61  _infinity(datana
+0000e980: 6d65 290a 2020 2020 2320 6669 7273 7420  me).    # first 
+0000e990: 796f 7520 6d75 7374 2064 726f 7020 726f  you must drop ro
+0000e9a0: 7773 2074 6861 7420 6861 7665 2069 6e66  ws that have inf
+0000e9b0: 2069 6e20 7468 656d 2023 2323 230a 2020   in them ####.  
+0000e9c0: 2020 6966 2063 6f6c 735f 7769 7468 5f69    if cols_with_i
+0000e9d0: 6e66 696e 6974 793a 0a20 2020 2020 2020  nfinity:.       
+0000e9e0: 2070 7269 6e74 2827 4472 6f70 7065 6420   print('Dropped 
+0000e9f0: 2564 2063 6f6c 756d 6e73 2077 6869 6368  %d columns which
+0000ea00: 2063 6f6e 7461 696e 2069 6e66 696e 6974   contain infinit
+0000ea10: 7920 696e 2064 6174 6173 6574 2720 256c  y in dataset' %l
+0000ea20: 656e 2863 6f6c 735f 7769 7468 5f69 6e66  en(cols_with_inf
+0000ea30: 696e 6974 7929 290a 2020 2020 2020 2020  inity)).        
+0000ea40: 2364 6174 616e 616d 6520 3d20 4645 5f64  #dataname = FE_d
+0000ea50: 726f 705f 726f 7773 5f77 6974 685f 696e  rop_rows_with_in
+0000ea60: 6669 6e69 7479 2864 6174 616e 616d 652c  finity(dataname,
+0000ea70: 2063 6f6c 735f 7769 7468 5f69 6e66 696e   cols_with_infin
+0000ea80: 6974 792c 2066 696c 6c5f 7661 6c75 653d  ity, fill_value=
+0000ea90: 5472 7565 290a 2020 2020 2020 2020 6461  True).        da
+0000eaa0: 7461 6e61 6d65 203d 2064 6174 616e 616d  taname = datanam
+0000eab0: 652e 6472 6f70 2863 6f6c 735f 7769 7468  e.drop(cols_with
+0000eac0: 5f69 6e66 696e 6974 792c 2061 7869 733d  _infinity, axis=
+0000ead0: 3129 0a20 2020 2020 2020 2070 7269 6e74  1).        print
+0000eae0: 2827 2573 2720 2563 6f6c 735f 7769 7468  ('%s' %cols_with
+0000eaf0: 5f69 6e66 696e 6974 7929 0a20 2020 2020  _infinity).     
+0000eb00: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000eb10: 2874 6573 745f 6461 7461 2c73 7472 2920  (test_data,str) 
+0000eb20: 6f72 2074 6573 745f 6461 7461 2069 7320  or test_data is 
+0000eb30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000eb40: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
+0000eb50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000eb60: 2074 6573 745f 6461 7461 203d 2074 6573   test_data = tes
+0000eb70: 745f 6461 7461 2e64 726f 7028 636f 6c73  t_data.drop(cols
+0000eb80: 5f77 6974 685f 696e 6669 6e69 7479 2c20  _with_infinity, 
+0000eb90: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
+0000eba0: 2020 2020 7072 696e 7428 2720 2020 2020      print('     
+0000ebb0: 6472 6f70 7065 6420 2573 2063 6f6c 756d  dropped %s colum
+0000ebc0: 6e73 2077 6974 6820 696e 6669 6e69 7479  ns with infinity
+0000ebd0: 2066 726f 6d20 7465 7374 2064 6174 612e   from test data.
+0000ebe0: 2e2e 2720 256c 656e 2863 6f6c 735f 7769  ..' %len(cols_wi
+0000ebf0: 7468 5f69 6e66 696e 6974 7929 290a 2020  th_infinity)).  
+0000ec00: 2020 2020 2020 6e75 6d76 6172 7320 3d20        numvars = 
+0000ec10: 6c65 6674 5f73 7562 7472 6163 7428 6e75  left_subtract(nu
+0000ec20: 6d76 6172 732c 2063 6f6c 735f 7769 7468  mvars, cols_with
+0000ec30: 5f69 6e66 696e 6974 7929 0a20 2020 2020  _infinity).     
+0000ec40: 2020 2070 7269 6e74 2827 2020 2020 206e     print('     n
+0000ec50: 756d 6572 6963 2066 6561 7475 7265 7320  umeric features 
+0000ec60: 6c65 6674 203d 2025 7327 2025 6c65 6e28  left = %s' %len(
+0000ec70: 6e75 6d76 6172 7329 290a 2020 2020 2323  numvars)).    ##
+0000ec80: 2323 2323 2320 2054 6869 7320 6973 2077  #####  This is w
+0000ec90: 6865 7265 2079 6f75 2073 7461 7274 2074  here you start t
+0000eca0: 6865 2053 554c 4f56 2070 726f 6365 7373  he SULOV process
+0000ecb0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+0000ecc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000ecd0: 2323 2320 2020 200a 2020 2020 7374 6172  ###    .    star
+0000ece0: 745f 7469 6d65 3120 3d20 7469 6d65 2e74  t_time1 = time.t
+0000ecf0: 696d 6528 290a 2020 2020 6966 206c 656e  ime().    if len
+0000ed00: 286e 756d 7661 7273 2920 3e20 3120 616e  (numvars) > 1 an
+0000ed10: 6420 6e6f 7420 736b 6970 5f73 756c 6f76  d not skip_sulov
+0000ed20: 3a0a 2020 2020 2020 2020 6966 2064 6174  :.        if dat
+0000ed30: 615f 6469 6d20 3c20 3530 3a0a 2020 2020  a_dim < 50:.    
+0000ed40: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000ed50: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+0000ed60: 616c 5f6c 6973 7420 3d20 4645 5f72 656d  al_list = FE_rem
+0000ed70: 6f76 655f 7661 7269 6162 6c65 735f 7573  ove_variables_us
+0000ed80: 696e 675f 5355 4c4f 565f 6d65 7468 6f64  ing_SULOV_method
+0000ed90: 2864 6174 616e 616d 652c 6e75 6d76 6172  (dataname,numvar
+0000eda0: 732c 7365 7474 696e 6773 2e6d 6f64 656c  s,settings.model
+0000edb0: 7479 7065 2c74 6172 6765 742c 0a20 2020  type,target,.   
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2020 2020 2020 2020 2020 636f 7272 5f6c            corr_l
+0000ede0: 696d 6974 2c76 6572 626f 7365 2c20 6461  imit,verbose, da
+0000edf0: 736b 5f78 6762 6f6f 7374 5f66 6c61 6729  sk_xgboost_flag)
+0000ee00: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000ee10: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0000ee20: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+0000ee30: 5355 4c4f 5620 6d65 7468 6f64 2069 7320  SULOV method is 
+0000ee40: 6572 726f 7269 6e67 2e20 436f 6e74 696e  erroring. Contin
+0000ee50: 7569 6e67 202e 2e2e 2729 0a20 2020 2020  uing ...').     
+0000ee60: 2020 2020 2020 2020 2020 2066 696e 616c             final
+0000ee70: 5f6c 6973 7420 3d20 636f 7079 2e64 6565  _list = copy.dee
+0000ee80: 7063 6f70 7928 6e75 6d76 6172 7329 0a20  pcopy(numvars). 
+0000ee90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000eea0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000eeb0: 6e74 2827 2020 2020 5275 6e6e 696e 6720  nt('    Running 
+0000eec0: 5355 4c4f 5620 6f6e 2073 6d61 6c6c 6572  SULOV on smaller
+0000eed0: 2064 6174 6173 6574 2073 616d 706c 6520   dataset sample 
+0000eee0: 7369 6e63 6520 6461 7461 2073 697a 6520  since data size 
+0000eef0: 2573 206d 203e 2035 3020 6d2e 2043 6f6e  %s m > 50 m. Con
+0000ef00: 7469 6e75 696e 6720 2e2e 2e27 2025 696e  tinuing ...' %in
+0000ef10: 7428 6461 7461 5f64 696d 2929 0a20 2020  t(data_dim)).   
+0000ef20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ef30: 7365 7474 696e 6773 2e6d 6f64 656c 7479  settings.modelty
+0000ef40: 7065 2021 3d20 2752 6567 7265 7373 696f  pe != 'Regressio
+0000ef50: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
+0000ef60: 2020 2020 2020 2020 6461 7461 5f74 656d          data_tem
+0000ef70: 7020 3d20 6461 7461 6e61 6d65 2e73 616d  p = dataname.sam
+0000ef80: 706c 6528 6e3d 3130 3030 302c 2072 6570  ple(n=10000, rep
+0000ef90: 6c61 6365 3d54 7275 652c 2072 616e 646f  lace=True, rando
+0000efa0: 6d5f 7374 6174 653d 3939 290a 2020 2020  m_state=99).    
+0000efb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000efc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000efd0: 2020 2020 2020 6461 7461 5f74 656d 7020        data_temp 
+0000efe0: 3d20 6461 7461 6e61 6d65 5b3a 3130 3030  = dataname[:1000
+0000eff0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+0000f000: 2020 2066 696e 616c 5f6c 6973 7420 3d20     final_list = 
+0000f010: 4645 5f72 656d 6f76 655f 7661 7269 6162  FE_remove_variab
+0000f020: 6c65 735f 7573 696e 675f 5355 4c4f 565f  les_using_SULOV_
+0000f030: 6d65 7468 6f64 2864 6174 615f 7465 6d70  method(data_temp
+0000f040: 2c6e 756d 7661 7273 2c73 6574 7469 6e67  ,numvars,setting
+0000f050: 732e 6d6f 6465 6c74 7970 652c 7461 7267  s.modeltype,targ
+0000f060: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f080: 2063 6f72 725f 6c69 6d69 742c 7665 7262   corr_limit,verb
+0000f090: 6f73 652c 2064 6173 6b5f 7867 626f 6f73  ose, dask_xgboos
+0000f0a0: 745f 666c 6167 290a 2020 2020 2020 2020  t_flag).        
+0000f0b0: 2020 2020 2020 2020 6465 6c20 6461 7461          del data
+0000f0c0: 5f74 656d 700a 2020 2020 656c 6966 2073  _temp.    elif s
+0000f0d0: 6b69 705f 7375 6c6f 763a 0a20 2020 2020  kip_sulov:.     
+0000f0e0: 2020 2070 7269 6e74 2827 2020 2020 536b     print('    Sk
+0000f0f0: 6970 7069 6e67 2053 554c 4f56 206d 6574  ipping SULOV met
+0000f100: 686f 642e 2043 6f6e 7469 6e75 696e 6720  hod. Continuing 
+0000f110: 2e2e 2e27 290a 2020 2020 2020 2020 6669  ...').        fi
+0000f120: 6e61 6c5f 6c69 7374 203d 2063 6f70 792e  nal_list = copy.
+0000f130: 6465 6570 636f 7079 286e 756d 7661 7273  deepcopy(numvars
+0000f140: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+0000f150: 2020 2020 7072 696e 7428 2720 2020 2053      print('    S
+0000f160: 6b69 7070 696e 6720 5355 4c4f 5620 6d65  kipping SULOV me
+0000f170: 7468 6f64 2073 696e 6365 2074 6865 7265  thod since there
+0000f180: 2061 7265 206e 6f20 636f 6e74 696e 756f   are no continuo
+0000f190: 7573 2076 6172 732e 2043 6f6e 7469 6e75  us vars. Continu
+0000f1a0: 696e 6720 2e2e 2e27 290a 2020 2020 2020  ing ...').      
+0000f1b0: 2020 6669 6e61 6c5f 6c69 7374 203d 2063    final_list = c
+0000f1c0: 6f70 792e 6465 6570 636f 7079 286e 756d  opy.deepcopy(num
+0000f1d0: 7661 7273 290a 2020 2020 2323 2323 2323  vars).    ######
+0000f1e0: 2320 5468 6973 2069 7320 7768 6572 6520  # This is where 
+0000f1f0: 796f 7520 6472 6177 2068 6f77 2066 6561  you draw how fea
+0000f200: 7475 7265 7769 7a20 776f 726b 7320 7768  turewiz works wh
+0000f210: 656e 2074 6865 2076 6572 626f 7365 203d  en the verbose =
+0000f220: 2032 2023 2323 2323 2323 2323 2323 0a20   2 ###########. 
+0000f230: 2020 2070 7269 6e74 2827 5469 6d65 2074     print('Time t
+0000f240: 616b 656e 2066 6f72 2053 554c 4f56 206d  aken for SULOV m
+0000f250: 6574 686f 6420 3d20 2530 2e30 6620 7365  ethod = %0.0f se
+0000f260: 636f 6e64 7327 2025 2874 696d 652e 7469  conds' %(time.ti
+0000f270: 6d65 2829 2d73 7461 7274 5f74 696d 6531  me()-start_time1
+0000f280: 2929 0a20 2020 2023 2323 2320 4e6f 7720  )).    #### Now 
+0000f290: 7765 2063 7265 6174 6520 696e 7465 7261  we create intera
+0000f2a0: 6374 696f 6e20 7661 7269 6162 6c65 7320  ction variables 
+0000f2b0: 6265 7477 6565 6e20 6361 7465 676f 7269  between categori
+0000f2c0: 6361 6c20 6665 6174 7572 6573 2023 2323  cal features ###
+0000f2d0: 2323 2323 230a 2020 2020 6966 2076 6572  #####.    if ver
+0000f2e0: 626f 7365 3a0a 2020 2020 2020 2020 7072  bose:.        pr
+0000f2f0: 696e 7428 2720 2020 2041 6464 696e 6720  int('    Adding 
+0000f300: 2573 2063 6174 6567 6f72 6963 616c 2076  %s categorical v
+0000f310: 6172 6961 626c 6573 2074 6f20 7265 6475  ariables to redu
+0000f320: 6365 6420 6e75 6d65 7269 6320 7661 7269  ced numeric vari
+0000f330: 6162 6c65 7320 206f 6620 2564 2720 2528  ables  of %d' %(
+0000f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 206c 656e 2869 6d70 6f72 7461 6e74 5f63   len(important_c
+0000f370: 6174 7329 2c6c 656e 2866 696e 616c 5f6c  ats),len(final_l
+0000f380: 6973 7429 2929 0a20 2020 2069 6620 2069  ist))).    if  i
+0000f390: 7369 6e73 7461 6e63 6528 6669 6e61 6c5f  sinstance(final_
+0000f3a0: 6c69 7374 2c6e 702e 6e64 6172 7261 7929  list,np.ndarray)
+0000f3b0: 3a0a 2020 2020 2020 2020 6669 6e61 6c5f  :.        final_
+0000f3c0: 6c69 7374 203d 2066 696e 616c 5f6c 6973  list = final_lis
+0000f3d0: 742e 746f 6c69 7374 2829 0a20 2020 2070  t.tolist().    p
+0000f3e0: 7265 6473 203d 2066 696e 616c 5f6c 6973  reds = final_lis
+0000f3f0: 742b 696d 706f 7274 616e 745f 6361 7473  t+important_cats
+0000f400: 0a20 2020 2069 6620 7665 7262 6f73 6520  .    if verbose 
+0000f410: 616e 6420 6c65 6e28 7072 6564 7329 203c  and len(preds) <
+0000f420: 3d20 3330 3a0a 2020 2020 2020 2020 7072  = 30:.        pr
+0000f430: 696e 7428 2746 696e 616c 206c 6973 7420  int('Final list 
+0000f440: 6f66 2073 656c 6563 7465 6420 2573 2076  of selected %s v
+0000f450: 6172 7320 6166 7465 7220 5355 4c4f 5620  ars after SULOV 
+0000f460: 3d20 2573 2720 2528 6c65 6e28 7072 6564  = %s' %(len(pred
+0000f470: 7329 2c20 7072 6564 7329 290a 2020 2020  s), preds)).    
+0000f480: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
+0000f490: 696e 7428 2746 696e 616c 6c79 2025 7320  int('Finally %s 
+0000f4a0: 7661 7273 2073 656c 6563 7465 6420 6166  vars selected af
+0000f4b0: 7465 7220 5355 4c4f 5627 2025 286c 656e  ter SULOV' %(len
+0000f4c0: 2870 7265 6473 2929 290a 2020 2020 2323  (preds))).    ##
+0000f4d0: 2323 2323 2359 6f75 206d 7573 7420 636f  #####You must co
+0000f4e0: 6e76 6572 7420 6361 7465 676f 7279 2076  nvert category v
+0000f4f0: 6172 6961 626c 6573 2069 6e74 6f20 696e  ariables into in
+0000f500: 7465 6765 7273 2023 2323 2323 2323 2323  tegers #########
+0000f510: 2323 2323 2323 2020 2020 0a20 2020 2070  ######    .    p
+0000f520: 7269 6e74 2827 436f 6e76 6572 7469 6e67  rint('Converting
+0000f530: 2061 6c6c 2066 6561 7475 7265 7320 746f   all features to
+0000f540: 206e 756d 6572 6963 2062 6566 6f72 6520   numeric before 
+0000f550: 7365 6e64 696e 6720 746f 2058 4742 6f6f  sending to XGBoo
+0000f560: 7374 2e2e 2e27 290a 2020 2020 6966 2069  st...').    if i
+0000f570: 7369 6e73 7461 6e63 6528 7461 7267 6574  sinstance(target
+0000f580: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0000f590: 6461 7461 6e61 6d65 203d 2064 6174 616e  dataname = datan
+0000f5a0: 616d 655b 7072 6564 732b 5b74 6172 6765  ame[preds+[targe
+0000f5b0: 745d 5d0a 2020 2020 656c 7365 3a0a 2020  t]].    else:.  
+0000f5c0: 2020 2020 2020 6461 7461 6e61 6d65 203d        dataname =
+0000f5d0: 2064 6174 616e 616d 655b 7072 6564 732b   dataname[preds+
+0000f5e0: 7461 7267 6574 5d0a 2020 2020 0a20 2020  target].    .   
+0000f5f0: 2069 6620 6e6f 7420 7465 7374 5f64 6174   if not test_dat
+0000f600: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
+0000f610: 2020 2074 6573 745f 6461 7461 203d 2074     test_data = t
+0000f620: 6573 745f 6461 7461 5b70 7265 6473 5d0a  est_data[preds].
+0000f630: 2020 2020 6966 206c 656e 2869 6d70 6f72      if len(impor
+0000f640: 7461 6e74 5f63 6174 7329 203e 2030 3a0a  tant_cats) > 0:.
+0000f650: 2020 2020 2020 2020 6461 7461 6e61 6d65          dataname
+0000f660: 2c20 7465 7374 5f64 6174 612c 2065 7272  , test_data, err
+0000f670: 6f72 5f63 6f6c 756d 6e73 203d 2046 455f  or_columns = FE_
+0000f680: 636f 6e76 6572 745f 616c 6c5f 6f62 6a65  convert_all_obje
+0000f690: 6374 5f63 6f6c 756d 6e73 5f74 6f5f 6e75  ct_columns_to_nu
+0000f6a0: 6d65 7269 6328 6461 7461 6e61 6d65 2c20  meric(dataname, 
+0000f6b0: 2074 6573 745f 6461 7461 2c20 7072 6564   test_data, pred
+0000f6c0: 7329 0a20 2020 2020 2020 2069 6d70 6f72  s).        impor
+0000f6d0: 7461 6e74 5f63 6174 7320 3d20 6c65 6674  tant_cats = left
+0000f6e0: 5f73 7562 7472 6163 7428 696d 706f 7274  _subtract(import
+0000f6f0: 616e 745f 6361 7473 2c20 6572 726f 725f  ant_cats, error_
+0000f700: 636f 6c75 6d6e 7329 0a20 2020 2020 2020  columns).       
+0000f710: 2069 6620 6c65 6e28 6572 726f 725f 636f   if len(error_co
+0000f720: 6c75 6d6e 7329 203e 2030 3a0a 2020 2020  lumns) > 0:.    
+0000f730: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+0000f740: 2020 2072 656d 6f76 696e 6720 2573 206f     removing %s o
+0000f750: 626a 6563 7420 636f 6c75 6d6e 7320 7468  bject columns th
+0000f760: 6174 2063 6f75 6c64 206e 6f74 2062 6520  at could not be 
+0000f770: 636f 6e76 6572 7465 6420 746f 206e 756d  converted to num
+0000f780: 6572 6963 2720 256c 656e 2865 7272 6f72  eric' %len(error
+0000f790: 5f63 6f6c 756d 6e73 2929 0a20 2020 2020  _columns)).     
+0000f7a0: 2020 2020 2020 2070 7265 6473 203d 206c         preds = l
+0000f7b0: 6973 7428 7365 7428 7072 6564 7329 2d73  ist(set(preds)-s
+0000f7c0: 6574 2865 7272 6f72 5f63 6f6c 756d 6e73  et(error_columns
+0000f7d0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
+0000f7e0: 6174 616e 616d 652e 6472 6f70 2865 7272  ataname.drop(err
+0000f7f0: 6f72 5f63 6f6c 756d 6e73 2c20 6178 6973  or_columns, axis
+0000f800: 3d31 2c20 696e 706c 6163 653d 5472 7565  =1, inplace=True
+0000f810: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000f820: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000f830: 7428 2720 2020 2074 6865 7265 2077 6572  t('    there wer
+0000f840: 6520 6e6f 206d 6978 6564 2064 6174 6120  e no mixed data 
+0000f850: 7479 7065 7320 6f72 206f 626a 6563 7420  types or object 
+0000f860: 636f 6c75 6d6e 7320 7468 6174 2065 7272  columns that err
+0000f870: 6f72 6564 2e20 4461 7461 2069 7320 616c  ored. Data is al
+0000f880: 6c20 6e75 6d65 7269 632e 2e2e 2729 0a20  l numeric...'). 
+0000f890: 2020 2020 2020 2070 7269 6e74 2827 5368         print('Sh
+0000f8a0: 6170 6520 6f66 2074 7261 696e 2064 6174  ape of train dat
+0000f8b0: 6120 6166 7465 7220 6164 6469 6e67 206d  a after adding m
+0000f8c0: 6973 7369 6e67 2076 616c 7565 7320 666c  issing values fl
+0000f8d0: 6167 7320 3d20 2573 2720 2528 6461 7461  ags = %s' %(data
+0000f8e0: 6e61 6d65 2e73 6861 7065 2c29 2029 0a20  name.shape,) ). 
+0000f8f0: 2020 2020 2020 2070 7265 6473 203d 205b         preds = [
+0000f900: 7820 666f 7220 7820 696e 206c 6973 7428  x for x in list(
+0000f910: 6461 7461 6e61 6d65 2920 6966 2078 206e  dataname) if x n
+0000f920: 6f74 2069 6e20 7461 7267 6574 735d 0a20  ot in targets]. 
+0000f930: 2020 2020 2020 2069 6620 6e6f 7420 7465         if not te
+0000f940: 7374 5f64 6174 6120 6973 204e 6f6e 653a  st_data is None:
+0000f950: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
+0000f960: 745f 6461 7461 2e64 726f 7028 6572 726f  t_data.drop(erro
+0000f970: 725f 636f 6c75 6d6e 732c 2061 7869 733d  r_columns, axis=
+0000f980: 312c 2069 6e70 6c61 6365 3d54 7275 6529  1, inplace=True)
+0000f990: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000f9a0: 6e74 2827 2020 2020 5368 6170 6520 6f66  nt('    Shape of
+0000f9b0: 2074 6573 7420 6461 7461 2061 6674 6572   test data after
+0000f9c0: 2061 6464 696e 6720 6d69 7373 696e 6720   adding missing 
+0000f9d0: 7661 6c75 6573 2066 6c61 6773 2020 3d20  values flags  = 
+0000f9e0: 2573 2720 2528 7465 7374 5f64 6174 612e  %s' %(test_data.
+0000f9f0: 7368 6170 652c 2920 290a 2020 2020 6966  shape,) ).    if
+0000fa00: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
+0000fa10: 2020 7072 696e 7428 2723 2323 2323 2323    print('#######
 0000fa20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fa30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fa40: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
-0000fa50: 2827 2323 2323 2320 2020 2052 2045 2043  ('#####    R E C
-0000fa60: 2055 2052 2053 2049 2056 2045 2020 2058   U R S I V E   X
-0000fa70: 2047 2042 204f 204f 2053 2054 203a 2046   G B O O S T : F
-0000fa80: 2045 2041 2054 2055 2052 2045 2020 2053   E A T U R E   S
-0000fa90: 2045 204c 2045 2043 2054 2049 204f 204e   E L E C T I O N
-0000faa0: 2020 2323 2323 2323 2327 290a 2020 2020    #######').    
-0000fab0: 2020 2020 7072 696e 7428 2723 2323 2323      print('#####
-0000fac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fa40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fa50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fa60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fa70: 2729 0a20 2020 2020 2020 2070 7269 6e74  ').        print
+0000fa80: 2827 2323 2323 2320 2020 2052 2045 2043  ('#####    R E C
+0000fa90: 2055 2052 2053 2049 2056 2045 2020 2058   U R S I V E   X
+0000faa0: 2047 2042 204f 204f 2053 2054 203a 2046   G B O O S T : F
+0000fab0: 2045 2041 2054 2055 2052 2045 2020 2053   E A T U R E   S
+0000fac0: 2045 204c 2045 2043 2054 2049 204f 204e   E L E C T I O N
+0000fad0: 2020 2323 2323 2323 2327 290a 2020 2020    #######').    
+0000fae0: 2020 2020 7072 696e 7428 2723 2323 2323      print('#####
 0000faf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fb00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fb10: 2323 2729 0a20 2020 200a 2020 2020 696d  ##').    .    im
-0000fb20: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
-0000fb30: 203d 205b 5d0a 2020 2020 2323 2323 2323   = [].    ######
-0000fb40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fb50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fb60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb40: 2323 2729 0a20 2020 200a 2020 2020 696d  ##').    .    im
+0000fb50: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
+0000fb60: 203d 205b 5d0a 2020 2020 2323 2323 2323   = [].    ######
 0000fb70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fb80: 230a 2020 2020 2323 2323 2320 2020 5468  #.    #####   Th
-0000fb90: 6973 2069 7320 666f 7220 4441 534b 2058  is is for DASK X
-0000fba0: 4742 2052 6567 7265 7373 6f72 2061 6e64  GB Regressor and
-0000fbb0: 2058 4742 2043 6c61 7373 6966 6965 7220   XGB Classifier 
-0000fbc0: 7072 6f62 6c65 6d73 2023 2323 230a 2020  problems ####.  
-0000fbd0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0000fbe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fbf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fc00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fc10: 2323 2323 2323 2323 230a 2020 2020 6966  #########.    if
-0000fc20: 2073 6574 7469 6e67 732e 6d75 6c74 695f   settings.multi_
-0000fc30: 6c61 6265 6c3a 0a20 2020 2020 2020 2023  label:.        #
-0000fc40: 2323 206f 6e6c 7920 7265 6775 6c61 7220  ## only regular 
-0000fc50: 7867 626f 6f73 7420 7769 7468 206d 756c  xgboost with mul
-0000fc60: 7469 2d6f 7574 7075 7420 6361 6e20 776f  ti-output can wo
-0000fc70: 726b 2077 656c 6c20 696e 206d 756c 7469  rk well in multi
-0000fc80: 2d6c 6162 656c 2073 6574 7469 6e67 7320  -label settings 
-0000fc90: 230a 2020 2020 2020 2020 6461 736b 5f78  #.        dask_x
-0000fca0: 6762 6f6f 7374 5f66 6c61 6720 3d20 4661  gboost_flag = Fa
-0000fcb0: 6c73 6520 0a20 2020 2062 7374 5f6d 6f64  lse .    bst_mod
-0000fcc0: 656c 7320 3d20 5b5d 0a0a 2020 2020 2323  els = []..    ##
-0000fcd0: 2323 2323 2323 2320 2020 5468 6973 2069  #######   This i
-0000fce0: 7320 666f 7220 4441 534b 2044 6174 6166  s for DASK Dataf
-0000fcf0: 7261 6d65 7320 5847 426f 6f73 7420 7472  rames XGBoost tr
-0000fd00: 6169 6e69 6e67 2023 2323 2323 2323 2323  aining #########
-0000fd10: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-0000fd20: 7472 793a 0a20 2020 2020 2020 2078 6762  try:.        xgb
-0000fd30: 2e73 6574 5f63 6f6e 6669 6728 7665 7262  .set_config(verb
-0000fd40: 6f73 6974 793d 3029 0a20 2020 2065 7863  osity=0).    exc
-0000fd50: 6570 743a 0a20 2020 2020 2020 2023 2320  ept:.        ## 
-0000fd60: 536f 6d65 2063 6173 6573 2c20 7468 6973  Some cases, this
-0000fd70: 2065 7272 6f72 732c 2073 6f20 7061 7373   errors, so pass
-0000fd80: 2023 2323 0a20 2020 2020 2020 2070 6173   ###.        pas
-0000fd90: 730a 2020 2020 2323 2323 2323 2323 2323  s.    ##########
-0000fda0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fdb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fdc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fb90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fbb0: 230a 2020 2020 2323 2323 2320 2020 5468  #.    #####   Th
+0000fbc0: 6973 2069 7320 666f 7220 4441 534b 2058  is is for DASK X
+0000fbd0: 4742 2052 6567 7265 7373 6f72 2061 6e64  GB Regressor and
+0000fbe0: 2058 4742 2043 6c61 7373 6966 6965 7220   XGB Classifier 
+0000fbf0: 7072 6f62 6c65 6d73 2023 2323 230a 2020  problems ####.  
+0000fc00: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0000fc10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fc20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fc30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fc40: 2323 2323 2323 2323 230a 2020 2020 6966  #########.    if
+0000fc50: 2073 6574 7469 6e67 732e 6d75 6c74 695f   settings.multi_
+0000fc60: 6c61 6265 6c3a 0a20 2020 2020 2020 2023  label:.        #
+0000fc70: 2323 206f 6e6c 7920 7265 6775 6c61 7220  ## only regular 
+0000fc80: 7867 626f 6f73 7420 7769 7468 206d 756c  xgboost with mul
+0000fc90: 7469 2d6f 7574 7075 7420 6361 6e20 776f  ti-output can wo
+0000fca0: 726b 2077 656c 6c20 696e 206d 756c 7469  rk well in multi
+0000fcb0: 2d6c 6162 656c 2073 6574 7469 6e67 7320  -label settings 
+0000fcc0: 230a 2020 2020 2020 2020 6461 736b 5f78  #.        dask_x
+0000fcd0: 6762 6f6f 7374 5f66 6c61 6720 3d20 4661  gboost_flag = Fa
+0000fce0: 6c73 6520 0a20 2020 2062 7374 5f6d 6f64  lse .    bst_mod
+0000fcf0: 656c 7320 3d20 5b5d 0a0a 2020 2020 2323  els = []..    ##
+0000fd00: 2323 2323 2323 2320 2020 5468 6973 2069  #######   This i
+0000fd10: 7320 666f 7220 4441 534b 2044 6174 6166  s for DASK Dataf
+0000fd20: 7261 6d65 7320 5847 426f 6f73 7420 7472  rames XGBoost tr
+0000fd30: 6169 6e69 6e67 2023 2323 2323 2323 2323  aining #########
+0000fd40: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+0000fd50: 7472 793a 0a20 2020 2020 2020 2078 6762  try:.        xgb
+0000fd60: 2e73 6574 5f63 6f6e 6669 6728 7665 7262  .set_config(verb
+0000fd70: 6f73 6974 793d 3029 0a20 2020 2065 7863  osity=0).    exc
+0000fd80: 6570 743a 0a20 2020 2020 2020 2023 2320  ept:.        ## 
+0000fd90: 536f 6d65 2063 6173 6573 2c20 7468 6973  Some cases, this
+0000fda0: 2065 7272 6f72 732c 2073 6f20 7061 7373   errors, so pass
+0000fdb0: 2023 2323 0a20 2020 2020 2020 2070 6173   ###.        pas
+0000fdc0: 730a 2020 2020 2323 2323 2323 2323 2323  s.    ##########
 0000fdd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000fde0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fdf0: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
-0000fe00: 2323 2323 2020 204e 6f77 2069 6620 6461  ####   Now if da
-0000fe10: 736b 5f78 6762 6f6f 7374 5f66 6c61 6720  sk_xgboost_flag 
-0000fe20: 6973 2054 7275 652c 2063 6f6e 7665 7274  is True, convert
-0000fe30: 2070 616e 6461 7320 6466 7320 6261 636b   pandas dfs back
-0000fe40: 2074 6f20 4461 736b 2044 6174 6166 7261   to Dask Datafra
-0000fe50: 6d65 7320 2020 2020 2323 2323 230a 2020  mes     #####.  
-0000fe60: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0000fe70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fe90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fdf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fe00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fe10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fe20: 2323 2323 2323 230a 2020 2020 2323 2323  #######.    ####
+0000fe30: 2323 2323 2020 204e 6f77 2069 6620 6461  ####   Now if da
+0000fe40: 736b 5f78 6762 6f6f 7374 5f66 6c61 6720  sk_xgboost_flag 
+0000fe50: 6973 2054 7275 652c 2063 6f6e 7665 7274  is True, convert
+0000fe60: 2070 616e 6461 7320 6466 7320 6261 636b   pandas dfs back
+0000fe70: 2074 6f20 4461 736b 2044 6174 6166 7261   to Dask Datafra
+0000fe80: 6d65 7320 2020 2020 2323 2323 230a 2020  mes     #####.  
+0000fe90: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
 0000fea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0000feb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000fec0: 2323 230a 2020 2020 6966 2064 6173 6b5f  ###.    if dask_
-0000fed0: 7867 626f 6f73 745f 666c 6167 3a0a 2020  xgboost_flag:.  
-0000fee0: 2020 2020 2020 2323 2320 7765 2072 656c        ### we rel
-0000fef0: 6f61 6420 7468 6520 6461 7461 6672 616d  oad the datafram
-0000ff00: 6573 2069 6e74 6f20 6461 736b 2073 696e  es into dask sin
-0000ff10: 6365 2063 6f6c 756d 6e73 206d 6179 2068  ce columns may h
-0000ff20: 6176 6520 6265 656e 2064 726f 7070 6564  ave been dropped
-0000ff30: 2023 230a 2020 2020 2020 2020 6966 2076   ##.        if v
-0000ff40: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-0000ff50: 2020 2020 7072 696e 7428 2720 2020 2075      print('    u
-0000ff60: 7369 6e67 2044 4153 4b20 5847 426f 6f73  sing DASK XGBoos
-0000ff70: 7427 2920 200a 2020 2020 2020 2020 7472  t')  .        tr
-0000ff80: 6169 6e20 3d20 6c6f 6164 5f64 6173 6b5f  ain = load_dask_
-0000ff90: 6461 7461 2864 6174 616e 616d 652c 2073  data(dataname, s
-0000ffa0: 6570 290a 2020 2020 2020 2020 6966 206e  ep).        if n
-0000ffb0: 6f74 2074 6573 745f 6461 7461 2069 7320  ot test_data is 
-0000ffc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000ffd0: 2020 7465 7374 203d 206c 6f61 645f 6461    test = load_da
-0000ffe0: 736b 5f64 6174 6128 7465 7374 5f64 6174  sk_data(test_dat
-0000fff0: 612c 2073 6570 290a 2020 2020 656c 7365  a, sep).    else
-00010000: 3a0a 2020 2020 2020 2020 2323 2320 7765  :.        ### we
-00010010: 2072 656c 6f61 6420 7468 6520 6461 7461   reload the data
-00010020: 6672 616d 6573 2069 6e74 6f20 6461 736b  frames into dask
-00010030: 2073 696e 6365 2063 6f6c 756d 6e73 206d   since columns m
-00010040: 6179 2068 6176 6520 6265 656e 2064 726f  ay have been dro
-00010050: 7070 6564 2023 230a 2020 2020 2020 2020  pped ##.        
-00010060: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-00010070: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-00010080: 2020 2075 7369 6e67 2072 6567 756c 6172     using regular
-00010090: 2058 4742 6f6f 7374 2729 200a 2020 2020   XGBoost') .    
-000100a0: 2020 2020 7472 6169 6e20 3d20 636f 7079      train = copy
-000100b0: 2e64 6565 7063 6f70 7928 6461 7461 6e61  .deepcopy(datana
-000100c0: 6d65 290a 2020 2020 2020 2020 7465 7374  me).        test
-000100d0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-000100e0: 2874 6573 745f 6461 7461 290a 2020 2020  (test_data).    
-000100f0: 2323 2323 2323 2323 2020 436f 6e76 6572  ########  Conver
-00010100: 7369 6f6e 2063 6f6d 706c 6574 6564 2066  sion completed f
-00010110: 6f72 2074 7261 696e 2061 6e64 2074 6573  or train and tes
-00010120: 7420 6461 7461 2023 2323 2323 2323 2323  t data #########
-00010130: 230a 2020 2023 2323 2320 4966 2043 6174  #.   #### If Cat
-00010140: 6567 6f72 7920 456e 636f 6469 6e67 2074  egory Encoding t
-00010150: 6f6f 6b20 706c 6163 652c 2074 6865 7365  ook place, these
-00010160: 2063 6174 2076 6172 6961 626c 6573 2061   cat variables a
-00010170: 7265 206e 6f20 6c6f 6e67 6572 206e 6565  re no longer nee
-00010180: 6465 6420 696e 2054 7261 696e 2e20 536f  ded in Train. So
-00010190: 2072 656d 6f76 6520 7468 656d 210a 2020   remove them!.  
-000101a0: 2020 6966 2066 6561 7475 7265 5f67 656e    if feature_gen
-000101b0: 206f 7220 6665 6174 7572 655f 7479 7065   or feature_type
-000101c0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-000101d0: 2753 696e 6365 2025 7320 6361 7465 676f  'Since %s catego
-000101e0: 7279 2065 6e63 6f64 696e 6720 6973 2064  ry encoding is d
-000101f0: 6f6e 652c 2064 726f 7070 696e 6720 6f72  one, dropping or
-00010200: 6967 696e 616c 2063 6174 6567 6f72 6963  iginal categoric
-00010210: 616c 2076 6172 7320 6672 6f6d 2070 7265  al vars from pre
-00010220: 6469 6374 6f72 732e 2e2e 2720 2566 6561  dictors...' %fea
-00010230: 7475 7265 5f67 656e 290a 2020 2020 2020  ture_gen).      
-00010240: 2020 7072 6564 7320 3d20 6c65 6674 5f73    preds = left_s
-00010250: 7562 7472 6163 7428 7072 6564 732c 2063  ubtract(preds, c
-00010260: 6174 7661 7273 290a 2020 2020 6966 2064  atvars).    if d
-00010270: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
-00010280: 3a0a 2020 2020 2020 2020 7472 6169 6e5f  :.        train_
-00010290: 7020 3d20 7472 6169 6e5b 7072 6564 735d  p = train[preds]
-000102a0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000102b0: 2020 2074 7261 696e 5f70 203d 2064 6174     train_p = dat
-000102c0: 616e 616d 655b 7072 6564 735d 0a20 2020  aname[preds].   
-000102d0: 2023 2323 2323 2323 2320 4c69 6d69 7420   ######## Limit 
-000102e0: 7468 6520 6e75 6d62 6572 206f 6620 6974  the number of it
-000102f0: 6572 6174 696f 6e73 2074 6f20 3520 6f72  erations to 5 or
-00010300: 2073 6f20 2323 2323 2323 230a 2020 2020   so #######.    
-00010310: 6966 2074 7261 696e 5f70 2e73 6861 7065  if train_p.shape
-00010320: 5b31 5d20 3c3d 2031 303a 0a20 2020 2020  [1] <= 10:.     
-00010330: 2020 2069 7465 725f 6c69 6d69 7420 3d20     iter_limit = 
-00010340: 320a 2020 2020 656c 7365 3a0a 2020 2020  2.    else:.    
-00010350: 2020 2020 6974 6572 5f6c 696d 6974 203d      iter_limit =
-00010360: 2069 6e74 2874 7261 696e 5f70 2e73 6861   int(train_p.sha
-00010370: 7065 5b31 5d2f 352b 302e 3529 0a20 2020  pe[1]/5+0.5).   
-00010380: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
-00010390: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
-000103a0: 5461 6b69 6e67 2074 6f70 2025 7320 6665  Taking top %s fe
-000103b0: 6174 7572 6573 2070 6572 2069 7465 7261  atures per itera
-000103c0: 7469 6f6e 2e2e 2e27 2025 746f 705f 6e75  tion...' %top_nu
-000103d0: 6d29 0a20 2020 2069 6620 6461 736b 5f78  m).    if dask_x
-000103e0: 6762 6f6f 7374 5f66 6c61 673a 0a20 2020  gboost_flag:.   
-000103f0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
-00010400: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00010410: 6e74 2827 2020 2020 4461 736b 2076 6572  nt('    Dask ver
-00010420: 7369 6f6e 203d 2025 7327 2025 6461 736b  sion = %s' %dask
-00010430: 2e5f 5f76 6572 7369 6f6e 5f5f 290a 2020  .__version__).  
-00010440: 2020 2020 2020 2323 2320 596f 7520 6361        ### You ca
-00010450: 6e20 7265 6d6f 7665 2064 6173 6b5f 6d6c  n remove dask_ml
-00010460: 2068 6572 6520 7369 6e63 6520 796f 7520   here since you 
-00010470: 646f 6e27 7420 646f 2061 6e79 2073 706c  don't do any spl
-00010480: 6974 206f 6620 7472 6169 6e20 7465 7374  it of train test
-00010490: 2068 6572 6520 2323 2323 2323 2323 2323   here ##########
-000104a0: 0a20 2020 2020 2020 2023 6672 6f6d 2064  .        #from d
-000104b0: 6173 6b5f 6d6c 2e6d 6f64 656c 5f73 656c  ask_ml.model_sel
-000104c0: 6563 7469 6f6e 2069 6d70 6f72 7420 7472  ection import tr
-000104d0: 6169 6e5f 7465 7374 5f73 706c 6974 0a20  ain_test_split. 
-000104e0: 2020 2020 2020 2023 2323 2063 6865 636b         ### check
-000104f0: 2061 7661 696c 6162 6c65 206d 656d 6f72   available memor
-00010500: 7920 616e 6420 616c 6c6f 6361 7465 2061  y and allocate a
-00010510: 7420 6c65 6173 7420 3147 4220 6f66 2069  t least 1GB of i
-00010520: 7420 696e 2074 6865 2043 6c69 656e 7420  t in the Client 
-00010530: 696e 2044 4153 4b20 2323 2323 2323 2323  in DASK ########
-00010540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00010550: 2323 2323 230a 2020 2020 2020 2020 6e5f  #####.        n_
-00010560: 776f 726b 6572 7320 3d20 6765 745f 6370  workers = get_cp
-00010570: 755f 776f 726b 6572 5f63 6f75 6e74 2829  u_worker_count()
-00010580: 0a20 2020 2020 2020 2023 2323 2041 766f  .        ### Avo
-00010590: 6964 2072 6564 7563 696e 6720 7468 6520  id reducing the 
-000105a0: 6672 6565 206d 656d 6f72 7920 2d20 6c65  free memory - le
-000105b0: 6176 6520 6974 2061 7320 6269 6720 6173  ave it as big as
-000105c0: 2069 7420 7761 6e74 7320 746f 2062 6520   it wants to be 
-000105d0: 2323 230a 2020 2020 2020 2020 6d65 6d6f  ###.        memo
-000105e0: 7279 5f66 7265 6520 3d20 7374 7228 6d61  ry_free = str(ma
-000105f0: 7828 312c 2069 6e74 2870 7375 7469 6c2e  x(1, int(psutil.
-00010600: 7669 7274 7561 6c5f 6d65 6d6f 7279 2829  virtual_memory()
-00010610: 5b30 5d2f 286e 5f77 6f72 6b65 7273 2a31  [0]/(n_workers*1
-00010620: 6539 2929 2929 2b27 4742 270a 2020 2020  e9))))+'GB'.    
-00010630: 2020 2020 7072 696e 7428 2720 2020 2055      print('    U
-00010640: 7369 6e67 2044 6173 6b20 5847 426f 6f73  sing Dask XGBoos
-00010650: 7420 616c 676f 7269 7468 6d20 7769 7468  t algorithm with
-00010660: 2025 7320 7669 7274 7561 6c20 4350 5573   %s virtual CPUs
-00010670: 2061 6e64 2025 7320 6d65 6d6f 7279 206c   and %s memory l
-00010680: 696d 6974 2e2e 2e27 2025 2867 6574 5f63  imit...' %(get_c
-00010690: 7075 5f77 6f72 6b65 725f 636f 756e 7428  pu_worker_count(
-000106a0: 292c 206d 656d 6f72 795f 6672 6565 2929  ), memory_free))
-000106b0: 0a20 2020 2020 2020 2063 6c69 656e 7420  .        client 
-000106c0: 3d20 436c 6965 6e74 286e 5f77 6f72 6b65  = Client(n_worke
-000106d0: 7273 3d20 6e5f 776f 726b 6572 732c 2074  rs= n_workers, t
-000106e0: 6872 6561 6473 5f70 6572 5f77 6f72 6b65  hreads_per_worke
-000106f0: 723d 312c 2070 726f 6365 7373 6573 3d54  r=1, processes=T
-00010700: 7275 652c 2073 696c 656e 6365 5f6c 6f67  rue, silence_log
-00010710: 733d 3530 2c0a 2020 2020 2020 2020 2020  s=50,.          
-00010720: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00010730: 6d6f 7279 5f6c 696d 6974 3d6d 656d 6f72  mory_limit=memor
-00010740: 795f 6672 6565 290a 2020 2020 2020 2020  y_free).        
-00010750: 7072 696e 7428 2744 6173 6b20 636c 6965  print('Dask clie
-00010760: 6e74 2063 6f6e 6669 6775 7261 7469 6f6e  nt configuration
-00010770: 3a20 2573 2720 2563 6c69 656e 7429 0a20  : %s' %client). 
-00010780: 2020 2020 2020 2069 6d70 6f72 7420 6763         import gc
-00010790: 0a20 2020 2020 2020 2063 6c69 656e 742e  .        client.
-000107a0: 7275 6e28 6763 2e63 6f6c 6c65 6374 2920  run(gc.collect) 
-000107b0: 0a20 2020 2020 2020 2023 7472 6169 6e5f  .        #train_
-000107c0: 7020 3d20 636c 6965 6e74 2e70 6572 7369  p = client.persi
-000107d0: 7374 2874 7261 696e 5f70 290a 2020 2020  st(train_p).    
-000107e0: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-000107f0: 2020 2020 7072 696e 7428 2720 2020 2058      print('    X
-00010800: 4742 6f6f 7374 2076 6572 7369 6f6e 2075  GBoost version u
-00010810: 7369 6e67 2025 7320 6173 2074 7265 6520  sing %s as tree 
-00010820: 6d65 7468 6f64 3a20 2573 2720 2528 7867  method: %s' %(xg
-00010830: 622e 5f5f 7665 7273 696f 6e5f 5f2c 2074  b.__version__, t
-00010840: 7265 655f 6d65 7468 6f64 2929 0a20 2020  ree_method)).   
-00010850: 2023 2323 2054 6869 7320 6973 2074 6f20   ### This is to 
-00010860: 636f 6e76 6572 7420 7468 6520 7461 7267  convert the targ
-00010870: 6574 206c 6162 656c 7320 746f 2070 726f  et labels to pro
-00010880: 7065 7220 6e75 6d65 7269 6320 636f 6c75  per numeric colu
-00010890: 6d6e 7320 2323 2323 2323 0a20 2020 2063  mns ######.    c
-000108a0: 6174 5f74 6172 6765 7473 203d 2064 6174  at_targets = dat
-000108b0: 616e 616d 655b 7461 7267 6574 5d2e 7365  aname[target].se
-000108c0: 6c65 6374 5f64 7479 7065 7328 696e 636c  lect_dtypes(incl
-000108d0: 7564 653d 276f 626a 6563 7427 292e 636f  ude='object').co
-000108e0: 6c75 6d6e 732e 746f 6c69 7374 2829 202b  lumns.tolist() +
-000108f0: 2064 6174 616e 616d 655b 7461 7267 6574   dataname[target
-00010900: 5d2e 7365 6c65 6374 5f64 7479 7065 7328  ].select_dtypes(
-00010910: 696e 636c 7564 653d 2763 6174 6567 6f72  include='categor
-00010920: 7927 292e 636f 6c75 6d6e 732e 746f 6c69  y').columns.toli
-00010930: 7374 2829 0a20 2020 2023 2323 2063 6865  st().    ### che
-00010940: 636b 2069 6620 7468 6579 2061 7265 206e  ck if they are n
-00010950: 6f74 2073 7461 7274 696e 6720 6672 6f6d  ot starting from
-00010960: 207a 6572 6f20 2323 2323 2323 2323 2323   zero ##########
-00010970: 2323 2323 2323 2323 0a20 2020 2069 6620  ########.    if 
-00010980: 6461 736b 5f78 6762 6f6f 7374 5f66 6c61  dask_xgboost_fla
-00010990: 673a 0a20 2020 2020 2020 2023 2323 2074  g:.        ### t
-000109a0: 7261 696e 2069 7320 616c 7265 6164 7920  rain is already 
-000109b0: 6120 6461 736b 2064 6174 6166 7261 6d65  a dask dataframe
-000109c0: 202d 3e20 796f 7520 6361 6e20 6c65 6176   -> you can leav
-000109d0: 6520 6974 2061 7320 6974 2069 730a 2020  e it as it is.  
-000109e0: 2020 2020 2020 795f 7472 6169 6e20 3d20        y_train = 
-000109f0: 7472 6169 6e5b 7461 7267 6574 5d0a 2020  train[target].  
-00010a00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00010a10: 2323 2320 7472 6169 6e20 6973 2061 6c72  ### train is alr
-00010a20: 6561 6479 2061 2072 6567 756c 6172 2064  eady a regular d
-00010a30: 6174 6166 7261 6d65 202d 3e20 796f 7520  ataframe -> you 
-00010a40: 6361 6e20 6c65 6176 6520 6974 2061 7320  can leave it as 
-00010a50: 6974 2069 730a 2020 2020 2020 2020 795f  it is.        y_
-00010a60: 7472 6169 6e20 3d20 6461 7461 6e61 6d65  train = dataname
-00010a70: 5b74 6172 6765 745d 0a20 2020 2023 2323  [target].    ###
-00010a80: 2320 4e6f 7720 7765 2070 726f 6365 7373  # Now we process
-00010a90: 2074 6865 206e 756d 6572 6963 2020 7661   the numeric  va
-00010aa0: 6c75 6573 2074 6872 6f75 6768 2044 4153  lues through DAS
-00010ab0: 4b20 5847 426f 6f73 7420 7265 7065 6174  K XGBoost repeat
-00010ac0: 6564 6c79 2023 2323 2323 2323 2323 2323  edly ###########
-00010ad0: 2323 2323 2323 2323 0a20 2020 2074 7279  ########.    try
-00010ae0: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-00010af0: 696e 2072 616e 6765 2830 2c74 7261 696e  in range(0,train
-00010b00: 5f70 2e73 6861 7065 5b31 5d2c 6974 6572  _p.shape[1],iter
-00010b10: 5f6c 696d 6974 293a 0a20 2020 2020 2020  _limit):.       
-00010b20: 2020 2020 2073 7461 7274 5f74 696d 6532       start_time2
-00010b30: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
-00010b40: 2020 2020 2020 2020 2020 2069 6d70 5f66             imp_f
-00010b50: 6561 7473 203d 205b 5d0a 2020 2020 2020  eats = [].      
-00010b60: 2020 2020 2020 6966 2074 7261 696e 5f70        if train_p
-00010b70: 2e73 6861 7065 5b31 5d2d 6920 3c20 6974  .shape[1]-i < it
-00010b80: 6572 5f6c 696d 6974 3a0a 2020 2020 2020  er_limit:.      
-00010b90: 2020 2020 2020 2020 2020 585f 7472 6169            X_trai
-00010ba0: 6e20 3d20 7472 6169 6e5f 702e 696c 6f63  n = train_p.iloc
-00010bb0: 5b3a 2c69 3a5d 0a20 2020 2020 2020 2020  [:,i:].         
-00010bc0: 2020 2020 2020 2063 6f6c 735f 7365 6c20         cols_sel 
-00010bd0: 3d20 585f 7472 6169 6e2e 636f 6c75 6d6e  = X_train.column
-00010be0: 732e 746f 6c69 7374 2829 0a20 2020 2020  s.tolist().     
-00010bf0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00010c00: 2020 2020 2020 2020 2020 2020 2058 5f74               X_t
-00010c10: 7261 696e 203d 2074 7261 696e 5f70 5b6c  rain = train_p[l
-00010c20: 6973 7428 7472 6169 6e5f 702e 636f 6c75  ist(train_p.colu
-00010c30: 6d6e 732e 7661 6c75 6573 295b 693a 7472  mns.values)[i:tr
-00010c40: 6169 6e5f 702e 7368 6170 655b 315d 5d5d  ain_p.shape[1]]]
-00010c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c60: 2063 6f6c 735f 7365 6c20 3d20 585f 7472   cols_sel = X_tr
-00010c70: 6169 6e2e 636f 6c75 6d6e 732e 746f 6c69  ain.columns.toli
-00010c80: 7374 2829 0a20 2020 2020 2020 2020 2020  st().           
-00010c90: 2023 2323 2323 2054 6869 7320 6973 2077   ##### This is w
-00010ca0: 6865 7265 2079 6f75 2072 6570 6561 7420  here you repeat 
-00010cb0: 7468 6520 7472 6169 6e69 6e67 2061 6e64  the training and
-00010cc0: 2066 696e 6469 6e67 2066 6561 7475 7265   finding feature
-00010cd0: 2069 6d70 6f72 7461 6e63 6573 0a20 2020   importances.   
-00010ce0: 2020 2020 2020 2020 2069 6620 6461 736b           if dask
-00010cf0: 5f78 6762 6f6f 7374 5f66 6c61 673a 0a20  _xgboost_flag:. 
-00010d00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010d10: 6f77 7320 3d20 585f 7472 6169 6e2e 636f  ows = X_train.co
-00010d20: 6d70 7574 6528 292e 7368 6170 655b 305d  mpute().shape[0]
-00010d30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00010d40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00010d50: 2020 2072 6f77 7320 3d20 585f 7472 6169     rows = X_trai
-00010d60: 6e2e 7368 6170 655b 305d 0a20 2020 2020  n.shape[0].     
-00010d70: 2020 2020 2020 2069 6620 726f 7773 203e         if rows >
-00010d80: 3d20 3130 3030 3030 3a0a 2020 2020 2020  = 100000:.      
-00010d90: 2020 2020 2020 2020 2020 6e75 6d5f 726f            num_ro
-00010da0: 756e 6473 203d 2032 300a 2020 2020 2020  unds = 20.      
-00010db0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010dc0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-00010dd0: 726f 756e 6473 203d 2031 3030 0a20 2020  rounds = 100.   
-00010de0: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
-00010df0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00010e00: 2020 2020 7072 696e 7428 274e 756d 6265      print('Numbe
-00010e10: 7220 6f66 2062 6f6f 7374 6572 2072 6f75  r of booster rou
-00010e20: 6e64 7320 3d20 2573 2720 256e 756d 5f72  nds = %s' %num_r
-00010e30: 6f75 6e64 7329 0a20 2020 2020 2020 2020  ounds).         
-00010e40: 2020 2069 6620 7472 6169 6e5f 702e 7368     if train_p.sh
-00010e50: 6170 655b 315d 2d69 203c 2032 3a0a 2020  ape[1]-i < 2:.  
-00010e60: 2020 2020 2020 2020 2020 2020 2020 2323                ##
-00010e70: 2320 4966 2074 6865 7265 2069 7320 6a75  # If there is ju
-00010e80: 7374 206f 6e65 2076 6172 6961 626c 6520  st one variable 
-00010e90: 6c65 6674 2c20 7468 656e 206a 7573 7420  left, then just 
-00010ea0: 736b 6970 2069 7420 2323 2323 230a 2020  skip it #####.  
-00010eb0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00010ec0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00010ed0: 2020 2023 2323 2323 2323 2323 2020 2054     #########   T
-00010ee0: 6869 7320 6973 2077 6865 7265 2077 6520  his is where we 
-00010ef0: 6368 6563 6b20 7461 7267 6574 2074 7970  check target typ
-00010f00: 6520 2323 2323 2323 2323 2323 0a20 2020  e ##########.   
-00010f10: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00010f20: 795f 7472 6169 6e2e 6474 7970 6573 5b30  y_train.dtypes[0
-00010f30: 5d20 696e 205b 6e70 2e66 6c6f 6174 3136  ] in [np.float16
-00010f40: 2c20 6e70 2e66 6c6f 6174 3332 2c20 6e70  , np.float32, np
-00010f50: 2e66 6c6f 6174 3634 2c20 6e70 2e69 6e74  .float64, np.int
-00010f60: 382c 6e70 2e69 6e74 3136 2c6e 702e 696e  8,np.int16,np.in
-00010f70: 7433 322c 6e70 2e69 6e74 3634 5d3a 0a20  t32,np.int64]:. 
-00010f80: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00010f90: 5f74 7261 696e 203d 2079 5f74 7261 696e  _train = y_train
-00010fa0: 2e61 7374 7970 6528 696e 7429 200a 2020  .astype(int) .  
-00010fb0: 2020 2020 2020 2020 2020 6966 2073 6574            if set
-00010fc0: 7469 6e67 732e 6d6f 6465 6c74 7970 6520  tings.modeltype 
-00010fd0: 3d3d 2027 5265 6772 6573 7369 6f6e 273a  == 'Regression':
-00010fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ff0: 206f 626a 6563 7469 7665 203d 2027 7265   objective = 're
-00011000: 673a 7371 7561 7265 6465 7272 6f72 270a  g:squarederror'.
-00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011020: 7061 7261 6d73 203d 207b 276f 626a 6563  params = {'objec
-00011030: 7469 7665 273a 206f 626a 6563 7469 7665  tive': objective
-00011040: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2020 2020 2020 2273 696c 656e 7422 3a54        "silent":T
-00011070: 7275 652c 2022 7665 7262 6f73 6974 7922  rue, "verbosity"
-00011080: 3a20 302c 2027 6d69 6e5f 6368 696c 645f  : 0, 'min_child_
-00011090: 7765 6967 6874 273a 2030 2e35 7d0a 2020  weight': 0.5}.  
-000110a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000110b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110c0: 2323 2323 2054 6869 7320 6973 2066 6f72  #### This is for
-000110d0: 2043 6c61 7373 6966 6965 7273 206f 6e6c   Classifiers onl
-000110e0: 7920 2323 2323 2323 2323 2323 2020 2020  y ##########    
-000110f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011110: 2069 6620 7365 7474 696e 6773 2e6d 6f64   if settings.mod
-00011120: 656c 7479 7065 203d 3d20 2742 696e 6172  eltype == 'Binar
-00011130: 795f 436c 6173 7369 6669 6361 7469 6f6e  y_Classification
-00011140: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00011150: 2020 2020 2020 206f 626a 6563 7469 7665         objective
-00011160: 203d 2027 6269 6e61 7279 3a6c 6f67 6973   = 'binary:logis
-00011170: 7469 6327 0a20 2020 2020 2020 2020 2020  tic'.           
-00011180: 2020 2020 2020 2020 206e 756d 5f63 6c61           num_cla
-00011190: 7373 203d 2031 0a20 2020 2020 2020 2020  ss = 1.         
-000111a0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-000111b0: 7320 3d20 7b27 6f62 6a65 6374 6976 6527  s = {'objective'
-000111c0: 3a20 6f62 6a65 6374 6976 652c 2027 6e75  : objective, 'nu
-000111d0: 6d5f 636c 6173 7327 3a20 6e75 6d5f 636c  m_class': num_cl
-000111e0: 6173 732c 0a20 2020 2020 2020 2020 2020  ass,.           
-000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011200: 2020 2020 2020 2020 2022 7369 6c65 6e74           "silent
-00011210: 223a 5472 7565 2c20 2022 7665 7262 6f73  ":True,  "verbos
-00011220: 6974 7922 3a20 302c 2020 276d 696e 5f63  ity": 0,  'min_c
-00011230: 6869 6c64 5f77 6569 6768 7427 3a20 302e  hild_weight': 0.
-00011240: 357d 0a20 2020 2020 2020 2020 2020 2020  5}.             
-00011250: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00011260: 2020 2020 2020 2020 2020 2020 206f 626a               obj
-00011270: 6563 7469 7665 203d 2027 6d75 6c74 693a  ective = 'multi:
-00011280: 736f 6674 6d61 7827 0a20 2020 2020 2020  softmax'.       
-00011290: 2020 2020 2020 2020 2020 2020 206e 756d               num
-000112a0: 5f63 6c61 7373 2020 3d20 2064 6174 616e  _class  =  datan
-000112b0: 616d 655b 7461 7267 6574 5d2e 6e75 6e69  ame[target].nuni
-000112c0: 7175 6528 295b 305d 0a20 2020 2020 2020  que()[0].       
-000112d0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-000112e0: 616d 7320 3d20 7b27 6f62 6a65 6374 6976  ams = {'objectiv
-000112f0: 6527 3a20 6f62 6a65 6374 6976 652c 200a  e': objective, .
-00011300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011320: 2020 2020 2273 696c 656e 7422 3a54 7275      "silent":Tru
-00011330: 652c 2022 7665 7262 6f73 6974 7922 3a20  e, "verbosity": 
-00011340: 302c 2020 2027 6d69 6e5f 6368 696c 645f  0,   'min_child_
-00011350: 7765 6967 6874 273a 2030 2e35 2c20 276e  weight': 0.5, 'n
-00011360: 756d 5f63 6c61 7373 273a 206e 756d 5f63  um_class': num_c
-00011370: 6c61 7373 7d0a 2020 2020 2020 2020 2020  lass}.          
-00011380: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00011390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000113a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000113b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000fef0: 2323 230a 2020 2020 6966 2064 6173 6b5f  ###.    if dask_
+0000ff00: 7867 626f 6f73 745f 666c 6167 3a0a 2020  xgboost_flag:.  
+0000ff10: 2020 2020 2020 2323 2320 7765 2072 656c        ### we rel
+0000ff20: 6f61 6420 7468 6520 6461 7461 6672 616d  oad the datafram
+0000ff30: 6573 2069 6e74 6f20 6461 736b 2073 696e  es into dask sin
+0000ff40: 6365 2063 6f6c 756d 6e73 206d 6179 2068  ce columns may h
+0000ff50: 6176 6520 6265 656e 2064 726f 7070 6564  ave been dropped
+0000ff60: 2023 230a 2020 2020 2020 2020 6966 2076   ##.        if v
+0000ff70: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0000ff80: 2020 2020 7072 696e 7428 2720 2020 2075      print('    u
+0000ff90: 7369 6e67 2044 4153 4b20 5847 426f 6f73  sing DASK XGBoos
+0000ffa0: 7427 2920 200a 2020 2020 2020 2020 7472  t')  .        tr
+0000ffb0: 6169 6e20 3d20 6c6f 6164 5f64 6173 6b5f  ain = load_dask_
+0000ffc0: 6461 7461 2864 6174 616e 616d 652c 2073  data(dataname, s
+0000ffd0: 6570 290a 2020 2020 2020 2020 6966 206e  ep).        if n
+0000ffe0: 6f74 2074 6573 745f 6461 7461 2069 7320  ot test_data is 
+0000fff0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010000: 2020 7465 7374 203d 206c 6f61 645f 6461    test = load_da
+00010010: 736b 5f64 6174 6128 7465 7374 5f64 6174  sk_data(test_dat
+00010020: 612c 2073 6570 290a 2020 2020 656c 7365  a, sep).    else
+00010030: 3a0a 2020 2020 2020 2020 2323 2320 7765  :.        ### we
+00010040: 2072 656c 6f61 6420 7468 6520 6461 7461   reload the data
+00010050: 6672 616d 6573 2069 6e74 6f20 6461 736b  frames into dask
+00010060: 2073 696e 6365 2063 6f6c 756d 6e73 206d   since columns m
+00010070: 6179 2068 6176 6520 6265 656e 2064 726f  ay have been dro
+00010080: 7070 6564 2023 230a 2020 2020 2020 2020  pped ##.        
+00010090: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+000100a0: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+000100b0: 2020 2075 7369 6e67 2072 6567 756c 6172     using regular
+000100c0: 2058 4742 6f6f 7374 2729 200a 2020 2020   XGBoost') .    
+000100d0: 2020 2020 7472 6169 6e20 3d20 636f 7079      train = copy
+000100e0: 2e64 6565 7063 6f70 7928 6461 7461 6e61  .deepcopy(datana
+000100f0: 6d65 290a 2020 2020 2020 2020 7465 7374  me).        test
+00010100: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00010110: 2874 6573 745f 6461 7461 290a 2020 2020  (test_data).    
+00010120: 2323 2323 2323 2323 2020 436f 6e76 6572  ########  Conver
+00010130: 7369 6f6e 2063 6f6d 706c 6574 6564 2066  sion completed f
+00010140: 6f72 2074 7261 696e 2061 6e64 2074 6573  or train and tes
+00010150: 7420 6461 7461 2023 2323 2323 2323 2323  t data #########
+00010160: 230a 2020 2023 2323 2320 4966 2043 6174  #.   #### If Cat
+00010170: 6567 6f72 7920 456e 636f 6469 6e67 2074  egory Encoding t
+00010180: 6f6f 6b20 706c 6163 652c 2074 6865 7365  ook place, these
+00010190: 2063 6174 2076 6172 6961 626c 6573 2061   cat variables a
+000101a0: 7265 206e 6f20 6c6f 6e67 6572 206e 6565  re no longer nee
+000101b0: 6465 6420 696e 2054 7261 696e 2e20 536f  ded in Train. So
+000101c0: 2072 656d 6f76 6520 7468 656d 210a 2020   remove them!.  
+000101d0: 2020 6966 2066 6561 7475 7265 5f67 656e    if feature_gen
+000101e0: 206f 7220 6665 6174 7572 655f 7479 7065   or feature_type
+000101f0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00010200: 2753 696e 6365 2025 7320 6361 7465 676f  'Since %s catego
+00010210: 7279 2065 6e63 6f64 696e 6720 6973 2064  ry encoding is d
+00010220: 6f6e 652c 2064 726f 7070 696e 6720 6f72  one, dropping or
+00010230: 6967 696e 616c 2063 6174 6567 6f72 6963  iginal categoric
+00010240: 616c 2076 6172 7320 6672 6f6d 2070 7265  al vars from pre
+00010250: 6469 6374 6f72 732e 2e2e 2720 2566 6561  dictors...' %fea
+00010260: 7475 7265 5f67 656e 290a 2020 2020 2020  ture_gen).      
+00010270: 2020 7072 6564 7320 3d20 6c65 6674 5f73    preds = left_s
+00010280: 7562 7472 6163 7428 7072 6564 732c 2063  ubtract(preds, c
+00010290: 6174 7661 7273 290a 2020 2020 6966 2064  atvars).    if d
+000102a0: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
+000102b0: 3a0a 2020 2020 2020 2020 7472 6169 6e5f  :.        train_
+000102c0: 7020 3d20 7472 6169 6e5b 7072 6564 735d  p = train[preds]
+000102d0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+000102e0: 2020 2074 7261 696e 5f70 203d 2064 6174     train_p = dat
+000102f0: 616e 616d 655b 7072 6564 735d 0a20 2020  aname[preds].   
+00010300: 2023 2323 2323 2323 2320 4c69 6d69 7420   ######## Limit 
+00010310: 7468 6520 6e75 6d62 6572 206f 6620 6974  the number of it
+00010320: 6572 6174 696f 6e73 2074 6f20 3520 6f72  erations to 5 or
+00010330: 2073 6f20 2323 2323 2323 230a 2020 2020   so #######.    
+00010340: 6966 2074 7261 696e 5f70 2e73 6861 7065  if train_p.shape
+00010350: 5b31 5d20 3c3d 2031 303a 0a20 2020 2020  [1] <= 10:.     
+00010360: 2020 2069 7465 725f 6c69 6d69 7420 3d20     iter_limit = 
+00010370: 320a 2020 2020 656c 7365 3a0a 2020 2020  2.    else:.    
+00010380: 2020 2020 6974 6572 5f6c 696d 6974 203d      iter_limit =
+00010390: 2069 6e74 2874 7261 696e 5f70 2e73 6861   int(train_p.sha
+000103a0: 7065 5b31 5d2f 352b 302e 3529 0a20 2020  pe[1]/5+0.5).   
+000103b0: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+000103c0: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+000103d0: 5461 6b69 6e67 2074 6f70 2025 7320 6665  Taking top %s fe
+000103e0: 6174 7572 6573 2070 6572 2069 7465 7261  atures per itera
+000103f0: 7469 6f6e 2e2e 2e27 2025 746f 705f 6e75  tion...' %top_nu
+00010400: 6d29 0a20 2020 2069 6620 6461 736b 5f78  m).    if dask_x
+00010410: 6762 6f6f 7374 5f66 6c61 673a 0a20 2020  gboost_flag:.   
+00010420: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+00010430: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00010440: 6e74 2827 2020 2020 4461 736b 2076 6572  nt('    Dask ver
+00010450: 7369 6f6e 203d 2025 7327 2025 6461 736b  sion = %s' %dask
+00010460: 2e5f 5f76 6572 7369 6f6e 5f5f 290a 2020  .__version__).  
+00010470: 2020 2020 2020 2323 2320 596f 7520 6361        ### You ca
+00010480: 6e20 7265 6d6f 7665 2064 6173 6b5f 6d6c  n remove dask_ml
+00010490: 2068 6572 6520 7369 6e63 6520 796f 7520   here since you 
+000104a0: 646f 6e27 7420 646f 2061 6e79 2073 706c  don't do any spl
+000104b0: 6974 206f 6620 7472 6169 6e20 7465 7374  it of train test
+000104c0: 2068 6572 6520 2323 2323 2323 2323 2323   here ##########
+000104d0: 0a20 2020 2020 2020 2023 6672 6f6d 2064  .        #from d
+000104e0: 6173 6b5f 6d6c 2e6d 6f64 656c 5f73 656c  ask_ml.model_sel
+000104f0: 6563 7469 6f6e 2069 6d70 6f72 7420 7472  ection import tr
+00010500: 6169 6e5f 7465 7374 5f73 706c 6974 0a20  ain_test_split. 
+00010510: 2020 2020 2020 2023 2323 2063 6865 636b         ### check
+00010520: 2061 7661 696c 6162 6c65 206d 656d 6f72   available memor
+00010530: 7920 616e 6420 616c 6c6f 6361 7465 2061  y and allocate a
+00010540: 7420 6c65 6173 7420 3147 4220 6f66 2069  t least 1GB of i
+00010550: 7420 696e 2074 6865 2043 6c69 656e 7420  t in the Client 
+00010560: 696e 2044 4153 4b20 2323 2323 2323 2323  in DASK ########
+00010570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010580: 2323 2323 230a 2020 2020 2020 2020 6e5f  #####.        n_
+00010590: 776f 726b 6572 7320 3d20 6765 745f 6370  workers = get_cp
+000105a0: 755f 776f 726b 6572 5f63 6f75 6e74 2829  u_worker_count()
+000105b0: 0a20 2020 2020 2020 2023 2323 2041 766f  .        ### Avo
+000105c0: 6964 2072 6564 7563 696e 6720 7468 6520  id reducing the 
+000105d0: 6672 6565 206d 656d 6f72 7920 2d20 6c65  free memory - le
+000105e0: 6176 6520 6974 2061 7320 6269 6720 6173  ave it as big as
+000105f0: 2069 7420 7761 6e74 7320 746f 2062 6520   it wants to be 
+00010600: 2323 230a 2020 2020 2020 2020 6d65 6d6f  ###.        memo
+00010610: 7279 5f66 7265 6520 3d20 7374 7228 6d61  ry_free = str(ma
+00010620: 7828 312c 2069 6e74 2870 7375 7469 6c2e  x(1, int(psutil.
+00010630: 7669 7274 7561 6c5f 6d65 6d6f 7279 2829  virtual_memory()
+00010640: 5b30 5d2f 286e 5f77 6f72 6b65 7273 2a31  [0]/(n_workers*1
+00010650: 6539 2929 2929 2b27 4742 270a 2020 2020  e9))))+'GB'.    
+00010660: 2020 2020 7072 696e 7428 2720 2020 2055      print('    U
+00010670: 7369 6e67 2044 6173 6b20 5847 426f 6f73  sing Dask XGBoos
+00010680: 7420 616c 676f 7269 7468 6d20 7769 7468  t algorithm with
+00010690: 2025 7320 7669 7274 7561 6c20 4350 5573   %s virtual CPUs
+000106a0: 2061 6e64 2025 7320 6d65 6d6f 7279 206c   and %s memory l
+000106b0: 696d 6974 2e2e 2e27 2025 2867 6574 5f63  imit...' %(get_c
+000106c0: 7075 5f77 6f72 6b65 725f 636f 756e 7428  pu_worker_count(
+000106d0: 292c 206d 656d 6f72 795f 6672 6565 2929  ), memory_free))
+000106e0: 0a20 2020 2020 2020 2063 6c69 656e 7420  .        client 
+000106f0: 3d20 436c 6965 6e74 286e 5f77 6f72 6b65  = Client(n_worke
+00010700: 7273 3d20 6e5f 776f 726b 6572 732c 2074  rs= n_workers, t
+00010710: 6872 6561 6473 5f70 6572 5f77 6f72 6b65  hreads_per_worke
+00010720: 723d 312c 2070 726f 6365 7373 6573 3d54  r=1, processes=T
+00010730: 7275 652c 2073 696c 656e 6365 5f6c 6f67  rue, silence_log
+00010740: 733d 3530 2c0a 2020 2020 2020 2020 2020  s=50,.          
+00010750: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00010760: 6d6f 7279 5f6c 696d 6974 3d6d 656d 6f72  mory_limit=memor
+00010770: 795f 6672 6565 290a 2020 2020 2020 2020  y_free).        
+00010780: 7072 696e 7428 2744 6173 6b20 636c 6965  print('Dask clie
+00010790: 6e74 2063 6f6e 6669 6775 7261 7469 6f6e  nt configuration
+000107a0: 3a20 2573 2720 2563 6c69 656e 7429 0a20  : %s' %client). 
+000107b0: 2020 2020 2020 2069 6d70 6f72 7420 6763         import gc
+000107c0: 0a20 2020 2020 2020 2063 6c69 656e 742e  .        client.
+000107d0: 7275 6e28 6763 2e63 6f6c 6c65 6374 2920  run(gc.collect) 
+000107e0: 0a20 2020 2020 2020 2023 7472 6169 6e5f  .        #train_
+000107f0: 7020 3d20 636c 6965 6e74 2e70 6572 7369  p = client.persi
+00010800: 7374 2874 7261 696e 5f70 290a 2020 2020  st(train_p).    
+00010810: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+00010820: 2020 2020 7072 696e 7428 2720 2020 2058      print('    X
+00010830: 4742 6f6f 7374 2076 6572 7369 6f6e 2075  GBoost version u
+00010840: 7369 6e67 2025 7320 6173 2074 7265 6520  sing %s as tree 
+00010850: 6d65 7468 6f64 3a20 2573 2720 2528 7867  method: %s' %(xg
+00010860: 622e 5f5f 7665 7273 696f 6e5f 5f2c 2074  b.__version__, t
+00010870: 7265 655f 6d65 7468 6f64 2929 0a20 2020  ree_method)).   
+00010880: 2023 2323 2054 6869 7320 6973 2074 6f20   ### This is to 
+00010890: 636f 6e76 6572 7420 7468 6520 7461 7267  convert the targ
+000108a0: 6574 206c 6162 656c 7320 746f 2070 726f  et labels to pro
+000108b0: 7065 7220 6e75 6d65 7269 6320 636f 6c75  per numeric colu
+000108c0: 6d6e 7320 2323 2323 2323 0a20 2020 2063  mns ######.    c
+000108d0: 6174 5f74 6172 6765 7473 203d 2064 6174  at_targets = dat
+000108e0: 616e 616d 655b 7461 7267 6574 5d2e 7365  aname[target].se
+000108f0: 6c65 6374 5f64 7479 7065 7328 696e 636c  lect_dtypes(incl
+00010900: 7564 653d 276f 626a 6563 7427 292e 636f  ude='object').co
+00010910: 6c75 6d6e 732e 746f 6c69 7374 2829 202b  lumns.tolist() +
+00010920: 2064 6174 616e 616d 655b 7461 7267 6574   dataname[target
+00010930: 5d2e 7365 6c65 6374 5f64 7479 7065 7328  ].select_dtypes(
+00010940: 696e 636c 7564 653d 2763 6174 6567 6f72  include='categor
+00010950: 7927 292e 636f 6c75 6d6e 732e 746f 6c69  y').columns.toli
+00010960: 7374 2829 0a20 2020 2023 2323 2063 6865  st().    ### che
+00010970: 636b 2069 6620 7468 6579 2061 7265 206e  ck if they are n
+00010980: 6f74 2073 7461 7274 696e 6720 6672 6f6d  ot starting from
+00010990: 207a 6572 6f20 2323 2323 2323 2323 2323   zero ##########
+000109a0: 2323 2323 2323 2323 0a20 2020 2069 6620  ########.    if 
+000109b0: 6461 736b 5f78 6762 6f6f 7374 5f66 6c61  dask_xgboost_fla
+000109c0: 673a 0a20 2020 2020 2020 2023 2323 2074  g:.        ### t
+000109d0: 7261 696e 2069 7320 616c 7265 6164 7920  rain is already 
+000109e0: 6120 6461 736b 2064 6174 6166 7261 6d65  a dask dataframe
+000109f0: 202d 3e20 796f 7520 6361 6e20 6c65 6176   -> you can leav
+00010a00: 6520 6974 2061 7320 6974 2069 730a 2020  e it as it is.  
+00010a10: 2020 2020 2020 795f 7472 6169 6e20 3d20        y_train = 
+00010a20: 7472 6169 6e5b 7461 7267 6574 5d0a 2020  train[target].  
+00010a30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00010a40: 2323 2320 7472 6169 6e20 6973 2061 6c72  ### train is alr
+00010a50: 6561 6479 2061 2072 6567 756c 6172 2064  eady a regular d
+00010a60: 6174 6166 7261 6d65 202d 3e20 796f 7520  ataframe -> you 
+00010a70: 6361 6e20 6c65 6176 6520 6974 2061 7320  can leave it as 
+00010a80: 6974 2069 730a 2020 2020 2020 2020 795f  it is.        y_
+00010a90: 7472 6169 6e20 3d20 6461 7461 6e61 6d65  train = dataname
+00010aa0: 5b74 6172 6765 745d 0a20 2020 2023 2323  [target].    ###
+00010ab0: 2320 4e6f 7720 7765 2070 726f 6365 7373  # Now we process
+00010ac0: 2074 6865 206e 756d 6572 6963 2020 7661   the numeric  va
+00010ad0: 6c75 6573 2074 6872 6f75 6768 2044 4153  lues through DAS
+00010ae0: 4b20 5847 426f 6f73 7420 7265 7065 6174  K XGBoost repeat
+00010af0: 6564 6c79 2023 2323 2323 2323 2323 2323  edly ###########
+00010b00: 2323 2323 2323 2323 0a20 2020 2074 7279  ########.    try
+00010b10: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
+00010b20: 696e 2072 616e 6765 2830 2c74 7261 696e  in range(0,train
+00010b30: 5f70 2e73 6861 7065 5b31 5d2c 6974 6572  _p.shape[1],iter
+00010b40: 5f6c 696d 6974 293a 0a20 2020 2020 2020  _limit):.       
+00010b50: 2020 2020 2073 7461 7274 5f74 696d 6532       start_time2
+00010b60: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+00010b70: 2020 2020 2020 2020 2020 2069 6d70 5f66             imp_f
+00010b80: 6561 7473 203d 205b 5d0a 2020 2020 2020  eats = [].      
+00010b90: 2020 2020 2020 6966 2074 7261 696e 5f70        if train_p
+00010ba0: 2e73 6861 7065 5b31 5d2d 6920 3c20 6974  .shape[1]-i < it
+00010bb0: 6572 5f6c 696d 6974 3a0a 2020 2020 2020  er_limit:.      
+00010bc0: 2020 2020 2020 2020 2020 585f 7472 6169            X_trai
+00010bd0: 6e20 3d20 7472 6169 6e5f 702e 696c 6f63  n = train_p.iloc
+00010be0: 5b3a 2c69 3a5d 0a20 2020 2020 2020 2020  [:,i:].         
+00010bf0: 2020 2020 2020 2063 6f6c 735f 7365 6c20         cols_sel 
+00010c00: 3d20 585f 7472 6169 6e2e 636f 6c75 6d6e  = X_train.column
+00010c10: 732e 746f 6c69 7374 2829 0a20 2020 2020  s.tolist().     
+00010c20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010c30: 2020 2020 2020 2020 2020 2020 2058 5f74               X_t
+00010c40: 7261 696e 203d 2074 7261 696e 5f70 5b6c  rain = train_p[l
+00010c50: 6973 7428 7472 6169 6e5f 702e 636f 6c75  ist(train_p.colu
+00010c60: 6d6e 732e 7661 6c75 6573 295b 693a 7472  mns.values)[i:tr
+00010c70: 6169 6e5f 702e 7368 6170 655b 315d 5d5d  ain_p.shape[1]]]
+00010c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010c90: 2063 6f6c 735f 7365 6c20 3d20 585f 7472   cols_sel = X_tr
+00010ca0: 6169 6e2e 636f 6c75 6d6e 732e 746f 6c69  ain.columns.toli
+00010cb0: 7374 2829 0a20 2020 2020 2020 2020 2020  st().           
+00010cc0: 2023 2323 2323 2054 6869 7320 6973 2077   ##### This is w
+00010cd0: 6865 7265 2079 6f75 2072 6570 6561 7420  here you repeat 
+00010ce0: 7468 6520 7472 6169 6e69 6e67 2061 6e64  the training and
+00010cf0: 2066 696e 6469 6e67 2066 6561 7475 7265   finding feature
+00010d00: 2069 6d70 6f72 7461 6e63 6573 0a20 2020   importances.   
+00010d10: 2020 2020 2020 2020 2069 6620 6461 736b           if dask
+00010d20: 5f78 6762 6f6f 7374 5f66 6c61 673a 0a20  _xgboost_flag:. 
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00010d40: 6f77 7320 3d20 585f 7472 6169 6e2e 636f  ows = X_train.co
+00010d50: 6d70 7574 6528 292e 7368 6170 655b 305d  mpute().shape[0]
+00010d60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00010d70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010d80: 2020 2072 6f77 7320 3d20 585f 7472 6169     rows = X_trai
+00010d90: 6e2e 7368 6170 655b 305d 0a20 2020 2020  n.shape[0].     
+00010da0: 2020 2020 2020 2069 6620 726f 7773 203e         if rows >
+00010db0: 3d20 3130 3030 3030 3a0a 2020 2020 2020  = 100000:.      
+00010dc0: 2020 2020 2020 2020 2020 6e75 6d5f 726f            num_ro
+00010dd0: 756e 6473 203d 2032 300a 2020 2020 2020  unds = 20.      
+00010de0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00010df0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00010e00: 726f 756e 6473 203d 2031 3030 0a20 2020  rounds = 100.   
+00010e10: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
+00010e20: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00010e30: 2020 2020 7072 696e 7428 274e 756d 6265      print('Numbe
+00010e40: 7220 6f66 2062 6f6f 7374 6572 2072 6f75  r of booster rou
+00010e50: 6e64 7320 3d20 2573 2720 256e 756d 5f72  nds = %s' %num_r
+00010e60: 6f75 6e64 7329 0a20 2020 2020 2020 2020  ounds).         
+00010e70: 2020 2069 6620 7472 6169 6e5f 702e 7368     if train_p.sh
+00010e80: 6170 655b 315d 2d69 203c 2032 3a0a 2020  ape[1]-i < 2:.  
+00010e90: 2020 2020 2020 2020 2020 2020 2020 2323                ##
+00010ea0: 2320 4966 2074 6865 7265 2069 7320 6a75  # If there is ju
+00010eb0: 7374 206f 6e65 2076 6172 6961 626c 6520  st one variable 
+00010ec0: 6c65 6674 2c20 7468 656e 206a 7573 7420  left, then just 
+00010ed0: 736b 6970 2069 7420 2323 2323 230a 2020  skip it #####.  
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00010ef0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00010f00: 2020 2023 2323 2323 2323 2323 2020 2054     #########   T
+00010f10: 6869 7320 6973 2077 6865 7265 2077 6520  his is where we 
+00010f20: 6368 6563 6b20 7461 7267 6574 2074 7970  check target typ
+00010f30: 6520 2323 2323 2323 2323 2323 0a20 2020  e ##########.   
+00010f40: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00010f50: 795f 7472 6169 6e2e 6474 7970 6573 5b30  y_train.dtypes[0
+00010f60: 5d20 696e 205b 6e70 2e66 6c6f 6174 3136  ] in [np.float16
+00010f70: 2c20 6e70 2e66 6c6f 6174 3332 2c20 6e70  , np.float32, np
+00010f80: 2e66 6c6f 6174 3634 2c20 6e70 2e69 6e74  .float64, np.int
+00010f90: 382c 6e70 2e69 6e74 3136 2c6e 702e 696e  8,np.int16,np.in
+00010fa0: 7433 322c 6e70 2e69 6e74 3634 5d3a 0a20  t32,np.int64]:. 
+00010fb0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00010fc0: 5f74 7261 696e 203d 2079 5f74 7261 696e  _train = y_train
+00010fd0: 2e61 7374 7970 6528 696e 7429 200a 2020  .astype(int) .  
+00010fe0: 2020 2020 2020 2020 2020 6966 2073 6574            if set
+00010ff0: 7469 6e67 732e 6d6f 6465 6c74 7970 6520  tings.modeltype 
+00011000: 3d3d 2027 5265 6772 6573 7369 6f6e 273a  == 'Regression':
+00011010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011020: 206f 626a 6563 7469 7665 203d 2027 7265   objective = 're
+00011030: 673a 7371 7561 7265 6465 7272 6f72 270a  g:squarederror'.
+00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011050: 7061 7261 6d73 203d 207b 276f 626a 6563  params = {'objec
+00011060: 7469 7665 273a 206f 626a 6563 7469 7665  tive': objective
+00011070: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00011080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011090: 2020 2020 2020 2273 696c 656e 7422 3a54        "silent":T
+000110a0: 7275 652c 2022 7665 7262 6f73 6974 7922  rue, "verbosity"
+000110b0: 3a20 302c 2027 6d69 6e5f 6368 696c 645f  : 0, 'min_child_
+000110c0: 7765 6967 6874 273a 2030 2e35 7d0a 2020  weight': 0.5}.  
+000110d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 2323 2323 2054 6869 7320 6973 2066 6f72  #### This is for
+00011100: 2043 6c61 7373 6966 6965 7273 206f 6e6c   Classifiers onl
+00011110: 7920 2323 2323 2323 2323 2323 2020 2020  y ##########    
+00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011140: 2069 6620 7365 7474 696e 6773 2e6d 6f64   if settings.mod
+00011150: 656c 7479 7065 203d 3d20 2742 696e 6172  eltype == 'Binar
+00011160: 795f 436c 6173 7369 6669 6361 7469 6f6e  y_Classification
+00011170: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00011180: 2020 2020 2020 206f 626a 6563 7469 7665         objective
+00011190: 203d 2027 6269 6e61 7279 3a6c 6f67 6973   = 'binary:logis
+000111a0: 7469 6327 0a20 2020 2020 2020 2020 2020  tic'.           
+000111b0: 2020 2020 2020 2020 206e 756d 5f63 6c61           num_cla
+000111c0: 7373 203d 2031 0a20 2020 2020 2020 2020  ss = 1.         
+000111d0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+000111e0: 7320 3d20 7b27 6f62 6a65 6374 6976 6527  s = {'objective'
+000111f0: 3a20 6f62 6a65 6374 6976 652c 2027 6e75  : objective, 'nu
+00011200: 6d5f 636c 6173 7327 3a20 6e75 6d5f 636c  m_class': num_cl
+00011210: 6173 732c 0a20 2020 2020 2020 2020 2020  ass,.           
+00011220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011230: 2020 2020 2020 2020 2022 7369 6c65 6e74           "silent
+00011240: 223a 5472 7565 2c20 2022 7665 7262 6f73  ":True,  "verbos
+00011250: 6974 7922 3a20 302c 2020 276d 696e 5f63  ity": 0,  'min_c
+00011260: 6869 6c64 5f77 6569 6768 7427 3a20 302e  hild_weight': 0.
+00011270: 357d 0a20 2020 2020 2020 2020 2020 2020  5}.             
+00011280: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011290: 2020 2020 2020 2020 2020 2020 206f 626a               obj
+000112a0: 6563 7469 7665 203d 2027 6d75 6c74 693a  ective = 'multi:
+000112b0: 736f 6674 6d61 7827 0a20 2020 2020 2020  softmax'.       
+000112c0: 2020 2020 2020 2020 2020 2020 206e 756d               num
+000112d0: 5f63 6c61 7373 2020 3d20 2064 6174 616e  _class  =  datan
+000112e0: 616d 655b 7461 7267 6574 5d2e 6e75 6e69  ame[target].nuni
+000112f0: 7175 6528 295b 305d 0a20 2020 2020 2020  que()[0].       
+00011300: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00011310: 616d 7320 3d20 7b27 6f62 6a65 6374 6976  ams = {'objectiv
+00011320: 6527 3a20 6f62 6a65 6374 6976 652c 200a  e': objective, .
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 2020 2020 2273 696c 656e 7422 3a54 7275      "silent":Tru
+00011360: 652c 2022 7665 7262 6f73 6974 7922 3a20  e, "verbosity": 
+00011370: 302c 2020 2027 6d69 6e5f 6368 696c 645f  0,   'min_child_
+00011380: 7765 6967 6874 273a 2030 2e35 2c20 276e  weight': 0.5, 'n
+00011390: 756d 5f63 6c61 7373 273a 206e 756d 5f63  um_class': num_c
+000113a0: 6c61 7373 7d0a 2020 2020 2020 2020 2020  lass}.          
+000113b0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
 000113c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000113d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000113e0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-000113f0: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00011400: 2323 2323 2054 6869 7320 6973 2077 6865  #### This is whe
-00011410: 7265 2077 6520 6669 6e64 206f 7574 2077  re we find out w
-00011420: 6865 7468 6572 2074 6f20 7573 6520 7369  hether to use si
-00011430: 6e67 6c65 206f 7220 6d75 6c74 692d 6c61  ngle or multi-la
-00011440: 6265 6c20 666f 7220 7867 626f 6f73 7420  bel for xgboost 
-00011450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011460: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-00011470: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+000113e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000113f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011410: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+00011420: 2020 2020 2020 2020 2020 2023 2323 2323             #####
+00011430: 2323 2323 2054 6869 7320 6973 2077 6865  #### This is whe
+00011440: 7265 2077 6520 6669 6e64 206f 7574 2077  re we find out w
+00011450: 6865 7468 6572 2074 6f20 7573 6520 7369  hether to use si
+00011460: 6e67 6c65 206f 7220 6d75 6c74 692d 6c61  ngle or multi-la
+00011470: 6265 6c20 666f 7220 7867 626f 6f73 7420  bel for xgboost 
 00011480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000114a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011490: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
+000114a0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
 000114b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000114c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000114d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000114e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000114f0: 7365 7474 696e 6773 2e6d 756c 7469 5f6c  settings.multi_l
-00011500: 6162 656c 3a0a 2020 2020 2020 2020 2020  abel:.          
-00011510: 2020 2020 2020 6966 2073 6574 7469 6e67        if setting
-00011520: 732e 6d6f 6465 6c74 7970 6520 3d3d 2027  s.modeltype == '
-00011530: 5265 6772 6573 7369 6f6e 273a 0a20 2020  Regression':.   
-00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011550: 2063 6c66 203d 2058 4742 5265 6772 6573   clf = XGBRegres
-00011560: 736f 7228 6e5f 6a6f 6273 3d2d 312c 206e  sor(n_jobs=-1, n
-00011570: 5f65 7374 696d 6174 6f72 733d 3130 302c  _estimators=100,
-00011580: 206d 6178 5f64 6570 7468 3d34 2c20 7261   max_depth=4, ra
-00011590: 6e64 6f6d 5f73 7461 7465 3d39 3929 0a20  ndom_state=99). 
-000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115b0: 2020 2063 6c66 2e73 6574 5f70 6172 616d     clf.set_param
-000115c0: 7328 2a2a 7061 7261 6d73 290a 2020 2020  s(**params).    
+000114e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000114f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011510: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011520: 7365 7474 696e 6773 2e6d 756c 7469 5f6c  settings.multi_l
+00011530: 6162 656c 3a0a 2020 2020 2020 2020 2020  abel:.          
+00011540: 2020 2020 2020 6966 2073 6574 7469 6e67        if setting
+00011550: 732e 6d6f 6465 6c74 7970 6520 3d3d 2027  s.modeltype == '
+00011560: 5265 6772 6573 7369 6f6e 273a 0a20 2020  Regression':.   
+00011570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011580: 2063 6c66 203d 2058 4742 5265 6772 6573   clf = XGBRegres
+00011590: 736f 7228 6e5f 6a6f 6273 3d2d 312c 206e  sor(n_jobs=-1, n
+000115a0: 5f65 7374 696d 6174 6f72 733d 3130 302c  _estimators=100,
+000115b0: 206d 6178 5f64 6570 7468 3d34 2c20 7261   max_depth=4, ra
+000115c0: 6e64 6f6d 5f73 7461 7465 3d39 3929 0a20  ndom_state=99). 
 000115d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115e0: 6273 7420 3d20 4d75 6c74 694f 7574 7075  bst = MultiOutpu
-000115f0: 7452 6567 7265 7373 6f72 2863 6c66 290a  tRegressor(clf).
+000115e0: 2020 2063 6c66 2e73 6574 5f70 6172 616d     clf.set_param
+000115f0: 7328 2a2a 7061 7261 6d73 290a 2020 2020  s(**params).    
 00011600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011610: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011620: 2020 2020 2020 2020 2020 636c 6620 3d20            clf = 
-00011630: 5847 4243 6c61 7373 6966 6965 7228 6e5f  XGBClassifier(n_
-00011640: 6a6f 6273 3d2d 312c 206e 5f65 7374 696d  jobs=-1, n_estim
-00011650: 6174 6f72 733d 3130 302c 206d 6178 5f64  ators=100, max_d
-00011660: 6570 7468 3d34 2c20 7261 6e64 6f6d 5f73  epth=4, random_s
-00011670: 7461 7465 3d39 3929 0a20 2020 2020 2020  tate=99).       
-00011680: 2020 2020 2020 2020 2020 2020 2063 6c66               clf
-00011690: 2e73 6574 5f70 6172 616d 7328 2a2a 7061  .set_params(**pa
-000116a0: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
-000116b0: 2020 2020 2020 2020 2020 6273 7420 3d20            bst = 
-000116c0: 4d75 6c74 694f 7574 7075 7443 6c61 7373  MultiOutputClass
-000116d0: 6966 6965 7228 636c 6629 0a20 2020 2020  ifier(clf).     
-000116e0: 2020 2020 2020 2020 2020 2062 7374 2e66             bst.f
-000116f0: 6974 2858 5f74 7261 696e 2c20 795f 7472  it(X_train, y_tr
-00011700: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
-00011710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011720: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
-00011730: 736b 5f78 6762 6f6f 7374 5f66 6c61 673a  sk_xgboost_flag:
-00011740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011750: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00011760: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011610: 6273 7420 3d20 4d75 6c74 694f 7574 7075  bst = MultiOutpu
+00011620: 7452 6567 7265 7373 6f72 2863 6c66 290a  tRegressor(clf).
+00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011640: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00011650: 2020 2020 2020 2020 2020 636c 6620 3d20            clf = 
+00011660: 5847 4243 6c61 7373 6966 6965 7228 6e5f  XGBClassifier(n_
+00011670: 6a6f 6273 3d2d 312c 206e 5f65 7374 696d  jobs=-1, n_estim
+00011680: 6174 6f72 733d 3130 302c 206d 6178 5f64  ators=100, max_d
+00011690: 6570 7468 3d34 2c20 7261 6e64 6f6d 5f73  epth=4, random_s
+000116a0: 7461 7465 3d39 3929 0a20 2020 2020 2020  tate=99).       
+000116b0: 2020 2020 2020 2020 2020 2020 2063 6c66               clf
+000116c0: 2e73 6574 5f70 6172 616d 7328 2a2a 7061  .set_params(**pa
+000116d0: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+000116e0: 2020 2020 2020 2020 2020 6273 7420 3d20            bst = 
+000116f0: 4d75 6c74 694f 7574 7075 7443 6c61 7373  MultiOutputClass
+00011700: 6966 6965 7228 636c 6629 0a20 2020 2020  ifier(clf).     
+00011710: 2020 2020 2020 2020 2020 2062 7374 2e66             bst.f
+00011720: 6974 2858 5f74 7261 696e 2c20 795f 7472  it(X_train, y_tr
+00011730: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
+00011740: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011750: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
+00011760: 736b 5f78 6762 6f6f 7374 5f66 6c61 673a  sk_xgboost_flag:
+00011770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011780: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
 00011790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000117a0: 2323 2323 230a 2020 2020 2020 2020 2020  #####.          
-000117b0: 2020 2020 2020 2020 2020 2323 2323 2323            ######
-000117c0: 2323 2320 2054 7261 696e 696e 6720 5265  ###  Training Re
-000117d0: 6775 6c61 7220 5847 426f 6f73 7420 6f6e  gular XGBoost on
-000117e0: 2070 616e 6461 7320 6461 7461 6672 616d   pandas datafram
-000117f0: 6573 206f 6e6c 7920 2323 2323 2323 2323  es only ########
-00011800: 2323 2323 2323 2323 2323 0a20 2020 2020  ##########.     
-00011810: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00011820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000117a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000117b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000117c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000117d0: 2323 2323 230a 2020 2020 2020 2020 2020  #####.          
+000117e0: 2020 2020 2020 2020 2020 2323 2323 2323            ######
+000117f0: 2323 2320 2054 7261 696e 696e 6720 5265  ###  Training Re
+00011800: 6775 6c61 7220 5847 426f 6f73 7420 6f6e  gular XGBoost on
+00011810: 2070 616e 6461 7320 6461 7461 6672 616d   pandas datafram
+00011820: 6573 206f 6e6c 7920 2323 2323 2323 2323  es only ########
+00011830: 2323 2323 2323 2323 2323 0a20 2020 2020  ##########.     
+00011840: 2020 2020 2020 2020 2020 2020 2020 2023                 #
 00011850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011860: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00011870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011880: 2020 2020 2323 2323 206e 6f77 2074 6869      #### now thi
-00011890: 7320 7472 6169 6e69 6e67 2076 6961 2062  s training via b
-000118a0: 7374 2077 6f72 6b73 2077 656c 6c20 666f  st works well fo
-000118b0: 7220 626f 7468 2078 6762 6f6f 7374 2030  r both xgboost 0
-000118c0: 2e30 2e39 3020 6173 2077 656c 6c20 6173  .0.90 as well as
-000118d0: 2031 2e35 2e31 2023 230a 2020 2020 2020   1.5.1 ##.      
-000118e0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-000118f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011900: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011920: 6474 7261 696e 203d 2078 6762 2e44 4d61  dtrain = xgb.DMa
-00011930: 7472 6978 2858 5f74 7261 696e 2c20 795f  trix(X_train, y_
-00011940: 7472 6169 6e2c 2065 6e61 626c 655f 6361  train, enable_ca
-00011950: 7465 676f 7269 6361 6c3d 5472 7565 2c20  tegorical=True, 
-00011960: 6665 6174 7572 655f 6e61 6d65 733d 636f  feature_names=co
-00011970: 6c73 5f73 656c 290a 2020 2020 2020 2020  ls_sel).        
-00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011990: 6273 7420 3d20 7867 622e 7472 6169 6e28  bst = xgb.train(
-000119a0: 7061 7261 6d73 2c20 6474 7261 696e 2c20  params, dtrain, 
-000119b0: 6e75 6d5f 626f 6f73 745f 726f 756e 643d  num_boost_round=
-000119c0: 6e75 6d5f 726f 756e 6473 2920 2020 2020  num_rounds)     
-000119d0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00011a10: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00011a20: 6570 7469 6f6e 2061 7320 6572 726f 725f  eption as error_
-00011a30: 6d73 673a 0a20 2020 2020 2020 2020 2020  msg:.           
-00011a40: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00011a50: 6e74 2827 5265 6775 6c61 7220 5847 426f  nt('Regular XGBo
-00011a60: 6f73 7420 6973 2063 7261 7368 696e 6720  ost is crashing 
-00011a70: 6475 6520 746f 3a20 2573 2720 2565 7272  due to: %s' %err
-00011a80: 6f72 5f6d 7367 290a 2020 2020 2020 2020  or_msg).        
-00011a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011aa0: 6966 2073 6574 7469 6e67 732e 6d6f 6465  if settings.mode
-00011ab0: 6c74 7970 6520 3d3d 2027 5265 6772 6573  ltype == 'Regres
-00011ac0: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ae0: 2020 2070 6172 616d 7320 3d20 7b27 7472     params = {'tr
-00011af0: 6565 5f6d 6574 686f 6427 3a20 6370 755f  ee_method': cpu_
-00011b00: 7472 6565 5f6d 6574 686f 642c 2027 6770  tree_method, 'gp
-00011b10: 755f 6964 273a 204e 6f6e 657d 0a20 2020  u_id': None}.   
-00011b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00011b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b50: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00011b60: 7b27 7472 6565 5f6d 6574 686f 6427 3a20  {'tree_method': 
-00011b70: 6370 755f 7472 6565 5f6d 6574 686f 642c  cpu_tree_method,
-00011b80: 276e 756d 5f63 6c61 7373 273a 206e 756d  'num_class': num
-00011b90: 5f63 6c61 7373 2c20 2767 7075 5f69 6427  _class, 'gpu_id'
-00011ba0: 3a20 4e6f 6e65 7d0a 2020 2020 2020 2020  : None}.        
-00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bc0: 7072 696e 7428 6572 726f 725f 6d73 6729  print(error_msg)
-00011bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011be0: 2020 2020 2020 2020 2062 7374 203d 2078           bst = x
-00011bf0: 6762 2e74 7261 696e 2870 6172 616d 732c  gb.train(params,
-00011c00: 2064 7472 6169 6e2c 206e 756d 5f62 6f6f   dtrain, num_boo
-00011c10: 7374 5f72 6f75 6e64 3d6e 756d 5f72 6f75  st_round=num_rou
-00011c20: 6e64 7329 2020 2020 2020 2020 2020 2020  nds)            
-00011c30: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00011c40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00011c50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00011c60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011890: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118b0: 2020 2020 2323 2323 206e 6f77 2074 6869      #### now thi
+000118c0: 7320 7472 6169 6e69 6e67 2076 6961 2062  s training via b
+000118d0: 7374 2077 6f72 6b73 2077 656c 6c20 666f  st works well fo
+000118e0: 7220 626f 7468 2078 6762 6f6f 7374 2030  r both xgboost 0
+000118f0: 2e30 2e39 3020 6173 2077 656c 6c20 6173  .0.90 as well as
+00011900: 2031 2e35 2e31 2023 230a 2020 2020 2020   1.5.1 ##.      
+00011910: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011930: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00011940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011950: 6474 7261 696e 203d 2078 6762 2e44 4d61  dtrain = xgb.DMa
+00011960: 7472 6978 2858 5f74 7261 696e 2c20 795f  trix(X_train, y_
+00011970: 7472 6169 6e2c 2065 6e61 626c 655f 6361  train, enable_ca
+00011980: 7465 676f 7269 6361 6c3d 5472 7565 2c20  tegorical=True, 
+00011990: 6665 6174 7572 655f 6e61 6d65 733d 636f  feature_names=co
+000119a0: 6c73 5f73 656c 290a 2020 2020 2020 2020  ls_sel).        
+000119b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119c0: 6273 7420 3d20 7867 622e 7472 6169 6e28  bst = xgb.train(
+000119d0: 7061 7261 6d73 2c20 6474 7261 696e 2c20  params, dtrain, 
+000119e0: 6e75 6d5f 626f 6f73 745f 726f 756e 643d  num_boost_round=
+000119f0: 6e75 6d5f 726f 756e 6473 2920 2020 2020  num_rounds)     
+00011a00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a30: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011a40: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00011a50: 6570 7469 6f6e 2061 7320 6572 726f 725f  eption as error_
+00011a60: 6d73 673a 0a20 2020 2020 2020 2020 2020  msg:.           
+00011a70: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00011a80: 6e74 2827 5265 6775 6c61 7220 5847 426f  nt('Regular XGBo
+00011a90: 6f73 7420 6973 2063 7261 7368 696e 6720  ost is crashing 
+00011aa0: 6475 6520 746f 3a20 2573 2720 2565 7272  due to: %s' %err
+00011ab0: 6f72 5f6d 7367 290a 2020 2020 2020 2020  or_msg).        
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 6966 2073 6574 7469 6e67 732e 6d6f 6465  if settings.mode
+00011ae0: 6c74 7970 6520 3d3d 2027 5265 6772 6573  ltype == 'Regres
+00011af0: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
+00011b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b10: 2020 2070 6172 616d 7320 3d20 7b27 7472     params = {'tr
+00011b20: 6565 5f6d 6574 686f 6427 3a20 6370 755f  ee_method': cpu_
+00011b30: 7472 6565 5f6d 6574 686f 642c 2027 6770  tree_method, 'gp
+00011b40: 755f 6964 273a 204e 6f6e 657d 0a20 2020  u_id': None}.   
+00011b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b80: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00011b90: 7b27 7472 6565 5f6d 6574 686f 6427 3a20  {'tree_method': 
+00011ba0: 6370 755f 7472 6565 5f6d 6574 686f 642c  cpu_tree_method,
+00011bb0: 276e 756d 5f63 6c61 7373 273a 206e 756d  'num_class': num
+00011bc0: 5f63 6c61 7373 2c20 2767 7075 5f69 6427  _class, 'gpu_id'
+00011bd0: 3a20 4e6f 6e65 7d0a 2020 2020 2020 2020  : None}.        
+00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bf0: 7072 696e 7428 6572 726f 725f 6d73 6729  print(error_msg)
+00011c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c10: 2020 2020 2020 2020 2062 7374 203d 2078           bst = x
+00011c20: 6762 2e74 7261 696e 2870 6172 616d 732c  gb.train(params,
+00011c30: 2064 7472 6169 6e2c 206e 756d 5f62 6f6f   dtrain, num_boo
+00011c40: 7374 5f72 6f75 6e64 3d6e 756d 5f72 6f75  st_round=num_rou
+00011c50: 6e64 7329 2020 2020 2020 2020 2020 2020  nds)            
+00011c60: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00011c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
 00011c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011ca0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cc0: 2020 2020 2323 2323 2323 2323 2323 2020      ##########  
-00011cd0: 2054 7261 696e 696e 6720 5847 426f 6f73   Training XGBoos
-00011ce0: 7420 6d6f 6465 6c20 7573 696e 6720 6461  t model using da
-00011cf0: 736b 5f78 6762 6f6f 7374 2023 2323 2323  sk_xgboost #####
-00011d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011d10: 2323 2323 0a20 2020 2020 2020 2020 2020  ####.           
-00011d20: 2020 2020 2020 2020 2023 2323 2323 2323           #######
+00011ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011cd0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cf0: 2020 2020 2323 2323 2323 2323 2323 2020      ##########  
+00011d00: 2054 7261 696e 696e 6720 5847 426f 6f73   Training XGBoos
+00011d10: 7420 6d6f 6465 6c20 7573 696e 6720 6461  t model using da
+00011d20: 736b 5f78 6762 6f6f 7374 2023 2323 2323  sk_xgboost #####
 00011d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011d40: 2323 2323 0a20 2020 2020 2020 2020 2020  ####.           
+00011d50: 2020 2020 2020 2020 2023 2323 2323 2323           #######
 00011d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011d70: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2323                ##
-00011d90: 2320 7468 6520 6474 7261 696e 2073 796e  # the dtrain syn
-00011da0: 7461 7820 6361 6e20 6f6e 6c79 2062 6520  tax can only be 
-00011db0: 7573 6564 2078 6762 6f6f 7374 2031 2e35  used xgboost 1.5
-00011dc0: 3020 6f72 2067 7265 6174 6572 2e20 446f  0 or greater. Do
-00011dd0: 6e74 2075 7365 2069 7420 756e 7469 6c20  nt use it until 
-00011de0: 7468 656e 2e0a 2020 2020 2020 2020 2020  then..          
-00011df0: 2020 2020 2020 2020 2020 2323 2320 7573            ### us
-00011e00: 6520 7468 6520 6e65 7874 206c 696e 6520  e the next line 
-00011e10: 666f 7220 6e65 7720 7867 626f 6f73 7420  for new xgboost 
-00011e20: 7665 7273 696f 6e20 312e 352e 3120 6162  version 1.5.1 ab
-00011e30: 6420 6869 6768 6572 2023 2323 2323 2323  d higher #######
-00011e40: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
-00011e50: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e70: 2020 2020 2323 2323 2053 594e 5441 5820      #### SYNTAX 
-00011e80: 4245 4c4f 5720 574f 524b 5320 5745 4c4c  BELOW WORKS WELL
-00011e90: 2e20 4255 5420 594f 5520 4341 4e4e 4f54  . BUT YOU CANNOT
-00011ea0: 2044 4f20 4556 414c 5320 5749 5448 2044   DO EVALS WITH D
-00011eb0: 4153 4b20 5847 424f 4f53 5420 4153 204f  ASK XGBOOST AS O
-00011ec0: 4620 4e4f 5720 2323 2323 0a20 2020 2020  F NOW ####.     
-00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ee0: 2020 2023 6474 7261 696e 203d 2078 6762     #dtrain = xgb
-00011ef0: 2e64 6173 6b2e 4461 736b 444d 6174 7269  .dask.DaskDMatri
-00011f00: 7828 636c 6965 6e74 2c20 585f 7472 6169  x(client, X_trai
-00011f10: 6e2c 2079 5f74 7261 696e 290a 2020 2020  n, y_train).    
-00011f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f30: 2020 2020 2362 7374 203d 2078 6762 2e64      #bst = xgb.d
-00011f40: 6173 6b2e 7472 6169 6e28 636c 6965 6e74  ask.train(client
-00011f50: 2c20 7061 7261 6d73 2c20 6474 7261 696e  , params, dtrain
-00011f60: 2c20 6e75 6d5f 626f 6f73 745f 726f 756e  , num_boost_roun
-00011f70: 643d 6e75 6d5f 726f 756e 6473 290a 2020  d=num_rounds).  
-00011f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f90: 2020 2020 2020 6273 7420 3d20 6461 736b        bst = dask
-00011fa0: 5f78 6762 6f6f 7374 5f74 7261 696e 696e  _xgboost_trainin
-00011fb0: 6728 585f 7472 6169 6e2c 2079 5f74 7261  g(X_train, y_tra
-00011fc0: 696e 2c20 7061 7261 6d73 290a 2020 2020  in, params).    
-00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011fe0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00011ff0: 2061 7320 6572 726f 725f 6d73 673a 0a20   as error_msg:. 
+00011d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011d80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00011da0: 2323 2323 2323 2323 230a 2020 2020 2020  #########.      
+00011db0: 2020 2020 2020 2020 2020 2020 2020 2323                ##
+00011dc0: 2320 7468 6520 6474 7261 696e 2073 796e  # the dtrain syn
+00011dd0: 7461 7820 6361 6e20 6f6e 6c79 2062 6520  tax can only be 
+00011de0: 7573 6564 2078 6762 6f6f 7374 2031 2e35  used xgboost 1.5
+00011df0: 3020 6f72 2067 7265 6174 6572 2e20 446f  0 or greater. Do
+00011e00: 6e74 2075 7365 2069 7420 756e 7469 6c20  nt use it until 
+00011e10: 7468 656e 2e0a 2020 2020 2020 2020 2020  then..          
+00011e20: 2020 2020 2020 2020 2020 2323 2320 7573            ### us
+00011e30: 6520 7468 6520 6e65 7874 206c 696e 6520  e the next line 
+00011e40: 666f 7220 6e65 7720 7867 626f 6f73 7420  for new xgboost 
+00011e50: 7665 7273 696f 6e20 312e 352e 3120 6162  version 1.5.1 ab
+00011e60: 6420 6869 6768 6572 2023 2323 2323 2323  d higher #######
+00011e70: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
+00011e80: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00011e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ea0: 2020 2020 2323 2323 2053 594e 5441 5820      #### SYNTAX 
+00011eb0: 4245 4c4f 5720 574f 524b 5320 5745 4c4c  BELOW WORKS WELL
+00011ec0: 2e20 4255 5420 594f 5520 4341 4e4e 4f54  . BUT YOU CANNOT
+00011ed0: 2044 4f20 4556 414c 5320 5749 5448 2044   DO EVALS WITH D
+00011ee0: 4153 4b20 5847 424f 4f53 5420 4153 204f  ASK XGBOOST AS O
+00011ef0: 4620 4e4f 5720 2323 2323 0a20 2020 2020  F NOW ####.     
+00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f10: 2020 2023 6474 7261 696e 203d 2078 6762     #dtrain = xgb
+00011f20: 2e64 6173 6b2e 4461 736b 444d 6174 7269  .dask.DaskDMatri
+00011f30: 7828 636c 6965 6e74 2c20 585f 7472 6169  x(client, X_trai
+00011f40: 6e2c 2079 5f74 7261 696e 290a 2020 2020  n, y_train).    
+00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f60: 2020 2020 2362 7374 203d 2078 6762 2e64      #bst = xgb.d
+00011f70: 6173 6b2e 7472 6169 6e28 636c 6965 6e74  ask.train(client
+00011f80: 2c20 7061 7261 6d73 2c20 6474 7261 696e  , params, dtrain
+00011f90: 2c20 6e75 6d5f 626f 6f73 745f 726f 756e  , num_boost_roun
+00011fa0: 643d 6e75 6d5f 726f 756e 6473 290a 2020  d=num_rounds).  
+00011fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fc0: 2020 2020 2020 6273 7420 3d20 6461 736b        bst = dask
+00011fd0: 5f78 6762 6f6f 7374 5f74 7261 696e 696e  _xgboost_trainin
+00011fe0: 6728 585f 7472 6169 6e2c 2079 5f74 7261  g(X_train, y_tra
+00011ff0: 696e 2c20 7061 7261 6d73 290a 2020 2020  in, params).    
 00012000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012010: 2020 2020 2020 2069 6620 7365 7474 696e         if settin
-00012020: 6773 2e6d 6f64 656c 7479 7065 203d 3d20  gs.modeltype == 
-00012030: 2752 6567 7265 7373 696f 6e27 3a0a 2020  'Regression':.  
-00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012050: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00012060: 203d 207b 2774 7265 655f 6d65 7468 6f64   = {'tree_method
-00012070: 273a 2063 7075 5f74 7265 655f 6d65 7468  ': cpu_tree_meth
-00012080: 6f64 7d0a 2020 2020 2020 2020 2020 2020  od}.            
-00012090: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000120a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000120b0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000120c0: 7261 6d73 203d 207b 2774 7265 655f 6d65  rams = {'tree_me
-000120d0: 7468 6f64 273a 2063 7075 5f74 7265 655f  thod': cpu_tree_
-000120e0: 6d65 7468 6f64 2c27 6e75 6d5f 636c 6173  method,'num_clas
-000120f0: 7327 3a20 6e75 6d5f 636c 6173 737d 0a20  s': num_class}. 
-00012100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012110: 2020 2020 2020 2064 7472 6169 6e20 3d20         dtrain = 
-00012120: 7867 622e 444d 6174 7269 7828 585f 7472  xgb.DMatrix(X_tr
-00012130: 6169 6e2c 206c 6162 656c 3d79 5f74 7261  ain, label=y_tra
-00012140: 696e 2c20 6665 6174 7572 655f 6e61 6d65  in, feature_name
-00012150: 733d 636f 6c73 5f73 656c 290a 2020 2020  s=cols_sel).    
-00012160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012170: 2020 2020 6273 7420 3d20 7867 622e 6461      bst = xgb.da
-00012180: 736b 2e74 7261 696e 2863 6c69 656e 743d  sk.train(client=
-00012190: 636c 6965 6e74 2c20 7061 7261 6d73 3d70  client, params=p
-000121a0: 6172 616d 732c 2064 7472 6169 6e3d 6474  arams, dtrain=dt
-000121b0: 7261 696e 2c20 6e75 6d5f 626f 6f73 745f  rain, num_boost_
-000121c0: 726f 756e 643d 6e75 6d5f 726f 756e 6473  round=num_rounds
-000121d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000121e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000121f0: 6572 726f 725f 6d73 6729 0a20 2020 2020  error_msg).     
-00012200: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00012210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012010: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00012020: 2061 7320 6572 726f 725f 6d73 673a 0a20   as error_msg:. 
+00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012040: 2020 2020 2020 2069 6620 7365 7474 696e         if settin
+00012050: 6773 2e6d 6f64 656c 7479 7065 203d 3d20  gs.modeltype == 
+00012060: 2752 6567 7265 7373 696f 6e27 3a0a 2020  'Regression':.  
+00012070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012080: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00012090: 203d 207b 2774 7265 655f 6d65 7468 6f64   = {'tree_method
+000120a0: 273a 2063 7075 5f74 7265 655f 6d65 7468  ': cpu_tree_meth
+000120b0: 6f64 7d0a 2020 2020 2020 2020 2020 2020  od}.            
+000120c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000120d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000120e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000120f0: 7261 6d73 203d 207b 2774 7265 655f 6d65  rams = {'tree_me
+00012100: 7468 6f64 273a 2063 7075 5f74 7265 655f  thod': cpu_tree_
+00012110: 6d65 7468 6f64 2c27 6e75 6d5f 636c 6173  method,'num_clas
+00012120: 7327 3a20 6e75 6d5f 636c 6173 737d 0a20  s': num_class}. 
+00012130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012140: 2020 2020 2020 2064 7472 6169 6e20 3d20         dtrain = 
+00012150: 7867 622e 444d 6174 7269 7828 585f 7472  xgb.DMatrix(X_tr
+00012160: 6169 6e2c 206c 6162 656c 3d79 5f74 7261  ain, label=y_tra
+00012170: 696e 2c20 6665 6174 7572 655f 6e61 6d65  in, feature_name
+00012180: 733d 636f 6c73 5f73 656c 290a 2020 2020  s=cols_sel).    
+00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121a0: 2020 2020 6273 7420 3d20 7867 622e 6461      bst = xgb.da
+000121b0: 736b 2e74 7261 696e 2863 6c69 656e 743d  sk.train(client=
+000121c0: 636c 6965 6e74 2c20 7061 7261 6d73 3d70  client, params=p
+000121d0: 6172 616d 732c 2064 7472 6169 6e3d 6474  arams, dtrain=dt
+000121e0: 7261 696e 2c20 6e75 6d5f 626f 6f73 745f  rain, num_boost_
+000121f0: 726f 756e 643d 6e75 6d5f 726f 756e 6473  round=num_rounds
+00012200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012210: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00012220: 6572 726f 725f 6d73 6729 0a20 2020 2020  error_msg).     
+00012230: 2020 2020 2020 2023 2323 2323 2323 2323         #########
 00012240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012250: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-00012260: 2020 2020 6966 206e 6f74 2064 6173 6b5f      if not dask_
-00012270: 7867 626f 6f73 745f 666c 6167 3a0a 2020  xgboost_flag:.  
-00012280: 2020 2020 2020 2020 2020 2020 2020 6273                bs
-00012290: 745f 6d6f 6465 6c73 2e61 7070 656e 6428  t_models.append(
-000122a0: 6273 7429 0a20 2020 2020 2020 2020 2020  bst).           
-000122b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000122c0: 2020 2020 2020 2062 7374 5f6d 6f64 656c         bst_model
-000122d0: 732e 6170 7065 6e64 2862 7374 5b27 626f  s.append(bst['bo
-000122e0: 6f73 7465 7227 5d29 2020 2020 2020 2020  oster'])        
-000122f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00012300: 2020 2020 2023 2323 2323 2074 6f20 6765       ##### to ge
-00012310: 7420 7468 6520 7061 7261 6d73 206f 6620  t the params of 
-00012320: 616e 2078 6762 6f6f 7374 2062 6f6f 7374  an xgboost boost
-00012330: 6572 206f 626a 6563 7420 796f 7520 6861  er object you ha
-00012340: 7665 2074 6f20 646f 2074 6865 2066 6f6c  ve to do the fol
-00012350: 6c6f 7769 6e67 2073 7465 7073 3a0a 2020  lowing steps:.  
-00012360: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-00012370: 626f 7365 203e 3d20 333a 0a20 2020 2020  bose >= 3:.     
-00012380: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00012390: 7420 6461 736b 5f78 6762 6f6f 7374 5f66  t dask_xgboost_f
-000123a0: 6c61 6720 3a0a 2020 2020 2020 2020 2020  lag :.          
-000123b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000123c0: 2752 6567 756c 6172 2058 4742 6f6f 7374  'Regular XGBoost
-000123d0: 206d 6f64 656c 2070 6172 616d 6574 6572   model parameter
-000123e0: 733a 5c6e 2729 0a20 2020 2020 2020 2020  s:\n').         
-000123f0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00012400: 6720 3d20 6a73 6f6e 2e6c 6f61 6473 2862  g = json.loads(b
-00012410: 7374 2e73 6176 655f 636f 6e66 6967 2829  st.save_config()
-00012420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012430: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012440: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00012450: 7428 2744 6173 6b20 5847 426f 6f73 7420  t('Dask XGBoost 
-00012460: 6d6f 6465 6c20 7061 7261 6d65 7465 7273  model parameters
-00012470: 3a5c 6e27 290a 2020 2020 2020 2020 2020  :\n').          
-00012480: 2020 2020 2020 2020 2020 626f 6f20 3d20            boo = 
-00012490: 6273 745b 2762 6f6f 7374 6572 275d 0a20  bst['booster']. 
-000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124b0: 2020 2063 6f6e 6669 6720 3d20 6a73 6f6e     config = json
-000124c0: 2e6c 6f61 6473 2862 6f6f 2e73 6176 655f  .loads(boo.save_
-000124d0: 636f 6e66 6967 2829 290a 2020 2020 2020  config()).      
-000124e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000124f0: 636f 6e66 6967 290a 2020 2020 2020 2020  config).        
-00012500: 2020 2020 2323 2323 2075 7365 2074 6869      #### use thi
-00012510: 7320 6e65 7874 206f 6e65 2066 6f72 2064  s next one for d
-00012520: 6173 6b5f 7867 626f 6f73 7420 6f6c 6420  ask_xgboost old 
-00012530: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
-00012540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012550: 7365 7474 696e 6773 2e6d 756c 7469 5f6c  settings.multi_l
-00012560: 6162 656c 3a0a 2020 2020 2020 2020 2020  abel:.          
-00012570: 2020 2020 2020 696d 705f 6665 6174 7320        imp_feats 
-00012580: 3d20 6469 6374 287a 6970 2858 5f74 7261  = dict(zip(X_tra
-00012590: 696e 2e63 6f6c 756d 6e73 2c20 6273 742e  in.columns, bst.
-000125a0: 6573 7469 6d61 746f 7273 5f5b 305d 2e66  estimators_[0].f
-000125b0: 6561 7475 7265 5f69 6d70 6f72 7461 6e63  eature_importanc
-000125c0: 6573 5f29 290a 2020 2020 2020 2020 2020  es_)).          
-000125d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000125e0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-000125f0: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
-00012600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012610: 2020 2020 2020 696d 705f 6665 6174 7320        imp_feats 
-00012620: 3d20 6273 742e 6765 745f 7363 6f72 6528  = bst.get_score(
-00012630: 666d 6170 3d27 272c 2069 6d70 6f72 7461  fmap='', importa
-00012640: 6e63 655f 7479 7065 3d27 746f 7461 6c5f  nce_type='total_
-00012650: 6761 696e 2729 0a20 2020 2020 2020 2020  gain').         
-00012660: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00012670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012680: 2069 6d70 5f66 6561 7473 203d 2062 7374   imp_feats = bst
-00012690: 5b27 626f 6f73 7465 7227 5d2e 6765 745f  ['booster'].get_
-000126a0: 7363 6f72 6528 666d 6170 3d27 272c 2069  score(fmap='', i
-000126b0: 6d70 6f72 7461 6e63 655f 7479 7065 3d27  mportance_type='
-000126c0: 746f 7461 6c5f 6761 696e 2729 0a20 2020  total_gain').   
-000126d0: 2020 2020 2020 2020 2023 2323 2073 6b69           ### ski
-000126e0: 7020 7468 6520 6e65 7874 2073 7461 7465  p the next state
-000126f0: 6d65 6e74 2073 696e 6365 2069 7420 6973  ment since it is
-00012700: 2064 7570 6c69 6361 7469 6e67 2074 6865   duplicating the
-00012710: 2077 6f72 6b20 6f66 2073 6f72 745f 7661   work of sort_va
-00012720: 6c75 6573 2023 230a 2020 2020 2020 2020  lues ##.        
-00012730: 2020 2020 2369 6d70 5f66 6561 7473 203d      #imp_feats =
-00012740: 2064 6963 7428 736f 7274 6564 2869 6d70   dict(sorted(imp
-00012750: 5f66 6561 7473 2e69 7465 6d73 2829 2c72  _feats.items(),r
-00012760: 6576 6572 7365 3d54 7275 652c 206b 6579  everse=True, key
-00012770: 3d6c 616d 6264 6120 6974 656d 3a20 6974  =lambda item: it
-00012780: 656d 5b31 5d29 290a 2020 2020 2020 2020  em[1])).        
-00012790: 2020 2020 2323 2320 646f 696e 6720 7468      ### doing th
-000127a0: 6973 2066 6f72 2073 696e 676c 652d 6c61  is for single-la
-000127b0: 6265 6c20 6973 2061 206c 6974 746c 6520  bel is a little 
-000127c0: 6469 6666 6572 656e 7420 6672 6f6d 2073  different from s
-000127d0: 6574 7469 6e67 732e 6d75 6c74 695f 6c61  ettings.multi_la
-000127e0: 6265 6c20 2323 2323 2323 2323 230a 0a20  bel #########.. 
-000127f0: 2020 2020 2020 2020 2020 2023 696d 705f             #imp_
-00012800: 6665 6174 7320 3d20 6d6f 6465 6c5f 7867  feats = model_xg
-00012810: 622e 6765 745f 626f 6f73 7465 7228 292e  b.get_booster().
-00012820: 6765 745f 7363 6f72 6528 696d 706f 7274  get_score(import
-00012830: 616e 6365 5f74 7970 653d 2767 6169 6e27  ance_type='gain'
-00012840: 290a 2020 2020 2020 2020 2020 2020 2370  ).            #p
-00012850: 7269 6e74 2827 2564 2069 7465 7261 7469  rint('%d iterati
-00012860: 6f6e 3a20 696d 705f 6665 6174 7320 3d20  on: imp_feats = 
-00012870: 2573 2720 2528 692b 312c 696d 705f 6665  %s' %(i+1,imp_fe
-00012880: 6174 7329 290a 2020 2020 2020 2020 2020  ats)).          
-00012890: 2020 6966 206c 656e 2870 642e 5365 7269    if len(pd.Seri
-000128a0: 6573 2869 6d70 5f66 6561 7473 295b 7064  es(imp_feats)[pd
-000128b0: 2e53 6572 6965 7328 696d 705f 6665 6174  .Series(imp_feat
-000128c0: 7329 2e73 6f72 745f 7661 6c75 6573 2861  s).sort_values(a
-000128d0: 7363 656e 6469 6e67 3d46 616c 7365 292f  scending=False)/
-000128e0: 7064 2e53 6572 6965 7328 696d 705f 6665  pd.Series(imp_fe
-000128f0: 6174 7329 2e76 616c 7565 732e 6d61 7828  ats).values.max(
-00012900: 293e 3d30 2e35 5d29 203e 2031 3a0a 2020  )>=0.5]) > 1:.  
-00012910: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00012920: 696e 745f 6665 6174 7320 3d20 2870 642e  int_feats = (pd.
-00012930: 5365 7269 6573 2869 6d70 5f66 6561 7473  Series(imp_feats
-00012940: 295b 7064 2e53 6572 6965 7328 696d 705f  )[pd.Series(imp_
-00012950: 6665 6174 7329 2e73 6f72 745f 7661 6c75  feats).sort_valu
-00012960: 6573 2861 7363 656e 6469 6e67 3d46 616c  es(ascending=Fal
-00012970: 7365 292f 7064 2e53 6572 6965 7328 696d  se)/pd.Series(im
-00012980: 705f 6665 6174 7329 2e76 616c 7565 732e  p_feats).values.
-00012990: 6d61 7828 293e 3d30 2e35 5d29 2e69 6e64  max()>=0.5]).ind
-000129a0: 6578 2e74 6f6c 6973 7428 290a 2020 2020  ex.tolist().    
-000129b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000129c0: 656e 2870 7269 6e74 5f66 6561 7473 2920  en(print_feats) 
-000129d0: 3c20 746f 705f 6e75 6d3a 0a20 2020 2020  < top_num:.     
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000129f0: 7269 6e74 5f66 6561 7473 203d 2070 642e  rint_feats = pd.
-00012a00: 5365 7269 6573 2869 6d70 5f66 6561 7473  Series(imp_feats
-00012a10: 292e 736f 7274 5f76 616c 7565 7328 6173  ).sort_values(as
-00012a20: 6365 6e64 696e 673d 4661 6c73 6529 5b3a  cending=False)[:
-00012a30: 746f 705f 6e75 6d5d 2e69 6e64 6578 2e74  top_num].index.t
-00012a40: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
-00012a50: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
-00012a60: 7269 6e74 5f66 6561 7473 2920 3c3d 2033  rint_feats) <= 3
-00012a70: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00012a80: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-00012a90: 2020 2020 2020 5365 6c65 6374 6564 3a20        Selected: 
-00012aa0: 2573 2720 2570 7269 6e74 5f66 6561 7473  %s' %print_feats
-00012ab0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012ac0: 2020 696d 706f 7274 616e 745f 6665 6174    important_feat
-00012ad0: 7572 6573 202b 3d20 7072 696e 745f 6665  ures += print_fe
-00012ae0: 6174 730a 2020 2020 2020 2020 2020 2020  ats.            
-00012af0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00012b00: 2020 2020 2020 7072 696e 745f 6665 6174        print_feat
-00012b10: 7320 3d20 7064 2e53 6572 6965 7328 696d  s = pd.Series(im
-00012b20: 705f 6665 6174 7329 2e73 6f72 745f 7661  p_feats).sort_va
-00012b30: 6c75 6573 2861 7363 656e 6469 6e67 3d46  lues(ascending=F
-00012b40: 616c 7365 295b 3a74 6f70 5f6e 756d 5d2e  alse)[:top_num].
-00012b50: 696e 6465 782e 746f 6c69 7374 2829 0a20  index.tolist(). 
-00012b60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012b70: 6620 6c65 6e28 7072 696e 745f 6665 6174  f len(print_feat
-00012b80: 7329 203c 3d20 3330 3a0a 2020 2020 2020  s) <= 30:.      
-00012b90: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00012ba0: 696e 7428 2720 2020 2020 2020 2053 656c  int('        Sel
-00012bb0: 6563 7465 643a 2025 7327 2025 7064 2e53  ected: %s' %pd.S
-00012bc0: 6572 6965 7328 696d 705f 6665 6174 7329  eries(imp_feats)
-00012bd0: 2e73 6f72 745f 7661 6c75 6573 2861 7363  .sort_values(asc
-00012be0: 656e 6469 6e67 3d46 616c 7365 295b 3a74  ending=False)[:t
-00012bf0: 6f70 5f6e 756d 5d2e 696e 6465 782e 746f  op_num].index.to
-00012c00: 6c69 7374 2829 290a 2020 2020 2020 2020  list()).        
-00012c10: 2020 2020 2020 2020 696d 706f 7274 616e          importan
-00012c20: 745f 6665 6174 7572 6573 202b 3d20 7072  t_features += pr
-00012c30: 696e 745f 6665 6174 730a 2020 2020 2020  int_feats.      
-00012c40: 2020 2020 2020 2323 2323 2323 2320 206f        #######  o
-00012c50: 7264 6572 2074 6869 7320 696e 2074 6865  rder this in the
-00012c60: 2073 616d 6520 6f72 6465 7220 696e 2077   same order in w
-00012c70: 6869 6368 2074 6865 7920 7765 7265 2063  hich they were c
-00012c80: 6f6c 6c65 6374 6564 2023 2323 2323 230a  ollected ######.
-00012c90: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00012ca0: 7274 616e 745f 6665 6174 7572 6573 203d  rtant_features =
-00012cb0: 206c 6973 7428 4f72 6465 7265 6444 6963   list(OrderedDic
-00012cc0: 742e 6672 6f6d 6b65 7973 2869 6d70 6f72  t.fromkeys(impor
-00012cd0: 7461 6e74 5f66 6561 7475 7265 7329 290a  tant_features)).
-00012ce0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00012cf0: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
-00012d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012d10: 2020 7072 696e 7428 2720 2020 2020 2020    print('       
-00012d20: 2020 2020 2054 696d 6520 7461 6b65 6e20       Time taken 
-00012d30: 666f 7220 4441 534b 2058 4742 6f6f 7374  for DASK XGBoost
-00012d40: 2066 6561 7475 7265 2073 656c 6563 7469   feature selecti
-00012d50: 6f6e 203d 2025 302e 3066 2073 6563 6f6e  on = %0.0f secon
-00012d60: 6473 2720 2528 7469 6d65 2e74 696d 6528  ds' %(time.time(
-00012d70: 292d 7374 6172 745f 7469 6d65 3229 290a  )-start_time2)).
-00012d80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00012d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012da0: 2020 7072 696e 7428 2720 2020 2020 2020    print('       
-00012db0: 2020 2020 2054 696d 6520 7461 6b65 6e20       Time taken 
-00012dc0: 666f 7220 7265 6775 6c61 7220 5847 426f  for regular XGBo
-00012dd0: 6f73 7420 6665 6174 7572 6520 7365 6c65  ost feature sele
-00012de0: 6374 696f 6e20 3d20 2530 2e30 6620 7365  ction = %0.0f se
-00012df0: 636f 6e64 7327 2025 2874 696d 652e 7469  conds' %(time.ti
-00012e00: 6d65 2829 2d73 7461 7274 5f74 696d 6532  me()-start_time2
-00012e10: 2929 0a20 2020 2020 2020 2023 2323 2320  )).        #### 
-00012e20: 706c 6f74 2061 6c6c 2074 6865 2066 6561  plot all the fea
-00012e30: 7475 7265 2069 6d70 6f72 7461 6e63 6573  ture importances
-00012e40: 2069 6e20 6120 6772 6964 2023 2323 2323   in a grid #####
-00012e50: 2323 2323 2323 0a20 2020 2020 2020 2069  ######.        i
-00012e60: 6620 7665 7262 6f73 6520 3e3d 2032 3a0a  f verbose >= 2:.
-00012e70: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00012e80: 6574 7469 6e67 732e 6d75 6c74 695f 6c61  ettings.multi_la
-00012e90: 6265 6c3a 0a20 2020 2020 2020 2020 2020  bel:.           
-00012ea0: 2020 2020 2064 7261 775f 6665 6174 7572       draw_featur
-00012eb0: 655f 696d 706f 7274 616e 6365 735f 6d75  e_importances_mu
-00012ec0: 6c74 695f 6c61 6265 6c28 6273 745f 6d6f  lti_label(bst_mo
-00012ed0: 6465 6c73 2c20 6461 736b 5f78 6762 6f6f  dels, dask_xgboo
-00012ee0: 7374 5f66 6c61 6729 0a20 2020 2020 2020  st_flag).       
-00012ef0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00012f00: 2020 2020 2020 2020 2020 2064 7261 775f             draw_
-00012f10: 6665 6174 7572 655f 696d 706f 7274 616e  feature_importan
-00012f20: 6365 735f 7369 6e67 6c65 5f6c 6162 656c  ces_single_label
-00012f30: 2862 7374 5f6d 6f64 656c 732c 2064 6173  (bst_models, das
-00012f40: 6b5f 7867 626f 6f73 745f 666c 6167 290a  k_xgboost_flag).
-00012f50: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00012f60: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00012f70: 2020 2069 6620 6461 736b 5f78 6762 6f6f     if dask_xgboo
-00012f80: 7374 5f66 6c61 673a 0a20 2020 2020 2020  st_flag:.       
-00012f90: 2020 2020 2070 7269 6e74 2827 4461 736b       print('Dask
-00012fa0: 2058 4742 6f6f 7374 2069 7320 6372 6173   XGBoost is cras
-00012fb0: 6869 6e67 2064 7565 2074 6f20 2573 2e20  hing due to %s. 
-00012fc0: 5265 7475 726e 696e 6720 7769 7468 2063  Returning with c
-00012fd0: 7572 7265 6e74 6c79 2073 656c 6563 7465  urrently selecte
-00012fe0: 6420 6665 6174 7572 6573 2e2e 2e27 2025  d features...' %
-00012ff0: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-00013000: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00013010: 6e74 2827 5265 6775 6c61 7220 5847 426f  nt('Regular XGBo
-00013020: 6f73 7420 6973 2063 7261 7368 696e 6720  ost is crashing 
-00013030: 6475 6520 746f 2025 732e 2052 6574 7572  due to %s. Retur
-00013040: 6e69 6e67 2077 6974 6820 6375 7272 656e  ning with curren
-00013050: 746c 7920 7365 6c65 6374 6564 2066 6561  tly selected fea
-00013060: 7475 7265 732e 2e2e 2720 2565 290a 2020  tures...' %e).  
-00013070: 2020 2020 2020 696d 706f 7274 616e 745f        important_
-00013080: 6665 6174 7572 6573 203d 2063 6f70 792e  features = copy.
-00013090: 6465 6570 636f 7079 2870 7265 6473 290a  deepcopy(preds).
-000130a0: 2020 2020 2323 2323 2323 2020 2020 4520      ######    E 
-000130b0: 2020 204e 2020 2020 2044 2020 2020 2020     N     D      
-000130c0: 4f20 2046 2020 2020 2020 5820 2047 2020  O  F      X  G  
-000130d0: 4220 204f 2020 4f20 2053 2020 5420 2020  B  O  O  S  T   
-000130e0: 2053 2045 204c 2045 2043 2054 2049 204f   S E L E C T I O
-000130f0: 204e 2023 2323 2323 2323 2323 2323 2323   N #############
-00013100: 2323 2323 2323 230a 2020 2020 7072 696e  #######.    prin
-00013110: 7428 2720 2020 2043 6f6d 706c 6574 6564  t('    Completed
-00013120: 2058 4742 6f6f 7374 2066 6561 7475 7265   XGBoost feature
-00013130: 2073 656c 6563 7469 6f6e 2069 6e20 2530   selection in %0
-00013140: 2e30 6620 7365 636f 6e64 7327 2025 2874  .0f seconds' %(t
-00013150: 696d 652e 7469 6d65 2829 2d73 7461 7274  ime.time()-start
-00013160: 5f74 696d 6532 2929 0a20 2020 2069 6620  _time2)).    if 
-00013170: 6c65 6e28 6964 636f 6c73 2920 3e20 303a  len(idcols) > 0:
-00013180: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00013190: 2020 2020 416c 6572 743a 204e 6f20 4944      Alert: No ID
-000131a0: 2076 6172 6961 626c 6573 2025 7320 6172   variables %s ar
-000131b0: 6520 696e 636c 7564 6564 2069 6e20 7365  e included in se
-000131c0: 6c65 6374 6564 2066 6561 7475 7265 7327  lected features'
-000131d0: 2025 6964 636f 6c73 290a 2020 2020 6966   %idcols).    if
-000131e0: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-000131f0: 2020 7072 696e 7428 2223 2323 2323 2323    print("#######
-00013200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012280: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
+00012290: 2020 2020 6966 206e 6f74 2064 6173 6b5f      if not dask_
+000122a0: 7867 626f 6f73 745f 666c 6167 3a0a 2020  xgboost_flag:.  
+000122b0: 2020 2020 2020 2020 2020 2020 2020 6273                bs
+000122c0: 745f 6d6f 6465 6c73 2e61 7070 656e 6428  t_models.append(
+000122d0: 6273 7429 0a20 2020 2020 2020 2020 2020  bst).           
+000122e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000122f0: 2020 2020 2020 2062 7374 5f6d 6f64 656c         bst_model
+00012300: 732e 6170 7065 6e64 2862 7374 5b27 626f  s.append(bst['bo
+00012310: 6f73 7465 7227 5d29 2020 2020 2020 2020  oster'])        
+00012320: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00012330: 2020 2020 2023 2323 2323 2074 6f20 6765       ##### to ge
+00012340: 7420 7468 6520 7061 7261 6d73 206f 6620  t the params of 
+00012350: 616e 2078 6762 6f6f 7374 2062 6f6f 7374  an xgboost boost
+00012360: 6572 206f 626a 6563 7420 796f 7520 6861  er object you ha
+00012370: 7665 2074 6f20 646f 2074 6865 2066 6f6c  ve to do the fol
+00012380: 6c6f 7769 6e67 2073 7465 7073 3a0a 2020  lowing steps:.  
+00012390: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
+000123a0: 626f 7365 203e 3d20 333a 0a20 2020 2020  bose >= 3:.     
+000123b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000123c0: 7420 6461 736b 5f78 6762 6f6f 7374 5f66  t dask_xgboost_f
+000123d0: 6c61 6720 3a0a 2020 2020 2020 2020 2020  lag :.          
+000123e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000123f0: 2752 6567 756c 6172 2058 4742 6f6f 7374  'Regular XGBoost
+00012400: 206d 6f64 656c 2070 6172 616d 6574 6572   model parameter
+00012410: 733a 5c6e 2729 0a20 2020 2020 2020 2020  s:\n').         
+00012420: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00012430: 6720 3d20 6a73 6f6e 2e6c 6f61 6473 2862  g = json.loads(b
+00012440: 7374 2e73 6176 655f 636f 6e66 6967 2829  st.save_config()
+00012450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012460: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00012470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00012480: 7428 2744 6173 6b20 5847 426f 6f73 7420  t('Dask XGBoost 
+00012490: 6d6f 6465 6c20 7061 7261 6d65 7465 7273  model parameters
+000124a0: 3a5c 6e27 290a 2020 2020 2020 2020 2020  :\n').          
+000124b0: 2020 2020 2020 2020 2020 626f 6f20 3d20            boo = 
+000124c0: 6273 745b 2762 6f6f 7374 6572 275d 0a20  bst['booster']. 
+000124d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124e0: 2020 2063 6f6e 6669 6720 3d20 6a73 6f6e     config = json
+000124f0: 2e6c 6f61 6473 2862 6f6f 2e73 6176 655f  .loads(boo.save_
+00012500: 636f 6e66 6967 2829 290a 2020 2020 2020  config()).      
+00012510: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00012520: 636f 6e66 6967 290a 2020 2020 2020 2020  config).        
+00012530: 2020 2020 2323 2323 2075 7365 2074 6869      #### use thi
+00012540: 7320 6e65 7874 206f 6e65 2066 6f72 2064  s next one for d
+00012550: 6173 6b5f 7867 626f 6f73 7420 6f6c 6420  ask_xgboost old 
+00012560: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+00012570: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012580: 7365 7474 696e 6773 2e6d 756c 7469 5f6c  settings.multi_l
+00012590: 6162 656c 3a0a 2020 2020 2020 2020 2020  abel:.          
+000125a0: 2020 2020 2020 696d 705f 6665 6174 7320        imp_feats 
+000125b0: 3d20 6469 6374 287a 6970 2858 5f74 7261  = dict(zip(X_tra
+000125c0: 696e 2e63 6f6c 756d 6e73 2c20 6273 742e  in.columns, bst.
+000125d0: 6573 7469 6d61 746f 7273 5f5b 305d 2e66  estimators_[0].f
+000125e0: 6561 7475 7265 5f69 6d70 6f72 7461 6e63  eature_importanc
+000125f0: 6573 5f29 290a 2020 2020 2020 2020 2020  es_)).          
+00012600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00012610: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+00012620: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
+00012630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012640: 2020 2020 2020 696d 705f 6665 6174 7320        imp_feats 
+00012650: 3d20 6273 742e 6765 745f 7363 6f72 6528  = bst.get_score(
+00012660: 666d 6170 3d27 272c 2069 6d70 6f72 7461  fmap='', importa
+00012670: 6e63 655f 7479 7065 3d27 746f 7461 6c5f  nce_type='total_
+00012680: 6761 696e 2729 0a20 2020 2020 2020 2020  gain').         
+00012690: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000126a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126b0: 2069 6d70 5f66 6561 7473 203d 2062 7374   imp_feats = bst
+000126c0: 5b27 626f 6f73 7465 7227 5d2e 6765 745f  ['booster'].get_
+000126d0: 7363 6f72 6528 666d 6170 3d27 272c 2069  score(fmap='', i
+000126e0: 6d70 6f72 7461 6e63 655f 7479 7065 3d27  mportance_type='
+000126f0: 746f 7461 6c5f 6761 696e 2729 0a20 2020  total_gain').   
+00012700: 2020 2020 2020 2020 2023 2323 2073 6b69           ### ski
+00012710: 7020 7468 6520 6e65 7874 2073 7461 7465  p the next state
+00012720: 6d65 6e74 2073 696e 6365 2069 7420 6973  ment since it is
+00012730: 2064 7570 6c69 6361 7469 6e67 2074 6865   duplicating the
+00012740: 2077 6f72 6b20 6f66 2073 6f72 745f 7661   work of sort_va
+00012750: 6c75 6573 2023 230a 2020 2020 2020 2020  lues ##.        
+00012760: 2020 2020 2369 6d70 5f66 6561 7473 203d      #imp_feats =
+00012770: 2064 6963 7428 736f 7274 6564 2869 6d70   dict(sorted(imp
+00012780: 5f66 6561 7473 2e69 7465 6d73 2829 2c72  _feats.items(),r
+00012790: 6576 6572 7365 3d54 7275 652c 206b 6579  everse=True, key
+000127a0: 3d6c 616d 6264 6120 6974 656d 3a20 6974  =lambda item: it
+000127b0: 656d 5b31 5d29 290a 2020 2020 2020 2020  em[1])).        
+000127c0: 2020 2020 2323 2320 646f 696e 6720 7468      ### doing th
+000127d0: 6973 2066 6f72 2073 696e 676c 652d 6c61  is for single-la
+000127e0: 6265 6c20 6973 2061 206c 6974 746c 6520  bel is a little 
+000127f0: 6469 6666 6572 656e 7420 6672 6f6d 2073  different from s
+00012800: 6574 7469 6e67 732e 6d75 6c74 695f 6c61  ettings.multi_la
+00012810: 6265 6c20 2323 2323 2323 2323 230a 0a20  bel #########.. 
+00012820: 2020 2020 2020 2020 2020 2023 696d 705f             #imp_
+00012830: 6665 6174 7320 3d20 6d6f 6465 6c5f 7867  feats = model_xg
+00012840: 622e 6765 745f 626f 6f73 7465 7228 292e  b.get_booster().
+00012850: 6765 745f 7363 6f72 6528 696d 706f 7274  get_score(import
+00012860: 616e 6365 5f74 7970 653d 2767 6169 6e27  ance_type='gain'
+00012870: 290a 2020 2020 2020 2020 2020 2020 2370  ).            #p
+00012880: 7269 6e74 2827 2564 2069 7465 7261 7469  rint('%d iterati
+00012890: 6f6e 3a20 696d 705f 6665 6174 7320 3d20  on: imp_feats = 
+000128a0: 2573 2720 2528 692b 312c 696d 705f 6665  %s' %(i+1,imp_fe
+000128b0: 6174 7329 290a 2020 2020 2020 2020 2020  ats)).          
+000128c0: 2020 6966 206c 656e 2870 642e 5365 7269    if len(pd.Seri
+000128d0: 6573 2869 6d70 5f66 6561 7473 295b 7064  es(imp_feats)[pd
+000128e0: 2e53 6572 6965 7328 696d 705f 6665 6174  .Series(imp_feat
+000128f0: 7329 2e73 6f72 745f 7661 6c75 6573 2861  s).sort_values(a
+00012900: 7363 656e 6469 6e67 3d46 616c 7365 292f  scending=False)/
+00012910: 7064 2e53 6572 6965 7328 696d 705f 6665  pd.Series(imp_fe
+00012920: 6174 7329 2e76 616c 7565 732e 6d61 7828  ats).values.max(
+00012930: 293e 3d30 2e35 5d29 203e 2031 3a0a 2020  )>=0.5]) > 1:.  
+00012940: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00012950: 696e 745f 6665 6174 7320 3d20 2870 642e  int_feats = (pd.
+00012960: 5365 7269 6573 2869 6d70 5f66 6561 7473  Series(imp_feats
+00012970: 295b 7064 2e53 6572 6965 7328 696d 705f  )[pd.Series(imp_
+00012980: 6665 6174 7329 2e73 6f72 745f 7661 6c75  feats).sort_valu
+00012990: 6573 2861 7363 656e 6469 6e67 3d46 616c  es(ascending=Fal
+000129a0: 7365 292f 7064 2e53 6572 6965 7328 696d  se)/pd.Series(im
+000129b0: 705f 6665 6174 7329 2e76 616c 7565 732e  p_feats).values.
+000129c0: 6d61 7828 293e 3d30 2e35 5d29 2e69 6e64  max()>=0.5]).ind
+000129d0: 6578 2e74 6f6c 6973 7428 290a 2020 2020  ex.tolist().    
+000129e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000129f0: 656e 2870 7269 6e74 5f66 6561 7473 2920  en(print_feats) 
+00012a00: 3c20 746f 705f 6e75 6d3a 0a20 2020 2020  < top_num:.     
+00012a10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00012a20: 7269 6e74 5f66 6561 7473 203d 2070 642e  rint_feats = pd.
+00012a30: 5365 7269 6573 2869 6d70 5f66 6561 7473  Series(imp_feats
+00012a40: 292e 736f 7274 5f76 616c 7565 7328 6173  ).sort_values(as
+00012a50: 6365 6e64 696e 673d 4661 6c73 6529 5b3a  cending=False)[:
+00012a60: 746f 705f 6e75 6d5d 2e69 6e64 6578 2e74  top_num].index.t
+00012a70: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
+00012a80: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
+00012a90: 7269 6e74 5f66 6561 7473 2920 3c3d 2033  rint_feats) <= 3
+00012aa0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00012ab0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+00012ac0: 2020 2020 2020 5365 6c65 6374 6564 3a20        Selected: 
+00012ad0: 2573 2720 2570 7269 6e74 5f66 6561 7473  %s' %print_feats
+00012ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012af0: 2020 696d 706f 7274 616e 745f 6665 6174    important_feat
+00012b00: 7572 6573 202b 3d20 7072 696e 745f 6665  ures += print_fe
+00012b10: 6174 730a 2020 2020 2020 2020 2020 2020  ats.            
+00012b20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00012b30: 2020 2020 2020 7072 696e 745f 6665 6174        print_feat
+00012b40: 7320 3d20 7064 2e53 6572 6965 7328 696d  s = pd.Series(im
+00012b50: 705f 6665 6174 7329 2e73 6f72 745f 7661  p_feats).sort_va
+00012b60: 6c75 6573 2861 7363 656e 6469 6e67 3d46  lues(ascending=F
+00012b70: 616c 7365 295b 3a74 6f70 5f6e 756d 5d2e  alse)[:top_num].
+00012b80: 696e 6465 782e 746f 6c69 7374 2829 0a20  index.tolist(). 
+00012b90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012ba0: 6620 6c65 6e28 7072 696e 745f 6665 6174  f len(print_feat
+00012bb0: 7329 203c 3d20 3330 3a0a 2020 2020 2020  s) <= 30:.      
+00012bc0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00012bd0: 696e 7428 2720 2020 2020 2020 2053 656c  int('        Sel
+00012be0: 6563 7465 643a 2025 7327 2025 7064 2e53  ected: %s' %pd.S
+00012bf0: 6572 6965 7328 696d 705f 6665 6174 7329  eries(imp_feats)
+00012c00: 2e73 6f72 745f 7661 6c75 6573 2861 7363  .sort_values(asc
+00012c10: 656e 6469 6e67 3d46 616c 7365 295b 3a74  ending=False)[:t
+00012c20: 6f70 5f6e 756d 5d2e 696e 6465 782e 746f  op_num].index.to
+00012c30: 6c69 7374 2829 290a 2020 2020 2020 2020  list()).        
+00012c40: 2020 2020 2020 2020 696d 706f 7274 616e          importan
+00012c50: 745f 6665 6174 7572 6573 202b 3d20 7072  t_features += pr
+00012c60: 696e 745f 6665 6174 730a 2020 2020 2020  int_feats.      
+00012c70: 2020 2020 2020 2323 2323 2323 2320 206f        #######  o
+00012c80: 7264 6572 2074 6869 7320 696e 2074 6865  rder this in the
+00012c90: 2073 616d 6520 6f72 6465 7220 696e 2077   same order in w
+00012ca0: 6869 6368 2074 6865 7920 7765 7265 2063  hich they were c
+00012cb0: 6f6c 6c65 6374 6564 2023 2323 2323 230a  ollected ######.
+00012cc0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00012cd0: 7274 616e 745f 6665 6174 7572 6573 203d  rtant_features =
+00012ce0: 206c 6973 7428 4f72 6465 7265 6444 6963   list(OrderedDic
+00012cf0: 742e 6672 6f6d 6b65 7973 2869 6d70 6f72  t.fromkeys(impor
+00012d00: 7461 6e74 5f66 6561 7475 7265 7329 290a  tant_features)).
+00012d10: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00012d20: 6173 6b5f 7867 626f 6f73 745f 666c 6167  ask_xgboost_flag
+00012d30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012d40: 2020 7072 696e 7428 2720 2020 2020 2020    print('       
+00012d50: 2020 2020 2054 696d 6520 7461 6b65 6e20       Time taken 
+00012d60: 666f 7220 4441 534b 2058 4742 6f6f 7374  for DASK XGBoost
+00012d70: 2066 6561 7475 7265 2073 656c 6563 7469   feature selecti
+00012d80: 6f6e 203d 2025 302e 3066 2073 6563 6f6e  on = %0.0f secon
+00012d90: 6473 2720 2528 7469 6d65 2e74 696d 6528  ds' %(time.time(
+00012da0: 292d 7374 6172 745f 7469 6d65 3229 290a  )-start_time2)).
+00012db0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012dc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012dd0: 2020 7072 696e 7428 2720 2020 2020 2020    print('       
+00012de0: 2020 2020 2054 696d 6520 7461 6b65 6e20       Time taken 
+00012df0: 666f 7220 7265 6775 6c61 7220 5847 426f  for regular XGBo
+00012e00: 6f73 7420 6665 6174 7572 6520 7365 6c65  ost feature sele
+00012e10: 6374 696f 6e20 3d20 2530 2e30 6620 7365  ction = %0.0f se
+00012e20: 636f 6e64 7327 2025 2874 696d 652e 7469  conds' %(time.ti
+00012e30: 6d65 2829 2d73 7461 7274 5f74 696d 6532  me()-start_time2
+00012e40: 2929 0a20 2020 2020 2020 2023 2323 2320  )).        #### 
+00012e50: 706c 6f74 2061 6c6c 2074 6865 2066 6561  plot all the fea
+00012e60: 7475 7265 2069 6d70 6f72 7461 6e63 6573  ture importances
+00012e70: 2069 6e20 6120 6772 6964 2023 2323 2323   in a grid #####
+00012e80: 2323 2323 2323 0a20 2020 2020 2020 2069  ######.        i
+00012e90: 6620 7665 7262 6f73 6520 3e3d 2032 3a0a  f verbose >= 2:.
+00012ea0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00012eb0: 6574 7469 6e67 732e 6d75 6c74 695f 6c61  ettings.multi_la
+00012ec0: 6265 6c3a 0a20 2020 2020 2020 2020 2020  bel:.           
+00012ed0: 2020 2020 2064 7261 775f 6665 6174 7572       draw_featur
+00012ee0: 655f 696d 706f 7274 616e 6365 735f 6d75  e_importances_mu
+00012ef0: 6c74 695f 6c61 6265 6c28 6273 745f 6d6f  lti_label(bst_mo
+00012f00: 6465 6c73 2c20 6461 736b 5f78 6762 6f6f  dels, dask_xgboo
+00012f10: 7374 5f66 6c61 6729 0a20 2020 2020 2020  st_flag).       
+00012f20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012f30: 2020 2020 2020 2020 2020 2064 7261 775f             draw_
+00012f40: 6665 6174 7572 655f 696d 706f 7274 616e  feature_importan
+00012f50: 6365 735f 7369 6e67 6c65 5f6c 6162 656c  ces_single_label
+00012f60: 2862 7374 5f6d 6f64 656c 732c 2064 6173  (bst_models, das
+00012f70: 6b5f 7867 626f 6f73 745f 666c 6167 290a  k_xgboost_flag).
+00012f80: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00012f90: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00012fa0: 2020 2069 6620 6461 736b 5f78 6762 6f6f     if dask_xgboo
+00012fb0: 7374 5f66 6c61 673a 0a20 2020 2020 2020  st_flag:.       
+00012fc0: 2020 2020 2070 7269 6e74 2827 4461 736b       print('Dask
+00012fd0: 2058 4742 6f6f 7374 2069 7320 6372 6173   XGBoost is cras
+00012fe0: 6869 6e67 2064 7565 2074 6f20 2573 2e20  hing due to %s. 
+00012ff0: 5265 7475 726e 696e 6720 7769 7468 2063  Returning with c
+00013000: 7572 7265 6e74 6c79 2073 656c 6563 7465  urrently selecte
+00013010: 6420 6665 6174 7572 6573 2e2e 2e27 2025  d features...' %
+00013020: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
+00013030: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00013040: 6e74 2827 5265 6775 6c61 7220 5847 426f  nt('Regular XGBo
+00013050: 6f73 7420 6973 2063 7261 7368 696e 6720  ost is crashing 
+00013060: 6475 6520 746f 2025 732e 2052 6574 7572  due to %s. Retur
+00013070: 6e69 6e67 2077 6974 6820 6375 7272 656e  ning with curren
+00013080: 746c 7920 7365 6c65 6374 6564 2066 6561  tly selected fea
+00013090: 7475 7265 732e 2e2e 2720 2565 290a 2020  tures...' %e).  
+000130a0: 2020 2020 2020 696d 706f 7274 616e 745f        important_
+000130b0: 6665 6174 7572 6573 203d 2063 6f70 792e  features = copy.
+000130c0: 6465 6570 636f 7079 2870 7265 6473 290a  deepcopy(preds).
+000130d0: 2020 2020 2323 2323 2323 2020 2020 4520      ######    E 
+000130e0: 2020 204e 2020 2020 2044 2020 2020 2020     N     D      
+000130f0: 4f20 2046 2020 2020 2020 5820 2047 2020  O  F      X  G  
+00013100: 4220 204f 2020 4f20 2053 2020 5420 2020  B  O  O  S  T   
+00013110: 2053 2045 204c 2045 2043 2054 2049 204f   S E L E C T I O
+00013120: 204e 2023 2323 2323 2323 2323 2323 2323   N #############
+00013130: 2323 2323 2323 230a 2020 2020 7072 696e  #######.    prin
+00013140: 7428 2720 2020 2043 6f6d 706c 6574 6564  t('    Completed
+00013150: 2058 4742 6f6f 7374 2066 6561 7475 7265   XGBoost feature
+00013160: 2073 656c 6563 7469 6f6e 2069 6e20 2530   selection in %0
+00013170: 2e30 6620 7365 636f 6e64 7327 2025 2874  .0f seconds' %(t
+00013180: 696d 652e 7469 6d65 2829 2d73 7461 7274  ime.time()-start
+00013190: 5f74 696d 6532 2929 0a20 2020 2069 6620  _time2)).    if 
+000131a0: 6c65 6e28 6964 636f 6c73 2920 3e20 303a  len(idcols) > 0:
+000131b0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+000131c0: 2020 2020 416c 6572 743a 204e 6f20 4944      Alert: No ID
+000131d0: 2076 6172 6961 626c 6573 2025 7320 6172   variables %s ar
+000131e0: 6520 696e 636c 7564 6564 2069 6e20 7365  e included in se
+000131f0: 6c65 6374 6564 2066 6561 7475 7265 7327  lected features'
+00013200: 2025 6964 636f 6c73 290a 2020 2020 6966   %idcols).    if
+00013210: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
+00013220: 2020 7072 696e 7428 2223 2323 2323 2323    print("#######
 00013230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00013240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013250: 2229 0a20 2020 2020 2020 2070 7269 6e74  ").        print
-00013260: 2822 2323 2323 2320 2020 2020 2020 2020  ("#####         
-00013270: 2046 2045 2041 2054 2055 2052 2045 2020   F E A T U R E  
-00013280: 2053 2045 204c 2045 2043 2054 2049 204f   S E L E C T I O
-00013290: 204e 2020 2043 204f 204d 2050 204c 2045   N   C O M P L E
-000132a0: 2054 2045 2044 2020 2020 2020 2020 2020   T E D          
-000132b0: 2020 2323 2323 2323 2322 290a 2020 2020    #######").    
-000132c0: 2020 2020 7072 696e 7428 2223 2323 2323      print("#####
-000132d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000132e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000132f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013280: 2229 0a20 2020 2020 2020 2070 7269 6e74  ").        print
+00013290: 2822 2323 2323 2320 2020 2020 2020 2020  ("#####         
+000132a0: 2046 2045 2041 2054 2055 2052 2045 2020   F E A T U R E  
+000132b0: 2053 2045 204c 2045 2043 2054 2049 204f   S E L E C T I O
+000132c0: 204e 2020 2043 204f 204d 2050 204c 2045   N   C O M P L E
+000132d0: 2054 2045 2044 2020 2020 2020 2020 2020   T E D          
+000132e0: 2020 2323 2323 2323 2322 290a 2020 2020    #######").    
+000132f0: 2020 2020 7072 696e 7428 2223 2323 2323      print("#####
 00013300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00013310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013320: 2323 2229 0a20 2020 2064 6963 746f 203d  ##").    dicto =
-00013330: 207b 7d0a 2020 2020 6d69 7373 696e 675f   {}.    missing_
-00013340: 666c 6167 7331 203d 205b 7b78 3a78 5b3a  flags1 = [{x:x[:
-00013350: 2d31 335d 7d20 666f 7220 7820 696e 2069  -13]} for x in i
-00013360: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00013370: 7320 6966 2027 4d69 7373 696e 675f 466c  s if 'Missing_Fl
-00013380: 6167 2720 696e 2078 5d0a 2020 2020 666f  ag' in x].    fo
-00013390: 7220 6561 6368 5f66 6c61 6720 696e 206d  r each_flag in m
-000133a0: 6973 7369 6e67 5f66 6c61 6773 313a 0a20  issing_flags1:. 
-000133b0: 2020 2020 2020 2070 7269 6e74 2827 416c         print('Al
-000133c0: 6572 743a 2044 6f6e 7420 666f 7267 6574  ert: Dont forget
-000133d0: 2074 6f20 6164 6420 6120 6d69 7373 696e   to add a missin
-000133e0: 6720 666c 6167 2074 6f20 2573 2074 6f20  g flag to %s to 
-000133f0: 6372 6561 7465 2025 7320 636f 6c75 6d6e  create %s column
-00013400: 2720 2528 6c69 7374 2865 6163 685f 666c  ' %(list(each_fl
-00013410: 6167 2e76 616c 7565 7328 2929 5b30 5d2c  ag.values())[0],
-00013420: 206c 6973 7428 6561 6368 5f66 6c61 672e   list(each_flag.
-00013430: 6b65 7973 2829 295b 305d 2929 0a20 2020  keys())[0])).   
-00013440: 2020 2020 2064 6963 746f 2e75 7064 6174       dicto.updat
-00013450: 6528 6561 6368 5f66 6c61 6729 0a20 2020  e(each_flag).   
-00013460: 2069 6620 6c65 6e28 6469 6374 6f29 203e   if len(dicto) >
-00013470: 2030 3a0a 2020 2020 2020 2020 696d 706f   0:.        impo
-00013480: 7274 616e 745f 6665 6174 7572 6573 203d  rtant_features =
-00013490: 2020 5b64 6963 746f 2e67 6574 2869 7465    [dicto.get(ite
-000134a0: 6d2c 6974 656d 2920 2066 6f72 2069 7465  m,item)  for ite
-000134b0: 6d20 696e 2069 6d70 6f72 7461 6e74 5f66  m in important_f
-000134c0: 6561 7475 7265 735d 0a20 2020 2069 6620  eatures].    if 
-000134d0: 6c65 6e28 696d 706f 7274 616e 745f 6665  len(important_fe
-000134e0: 6174 7572 6573 2920 3c3d 2033 303a 0a20  atures) <= 30:. 
-000134f0: 2020 2020 2020 2070 7269 6e74 2827 5365         print('Se
-00013500: 6c65 6374 6564 2025 6420 696d 706f 7274  lected %d import
-00013510: 616e 7420 6665 6174 7572 6573 3a5c 6e25  ant features:\n%
-00013520: 7327 2025 286c 656e 2869 6d70 6f72 7461  s' %(len(importa
-00013530: 6e74 5f66 6561 7475 7265 7329 2c20 696d  nt_features), im
-00013540: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
-00013550: 2929 0a20 2020 2065 6c73 653a 0a20 2020  )).    else:.   
-00013560: 2020 2020 2070 7269 6e74 2827 5365 6c65       print('Sele
-00013570: 6374 6564 2025 6420 696d 706f 7274 616e  cted %d importan
-00013580: 7420 6665 6174 7572 6573 2e20 546f 6f20  t features. Too 
-00013590: 6d61 6e79 2074 6f20 7072 696e 742e 2e2e  many to print...
-000135a0: 2720 256c 656e 2869 6d70 6f72 7461 6e74  ' %len(important
-000135b0: 5f66 6561 7475 7265 7329 290a 2020 2020  _features)).    
-000135c0: 6e75 6d76 6172 7320 3d20 5b78 2066 6f72  numvars = [x for
-000135d0: 2078 2069 6e20 6e75 6d76 6172 7320 6966   x in numvars if
-000135e0: 2078 2069 6e20 696d 706f 7274 616e 745f   x in important_
-000135f0: 6665 6174 7572 6573 5d0a 2020 2020 696d  features].    im
-00013600: 706f 7274 616e 745f 6361 7473 203d 205b  portant_cats = [
-00013610: 7820 666f 7220 7820 696e 2069 6d70 6f72  x for x in impor
-00013620: 7461 6e74 5f63 6174 7320 6966 2078 2069  tant_cats if x i
-00013630: 6e20 696d 706f 7274 616e 745f 6665 6174  n important_feat
-00013640: 7572 6573 5d0a 2020 2020 7072 696e 7428  ures].    print(
-00013650: 2754 6f74 616c 2054 696d 6520 7461 6b65  'Total Time take
-00013660: 6e20 666f 7220 6665 6174 7572 6577 697a  n for featurewiz
-00013670: 2073 656c 6563 7469 6f6e 203d 2025 302e   selection = %0.
-00013680: 3066 2073 6563 6f6e 6473 2720 2528 7469  0f seconds' %(ti
-00013690: 6d65 2e74 696d 6528 292d 7374 6172 745f  me.time()-start_
-000136a0: 7469 6d65 2929 0a20 2020 2023 2323 2320  time)).    #### 
-000136b0: 4e6f 7720 6368 616e 6765 2074 6865 2066  Now change the f
-000136c0: 6561 7475 7265 206e 616d 6573 2062 6163  eature names bac
-000136d0: 6b20 746f 206f 7269 6769 6e61 6c20 6665  k to original fe
-000136e0: 6174 7572 6520 6e61 6d65 7320 2323 2323  ature names ####
-000136f0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-00013700: 2069 7465 6d5f 7265 706c 6163 6572 203d   item_replacer =
-00013710: 2063 6f6c 5f6e 616d 655f 6d61 7070 6572   col_name_mapper
-00013720: 2e67 6574 2020 2320 466f 7220 6661 7374  .get  # For fast
-00013730: 6572 2067 6574 732e 0a20 2020 2023 2323  er gets..    ###
-00013740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013760: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013350: 2323 2229 0a20 2020 2064 6963 746f 203d  ##").    dicto =
+00013360: 207b 7d0a 2020 2020 6d69 7373 696e 675f   {}.    missing_
+00013370: 666c 6167 7331 203d 205b 7b78 3a78 5b3a  flags1 = [{x:x[:
+00013380: 2d31 335d 7d20 666f 7220 7820 696e 2069  -13]} for x in i
+00013390: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+000133a0: 7320 6966 2027 4d69 7373 696e 675f 466c  s if 'Missing_Fl
+000133b0: 6167 2720 696e 2078 5d0a 2020 2020 666f  ag' in x].    fo
+000133c0: 7220 6561 6368 5f66 6c61 6720 696e 206d  r each_flag in m
+000133d0: 6973 7369 6e67 5f66 6c61 6773 313a 0a20  issing_flags1:. 
+000133e0: 2020 2020 2020 2070 7269 6e74 2827 416c         print('Al
+000133f0: 6572 743a 2044 6f6e 7420 666f 7267 6574  ert: Dont forget
+00013400: 2074 6f20 6164 6420 6120 6d69 7373 696e   to add a missin
+00013410: 6720 666c 6167 2074 6f20 2573 2074 6f20  g flag to %s to 
+00013420: 6372 6561 7465 2025 7320 636f 6c75 6d6e  create %s column
+00013430: 2720 2528 6c69 7374 2865 6163 685f 666c  ' %(list(each_fl
+00013440: 6167 2e76 616c 7565 7328 2929 5b30 5d2c  ag.values())[0],
+00013450: 206c 6973 7428 6561 6368 5f66 6c61 672e   list(each_flag.
+00013460: 6b65 7973 2829 295b 305d 2929 0a20 2020  keys())[0])).   
+00013470: 2020 2020 2064 6963 746f 2e75 7064 6174       dicto.updat
+00013480: 6528 6561 6368 5f66 6c61 6729 0a20 2020  e(each_flag).   
+00013490: 2069 6620 6c65 6e28 6469 6374 6f29 203e   if len(dicto) >
+000134a0: 2030 3a0a 2020 2020 2020 2020 696d 706f   0:.        impo
+000134b0: 7274 616e 745f 6665 6174 7572 6573 203d  rtant_features =
+000134c0: 2020 5b64 6963 746f 2e67 6574 2869 7465    [dicto.get(ite
+000134d0: 6d2c 6974 656d 2920 2066 6f72 2069 7465  m,item)  for ite
+000134e0: 6d20 696e 2069 6d70 6f72 7461 6e74 5f66  m in important_f
+000134f0: 6561 7475 7265 735d 0a20 2020 2069 6620  eatures].    if 
+00013500: 6c65 6e28 696d 706f 7274 616e 745f 6665  len(important_fe
+00013510: 6174 7572 6573 2920 3c3d 2033 303a 0a20  atures) <= 30:. 
+00013520: 2020 2020 2020 2070 7269 6e74 2827 5365         print('Se
+00013530: 6c65 6374 6564 2025 6420 696d 706f 7274  lected %d import
+00013540: 616e 7420 6665 6174 7572 6573 3a5c 6e25  ant features:\n%
+00013550: 7327 2025 286c 656e 2869 6d70 6f72 7461  s' %(len(importa
+00013560: 6e74 5f66 6561 7475 7265 7329 2c20 696d  nt_features), im
+00013570: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
+00013580: 2929 0a20 2020 2065 6c73 653a 0a20 2020  )).    else:.   
+00013590: 2020 2020 2070 7269 6e74 2827 5365 6c65       print('Sele
+000135a0: 6374 6564 2025 6420 696d 706f 7274 616e  cted %d importan
+000135b0: 7420 6665 6174 7572 6573 2e20 546f 6f20  t features. Too 
+000135c0: 6d61 6e79 2074 6f20 7072 696e 742e 2e2e  many to print...
+000135d0: 2720 256c 656e 2869 6d70 6f72 7461 6e74  ' %len(important
+000135e0: 5f66 6561 7475 7265 7329 290a 2020 2020  _features)).    
+000135f0: 6e75 6d76 6172 7320 3d20 5b78 2066 6f72  numvars = [x for
+00013600: 2078 2069 6e20 6e75 6d76 6172 7320 6966   x in numvars if
+00013610: 2078 2069 6e20 696d 706f 7274 616e 745f   x in important_
+00013620: 6665 6174 7572 6573 5d0a 2020 2020 696d  features].    im
+00013630: 706f 7274 616e 745f 6361 7473 203d 205b  portant_cats = [
+00013640: 7820 666f 7220 7820 696e 2069 6d70 6f72  x for x in impor
+00013650: 7461 6e74 5f63 6174 7320 6966 2078 2069  tant_cats if x i
+00013660: 6e20 696d 706f 7274 616e 745f 6665 6174  n important_feat
+00013670: 7572 6573 5d0a 2020 2020 7072 696e 7428  ures].    print(
+00013680: 2754 6f74 616c 2054 696d 6520 7461 6b65  'Total Time take
+00013690: 6e20 666f 7220 6665 6174 7572 6577 697a  n for featurewiz
+000136a0: 2073 656c 6563 7469 6f6e 203d 2025 302e   selection = %0.
+000136b0: 3066 2073 6563 6f6e 6473 2720 2528 7469  0f seconds' %(ti
+000136c0: 6d65 2e74 696d 6528 292d 7374 6172 745f  me.time()-start_
+000136d0: 7469 6d65 2929 0a20 2020 2023 2323 2320  time)).    #### 
+000136e0: 4e6f 7720 6368 616e 6765 2074 6865 2066  Now change the f
+000136f0: 6561 7475 7265 206e 616d 6573 2062 6163  eature names bac
+00013700: 6b20 746f 206f 7269 6769 6e61 6c20 6665  k to original fe
+00013710: 6174 7572 6520 6e61 6d65 7320 2323 2323  ature names ####
+00013720: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00013730: 2069 7465 6d5f 7265 706c 6163 6572 203d   item_replacer =
+00013740: 2063 6f6c 5f6e 616d 655f 6d61 7070 6572   col_name_mapper
+00013750: 2e67 6574 2020 2320 466f 7220 6661 7374  .get  # For fast
+00013760: 6572 2067 6574 732e 0a20 2020 2023 2323  er gets..    ###
 00013770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013780: 2323 2323 2323 230a 2020 2020 2323 2320  #######.    ### 
-00013790: 596f 7520 7365 6c65 6374 2074 6865 2066  You select the f
-000137a0: 6561 7475 7265 7320 7769 7468 2074 6865  eatures with the
-000137b0: 2073 616d 6520 6f6c 6420 6e61 6d65 7320   same old names 
-000137c0: 6173 2062 6566 6f72 6520 6865 7265 2023  as before here #
-000137d0: 2323 2323 2323 0a20 2020 2023 2323 2323  ######.    #####
-000137e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000137f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000137a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000137b0: 2323 2323 2323 230a 2020 2020 2323 2320  #######.    ### 
+000137c0: 596f 7520 7365 6c65 6374 2074 6865 2066  You select the f
+000137d0: 6561 7475 7265 7320 7769 7468 2074 6865  eatures with the
+000137e0: 2073 616d 6520 6f6c 6420 6e61 6d65 7320   same old names 
+000137f0: 6173 2062 6566 6f72 6520 6865 7265 2023  as before here #
+00013800: 2323 2323 2323 0a20 2020 2023 2323 2323  ######.    #####
 00013810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013820: 2323 2323 230a 2020 2020 2323 2049 6e20  #####.    ## In 
-00013830: 6f6e 6520 6361 7365 2c20 636f 6c75 6d6e  one case, column
-00013840: 206e 616d 6573 2067 6574 2063 6861 6e67   names get chang
-00013850: 6564 2069 6e20 7472 6169 6e20 6275 7420  ed in train but 
-00013860: 6e6f 7420 696e 2074 6573 7420 7369 6e63  not in test sinc
-00013870: 6520 6974 2074 6573 7420 6973 206e 6f74  e it test is not
-00013880: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
-00013890: 6966 2069 7369 6e73 7461 6e63 6528 7465  if isinstance(te
-000138a0: 7374 5f64 6174 612c 2073 7472 2920 6f72  st_data, str) or
-000138b0: 2074 6573 745f 6461 7461 2069 7320 4e6f   test_data is No
-000138c0: 6e65 3a0a 2020 2020 2020 2020 7072 696e  ne:.        prin
-000138d0: 7428 274f 7574 7075 7420 636f 6e74 6169  t('Output contai
-000138e0: 6e73 2061 206c 6973 7420 6f66 2025 7320  ns a list of %s 
-000138f0: 696d 706f 7274 616e 7420 6665 6174 7572  important featur
-00013900: 6573 2061 6e64 2061 2074 7261 696e 2064  es and a train d
-00013910: 6174 6166 7261 6d65 2720 256c 656e 2869  ataframe' %len(i
-00013920: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00013930: 7329 290a 2020 2020 656c 7365 3a0a 2020  s)).    else:.  
-00013940: 2020 2020 2020 7072 696e 7428 274f 7574        print('Out
-00013950: 7075 7420 636f 6e74 6169 6e73 2074 776f  put contains two
-00013960: 2064 6174 6166 7261 6d65 733a 2074 7261   dataframes: tra
-00013970: 696e 2061 6e64 2074 6573 7420 7769 7468  in and test with
-00013980: 2025 6420 696d 706f 7274 616e 7420 6665   %d important fe
-00013990: 6174 7572 6573 2e27 2025 6c65 6e28 696d  atures.' %len(im
-000139a0: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
-000139b0: 2929 0a20 2020 2069 6620 6665 6174 7572  )).    if featur
-000139c0: 655f 6765 6e20 6f72 2066 6561 7475 7265  e_gen or feature
-000139d0: 5f74 7970 653a 0a20 2020 2020 2020 2069  _type:.        i
-000139e0: 6620 6973 696e 7374 616e 6365 2874 6573  f isinstance(tes
-000139f0: 745f 6461 7461 2c20 7374 7229 206f 7220  t_data, str) or 
-00013a00: 7465 7374 5f64 6174 6120 6973 204e 6f6e  test_data is Non
-00013a10: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00013a20: 2323 2069 6620 6665 6174 7572 6520 656e  ## if feature en
-00013a30: 6767 2069 7320 7065 7266 6f72 6d65 642c  gg is performed,
-00013a40: 2069 6420 636f 6c75 6d6e 7320 6172 6520   id columns are 
-00013a50: 6472 6f70 7065 642e 2048 656e 6365 2074  dropped. Hence t
-00013a60: 6865 7920 6d75 7374 2072 656a 6f69 6e20  hey must rejoin 
-00013a70: 6865 7265 2e0a 2020 2020 2020 2020 2020  here..          
-00013a80: 2020 6461 7461 6e61 6d65 203d 2070 642e    dataname = pd.
-00013a90: 636f 6e63 6174 285b 7472 6169 6e5f 6964  concat([train_id
-00013aa0: 732c 2064 6174 616e 616d 655d 2c20 6178  s, dataname], ax
-00013ab0: 6973 3d31 290a 2020 2020 2020 2020 2020  is=1).          
-00013ac0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00013ad0: 7461 7267 6574 2c20 7374 7229 3a0a 2020  target, str):.  
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013af0: 7475 726e 2069 6d70 6f72 7461 6e74 5f66  turn important_f
-00013b00: 6561 7475 7265 732c 2064 6174 616e 616d  eatures, datanam
-00013b10: 655b 696d 706f 7274 616e 745f 6665 6174  e[important_feat
-00013b20: 7572 6573 2b5b 7461 7267 6574 5d5d 0a20  ures+[target]]. 
-00013b30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00013b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b50: 2072 6574 7572 6e20 696d 706f 7274 616e   return importan
-00013b60: 745f 6665 6174 7572 6573 2c20 6461 7461  t_features, data
-00013b70: 6e61 6d65 5b69 6d70 6f72 7461 6e74 5f66  name[important_f
-00013b80: 6561 7475 7265 732b 7461 7267 6574 5d0a  eatures+target].
-00013b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00013ba0: 2020 2020 2020 2020 2020 2323 2320 6966            ### if
-00013bb0: 2066 6561 7475 7265 2065 6e67 6720 6973   feature engg is
-00013bc0: 2070 6572 666f 726d 6564 2c20 6964 2063   performed, id c
-00013bd0: 6f6c 756d 6e73 2061 7265 2064 726f 7070  olumns are dropp
-00013be0: 6564 2e20 4865 6e63 6520 7468 6579 206d  ed. Hence they m
-00013bf0: 7573 7420 7265 6a6f 696e 2068 6572 652e  ust rejoin here.
-00013c00: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00013c10: 616e 616d 6520 3d20 7064 2e63 6f6e 6361  aname = pd.conca
-00013c20: 7428 5b74 7261 696e 5f69 6473 2c20 6461  t([train_ids, da
-00013c30: 7461 6e61 6d65 5d2c 2061 7869 733d 3129  taname], axis=1)
-00013c40: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
-00013c50: 745f 6461 7461 203d 2070 642e 636f 6e63  t_data = pd.conc
-00013c60: 6174 285b 7465 7374 5f69 6473 2c20 7465  at([test_ids, te
-00013c70: 7374 5f64 6174 615d 2c20 6178 6973 3d31  st_data], axis=1
-00013c80: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00013c90: 2069 7369 6e73 7461 6e63 6528 7461 7267   isinstance(targ
-00013ca0: 6574 2c20 7374 7229 3a0a 2020 2020 2020  et, str):.      
-00013cb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013cc0: 2064 6174 616e 616d 655b 696d 706f 7274   dataname[import
-00013cd0: 616e 745f 6665 6174 7572 6573 2b5b 7461  ant_features+[ta
-00013ce0: 7267 6574 5d5d 2c20 7465 7374 5f64 6174  rget]], test_dat
-00013cf0: 615b 696d 706f 7274 616e 745f 6665 6174  a[important_feat
-00013d00: 7572 6573 5d0a 2020 2020 2020 2020 2020  ures].          
-00013d10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00013d20: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00013d30: 6174 616e 616d 655b 696d 706f 7274 616e  ataname[importan
-00013d40: 745f 6665 6174 7572 6573 2b74 6172 6765  t_features+targe
-00013d50: 745d 2c20 7465 7374 5f64 6174 615b 696d  t], test_data[im
-00013d60: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
-00013d70: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
-00013d80: 2020 2020 2323 2320 596f 7520 7365 6c65      ### You sele
-00013d90: 6374 2074 6865 2066 6561 7475 7265 7320  ct the features 
-00013da0: 7769 7468 2074 6865 2073 616d 6520 6f6c  with the same ol
-00013db0: 6420 6e61 6d65 7320 6173 2062 6566 6f72  d names as befor
-00013dc0: 6520 2323 2323 2323 230a 2020 2020 2020  e #######.      
-00013dd0: 2020 6f6c 645f 696d 706f 7274 616e 745f    old_important_
-00013de0: 6665 6174 7572 6573 203d 2063 6f70 792e  features = copy.
-00013df0: 6465 6570 636f 7079 2869 6d70 6f72 7461  deepcopy(importa
-00013e00: 6e74 5f66 6561 7475 7265 7329 0a20 2020  nt_features).   
-00013e10: 2020 2020 2069 6620 6c65 6e28 6461 7465       if len(date
-00013e20: 5f63 6f6c 7329 203e 2030 3a0a 2020 2020  _cols) > 0:.    
-00013e30: 2020 2020 2020 2020 6461 7465 5f72 6570          date_rep
-00013e40: 6c61 6365 7220 3d20 6461 7465 5f63 6f6c  lacer = date_col
-00013e50: 5f6d 6170 7065 7273 2e67 6574 2020 2320  _mappers.get  # 
-00013e60: 466f 7220 6661 7374 6572 2067 6574 732e  For faster gets.
-00013e70: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-00013e80: 6f72 7461 6e74 5f66 6561 7475 7265 7331  ortant_features1
-00013e90: 203d 205b 6461 7465 5f72 6570 6c61 6365   = [date_replace
-00013ea0: 7228 6e2c 206e 2920 666f 7220 6e20 696e  r(n, n) for n in
-00013eb0: 2069 6d70 6f72 7461 6e74 5f66 6561 7475   important_featu
-00013ec0: 7265 735d 0a20 2020 2020 2020 2065 6c73  res].        els
-00013ed0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00013ee0: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00013ef0: 7331 203d 205b 6974 656d 5f72 6570 6c61  s1 = [item_repla
-00013f00: 6365 7228 6e2c 206e 2920 666f 7220 6e20  cer(n, n) for n 
-00013f10: 696e 2069 6d70 6f72 7461 6e74 5f66 6561  in important_fea
-00013f20: 7475 7265 735d 0a20 2020 2020 2020 2069  tures].        i
-00013f30: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00013f40: 7320 3d20 6669 6e64 5f72 656d 6f76 655f  s = find_remove_
-00013f50: 6475 706c 6963 6174 6573 2869 6d70 6f72  duplicates(impor
-00013f60: 7461 6e74 5f66 6561 7475 7265 7331 290a  tant_features1).
-00013f70: 2020 2020 2020 2020 6966 206f 6c64 5f69          if old_i
-00013f80: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00013f90: 7320 3d3d 2069 6d70 6f72 7461 6e74 5f66  s == important_f
-00013fa0: 6561 7475 7265 733a 0a20 2020 2020 2020  eatures:.       
-00013fb0: 2020 2020 2023 2320 446f 6e27 7420 6472       ## Don't dr
-00013fc0: 6f70 2074 6865 206f 6c64 2074 6172 6765  op the old targe
-00013fd0: 7420 7369 6e63 6520 7468 6572 6520 6973  t since there is
-00013fe0: 206f 6e6c 7920 6f6e 6520 7461 7267 6574   only one target
-00013ff0: 2068 6572 6520 2323 230a 2020 2020 2020   here ###.      
-00014000: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00014010: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014020: 2020 2020 2069 6620 6c65 6e28 6f6c 645f       if len(old_
-00014030: 696d 706f 7274 616e 745f 6665 6174 7572  important_featur
-00014040: 6573 2920 3d3d 206c 656e 2869 6d70 6f72  es) == len(impor
-00014050: 7461 6e74 5f66 6561 7475 7265 7329 3a0a  tant_features):.
-00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014070: 2323 2320 596f 7520 6a75 7374 206d 6f76  ### You just mov
-00014080: 6520 7468 6520 7661 6c75 6573 2066 726f  e the values fro
-00014090: 6d20 7468 6520 6e65 7720 6e61 6d65 7320  m the new names 
-000140a0: 746f 2074 6865 206f 6c64 2066 6561 7475  to the old featu
-000140b0: 7265 206e 616d 6573 2023 230a 2020 2020  re names ##.    
-000140c0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000140d0: 6e61 6d65 5b69 6d70 6f72 7461 6e74 5f66  name[important_f
-000140e0: 6561 7475 7265 735d 203d 2064 6174 616e  eatures] = datan
-000140f0: 616d 655b 6f6c 645f 696d 706f 7274 616e  ame[old_importan
-00014100: 745f 6665 6174 7572 6573 5d0a 2020 2020  t_features].    
-00014110: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00014120: 7369 6e73 7461 6e63 6528 7465 7374 5f64  sinstance(test_d
-00014130: 6174 612c 2073 7472 2920 6f72 2074 6573  ata, str) or tes
-00014140: 745f 6461 7461 2069 7320 4e6f 6e65 3a0a  t_data is None:.
-00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014160: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00014170: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00013820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013850: 2323 2323 230a 2020 2020 2323 2049 6e20  #####.    ## In 
+00013860: 6f6e 6520 6361 7365 2c20 636f 6c75 6d6e  one case, column
+00013870: 206e 616d 6573 2067 6574 2063 6861 6e67   names get chang
+00013880: 6564 2069 6e20 7472 6169 6e20 6275 7420  ed in train but 
+00013890: 6e6f 7420 696e 2074 6573 7420 7369 6e63  not in test sinc
+000138a0: 6520 6974 2074 6573 7420 6973 206e 6f74  e it test is not
+000138b0: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
+000138c0: 6966 2069 7369 6e73 7461 6e63 6528 7465  if isinstance(te
+000138d0: 7374 5f64 6174 612c 2073 7472 2920 6f72  st_data, str) or
+000138e0: 2074 6573 745f 6461 7461 2069 7320 4e6f   test_data is No
+000138f0: 6e65 3a0a 2020 2020 2020 2020 7072 696e  ne:.        prin
+00013900: 7428 274f 7574 7075 7420 636f 6e74 6169  t('Output contai
+00013910: 6e73 2061 206c 6973 7420 6f66 2025 7320  ns a list of %s 
+00013920: 696d 706f 7274 616e 7420 6665 6174 7572  important featur
+00013930: 6573 2061 6e64 2061 2074 7261 696e 2064  es and a train d
+00013940: 6174 6166 7261 6d65 2720 256c 656e 2869  ataframe' %len(i
+00013950: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00013960: 7329 290a 2020 2020 656c 7365 3a0a 2020  s)).    else:.  
+00013970: 2020 2020 2020 7072 696e 7428 274f 7574        print('Out
+00013980: 7075 7420 636f 6e74 6169 6e73 2074 776f  put contains two
+00013990: 2064 6174 6166 7261 6d65 733a 2074 7261   dataframes: tra
+000139a0: 696e 2061 6e64 2074 6573 7420 7769 7468  in and test with
+000139b0: 2025 6420 696d 706f 7274 616e 7420 6665   %d important fe
+000139c0: 6174 7572 6573 2e27 2025 6c65 6e28 696d  atures.' %len(im
+000139d0: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
+000139e0: 2929 0a20 2020 2069 6620 6665 6174 7572  )).    if featur
+000139f0: 655f 6765 6e20 6f72 2066 6561 7475 7265  e_gen or feature
+00013a00: 5f74 7970 653a 0a20 2020 2020 2020 2069  _type:.        i
+00013a10: 6620 6973 696e 7374 616e 6365 2874 6573  f isinstance(tes
+00013a20: 745f 6461 7461 2c20 7374 7229 206f 7220  t_data, str) or 
+00013a30: 7465 7374 5f64 6174 6120 6973 204e 6f6e  test_data is Non
+00013a40: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00013a50: 2323 2069 6620 6665 6174 7572 6520 656e  ## if feature en
+00013a60: 6767 2069 7320 7065 7266 6f72 6d65 642c  gg is performed,
+00013a70: 2069 6420 636f 6c75 6d6e 7320 6172 6520   id columns are 
+00013a80: 6472 6f70 7065 642e 2048 656e 6365 2074  dropped. Hence t
+00013a90: 6865 7920 6d75 7374 2072 656a 6f69 6e20  hey must rejoin 
+00013aa0: 6865 7265 2e0a 2020 2020 2020 2020 2020  here..          
+00013ab0: 2020 6461 7461 6e61 6d65 203d 2070 642e    dataname = pd.
+00013ac0: 636f 6e63 6174 285b 7472 6169 6e5f 6964  concat([train_id
+00013ad0: 732c 2064 6174 616e 616d 655d 2c20 6178  s, dataname], ax
+00013ae0: 6973 3d31 290a 2020 2020 2020 2020 2020  is=1).          
+00013af0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00013b00: 7461 7267 6574 2c20 7374 7229 3a0a 2020  target, str):.  
+00013b10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013b20: 7475 726e 2069 6d70 6f72 7461 6e74 5f66  turn important_f
+00013b30: 6561 7475 7265 732c 2064 6174 616e 616d  eatures, datanam
+00013b40: 655b 696d 706f 7274 616e 745f 6665 6174  e[important_feat
+00013b50: 7572 6573 2b5b 7461 7267 6574 5d5d 0a20  ures+[target]]. 
+00013b60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00013b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013b80: 2072 6574 7572 6e20 696d 706f 7274 616e   return importan
+00013b90: 745f 6665 6174 7572 6573 2c20 6461 7461  t_features, data
+00013ba0: 6e61 6d65 5b69 6d70 6f72 7461 6e74 5f66  name[important_f
+00013bb0: 6561 7475 7265 732b 7461 7267 6574 5d0a  eatures+target].
+00013bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00013bd0: 2020 2020 2020 2020 2020 2323 2320 6966            ### if
+00013be0: 2066 6561 7475 7265 2065 6e67 6720 6973   feature engg is
+00013bf0: 2070 6572 666f 726d 6564 2c20 6964 2063   performed, id c
+00013c00: 6f6c 756d 6e73 2061 7265 2064 726f 7070  olumns are dropp
+00013c10: 6564 2e20 4865 6e63 6520 7468 6579 206d  ed. Hence they m
+00013c20: 7573 7420 7265 6a6f 696e 2068 6572 652e  ust rejoin here.
+00013c30: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00013c40: 616e 616d 6520 3d20 7064 2e63 6f6e 6361  aname = pd.conca
+00013c50: 7428 5b74 7261 696e 5f69 6473 2c20 6461  t([train_ids, da
+00013c60: 7461 6e61 6d65 5d2c 2061 7869 733d 3129  taname], axis=1)
+00013c70: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
+00013c80: 745f 6461 7461 203d 2070 642e 636f 6e63  t_data = pd.conc
+00013c90: 6174 285b 7465 7374 5f69 6473 2c20 7465  at([test_ids, te
+00013ca0: 7374 5f64 6174 615d 2c20 6178 6973 3d31  st_data], axis=1
+00013cb0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00013cc0: 2069 7369 6e73 7461 6e63 6528 7461 7267   isinstance(targ
+00013cd0: 6574 2c20 7374 7229 3a0a 2020 2020 2020  et, str):.      
+00013ce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013cf0: 2064 6174 616e 616d 655b 696d 706f 7274   dataname[import
+00013d00: 616e 745f 6665 6174 7572 6573 2b5b 7461  ant_features+[ta
+00013d10: 7267 6574 5d5d 2c20 7465 7374 5f64 6174  rget]], test_dat
+00013d20: 615b 696d 706f 7274 616e 745f 6665 6174  a[important_feat
+00013d30: 7572 6573 5d0a 2020 2020 2020 2020 2020  ures].          
+00013d40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013d50: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00013d60: 6174 616e 616d 655b 696d 706f 7274 616e  ataname[importan
+00013d70: 745f 6665 6174 7572 6573 2b74 6172 6765  t_features+targe
+00013d80: 745d 2c20 7465 7374 5f64 6174 615b 696d  t], test_data[im
+00013d90: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
+00013da0: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
+00013db0: 2020 2020 2323 2320 596f 7520 7365 6c65      ### You sele
+00013dc0: 6374 2074 6865 2066 6561 7475 7265 7320  ct the features 
+00013dd0: 7769 7468 2074 6865 2073 616d 6520 6f6c  with the same ol
+00013de0: 6420 6e61 6d65 7320 6173 2062 6566 6f72  d names as befor
+00013df0: 6520 2323 2323 2323 230a 2020 2020 2020  e #######.      
+00013e00: 2020 6f6c 645f 696d 706f 7274 616e 745f    old_important_
+00013e10: 6665 6174 7572 6573 203d 2063 6f70 792e  features = copy.
+00013e20: 6465 6570 636f 7079 2869 6d70 6f72 7461  deepcopy(importa
+00013e30: 6e74 5f66 6561 7475 7265 7329 0a20 2020  nt_features).   
+00013e40: 2020 2020 2069 6620 6c65 6e28 6461 7465       if len(date
+00013e50: 5f63 6f6c 7329 203e 2030 3a0a 2020 2020  _cols) > 0:.    
+00013e60: 2020 2020 2020 2020 6461 7465 5f72 6570          date_rep
+00013e70: 6c61 6365 7220 3d20 6461 7465 5f63 6f6c  lacer = date_col
+00013e80: 5f6d 6170 7065 7273 2e67 6574 2020 2320  _mappers.get  # 
+00013e90: 466f 7220 6661 7374 6572 2067 6574 732e  For faster gets.
+00013ea0: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+00013eb0: 6f72 7461 6e74 5f66 6561 7475 7265 7331  ortant_features1
+00013ec0: 203d 205b 6461 7465 5f72 6570 6c61 6365   = [date_replace
+00013ed0: 7228 6e2c 206e 2920 666f 7220 6e20 696e  r(n, n) for n in
+00013ee0: 2069 6d70 6f72 7461 6e74 5f66 6561 7475   important_featu
+00013ef0: 7265 735d 0a20 2020 2020 2020 2065 6c73  res].        els
+00013f00: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00013f10: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00013f20: 7331 203d 205b 6974 656d 5f72 6570 6c61  s1 = [item_repla
+00013f30: 6365 7228 6e2c 206e 2920 666f 7220 6e20  cer(n, n) for n 
+00013f40: 696e 2069 6d70 6f72 7461 6e74 5f66 6561  in important_fea
+00013f50: 7475 7265 735d 0a20 2020 2020 2020 2069  tures].        i
+00013f60: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00013f70: 7320 3d20 6669 6e64 5f72 656d 6f76 655f  s = find_remove_
+00013f80: 6475 706c 6963 6174 6573 2869 6d70 6f72  duplicates(impor
+00013f90: 7461 6e74 5f66 6561 7475 7265 7331 290a  tant_features1).
+00013fa0: 2020 2020 2020 2020 6966 206f 6c64 5f69          if old_i
+00013fb0: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00013fc0: 7320 3d3d 2069 6d70 6f72 7461 6e74 5f66  s == important_f
+00013fd0: 6561 7475 7265 733a 0a20 2020 2020 2020  eatures:.       
+00013fe0: 2020 2020 2023 2320 446f 6e27 7420 6472       ## Don't dr
+00013ff0: 6f70 2074 6865 206f 6c64 2074 6172 6765  op the old targe
+00014000: 7420 7369 6e63 6520 7468 6572 6520 6973  t since there is
+00014010: 206f 6e6c 7920 6f6e 6520 7461 7267 6574   only one target
+00014020: 2068 6572 6520 2323 230a 2020 2020 2020   here ###.      
+00014030: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00014040: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00014050: 2020 2020 2069 6620 6c65 6e28 6f6c 645f       if len(old_
+00014060: 696d 706f 7274 616e 745f 6665 6174 7572  important_featur
+00014070: 6573 2920 3d3d 206c 656e 2869 6d70 6f72  es) == len(impor
+00014080: 7461 6e74 5f66 6561 7475 7265 7329 3a0a  tant_features):.
+00014090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140a0: 2323 2320 596f 7520 6a75 7374 206d 6f76  ### You just mov
+000140b0: 6520 7468 6520 7661 6c75 6573 2066 726f  e the values fro
+000140c0: 6d20 7468 6520 6e65 7720 6e61 6d65 7320  m the new names 
+000140d0: 746f 2074 6865 206f 6c64 2066 6561 7475  to the old featu
+000140e0: 7265 206e 616d 6573 2023 230a 2020 2020  re names ##.    
+000140f0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00014100: 6e61 6d65 5b69 6d70 6f72 7461 6e74 5f66  name[important_f
+00014110: 6561 7475 7265 735d 203d 2064 6174 616e  eatures] = datan
+00014120: 616d 655b 6f6c 645f 696d 706f 7274 616e  ame[old_importan
+00014130: 745f 6665 6174 7572 6573 5d0a 2020 2020  t_features].    
+00014140: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00014150: 7369 6e73 7461 6e63 6528 7465 7374 5f64  sinstance(test_d
+00014160: 6174 612c 2073 7472 2920 6f72 2074 6573  ata, str) or tes
+00014170: 745f 6461 7461 2069 7320 4e6f 6e65 3a0a  t_data is None:.
 00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014190: 2020 2023 2323 2320 6966 2074 6865 7265     #### if there
-000141a0: 2069 7320 7465 7374 2064 6174 6120 7472   is test data tr
-000141b0: 616e 7366 6572 2076 616c 7565 7320 746f  ansfer values to
-000141c0: 2069 7420 2323 230a 2020 2020 2020 2020   it ###.        
-000141d0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-000141e0: 5f64 6174 615b 696d 706f 7274 616e 745f  _data[important_
-000141f0: 6665 6174 7572 6573 5d20 3d20 7465 7374  features] = test
-00014200: 5f64 6174 615b 6f6c 645f 696d 706f 7274  _data[old_import
-00014210: 616e 745f 6665 6174 7572 6573 5d0a 2020  ant_features].  
-00014220: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2323 2320 6669 7273 7420 7472 7920 746f  ### first try to
-00014250: 2072 6574 7572 6e20 7769 7468 2074 6865   return with the
-00014260: 206e 6577 2069 6d70 6f72 7461 6e74 2066   new important f
-00014270: 6561 7475 7265 732c 2069 6620 7468 6174  eatures, if that
-00014280: 2066 6169 6c73 2072 6574 7572 6e20 7769   fails return wi
-00014290: 7468 206f 6c64 2066 6561 7475 7265 730a  th old features.
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000142c0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000142d0: 5468 6572 6520 6172 6520 7370 6563 6961  There are specia
-000142e0: 6c20 6368 6172 7320 696e 2063 6f6c 756d  l chars in colum
-000142f0: 6e20 6e61 6d65 732e 2050 6c65 6173 6520  n names. Please 
-00014300: 7265 6d6f 7665 2074 6865 6d20 616e 6420  remove them and 
-00014310: 7472 7920 6167 6169 6e2e 2729 0a20 2020  try again.').   
-00014320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014330: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-00014340: 6573 745f 6461 7461 2c20 7374 7229 206f  est_data, str) o
-00014350: 7220 7465 7374 5f64 6174 6120 6973 204e  r test_data is N
-00014360: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00014370: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00014380: 7572 6e20 696d 706f 7274 616e 745f 6665  urn important_fe
-00014390: 6174 7572 6573 2c20 6461 7461 6e61 6d65  atures, dataname
-000143a0: 5b69 6d70 6f72 7461 6e74 5f66 6561 7475  [important_featu
-000143b0: 7265 735d 0a20 2020 2020 2020 2020 2020  res].           
-000143c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143e0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-000143f0: 7461 6e61 6d65 5b69 6d70 6f72 7461 6e74  taname[important
-00014400: 5f66 6561 7475 7265 735d 2c20 7465 7374  _features], test
-00014410: 5f64 6174 615b 696d 706f 7274 616e 745f  _data[important_
-00014420: 6665 6174 7572 6573 5d0a 2020 2020 2020  features].      
-00014430: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00014440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014450: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
-00014460: 7265 2061 7265 2073 7065 6369 616c 2063  re are special c
-00014470: 6861 7273 2069 6e20 636f 6c75 6d6e 206e  hars in column n
-00014480: 616d 6573 2e20 5265 7475 726e 696e 6720  ames. Returning 
-00014490: 7769 7468 2069 6d70 6f72 7461 6e74 2066  with important f
-000144a0: 6561 7475 7265 7320 616e 6420 7472 6169  eatures and trai
-000144b0: 6e2e 2729 0a20 2020 2020 2020 2020 2020  n.').           
-000144c0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-000144d0: 7374 616e 6365 2874 6573 745f 6461 7461  stance(test_data
-000144e0: 2c20 7374 7229 206f 7220 7465 7374 5f64  , str) or test_d
-000144f0: 6174 6120 6973 204e 6f6e 653a 0a20 2020  ata is None:.   
-00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014510: 2020 2020 2072 6574 7572 6e20 6f6c 645f       return old_
-00014520: 696d 706f 7274 616e 745f 6665 6174 7572  important_featur
-00014530: 6573 2c20 6461 7461 6e61 6d65 5b6f 6c64  es, dataname[old
-00014540: 5f69 6d70 6f72 7461 6e74 5f66 6561 7475  _important_featu
-00014550: 7265 735d 0a20 2020 2020 2020 2020 2020  res].           
-00014560: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014580: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00014590: 7461 6e61 6d65 5b6f 6c64 5f69 6d70 6f72  taname[old_impor
-000145a0: 7461 6e74 5f66 6561 7475 7265 735d 2c20  tant_features], 
-000145b0: 7465 7374 5f64 6174 615b 6f6c 645f 696d  test_data[old_im
-000145c0: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
-000145d0: 5d20 2020 0a20 2020 2020 2020 200a 2020  ]   .        .  
-000145e0: 2020 2020 2020 6f6c 645f 7461 7267 6574        old_target
-000145f0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-00014600: 2874 6172 6765 7429 0a20 2020 2020 2020  (target).       
-00014610: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-00014620: 6172 6765 742c 2073 7472 293a 0a20 2020  arget, str):.   
-00014630: 2020 2020 2020 2020 2074 6172 6765 7420           target 
-00014640: 3d20 6974 656d 5f72 6570 6c61 6365 7228  = item_replacer(
-00014650: 7461 7267 6574 2c20 7461 7267 6574 290a  target, target).
-00014660: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-00014670: 6574 7320 3d20 5b74 6172 6765 745d 0a20  ets = [target]. 
-00014680: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014690: 2020 2020 2020 2020 2074 6172 6765 7420           target 
-000146a0: 3d20 5b69 7465 6d5f 7265 706c 6163 6572  = [item_replacer
-000146b0: 286e 2c20 6e29 2066 6f72 206e 2069 6e20  (n, n) for n in 
-000146c0: 7461 7267 6574 5d0a 2020 2020 2020 2020  target].        
-000146d0: 2020 2020 7461 7267 6574 7320 3d20 636f      targets = co
-000146e0: 7079 2e64 6565 7063 6f70 7928 7461 7267  py.deepcopy(targ
-000146f0: 6574 290a 0a20 2020 2020 2020 2069 6620  et)..        if 
-00014700: 6f6c 645f 7461 7267 6574 203d 3d20 7461  old_target == ta
-00014710: 7267 6574 3a0a 2020 2020 2020 2020 2020  rget:.          
-00014720: 2020 2323 2044 6f6e 2774 2064 726f 7020    ## Don't drop 
-00014730: 7468 6520 6f6c 6420 7461 7267 6574 2073  the old target s
-00014740: 696e 6365 2074 6865 7265 2069 7320 6f6e  ince there is on
-00014750: 6c79 206f 6e65 2074 6172 6765 7420 6865  ly one target he
-00014760: 7265 2023 2323 0a20 2020 2020 2020 2020  re ###.         
-00014770: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00014780: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014790: 2020 2323 2320 796f 7520 646f 6e27 7420    ### you don't 
-000147a0: 6e65 6564 2064 726f 7020 7468 6520 636f  need drop the co
-000147b0: 6c73 2074 6861 7420 6861 7665 2063 6861  ls that have cha
-000147c0: 6e67 6564 2073 696e 6365 206f 6e6c 7920  nged since only 
-000147d0: 6120 6665 7720 6172 6520 7365 6c65 6374  a few are select
-000147e0: 6564 2023 2323 2323 2323 0a20 2020 2020  ed #######.     
-000147f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00014800: 616e 6365 2874 6172 6765 742c 2073 7472  ance(target, str
-00014810: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014820: 2020 2064 6174 616e 616d 655b 7461 7267     dataname[targ
-00014830: 6574 5d20 3d20 6461 7461 6e61 6d65 5b6f  et] = dataname[o
-00014840: 6c64 5f74 6172 6765 745d 0a20 2020 2020  ld_target].     
-00014850: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014860: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
-00014870: 795f 7461 7267 6574 7320 3d20 636f 7079  y_targets = copy
-00014880: 2e64 6565 7063 6f70 7928 7461 7267 6574  .deepcopy(target
-00014890: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000148a0: 2020 2063 6f70 795f 6f6c 6420 3d20 636f     copy_old = co
-000148b0: 7079 2e64 6565 7063 6f70 7928 6f6c 645f  py.deepcopy(old_
-000148c0: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
-000148d0: 2020 2020 2020 2020 666f 7220 6561 6368          for each
-000148e0: 5f74 6172 6765 742c 2065 6163 685f 6f6c  _target, each_ol
-000148f0: 645f 7461 7267 6574 2069 6e20 7a69 7028  d_target in zip(
-00014900: 636f 7079 5f74 6172 6765 7473 2c20 636f  copy_targets, co
-00014910: 7079 5f6f 6c64 293a 0a20 2020 2020 2020  py_old):.       
-00014920: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00014930: 616e 616d 655b 6561 6368 5f74 6172 6765  aname[each_targe
-00014940: 745d 203d 2064 6174 616e 616d 655b 6561  t] = dataname[ea
-00014950: 6368 5f6f 6c64 5f74 6172 6765 745d 0a0a  ch_old_target]..
-00014960: 2020 2020 2020 2020 2323 2323 2054 6869          #### Thi
-00014970: 7320 6973 2077 6865 7265 2077 6520 6368  s is where we ch
-00014980: 6563 6b20 7768 6574 6865 7220 746f 2072  eck whether to r
-00014990: 6574 7572 6e20 7465 7374 2064 6174 6120  eturn test data 
-000149a0: 6f72 206e 6f74 2023 2323 2323 230a 2020  or not ######.  
-000149b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000149c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000149d0: 616e 6365 2874 6573 745f 6461 7461 2c20  ance(test_data, 
-000149e0: 7374 7229 206f 7220 7465 7374 5f64 6174  str) or test_dat
-000149f0: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
-00014a00: 2020 2020 2020 2020 2020 2069 6620 6665             if fe
-00014a10: 6174 7572 655f 6765 6e20 6f72 2066 6561  ature_gen or fea
-00014a20: 7475 7265 5f74 7970 653a 0a20 2020 2020  ture_type:.     
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00014a40: 2323 2069 6620 6665 6174 7572 6520 656e  ## if feature en
-00014a50: 6767 2069 7320 7065 7266 6f72 6d65 642c  gg is performed,
-00014a60: 2069 6420 636f 6c75 6d6e 7320 6172 6520   id columns are 
-00014a70: 6472 6f70 7065 642e 2048 656e 6365 2074  dropped. Hence t
-00014a80: 6865 7920 6d75 7374 2072 656a 6f69 6e20  hey must rejoin 
-00014a90: 6865 7265 2e0a 2020 2020 2020 2020 2020  here..          
-00014aa0: 2020 2020 2020 2020 2020 6461 7461 6e61            datana
-00014ab0: 6d65 203d 2070 642e 636f 6e63 6174 285b  me = pd.concat([
-00014ac0: 7472 6169 6e5f 6964 732c 2064 6174 616e  train_ids, datan
-00014ad0: 616d 655d 2c20 6178 6973 3d31 290a 2020  ame], axis=1).  
-00014ae0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014af0: 7475 726e 2069 6d70 6f72 7461 6e74 5f66  turn important_f
-00014b00: 6561 7475 7265 732c 2064 6174 616e 616d  eatures, datanam
-00014b10: 655b 696d 706f 7274 616e 745f 6665 6174  e[important_feat
-00014b20: 7572 6573 2b74 6172 6765 745d 0a20 2020  ures+target].   
-00014b30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00014b40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00014b50: 2320 5468 6973 2069 7320 666f 7220 7465  # This is for te
-00014b60: 7374 2064 6174 6120 6578 6973 7469 6e67  st data existing
-00014b70: 2023 2323 230a 2020 2020 2020 2020 2020   ####.          
-00014b80: 2020 2020 2020 6966 2066 6561 7475 7265        if feature
-00014b90: 5f67 656e 206f 7220 6665 6174 7572 655f  _gen or feature_
-00014ba0: 7479 7065 3a0a 2020 2020 2020 2020 2020  type:.          
-00014bb0: 2020 2020 2020 2020 2020 2323 2320 6966            ### if
-00014bc0: 2066 6561 7475 7265 2065 6e67 6720 6973   feature engg is
-00014bd0: 2070 6572 666f 726d 6564 2c20 6964 2063   performed, id c
-00014be0: 6f6c 756d 6e73 2061 7265 2064 726f 7070  olumns are dropp
-00014bf0: 6564 2e20 4865 6e63 6520 7468 6579 206d  ed. Hence they m
-00014c00: 7573 7420 7265 6a6f 696e 2068 6572 652e  ust rejoin here.
-00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c20: 2020 2020 2064 6174 616e 616d 6520 3d20       dataname = 
-00014c30: 7064 2e63 6f6e 6361 7428 5b74 7261 696e  pd.concat([train
-00014c40: 5f69 6473 2c20 6461 7461 6e61 6d65 5d2c  _ids, dataname],
-00014c50: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-00014c60: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-00014c70: 745f 6461 7461 203d 2070 642e 636f 6e63  t_data = pd.conc
-00014c80: 6174 285b 7465 7374 5f69 6473 2c20 7465  at([test_ids, te
-00014c90: 7374 5f64 6174 615d 2c20 6178 6973 3d31  st_data], axis=1
-00014ca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014cb0: 2020 2323 2320 596f 7520 7365 6c65 6374    ### You select
-00014cc0: 2074 6865 2066 6561 7475 7265 7320 7769   the features wi
-00014cd0: 7468 2074 6865 2073 616d 6520 6f6c 6420  th the same old 
-00014ce0: 6e61 6d65 7320 6173 2062 6566 6f72 6520  names as before 
-00014cf0: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
-00014d00: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00014d10: 6174 616e 616d 655b 696d 706f 7274 616e  ataname[importan
-00014d20: 745f 6665 6174 7572 6573 2b74 6172 6765  t_features+targe
-00014d30: 7473 5d2c 2074 6573 745f 6461 7461 5b69  ts], test_data[i
-00014d40: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00014d50: 735d 0a20 2020 2020 2020 2065 7863 6570  s].        excep
-00014d60: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-00014d70: 7269 6e74 2827 5761 726e 696e 673a 2052  rint('Warning: R
-00014d80: 6574 7572 6e69 6e67 2077 6974 6820 696d  eturning with im
-00014d90: 706f 7274 616e 7420 6665 6174 7572 6573  portant features
-00014da0: 2061 6e64 2074 7261 696e 2e20 506c 6561   and train. Plea
-00014db0: 7365 2072 652d 6368 6563 6b20 796f 7572  se re-check your
-00014dc0: 206f 7574 7075 7473 2e27 290a 2020 2020   outputs.').    
-00014dd0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00014de0: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
-00014df0: 732c 2064 6174 616e 616d 655b 696d 706f  s, dataname[impo
-00014e00: 7274 616e 745f 6665 6174 7572 6573 2b74  rtant_features+t
-00014e10: 6172 6765 7473 5d0a 2323 2323 2323 2323  argets].########
-00014e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014190: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+000141a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000141b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141c0: 2020 2023 2323 2320 6966 2074 6865 7265     #### if there
+000141d0: 2069 7320 7465 7374 2064 6174 6120 7472   is test data tr
+000141e0: 616e 7366 6572 2076 616c 7565 7320 746f  ansfer values to
+000141f0: 2069 7420 2323 230a 2020 2020 2020 2020   it ###.        
+00014200: 2020 2020 2020 2020 2020 2020 7465 7374              test
+00014210: 5f64 6174 615b 696d 706f 7274 616e 745f  _data[important_
+00014220: 6665 6174 7572 6573 5d20 3d20 7465 7374  features] = test
+00014230: 5f64 6174 615b 6f6c 645f 696d 706f 7274  _data[old_import
+00014240: 616e 745f 6665 6174 7572 6573 5d0a 2020  ant_features].  
+00014250: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014270: 2323 2320 6669 7273 7420 7472 7920 746f  ### first try to
+00014280: 2072 6574 7572 6e20 7769 7468 2074 6865   return with the
+00014290: 206e 6577 2069 6d70 6f72 7461 6e74 2066   new important f
+000142a0: 6561 7475 7265 732c 2069 6620 7468 6174  eatures, if that
+000142b0: 2066 6169 6c73 2072 6574 7572 6e20 7769   fails return wi
+000142c0: 7468 206f 6c64 2066 6561 7475 7265 730a  th old features.
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000142f0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00014300: 5468 6572 6520 6172 6520 7370 6563 6961  There are specia
+00014310: 6c20 6368 6172 7320 696e 2063 6f6c 756d  l chars in colum
+00014320: 6e20 6e61 6d65 732e 2050 6c65 6173 6520  n names. Please 
+00014330: 7265 6d6f 7665 2074 6865 6d20 616e 6420  remove them and 
+00014340: 7472 7920 6167 6169 6e2e 2729 0a20 2020  try again.').   
+00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014360: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
+00014370: 6573 745f 6461 7461 2c20 7374 7229 206f  est_data, str) o
+00014380: 7220 7465 7374 5f64 6174 6120 6973 204e  r test_data is N
+00014390: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000143a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000143b0: 7572 6e20 696d 706f 7274 616e 745f 6665  urn important_fe
+000143c0: 6174 7572 6573 2c20 6461 7461 6e61 6d65  atures, dataname
+000143d0: 5b69 6d70 6f72 7461 6e74 5f66 6561 7475  [important_featu
+000143e0: 7265 735d 0a20 2020 2020 2020 2020 2020  res].           
+000143f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014410: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00014420: 7461 6e61 6d65 5b69 6d70 6f72 7461 6e74  taname[important
+00014430: 5f66 6561 7475 7265 735d 2c20 7465 7374  _features], test
+00014440: 5f64 6174 615b 696d 706f 7274 616e 745f  _data[important_
+00014450: 6665 6174 7572 6573 5d0a 2020 2020 2020  features].      
+00014460: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00014470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014480: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
+00014490: 7265 2061 7265 2073 7065 6369 616c 2063  re are special c
+000144a0: 6861 7273 2069 6e20 636f 6c75 6d6e 206e  hars in column n
+000144b0: 616d 6573 2e20 5265 7475 726e 696e 6720  ames. Returning 
+000144c0: 7769 7468 2069 6d70 6f72 7461 6e74 2066  with important f
+000144d0: 6561 7475 7265 7320 616e 6420 7472 6169  eatures and trai
+000144e0: 6e2e 2729 0a20 2020 2020 2020 2020 2020  n.').           
+000144f0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00014500: 7374 616e 6365 2874 6573 745f 6461 7461  stance(test_data
+00014510: 2c20 7374 7229 206f 7220 7465 7374 5f64  , str) or test_d
+00014520: 6174 6120 6973 204e 6f6e 653a 0a20 2020  ata is None:.   
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 2072 6574 7572 6e20 6f6c 645f       return old_
+00014550: 696d 706f 7274 616e 745f 6665 6174 7572  important_featur
+00014560: 6573 2c20 6461 7461 6e61 6d65 5b6f 6c64  es, dataname[old
+00014570: 5f69 6d70 6f72 7461 6e74 5f66 6561 7475  _important_featu
+00014580: 7265 735d 0a20 2020 2020 2020 2020 2020  res].           
+00014590: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145b0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+000145c0: 7461 6e61 6d65 5b6f 6c64 5f69 6d70 6f72  taname[old_impor
+000145d0: 7461 6e74 5f66 6561 7475 7265 735d 2c20  tant_features], 
+000145e0: 7465 7374 5f64 6174 615b 6f6c 645f 696d  test_data[old_im
+000145f0: 706f 7274 616e 745f 6665 6174 7572 6573  portant_features
+00014600: 5d20 2020 0a20 2020 2020 2020 200a 2020  ]   .        .  
+00014610: 2020 2020 2020 6f6c 645f 7461 7267 6574        old_target
+00014620: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00014630: 2874 6172 6765 7429 0a20 2020 2020 2020  (target).       
+00014640: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
+00014650: 6172 6765 742c 2073 7472 293a 0a20 2020  arget, str):.   
+00014660: 2020 2020 2020 2020 2074 6172 6765 7420           target 
+00014670: 3d20 6974 656d 5f72 6570 6c61 6365 7228  = item_replacer(
+00014680: 7461 7267 6574 2c20 7461 7267 6574 290a  target, target).
+00014690: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+000146a0: 6574 7320 3d20 5b74 6172 6765 745d 0a20  ets = [target]. 
+000146b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000146c0: 2020 2020 2020 2020 2074 6172 6765 7420           target 
+000146d0: 3d20 5b69 7465 6d5f 7265 706c 6163 6572  = [item_replacer
+000146e0: 286e 2c20 6e29 2066 6f72 206e 2069 6e20  (n, n) for n in 
+000146f0: 7461 7267 6574 5d0a 2020 2020 2020 2020  target].        
+00014700: 2020 2020 7461 7267 6574 7320 3d20 636f      targets = co
+00014710: 7079 2e64 6565 7063 6f70 7928 7461 7267  py.deepcopy(targ
+00014720: 6574 290a 0a20 2020 2020 2020 2069 6620  et)..        if 
+00014730: 6f6c 645f 7461 7267 6574 203d 3d20 7461  old_target == ta
+00014740: 7267 6574 3a0a 2020 2020 2020 2020 2020  rget:.          
+00014750: 2020 2323 2044 6f6e 2774 2064 726f 7020    ## Don't drop 
+00014760: 7468 6520 6f6c 6420 7461 7267 6574 2073  the old target s
+00014770: 696e 6365 2074 6865 7265 2069 7320 6f6e  ince there is on
+00014780: 6c79 206f 6e65 2074 6172 6765 7420 6865  ly one target he
+00014790: 7265 2023 2323 0a20 2020 2020 2020 2020  re ###.         
+000147a0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+000147b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000147c0: 2020 2323 2320 796f 7520 646f 6e27 7420    ### you don't 
+000147d0: 6e65 6564 2064 726f 7020 7468 6520 636f  need drop the co
+000147e0: 6c73 2074 6861 7420 6861 7665 2063 6861  ls that have cha
+000147f0: 6e67 6564 2073 696e 6365 206f 6e6c 7920  nged since only 
+00014800: 6120 6665 7720 6172 6520 7365 6c65 6374  a few are select
+00014810: 6564 2023 2323 2323 2323 0a20 2020 2020  ed #######.     
+00014820: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00014830: 616e 6365 2874 6172 6765 742c 2073 7472  ance(target, str
+00014840: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014850: 2020 2064 6174 616e 616d 655b 7461 7267     dataname[targ
+00014860: 6574 5d20 3d20 6461 7461 6e61 6d65 5b6f  et] = dataname[o
+00014870: 6c64 5f74 6172 6765 745d 0a20 2020 2020  ld_target].     
+00014880: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014890: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
+000148a0: 795f 7461 7267 6574 7320 3d20 636f 7079  y_targets = copy
+000148b0: 2e64 6565 7063 6f70 7928 7461 7267 6574  .deepcopy(target
+000148c0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+000148d0: 2020 2063 6f70 795f 6f6c 6420 3d20 636f     copy_old = co
+000148e0: 7079 2e64 6565 7063 6f70 7928 6f6c 645f  py.deepcopy(old_
+000148f0: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
+00014900: 2020 2020 2020 2020 666f 7220 6561 6368          for each
+00014910: 5f74 6172 6765 742c 2065 6163 685f 6f6c  _target, each_ol
+00014920: 645f 7461 7267 6574 2069 6e20 7a69 7028  d_target in zip(
+00014930: 636f 7079 5f74 6172 6765 7473 2c20 636f  copy_targets, co
+00014940: 7079 5f6f 6c64 293a 0a20 2020 2020 2020  py_old):.       
+00014950: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00014960: 616e 616d 655b 6561 6368 5f74 6172 6765  aname[each_targe
+00014970: 745d 203d 2064 6174 616e 616d 655b 6561  t] = dataname[ea
+00014980: 6368 5f6f 6c64 5f74 6172 6765 745d 0a0a  ch_old_target]..
+00014990: 2020 2020 2020 2020 2323 2323 2054 6869          #### Thi
+000149a0: 7320 6973 2077 6865 7265 2077 6520 6368  s is where we ch
+000149b0: 6563 6b20 7768 6574 6865 7220 746f 2072  eck whether to r
+000149c0: 6574 7572 6e20 7465 7374 2064 6174 6120  eturn test data 
+000149d0: 6f72 206e 6f74 2023 2323 2323 230a 2020  or not ######.  
+000149e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000149f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00014a00: 616e 6365 2874 6573 745f 6461 7461 2c20  ance(test_data, 
+00014a10: 7374 7229 206f 7220 7465 7374 5f64 6174  str) or test_dat
+00014a20: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
+00014a30: 2020 2020 2020 2020 2020 2069 6620 6665             if fe
+00014a40: 6174 7572 655f 6765 6e20 6f72 2066 6561  ature_gen or fea
+00014a50: 7475 7265 5f74 7970 653a 0a20 2020 2020  ture_type:.     
+00014a60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00014a70: 2323 2069 6620 6665 6174 7572 6520 656e  ## if feature en
+00014a80: 6767 2069 7320 7065 7266 6f72 6d65 642c  gg is performed,
+00014a90: 2069 6420 636f 6c75 6d6e 7320 6172 6520   id columns are 
+00014aa0: 6472 6f70 7065 642e 2048 656e 6365 2074  dropped. Hence t
+00014ab0: 6865 7920 6d75 7374 2072 656a 6f69 6e20  hey must rejoin 
+00014ac0: 6865 7265 2e0a 2020 2020 2020 2020 2020  here..          
+00014ad0: 2020 2020 2020 2020 2020 6461 7461 6e61            datana
+00014ae0: 6d65 203d 2070 642e 636f 6e63 6174 285b  me = pd.concat([
+00014af0: 7472 6169 6e5f 6964 732c 2064 6174 616e  train_ids, datan
+00014b00: 616d 655d 2c20 6178 6973 3d31 290a 2020  ame], axis=1).  
+00014b10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014b20: 7475 726e 2069 6d70 6f72 7461 6e74 5f66  turn important_f
+00014b30: 6561 7475 7265 732c 2064 6174 616e 616d  eatures, datanam
+00014b40: 655b 696d 706f 7274 616e 745f 6665 6174  e[important_feat
+00014b50: 7572 6573 2b74 6172 6765 745d 0a20 2020  ures+target].   
+00014b60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00014b70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00014b80: 2320 5468 6973 2069 7320 666f 7220 7465  # This is for te
+00014b90: 7374 2064 6174 6120 6578 6973 7469 6e67  st data existing
+00014ba0: 2023 2323 230a 2020 2020 2020 2020 2020   ####.          
+00014bb0: 2020 2020 2020 6966 2066 6561 7475 7265        if feature
+00014bc0: 5f67 656e 206f 7220 6665 6174 7572 655f  _gen or feature_
+00014bd0: 7479 7065 3a0a 2020 2020 2020 2020 2020  type:.          
+00014be0: 2020 2020 2020 2020 2020 2323 2320 6966            ### if
+00014bf0: 2066 6561 7475 7265 2065 6e67 6720 6973   feature engg is
+00014c00: 2070 6572 666f 726d 6564 2c20 6964 2063   performed, id c
+00014c10: 6f6c 756d 6e73 2061 7265 2064 726f 7070  olumns are dropp
+00014c20: 6564 2e20 4865 6e63 6520 7468 6579 206d  ed. Hence they m
+00014c30: 7573 7420 7265 6a6f 696e 2068 6572 652e  ust rejoin here.
+00014c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c50: 2020 2020 2064 6174 616e 616d 6520 3d20       dataname = 
+00014c60: 7064 2e63 6f6e 6361 7428 5b74 7261 696e  pd.concat([train
+00014c70: 5f69 6473 2c20 6461 7461 6e61 6d65 5d2c  _ids, dataname],
+00014c80: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
+00014c90: 2020 2020 2020 2020 2020 2020 2074 6573               tes
+00014ca0: 745f 6461 7461 203d 2070 642e 636f 6e63  t_data = pd.conc
+00014cb0: 6174 285b 7465 7374 5f69 6473 2c20 7465  at([test_ids, te
+00014cc0: 7374 5f64 6174 615d 2c20 6178 6973 3d31  st_data], axis=1
+00014cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014ce0: 2020 2323 2320 596f 7520 7365 6c65 6374    ### You select
+00014cf0: 2074 6865 2066 6561 7475 7265 7320 7769   the features wi
+00014d00: 7468 2074 6865 2073 616d 6520 6f6c 6420  th the same old 
+00014d10: 6e61 6d65 7320 6173 2062 6566 6f72 6520  names as before 
+00014d20: 2323 2323 2323 230a 2020 2020 2020 2020  #######.        
+00014d30: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00014d40: 6174 616e 616d 655b 696d 706f 7274 616e  ataname[importan
+00014d50: 745f 6665 6174 7572 6573 2b74 6172 6765  t_features+targe
+00014d60: 7473 5d2c 2074 6573 745f 6461 7461 5b69  ts], test_data[i
+00014d70: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00014d80: 735d 0a20 2020 2020 2020 2065 7863 6570  s].        excep
+00014d90: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00014da0: 7269 6e74 2827 5761 726e 696e 673a 2052  rint('Warning: R
+00014db0: 6574 7572 6e69 6e67 2077 6974 6820 696d  eturning with im
+00014dc0: 706f 7274 616e 7420 6665 6174 7572 6573  portant features
+00014dd0: 2061 6e64 2074 7261 696e 2e20 506c 6561   and train. Plea
+00014de0: 7365 2072 652d 6368 6563 6b20 796f 7572  se re-check your
+00014df0: 206f 7574 7075 7473 2e27 290a 2020 2020   outputs.').    
+00014e00: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00014e10: 6d70 6f72 7461 6e74 5f66 6561 7475 7265  mportant_feature
+00014e20: 732c 2064 6174 616e 616d 655b 696d 706f  s, dataname[impo
+00014e30: 7274 616e 745f 6665 6174 7572 6573 2b74  rtant_features+t
+00014e40: 6172 6765 7473 5d0a 2323 2323 2323 2323  argets].########
 00014e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014e60: 2323 2323 2323 2323 0a64 6566 2072 656d  ########.def rem
-00014e70: 6f76 655f 6869 6768 6c79 5f63 6f72 7265  ove_highly_corre
-00014e80: 6c61 7465 645f 7661 7273 5f66 6173 7428  lated_vars_fast(
-00014e90: 6466 2c20 636f 7272 5f6c 696d 6974 3d30  df, corr_limit=0
-00014ea0: 2e37 3029 3a0a 2020 2020 2222 220a 2020  .70):.    """.  
-00014eb0: 2020 5468 6973 2069 7320 6120 7369 6d70    This is a simp
-00014ec0: 6c65 206d 6574 686f 6420 746f 2072 656d  le method to rem
-00014ed0: 6f76 6520 6869 6768 6c79 2063 6f72 7265  ove highly corre
-00014ee0: 6c61 7465 6420 6665 6174 7572 6573 2066  lated features f
-00014ef0: 6173 7420 7573 696e 6720 5065 6172 736f  ast using Pearso
-00014f00: 6e27 7320 436f 7272 656c 6174 696f 6e2e  n's Correlation.
-00014f10: 0a20 2020 2055 7365 2074 6869 7320 6f6e  .    Use this on
-00014f20: 6c79 2066 6f72 2066 6c6f 6174 2061 6e64  ly for float and
-00014f30: 2069 6e74 6567 6572 2076 6172 6961 626c   integer variabl
-00014f40: 6573 2e20 4974 2077 696c 6c20 6175 746f  es. It will auto
-00014f50: 6d61 7469 6361 6c6c 7920 7365 6c65 6374  matically select
-00014f60: 2074 686f 7365 206f 6e6c 792e 0a20 2020   those only..   
-00014f70: 2049 7420 6361 6e20 6265 2075 7365 6420   It can be used 
-00014f80: 666f 7220 7665 7279 206c 6172 6765 2064  for very large d
-00014f90: 6174 6120 7365 7473 2077 6865 7265 2066  ata sets where f
-00014fa0: 6561 7475 7265 7769 7a20 6861 7320 7472  eaturewiz has tr
-00014fb0: 6f75 626c 6520 7769 7468 206d 656d 6f72  ouble with memor
-00014fc0: 790a 2020 2020 2222 220a 2020 2020 2320  y.    """.    # 
-00014fd0: 4372 6561 7469 6e67 2063 6f72 7265 6c61  Creating correla
-00014fe0: 7469 6f6e 206d 6174 7269 780a 2020 2020  tion matrix.    
-00014ff0: 636f 7272 656c 6174 696f 6e5f 6461 7461  correlation_data
-00015000: 6672 616d 6520 3d20 6466 2e63 6f72 7228  frame = df.corr(
-00015010: 292e 6162 7328 292e 6173 7479 7065 286e  ).abs().astype(n
-00015020: 702e 666c 6f61 7431 3629 0a20 2020 2023  p.float16).    #
-00015030: 2053 656c 6563 7469 6e67 2075 7070 6572   Selecting upper
-00015040: 2074 7269 616e 676c 6520 6f66 2063 6f72   triangle of cor
-00015050: 7265 6c61 7469 6f6e 206d 6174 7269 780a  relation matrix.
-00015060: 2020 2020 7570 7065 725f 7472 6920 3d20      upper_tri = 
-00015070: 636f 7272 656c 6174 696f 6e5f 6461 7461  correlation_data
-00015080: 6672 616d 652e 7768 6572 6528 6e70 2e74  frame.where(np.t
-00015090: 7269 7528 6e70 2e6f 6e65 7328 636f 7272  riu(np.ones(corr
-000150a0: 656c 6174 696f 6e5f 6461 7461 6672 616d  elation_datafram
-000150b0: 652e 7368 6170 6529 2c0a 2020 2020 2020  e.shape),.      
-000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150d0: 2020 2020 2020 2020 2020 2020 6b3d 3129              k=1)
-000150e0: 2e61 7374 7970 6528 6e70 2e62 6f6f 6c29  .astype(np.bool)
-000150f0: 290a 2020 2020 2320 4669 6e64 696e 6720  ).    # Finding 
-00015100: 696e 6465 7820 6f66 2066 6561 7475 7265  index of feature
-00015110: 2063 6f6c 756d 6e73 2077 6974 6820 636f   columns with co
-00015120: 7272 656c 6174 696f 6e20 6772 6561 7465  rrelation greate
-00015130: 7220 7468 616e 2030 2e39 350a 2020 2020  r than 0.95.    
-00015140: 746f 5f64 726f 7020 3d20 5b63 6f6c 756d  to_drop = [colum
-00015150: 6e20 666f 7220 636f 6c75 6d6e 2069 6e20  n for column in 
-00015160: 7570 7065 725f 7472 692e 636f 6c75 6d6e  upper_tri.column
-00015170: 7320 6966 2061 6e79 2875 7070 6572 5f74  s if any(upper_t
-00015180: 7269 5b63 6f6c 756d 6e5d 203e 2063 6f72  ri[column] > cor
-00015190: 725f 6c69 6d69 7429 5d0a 2020 2020 7072  r_limit)].    pr
-000151a0: 696e 7428 293b 0a20 2020 2070 7269 6e74  int();.    print
-000151b0: 2827 4869 6768 6c79 2063 6f72 7265 6c61  ('Highly correla
-000151c0: 7465 6420 636f 6c75 6d6e 7320 746f 2072  ted columns to r
-000151d0: 656d 6f76 653a 2025 7327 2025 746f 5f64  emove: %s' %to_d
-000151e0: 726f 7029 0a20 2020 2072 6574 7572 6e20  rop).    return 
-000151f0: 746f 5f64 726f 700a 2323 2323 2323 2323  to_drop.########
-00015200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014e70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014e90: 2323 2323 2323 2323 0a64 6566 2072 656d  ########.def rem
+00014ea0: 6f76 655f 6869 6768 6c79 5f63 6f72 7265  ove_highly_corre
+00014eb0: 6c61 7465 645f 7661 7273 5f66 6173 7428  lated_vars_fast(
+00014ec0: 6466 2c20 636f 7272 5f6c 696d 6974 3d30  df, corr_limit=0
+00014ed0: 2e37 3029 3a0a 2020 2020 2222 220a 2020  .70):.    """.  
+00014ee0: 2020 5468 6973 2069 7320 6120 7369 6d70    This is a simp
+00014ef0: 6c65 206d 6574 686f 6420 746f 2072 656d  le method to rem
+00014f00: 6f76 6520 6869 6768 6c79 2063 6f72 7265  ove highly corre
+00014f10: 6c61 7465 6420 6665 6174 7572 6573 2066  lated features f
+00014f20: 6173 7420 7573 696e 6720 5065 6172 736f  ast using Pearso
+00014f30: 6e27 7320 436f 7272 656c 6174 696f 6e2e  n's Correlation.
+00014f40: 0a20 2020 2055 7365 2074 6869 7320 6f6e  .    Use this on
+00014f50: 6c79 2066 6f72 2066 6c6f 6174 2061 6e64  ly for float and
+00014f60: 2069 6e74 6567 6572 2076 6172 6961 626c   integer variabl
+00014f70: 6573 2e20 4974 2077 696c 6c20 6175 746f  es. It will auto
+00014f80: 6d61 7469 6361 6c6c 7920 7365 6c65 6374  matically select
+00014f90: 2074 686f 7365 206f 6e6c 792e 0a20 2020   those only..   
+00014fa0: 2049 7420 6361 6e20 6265 2075 7365 6420   It can be used 
+00014fb0: 666f 7220 7665 7279 206c 6172 6765 2064  for very large d
+00014fc0: 6174 6120 7365 7473 2077 6865 7265 2066  ata sets where f
+00014fd0: 6561 7475 7265 7769 7a20 6861 7320 7472  eaturewiz has tr
+00014fe0: 6f75 626c 6520 7769 7468 206d 656d 6f72  ouble with memor
+00014ff0: 790a 2020 2020 2222 220a 2020 2020 2320  y.    """.    # 
+00015000: 4372 6561 7469 6e67 2063 6f72 7265 6c61  Creating correla
+00015010: 7469 6f6e 206d 6174 7269 780a 2020 2020  tion matrix.    
+00015020: 636f 7272 656c 6174 696f 6e5f 6461 7461  correlation_data
+00015030: 6672 616d 6520 3d20 6466 2e63 6f72 7228  frame = df.corr(
+00015040: 292e 6162 7328 292e 6173 7479 7065 286e  ).abs().astype(n
+00015050: 702e 666c 6f61 7431 3629 0a20 2020 2023  p.float16).    #
+00015060: 2053 656c 6563 7469 6e67 2075 7070 6572   Selecting upper
+00015070: 2074 7269 616e 676c 6520 6f66 2063 6f72   triangle of cor
+00015080: 7265 6c61 7469 6f6e 206d 6174 7269 780a  relation matrix.
+00015090: 2020 2020 7570 7065 725f 7472 6920 3d20      upper_tri = 
+000150a0: 636f 7272 656c 6174 696f 6e5f 6461 7461  correlation_data
+000150b0: 6672 616d 652e 7768 6572 6528 6e70 2e74  frame.where(np.t
+000150c0: 7269 7528 6e70 2e6f 6e65 7328 636f 7272  riu(np.ones(corr
+000150d0: 656c 6174 696f 6e5f 6461 7461 6672 616d  elation_datafram
+000150e0: 652e 7368 6170 6529 2c0a 2020 2020 2020  e.shape),.      
+000150f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015100: 2020 2020 2020 2020 2020 2020 6b3d 3129              k=1)
+00015110: 2e61 7374 7970 6528 6e70 2e62 6f6f 6c29  .astype(np.bool)
+00015120: 290a 2020 2020 2320 4669 6e64 696e 6720  ).    # Finding 
+00015130: 696e 6465 7820 6f66 2066 6561 7475 7265  index of feature
+00015140: 2063 6f6c 756d 6e73 2077 6974 6820 636f   columns with co
+00015150: 7272 656c 6174 696f 6e20 6772 6561 7465  rrelation greate
+00015160: 7220 7468 616e 2030 2e39 350a 2020 2020  r than 0.95.    
+00015170: 746f 5f64 726f 7020 3d20 5b63 6f6c 756d  to_drop = [colum
+00015180: 6e20 666f 7220 636f 6c75 6d6e 2069 6e20  n for column in 
+00015190: 7570 7065 725f 7472 692e 636f 6c75 6d6e  upper_tri.column
+000151a0: 7320 6966 2061 6e79 2875 7070 6572 5f74  s if any(upper_t
+000151b0: 7269 5b63 6f6c 756d 6e5d 203e 2063 6f72  ri[column] > cor
+000151c0: 725f 6c69 6d69 7429 5d0a 2020 2020 7072  r_limit)].    pr
+000151d0: 696e 7428 293b 0a20 2020 2070 7269 6e74  int();.    print
+000151e0: 2827 4869 6768 6c79 2063 6f72 7265 6c61  ('Highly correla
+000151f0: 7465 6420 636f 6c75 6d6e 7320 746f 2072  ted columns to r
+00015200: 656d 6f76 653a 2025 7327 2025 746f 5f64  emove: %s' %to_d
+00015210: 726f 7029 0a20 2020 2072 6574 7572 6e20  rop).    return 
+00015220: 746f 5f64 726f 700a 2323 2323 2323 2323  to_drop.########
 00015230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015240: 2323 2323 2323 2323 2323 2323 230a 696d  #############.im
-00015250: 706f 7274 206d 756c 7469 7072 6f63 6573  port multiproces
-00015260: 7369 6e67 0a64 6566 2067 6574 5f63 7075  sing.def get_cpu
-00015270: 5f77 6f72 6b65 725f 636f 756e 7428 293a  _worker_count():
-00015280: 0a20 2020 2072 6574 7572 6e20 6d75 6c74  .    return mult
-00015290: 6970 726f 6365 7373 696e 672e 6370 755f  iprocessing.cpu_
-000152a0: 636f 756e 7428 290a 2323 2323 2323 2323  count().########
-000152b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000152c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000152d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015270: 2323 2323 2323 2323 2323 2323 230a 696d  #############.im
+00015280: 706f 7274 206d 756c 7469 7072 6f63 6573  port multiproces
+00015290: 7369 6e67 0a64 6566 2067 6574 5f63 7075  sing.def get_cpu
+000152a0: 5f77 6f72 6b65 725f 636f 756e 7428 293a  _worker_count():
+000152b0: 0a20 2020 2072 6574 7572 6e20 6d75 6c74  .    return mult
+000152c0: 6970 726f 6365 7373 696e 672e 6370 755f  iprocessing.cpu_
+000152d0: 636f 756e 7428 290a 2323 2323 2323 2323  count().########
 000152e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000152f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015300: 2323 2323 230a 6672 6f6d 2069 7465 7274  #####.from itert
-00015310: 6f6f 6c73 2069 6d70 6f72 7420 636f 6d62  ools import comb
-00015320: 696e 6174 696f 6e73 0a69 6d70 6f72 7420  inations.import 
-00015330: 6d61 7470 6c6f 746c 6962 2e70 6174 6368  matplotlib.patch
-00015340: 6573 2061 7320 6d70 6174 6368 6573 0a69  es as mpatches.i
-00015350: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
-00015360: 2e70 7970 6c6f 7420 6173 2070 6c74 0a66  .pyplot as plt.f
-00015370: 726f 6d20 736b 6c65 6172 6e2e 6665 6174  rom sklearn.feat
-00015380: 7572 655f 7365 6c65 6374 696f 6e20 696d  ure_selection im
-00015390: 706f 7274 2063 6869 322c 206d 7574 7561  port chi2, mutua
-000153a0: 6c5f 696e 666f 5f72 6567 7265 7373 696f  l_info_regressio
-000153b0: 6e2c 206d 7574 7561 6c5f 696e 666f 5f63  n, mutual_info_c
-000153c0: 6c61 7373 6966 0a66 726f 6d20 736b 6c65  lassif.from skle
-000153d0: 6172 6e2e 6665 6174 7572 655f 7365 6c65  arn.feature_sele
-000153e0: 6374 696f 6e20 696d 706f 7274 2053 656c  ction import Sel
-000153f0: 6563 744b 4265 7374 0a69 6d70 6f72 7420  ectKBest.import 
-00015400: 7867 626f 6f73 740a 6465 6620 6472 6177  xgboost.def draw
-00015410: 5f66 6561 7475 7265 5f69 6d70 6f72 7461  _feature_importa
-00015420: 6e63 6573 5f6d 756c 7469 5f6c 6162 656c  nces_multi_label
-00015430: 2862 7374 5f6d 6f64 656c 732c 2064 6173  (bst_models, das
-00015440: 6b5f 7867 626f 6f73 745f 666c 6167 3d46  k_xgboost_flag=F
-00015450: 616c 7365 293a 0a20 2020 2072 6f77 7320  alse):.    rows 
-00015460: 3d20 696e 7428 6c65 6e28 6273 745f 6d6f  = int(len(bst_mo
-00015470: 6465 6c73 292f 3220 2b20 302e 3529 0a20  dels)/2 + 0.5). 
-00015480: 2020 2063 6f6c 7573 203d 2032 0a20 2020     colus = 2.   
-00015490: 2066 6967 2c20 6178 203d 2070 6c74 2e73   fig, ax = plt.s
-000154a0: 7562 706c 6f74 7328 726f 7773 2c20 636f  ubplots(rows, co
-000154b0: 6c75 7329 0a20 2020 2066 6967 2e73 6574  lus).    fig.set
-000154c0: 5f73 697a 655f 696e 6368 6573 286d 696e  _size_inches(min
-000154d0: 2863 6f6c 7573 2a35 2c32 3029 2c72 6f77  (colus*5,20),row
-000154e0: 732a 3529 0a20 2020 2066 6967 2e73 7562  s*5).    fig.sub
-000154f0: 706c 6f74 735f 6164 6a75 7374 2868 7370  plots_adjust(hsp
-00015500: 6163 653d 302e 3529 2023 2323 2054 6869  ace=0.5) ### Thi
-00015510: 7320 636f 6e74 726f 6c73 2074 6865 2073  s controls the s
-00015520: 7061 6365 2062 6574 7765 6e20 726f 7773  pace betwen rows
-00015530: 0a20 2020 2066 6967 2e73 7562 706c 6f74  .    fig.subplot
-00015540: 735f 6164 6a75 7374 2877 7370 6163 653d  s_adjust(wspace=
-00015550: 302e 3529 2023 2323 2054 6869 7320 636f  0.5) ### This co
-00015560: 6e74 726f 6c73 2074 6865 2073 7061 6365  ntrols the space
-00015570: 2062 6574 7765 656e 2063 6f6c 756d 6e73   between columns
-00015580: 0a20 2020 2063 6f75 6e74 6572 203d 2030  .    counter = 0
-00015590: 0a20 2020 2069 6620 726f 7773 203d 3d20  .    if rows == 
-000155a0: 313a 0a20 2020 2020 2020 2061 7820 3d20  1:.        ax = 
-000155b0: 6178 2e72 6573 6861 7065 282d 312c 3129  ax.reshape(-1,1)
-000155c0: 2e54 0a20 2020 2066 6f72 206b 2069 6e20  .T.    for k in 
-000155d0: 6e70 2e61 7261 6e67 6528 726f 7773 293a  np.arange(rows):
-000155e0: 0a20 2020 2020 2020 2066 6f72 206c 2069  .        for l i
-000155f0: 6e20 6e70 2e61 7261 6e67 6528 636f 6c75  n np.arange(colu
-00015600: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00015610: 6966 2063 6f75 6e74 6572 203c 206c 656e  if counter < len
-00015620: 2862 7374 5f6d 6f64 656c 7329 3a0a 2020  (bst_models):.  
-00015630: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00015640: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00015650: 2020 2020 2020 2062 7374 5f62 6f6f 7374         bst_boost
-00015660: 6572 203d 2062 7374 5f6d 6f64 656c 735b  er = bst_models[
-00015670: 636f 756e 7465 725d 2e65 7374 696d 6174  counter].estimat
-00015680: 6f72 735f 5b30 5d0a 2020 2020 2020 2020  ors_[0].        
-00015690: 2020 2020 2020 2020 2020 2020 6178 3120              ax1 
-000156a0: 3d20 7867 626f 6f73 742e 706c 6f74 5f69  = xgboost.plot_i
-000156b0: 6d70 6f72 7461 6e63 6528 6273 745f 626f  mportance(bst_bo
-000156c0: 6f73 7465 722c 2068 6569 6768 743d 302e  oster, height=0.
-000156d0: 382c 2073 686f 775f 7661 6c75 6573 3d46  8, show_values=F
-000156e0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015700: 2020 696d 706f 7274 616e 6365 5f74 7970    importance_typ
-00015710: 653d 2767 6169 6e27 2c20 6d61 785f 6e75  e='gain', max_nu
-00015720: 6d5f 6665 6174 7572 6573 3d31 302c 2061  m_features=10, a
-00015730: 783d 6178 5b6b 5d5b 6c5d 290a 2020 2020  x=ax[k][l]).    
-00015740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015750: 6178 312e 7365 745f 7469 746c 6528 274d  ax1.set_title('M
-00015760: 756c 7469 5f6c 6162 656c 3a20 546f 7020  ulti_label: Top 
-00015770: 3130 2066 6561 7475 7265 7320 666f 7220  10 features for 
-00015780: 6669 7273 7420 6c61 6265 6c3a 2072 6f75  first label: rou
-00015790: 6e64 2025 7327 2025 2863 6f75 6e74 6572  nd %s' %(counter
-000157a0: 2b31 2929 0a20 2020 2020 2020 2020 2020  +1)).           
-000157b0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-000157c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157d0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-000157e0: 2020 636f 756e 7465 7220 2b3d 2031 0a20    counter += 1. 
-000157f0: 2020 2070 6c74 2e73 686f 7728 293b 0a23     plt.show();.#
-00015800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015330: 2323 2323 230a 6672 6f6d 2069 7465 7274  #####.from itert
+00015340: 6f6f 6c73 2069 6d70 6f72 7420 636f 6d62  ools import comb
+00015350: 696e 6174 696f 6e73 0a69 6d70 6f72 7420  inations.import 
+00015360: 6d61 7470 6c6f 746c 6962 2e70 6174 6368  matplotlib.patch
+00015370: 6573 2061 7320 6d70 6174 6368 6573 0a69  es as mpatches.i
+00015380: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
+00015390: 2e70 7970 6c6f 7420 6173 2070 6c74 0a66  .pyplot as plt.f
+000153a0: 726f 6d20 736b 6c65 6172 6e2e 6665 6174  rom sklearn.feat
+000153b0: 7572 655f 7365 6c65 6374 696f 6e20 696d  ure_selection im
+000153c0: 706f 7274 2063 6869 322c 206d 7574 7561  port chi2, mutua
+000153d0: 6c5f 696e 666f 5f72 6567 7265 7373 696f  l_info_regressio
+000153e0: 6e2c 206d 7574 7561 6c5f 696e 666f 5f63  n, mutual_info_c
+000153f0: 6c61 7373 6966 0a66 726f 6d20 736b 6c65  lassif.from skle
+00015400: 6172 6e2e 6665 6174 7572 655f 7365 6c65  arn.feature_sele
+00015410: 6374 696f 6e20 696d 706f 7274 2053 656c  ction import Sel
+00015420: 6563 744b 4265 7374 0a69 6d70 6f72 7420  ectKBest.import 
+00015430: 7867 626f 6f73 740a 6465 6620 6472 6177  xgboost.def draw
+00015440: 5f66 6561 7475 7265 5f69 6d70 6f72 7461  _feature_importa
+00015450: 6e63 6573 5f6d 756c 7469 5f6c 6162 656c  nces_multi_label
+00015460: 2862 7374 5f6d 6f64 656c 732c 2064 6173  (bst_models, das
+00015470: 6b5f 7867 626f 6f73 745f 666c 6167 3d46  k_xgboost_flag=F
+00015480: 616c 7365 293a 0a20 2020 2072 6f77 7320  alse):.    rows 
+00015490: 3d20 696e 7428 6c65 6e28 6273 745f 6d6f  = int(len(bst_mo
+000154a0: 6465 6c73 292f 3220 2b20 302e 3529 0a20  dels)/2 + 0.5). 
+000154b0: 2020 2063 6f6c 7573 203d 2032 0a20 2020     colus = 2.   
+000154c0: 2066 6967 2c20 6178 203d 2070 6c74 2e73   fig, ax = plt.s
+000154d0: 7562 706c 6f74 7328 726f 7773 2c20 636f  ubplots(rows, co
+000154e0: 6c75 7329 0a20 2020 2066 6967 2e73 6574  lus).    fig.set
+000154f0: 5f73 697a 655f 696e 6368 6573 286d 696e  _size_inches(min
+00015500: 2863 6f6c 7573 2a35 2c32 3029 2c72 6f77  (colus*5,20),row
+00015510: 732a 3529 0a20 2020 2066 6967 2e73 7562  s*5).    fig.sub
+00015520: 706c 6f74 735f 6164 6a75 7374 2868 7370  plots_adjust(hsp
+00015530: 6163 653d 302e 3529 2023 2323 2054 6869  ace=0.5) ### Thi
+00015540: 7320 636f 6e74 726f 6c73 2074 6865 2073  s controls the s
+00015550: 7061 6365 2062 6574 7765 6e20 726f 7773  pace betwen rows
+00015560: 0a20 2020 2066 6967 2e73 7562 706c 6f74  .    fig.subplot
+00015570: 735f 6164 6a75 7374 2877 7370 6163 653d  s_adjust(wspace=
+00015580: 302e 3529 2023 2323 2054 6869 7320 636f  0.5) ### This co
+00015590: 6e74 726f 6c73 2074 6865 2073 7061 6365  ntrols the space
+000155a0: 2062 6574 7765 656e 2063 6f6c 756d 6e73   between columns
+000155b0: 0a20 2020 2063 6f75 6e74 6572 203d 2030  .    counter = 0
+000155c0: 0a20 2020 2069 6620 726f 7773 203d 3d20  .    if rows == 
+000155d0: 313a 0a20 2020 2020 2020 2061 7820 3d20  1:.        ax = 
+000155e0: 6178 2e72 6573 6861 7065 282d 312c 3129  ax.reshape(-1,1)
+000155f0: 2e54 0a20 2020 2066 6f72 206b 2069 6e20  .T.    for k in 
+00015600: 6e70 2e61 7261 6e67 6528 726f 7773 293a  np.arange(rows):
+00015610: 0a20 2020 2020 2020 2066 6f72 206c 2069  .        for l i
+00015620: 6e20 6e70 2e61 7261 6e67 6528 636f 6c75  n np.arange(colu
+00015630: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00015640: 6966 2063 6f75 6e74 6572 203c 206c 656e  if counter < len
+00015650: 2862 7374 5f6d 6f64 656c 7329 3a0a 2020  (bst_models):.  
+00015660: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00015670: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00015680: 2020 2020 2020 2062 7374 5f62 6f6f 7374         bst_boost
+00015690: 6572 203d 2062 7374 5f6d 6f64 656c 735b  er = bst_models[
+000156a0: 636f 756e 7465 725d 2e65 7374 696d 6174  counter].estimat
+000156b0: 6f72 735f 5b30 5d0a 2020 2020 2020 2020  ors_[0].        
+000156c0: 2020 2020 2020 2020 2020 2020 6178 3120              ax1 
+000156d0: 3d20 7867 626f 6f73 742e 706c 6f74 5f69  = xgboost.plot_i
+000156e0: 6d70 6f72 7461 6e63 6528 6273 745f 626f  mportance(bst_bo
+000156f0: 6f73 7465 722c 2068 6569 6768 743d 302e  oster, height=0.
+00015700: 382c 2073 686f 775f 7661 6c75 6573 3d46  8, show_values=F
+00015710: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015730: 2020 696d 706f 7274 616e 6365 5f74 7970    importance_typ
+00015740: 653d 2767 6169 6e27 2c20 6d61 785f 6e75  e='gain', max_nu
+00015750: 6d5f 6665 6174 7572 6573 3d31 302c 2061  m_features=10, a
+00015760: 783d 6178 5b6b 5d5b 6c5d 290a 2020 2020  x=ax[k][l]).    
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 6178 312e 7365 745f 7469 746c 6528 274d  ax1.set_title('M
+00015790: 756c 7469 5f6c 6162 656c 3a20 546f 7020  ulti_label: Top 
+000157a0: 3130 2066 6561 7475 7265 7320 666f 7220  10 features for 
+000157b0: 6669 7273 7420 6c61 6265 6c3a 2072 6f75  first label: rou
+000157c0: 6e64 2025 7327 2025 2863 6f75 6e74 6572  nd %s' %(counter
+000157d0: 2b31 2929 0a20 2020 2020 2020 2020 2020  +1)).           
+000157e0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015800: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00015810: 2020 636f 756e 7465 7220 2b3d 2031 0a20    counter += 1. 
+00015820: 2020 2070 6c74 2e73 686f 7728 293b 0a23     plt.show();.#
 00015830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00015840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015850: 2323 2323 2323 230a 6465 6620 6472 6177  #######.def draw
-00015860: 5f66 6561 7475 7265 5f69 6d70 6f72 7461  _feature_importa
-00015870: 6e63 6573 5f73 696e 676c 655f 6c61 6265  nces_single_labe
-00015880: 6c28 6273 745f 6d6f 6465 6c73 2c20 6461  l(bst_models, da
-00015890: 736b 5f78 6762 6f6f 7374 5f66 6c61 673d  sk_xgboost_flag=
-000158a0: 4661 6c73 6529 3a0a 2020 2020 726f 7773  False):.    rows
-000158b0: 203d 2069 6e74 286c 656e 2862 7374 5f6d   = int(len(bst_m
-000158c0: 6f64 656c 7329 2f32 202b 2030 2e35 290a  odels)/2 + 0.5).
-000158d0: 2020 2020 636f 6c75 7320 3d20 320a 2020      colus = 2.  
-000158e0: 2020 6669 672c 2061 7820 3d20 706c 742e    fig, ax = plt.
-000158f0: 7375 6270 6c6f 7473 2872 6f77 732c 2063  subplots(rows, c
-00015900: 6f6c 7573 290a 2020 2020 6669 672e 7365  olus).    fig.se
-00015910: 745f 7369 7a65 5f69 6e63 6865 7328 6d69  t_size_inches(mi
-00015920: 6e28 636f 6c75 732a 352c 3230 292c 726f  n(colus*5,20),ro
-00015930: 7773 2a35 290a 2020 2020 6669 672e 7375  ws*5).    fig.su
-00015940: 6270 6c6f 7473 5f61 646a 7573 7428 6873  bplots_adjust(hs
-00015950: 7061 6365 3d30 2e35 2920 2323 2320 5468  pace=0.5) ### Th
-00015960: 6973 2063 6f6e 7472 6f6c 7320 7468 6520  is controls the 
-00015970: 7370 6163 6520 6265 7477 656e 2072 6f77  space betwen row
-00015980: 730a 2020 2020 6669 672e 7375 6270 6c6f  s.    fig.subplo
-00015990: 7473 5f61 646a 7573 7428 7773 7061 6365  ts_adjust(wspace
-000159a0: 3d30 2e35 2920 2323 2320 5468 6973 2063  =0.5) ### This c
-000159b0: 6f6e 7472 6f6c 7320 7468 6520 7370 6163  ontrols the spac
-000159c0: 6520 6265 7477 6565 6e20 636f 6c75 6d6e  e between column
-000159d0: 730a 2020 2020 636f 756e 7465 7220 3d20  s.    counter = 
-000159e0: 300a 2020 2020 6966 2072 6f77 7320 3d3d  0.    if rows ==
-000159f0: 2031 3a0a 2020 2020 2020 2020 6178 203d   1:.        ax =
-00015a00: 2061 782e 7265 7368 6170 6528 2d31 2c31   ax.reshape(-1,1
-00015a10: 292e 540a 2020 2020 666f 7220 6b20 696e  ).T.    for k in
-00015a20: 206e 702e 6172 616e 6765 2872 6f77 7329   np.arange(rows)
-00015a30: 3a0a 2020 2020 2020 2020 666f 7220 6c20  :.        for l 
-00015a40: 696e 206e 702e 6172 616e 6765 2863 6f6c  in np.arange(col
-00015a50: 7573 293a 0a20 2020 2020 2020 2020 2020  us):.           
-00015a60: 2069 6620 636f 756e 7465 7220 3c20 6c65   if counter < le
-00015a70: 6e28 6273 745f 6d6f 6465 6c73 293a 0a20  n(bst_models):. 
-00015a80: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00015a90: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00015aa0: 2020 2020 2020 2020 6273 745f 626f 6f73          bst_boos
-00015ab0: 7465 7220 3d20 6273 745f 6d6f 6465 6c73  ter = bst_models
-00015ac0: 5b63 6f75 6e74 6572 5d0a 2020 2020 2020  [counter].      
-00015ad0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00015ae0: 3120 3d20 7867 626f 6f73 742e 706c 6f74  1 = xgboost.plot
-00015af0: 5f69 6d70 6f72 7461 6e63 6528 6273 745f  _importance(bst_
-00015b00: 626f 6f73 7465 722c 2068 6569 6768 743d  booster, height=
-00015b10: 302e 382c 2073 686f 775f 7661 6c75 6573  0.8, show_values
-00015b20: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00015b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b40: 2020 2020 696d 706f 7274 616e 6365 5f74      importance_t
-00015b50: 7970 653d 2767 6169 6e27 2c20 6d61 785f  ype='gain', max_
-00015b60: 6e75 6d5f 6665 6174 7572 6573 3d31 302c  num_features=10,
-00015b70: 2061 783d 6178 5b6b 5d5b 6c5d 290a 2020   ax=ax[k][l]).  
-00015b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b90: 2020 6178 312e 7365 745f 7469 746c 6528    ax1.set_title(
-00015ba0: 2754 6f70 2031 3020 6665 6174 7572 6573  'Top 10 features
-00015bb0: 2077 6974 6820 5847 4220 6d6f 6465 6c20   with XGB model 
-00015bc0: 2573 2720 2528 636f 756e 7465 722b 3129  %s' %(counter+1)
-00015bd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015be0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00015c00: 7373 0a20 2020 2020 2020 2020 2020 2063  ss.            c
-00015c10: 6f75 6e74 6572 202b 3d20 310a 2020 2020  ounter += 1.    
-00015c20: 706c 742e 7368 6f77 2829 3b0a 2323 2323  plt.show();.####
-00015c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015c50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015880: 2323 2323 2323 230a 6465 6620 6472 6177  #######.def draw
+00015890: 5f66 6561 7475 7265 5f69 6d70 6f72 7461  _feature_importa
+000158a0: 6e63 6573 5f73 696e 676c 655f 6c61 6265  nces_single_labe
+000158b0: 6c28 6273 745f 6d6f 6465 6c73 2c20 6461  l(bst_models, da
+000158c0: 736b 5f78 6762 6f6f 7374 5f66 6c61 673d  sk_xgboost_flag=
+000158d0: 4661 6c73 6529 3a0a 2020 2020 726f 7773  False):.    rows
+000158e0: 203d 2069 6e74 286c 656e 2862 7374 5f6d   = int(len(bst_m
+000158f0: 6f64 656c 7329 2f32 202b 2030 2e35 290a  odels)/2 + 0.5).
+00015900: 2020 2020 636f 6c75 7320 3d20 320a 2020      colus = 2.  
+00015910: 2020 6669 672c 2061 7820 3d20 706c 742e    fig, ax = plt.
+00015920: 7375 6270 6c6f 7473 2872 6f77 732c 2063  subplots(rows, c
+00015930: 6f6c 7573 290a 2020 2020 6669 672e 7365  olus).    fig.se
+00015940: 745f 7369 7a65 5f69 6e63 6865 7328 6d69  t_size_inches(mi
+00015950: 6e28 636f 6c75 732a 352c 3230 292c 726f  n(colus*5,20),ro
+00015960: 7773 2a35 290a 2020 2020 6669 672e 7375  ws*5).    fig.su
+00015970: 6270 6c6f 7473 5f61 646a 7573 7428 6873  bplots_adjust(hs
+00015980: 7061 6365 3d30 2e35 2920 2323 2320 5468  pace=0.5) ### Th
+00015990: 6973 2063 6f6e 7472 6f6c 7320 7468 6520  is controls the 
+000159a0: 7370 6163 6520 6265 7477 656e 2072 6f77  space betwen row
+000159b0: 730a 2020 2020 6669 672e 7375 6270 6c6f  s.    fig.subplo
+000159c0: 7473 5f61 646a 7573 7428 7773 7061 6365  ts_adjust(wspace
+000159d0: 3d30 2e35 2920 2323 2320 5468 6973 2063  =0.5) ### This c
+000159e0: 6f6e 7472 6f6c 7320 7468 6520 7370 6163  ontrols the spac
+000159f0: 6520 6265 7477 6565 6e20 636f 6c75 6d6e  e between column
+00015a00: 730a 2020 2020 636f 756e 7465 7220 3d20  s.    counter = 
+00015a10: 300a 2020 2020 6966 2072 6f77 7320 3d3d  0.    if rows ==
+00015a20: 2031 3a0a 2020 2020 2020 2020 6178 203d   1:.        ax =
+00015a30: 2061 782e 7265 7368 6170 6528 2d31 2c31   ax.reshape(-1,1
+00015a40: 292e 540a 2020 2020 666f 7220 6b20 696e  ).T.    for k in
+00015a50: 206e 702e 6172 616e 6765 2872 6f77 7329   np.arange(rows)
+00015a60: 3a0a 2020 2020 2020 2020 666f 7220 6c20  :.        for l 
+00015a70: 696e 206e 702e 6172 616e 6765 2863 6f6c  in np.arange(col
+00015a80: 7573 293a 0a20 2020 2020 2020 2020 2020  us):.           
+00015a90: 2069 6620 636f 756e 7465 7220 3c20 6c65   if counter < le
+00015aa0: 6e28 6273 745f 6d6f 6465 6c73 293a 0a20  n(bst_models):. 
+00015ab0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00015ac0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00015ad0: 2020 2020 2020 2020 6273 745f 626f 6f73          bst_boos
+00015ae0: 7465 7220 3d20 6273 745f 6d6f 6465 6c73  ter = bst_models
+00015af0: 5b63 6f75 6e74 6572 5d0a 2020 2020 2020  [counter].      
+00015b00: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00015b10: 3120 3d20 7867 626f 6f73 742e 706c 6f74  1 = xgboost.plot
+00015b20: 5f69 6d70 6f72 7461 6e63 6528 6273 745f  _importance(bst_
+00015b30: 626f 6f73 7465 722c 2068 6569 6768 743d  booster, height=
+00015b40: 302e 382c 2073 686f 775f 7661 6c75 6573  0.8, show_values
+00015b50: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00015b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b70: 2020 2020 696d 706f 7274 616e 6365 5f74      importance_t
+00015b80: 7970 653d 2767 6169 6e27 2c20 6d61 785f  ype='gain', max_
+00015b90: 6e75 6d5f 6665 6174 7572 6573 3d31 302c  num_features=10,
+00015ba0: 2061 783d 6178 5b6b 5d5b 6c5d 290a 2020   ax=ax[k][l]).  
+00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bc0: 2020 6178 312e 7365 745f 7469 746c 6528    ax1.set_title(
+00015bd0: 2754 6f70 2031 3020 6665 6174 7572 6573  'Top 10 features
+00015be0: 2077 6974 6820 5847 4220 6d6f 6465 6c20   with XGB model 
+00015bf0: 2573 2720 2528 636f 756e 7465 722b 3129  %s' %(counter+1)
+00015c00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015c10: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+00015c20: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00015c30: 7373 0a20 2020 2020 2020 2020 2020 2063  ss.            c
+00015c40: 6f75 6e74 6572 202b 3d20 310a 2020 2020  ounter += 1.    
+00015c50: 706c 742e 7368 6f77 2829 3b0a 2323 2323  plt.show();.####
 00015c60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00015c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015c80: 2323 0a64 6566 2072 6564 7563 655f 6d65  ##.def reduce_me
-00015c90: 6d5f 7573 6167 6528 6466 293a 0a20 2020  m_usage(df):.   
-00015ca0: 2022 2222 0a20 2020 2023 2323 2323 2323   """.    #######
-00015cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015ce0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-00015cf0: 2020 2047 7265 6174 6c79 2069 6e64 6562     Greatly indeb
-00015d00: 7465 6420 746f 203a 0a20 2020 2068 7474  ted to :.    htt
-00015d10: 7073 3a2f 2f77 7777 2e6b 6167 676c 652e  ps://www.kaggle.
-00015d20: 636f 6d2f 6172 6a61 6e73 6f2f 7265 6475  com/arjanso/redu
-00015d30: 6369 6e67 2d64 6174 6166 7261 6d65 2d6d  cing-dataframe-m
-00015d40: 656d 6f72 792d 7369 7a65 2d62 792d 3635  emory-size-by-65
-00015d50: 0a20 2020 2020 2020 2066 6f72 2074 6869  .        for thi
-00015d60: 7320 6675 6e63 7469 6f6e 2074 6f20 7265  s function to re
-00015d70: 6475 6365 206d 656d 6f72 7920 7573 6167  duce memory usag
-00015d80: 652e 0a20 2020 2023 2323 2323 2323 2323  e..    #########
-00015d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015da0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015dc0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
-00015dd0: 2049 7420 6973 2061 2062 6974 2073 6c6f   It is a bit slo
-00015de0: 7720 6173 2069 7420 6974 6572 6174 6573  w as it iterates
-00015df0: 2074 6872 6f75 6768 2061 6c6c 2074 6865   through all the
-00015e00: 2063 6f6c 756d 6e73 206f 6620 6120 6461   columns of a da
-00015e10: 7461 6672 616d 6520 616e 6420 6d6f 6469  taframe and modi
-00015e20: 6669 6573 2064 6174 6120 7479 7065 730a  fies data types.
-00015e30: 2020 2020 2020 2020 746f 2072 6564 7563          to reduc
-00015e40: 6520 6d65 6d6f 7279 2075 7361 6765 2e20  e memory usage. 
-00015e50: 4275 7420 6974 2068 6173 2062 6565 6e20  But it has been 
-00015e60: 7368 6f77 6e20 746f 2072 6564 7563 6520  shown to reduce 
-00015e70: 6d65 6d6f 7279 2075 7361 6765 2062 7920  memory usage by 
-00015e80: 3635 2520 6f72 2073 6f2e 2020 2020 2020  65% or so.      
-00015e90: 200a 2020 2020 2222 220a 2020 2020 7374   .    """.    st
-00015ea0: 6172 745f 6d65 6d20 3d20 6466 2e6d 656d  art_mem = df.mem
-00015eb0: 6f72 795f 7573 6167 6528 292e 7375 6d28  ory_usage().sum(
-00015ec0: 2920 2f20 3130 3234 2a2a 320a 2020 2020  ) / 1024**2.    
-00015ed0: 6966 2074 7970 6528 6466 2920 3d3d 2064  if type(df) == d
-00015ee0: 6173 6b2e 6461 7461 6672 616d 652e 636f  ask.dataframe.co
-00015ef0: 7265 2e44 6174 6146 7261 6d65 3a0a 2020  re.DataFrame:.  
-00015f00: 2020 2020 2020 7374 6172 745f 6d65 6d20        start_mem 
-00015f10: 3d20 7374 6172 745f 6d65 6d2e 636f 6d70  = start_mem.comp
-00015f20: 7574 6528 290a 2020 2020 7072 696e 7428  ute().    print(
-00015f30: 2720 2020 2043 6175 7469 6f6e 3a20 5765  '    Caution: We
-00015f40: 2077 696c 6c20 7472 7920 746f 2072 6564   will try to red
-00015f50: 7563 6520 7468 6520 6d65 6d6f 7279 2075  uce the memory u
-00015f60: 7361 6765 206f 6620 6461 7461 6672 616d  sage of datafram
-00015f70: 6520 6672 6f6d 207b 3a2e 3266 7d20 4d42  e from {:.2f} MB
-00015f80: 272e 666f 726d 6174 2873 7461 7274 5f6d  '.format(start_m
-00015f90: 656d 2929 0a20 2020 2063 6f6c 7320 3d20  em)).    cols = 
-00015fa0: 6466 2e63 6f6c 756d 6e73 0a20 2020 2069  df.columns.    i
-00015fb0: 6620 7479 7065 2864 6629 203d 3d20 6461  f type(df) == da
-00015fc0: 736b 2e64 6174 6166 7261 6d65 2e63 6f72  sk.dataframe.cor
-00015fd0: 652e 4461 7461 4672 616d 653a 0a20 2020  e.DataFrame:.   
-00015fe0: 2020 2020 2063 6f6c 7320 3d20 636f 6c73       cols = cols
-00015ff0: 2e74 6f6c 6973 7428 290a 0a20 2020 2066  .tolist()..    f
-00016000: 6f72 2063 6f6c 2069 6e20 636f 6c73 3a0a  or col in cols:.
-00016010: 2020 2020 2020 2020 636f 6c5f 7479 7065          col_type
-00016020: 203d 2064 665b 636f 6c5d 2e64 7479 7065   = df[col].dtype
-00016030: 0a20 2020 2020 2020 2069 6620 636f 6c5f  .        if col_
-00016040: 7479 7065 2021 3d20 6f62 6a65 6374 3a0a  type != object:.
-00016050: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00016060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016070: 2063 5f6d 696e 203d 2064 665b 636f 6c5d   c_min = df[col]
-00016080: 2e6d 696e 2829 0a20 2020 2020 2020 2020  .min().         
-00016090: 2020 2020 2020 2063 5f6d 6178 203d 2064         c_max = d
-000160a0: 665b 636f 6c5d 2e6d 6178 2829 0a20 2020  f[col].max().   
-000160b0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-000160c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000160d0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-000160e0: 2020 2020 2020 6966 2074 7970 6528 6466        if type(df
-000160f0: 2920 3d3d 2064 6173 6b2e 6461 7461 6672  ) == dask.datafr
-00016100: 616d 652e 636f 7265 2e44 6174 6146 7261  ame.core.DataFra
-00016110: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00016120: 2020 2020 635f 6d69 6e20 3d20 635f 6d69      c_min = c_mi
-00016130: 6e2e 636f 6d70 7574 6528 290a 2020 2020  n.compute().    
-00016140: 2020 2020 2020 2020 2020 2020 635f 6d61              c_ma
-00016150: 7820 3d20 635f 6d61 782e 636f 6d70 7574  x = c_max.comput
-00016160: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00016170: 6966 2073 7472 2863 6f6c 5f74 7970 6529  if str(col_type)
-00016180: 5b3a 335d 203d 3d20 2769 6e74 273a 0a20  [:3] == 'int':. 
-00016190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000161a0: 6620 635f 6d69 6e20 3e20 6e70 2e69 696e  f c_min > np.iin
-000161b0: 666f 286e 702e 696e 7438 292e 6d69 6e20  fo(np.int8).min 
-000161c0: 616e 6420 635f 6d61 7820 3c20 6e70 2e69  and c_max < np.i
-000161d0: 696e 666f 286e 702e 696e 7438 292e 6d61  info(np.int8).ma
-000161e0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-000161f0: 2020 2020 2020 2064 665b 636f 6c5d 203d         df[col] =
-00016200: 2064 665b 636f 6c5d 2e61 7374 7970 6528   df[col].astype(
-00016210: 6e70 2e69 6e74 3829 0a20 2020 2020 2020  np.int8).       
-00016220: 2020 2020 2020 2020 2065 6c69 6620 635f           elif c_
-00016230: 6d69 6e20 3e20 6e70 2e69 696e 666f 286e  min > np.iinfo(n
-00016240: 702e 696e 7431 3629 2e6d 696e 2061 6e64  p.int16).min and
-00016250: 2063 5f6d 6178 203c 206e 702e 6969 6e66   c_max < np.iinf
-00016260: 6f28 6e70 2e69 6e74 3136 292e 6d61 783a  o(np.int16).max:
-00016270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016280: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
-00016290: 665b 636f 6c5d 2e61 7374 7970 6528 6e70  f[col].astype(np
-000162a0: 2e69 6e74 3136 290a 2020 2020 2020 2020  .int16).        
-000162b0: 2020 2020 2020 2020 656c 6966 2063 5f6d          elif c_m
-000162c0: 696e 203e 206e 702e 6969 6e66 6f28 6e70  in > np.iinfo(np
-000162d0: 2e69 6e74 3332 292e 6d69 6e20 616e 6420  .int32).min and 
-000162e0: 635f 6d61 7820 3c20 6e70 2e69 696e 666f  c_max < np.iinfo
-000162f0: 286e 702e 696e 7433 3229 2e6d 6178 3a0a  (np.int32).max:.
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 2020 2020 6466 5b63 6f6c 5d20 3d20 6466      df[col] = df
-00016320: 5b63 6f6c 5d2e 6173 7479 7065 286e 702e  [col].astype(np.
-00016330: 696e 7433 3229 0a20 2020 2020 2020 2020  int32).         
-00016340: 2020 2020 2020 2065 6c69 6620 635f 6d69         elif c_mi
-00016350: 6e20 3e20 6e70 2e69 696e 666f 286e 702e  n > np.iinfo(np.
-00016360: 696e 7436 3429 2e6d 696e 2061 6e64 2063  int64).min and c
-00016370: 5f6d 6178 203c 206e 702e 6969 6e66 6f28  _max < np.iinfo(
-00016380: 6e70 2e69 6e74 3634 292e 6d61 783a 0a20  np.int64).max:. 
-00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163a0: 2020 2064 665b 636f 6c5d 203d 2064 665b     df[col] = df[
-000163b0: 636f 6c5d 2e61 7374 7970 6528 6e70 2e69  col].astype(np.i
-000163c0: 6e74 3634 2920 200a 2020 2020 2020 2020  nt64)  .        
-000163d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000163e0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-000163f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016400: 2020 2069 6620 635f 6d69 6e20 3e20 6e70     if c_min > np
-00016410: 2e66 696e 666f 286e 702e 666c 6f61 7431  .finfo(np.float1
-00016420: 3629 2e6d 696e 2061 6e64 2063 5f6d 6178  6).min and c_max
-00016430: 203c 206e 702e 6669 6e66 6f28 6e70 2e66   < np.finfo(np.f
-00016440: 6c6f 6174 3136 292e 6d61 783a 0a20 2020  loat16).max:.   
-00016450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016460: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
-00016470: 665b 636f 6c5d 2e61 7374 7970 6528 6e70  f[col].astype(np
-00016480: 2e66 6c6f 6174 3136 290a 2020 2020 2020  .float16).      
-00016490: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000164a0: 6966 2063 5f6d 696e 203e 206e 702e 6669  if c_min > np.fi
-000164b0: 6e66 6f28 6e70 2e66 6c6f 6174 3332 292e  nfo(np.float32).
-000164c0: 6d69 6e20 616e 6420 635f 6d61 7820 3c20  min and c_max < 
-000164d0: 6e70 2e66 696e 666f 286e 702e 666c 6f61  np.finfo(np.floa
-000164e0: 7433 3229 2e6d 6178 3a0a 2020 2020 2020  t32).max:.      
-000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016500: 2020 6466 5b63 6f6c 5d20 3d20 6466 5b63    df[col] = df[c
-00016510: 6f6c 5d2e 6173 7479 7065 286e 702e 666c  ol].astype(np.fl
-00016520: 6f61 7433 3229 0a20 2020 2020 2020 2020  oat32).         
-00016530: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00016540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016550: 2020 2020 2020 2020 2064 665b 636f 6c5d           df[col]
-00016560: 203d 2064 665b 636f 6c5d 2e61 7374 7970   = df[col].astyp
-00016570: 6528 6e70 2e66 6c6f 6174 3634 290a 2020  e(np.float64).  
-00016580: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00016590: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-000165a0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000165b0: 7565 0a20 2020 2020 2020 2065 6c73 653a  ue.        else:
-000165c0: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
-000165d0: 636f 6c5d 203d 2064 665b 636f 6c5d 2e61  col] = df[col].a
-000165e0: 7374 7970 6528 2763 6174 6567 6f72 7927  stype('category'
-000165f0: 290a 0a20 2020 2023 2323 2323 2323 2020  )..    #######  
-00016600: 5265 7375 6c74 7320 6166 7465 7220 6d65  Results after me
-00016610: 6d6f 7279 2075 7361 6765 2066 756e 6374  mory usage funct
-00016620: 696f 6e20 2323 2323 2323 2323 2323 2323  ion ############
-00016630: 2323 2323 2323 230a 2020 2020 656e 645f  #######.    end_
-00016640: 6d65 6d20 3d20 6466 2e6d 656d 6f72 795f  mem = df.memory_
-00016650: 7573 6167 6528 292e 7375 6d28 2920 2f20  usage().sum() / 
-00016660: 3130 3234 2a2a 320a 2020 2020 6966 2074  1024**2.    if t
-00016670: 7970 6528 6466 2920 3d3d 2064 6173 6b2e  ype(df) == dask.
-00016680: 6461 7461 6672 616d 652e 636f 7265 2e44  dataframe.core.D
-00016690: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
-000166a0: 2020 656e 645f 6d65 6d20 3d20 656e 645f    end_mem = end_
-000166b0: 6d65 6d2e 636f 6d70 7574 6528 290a 2020  mem.compute().  
-000166c0: 2020 7072 696e 7428 2720 2020 2020 2020    print('       
-000166d0: 206d 656d 6f72 7920 7573 6167 6520 6166   memory usage af
-000166e0: 7465 7220 6f70 7469 6d69 7a61 7469 6f6e  ter optimization
-000166f0: 2069 733a 207b 3a2e 3266 7d20 4d42 272e   is: {:.2f} MB'.
-00016700: 666f 726d 6174 2865 6e64 5f6d 656d 2929  format(end_mem))
-00016710: 0a20 2020 2070 7269 6e74 2827 2020 2020  .    print('    
-00016720: 2020 2020 6465 6372 6561 7365 6420 6279      decreased by
-00016730: 207b 3a2e 3166 7d25 272e 666f 726d 6174   {:.1f}%'.format
-00016740: 2831 3030 202a 2028 7374 6172 745f 6d65  (100 * (start_me
-00016750: 6d20 2d20 656e 645f 6d65 6d29 202f 2073  m - end_mem) / s
-00016760: 7461 7274 5f6d 656d 2929 0a20 2020 200a  tart_mem)).    .
-00016770: 2020 2020 7265 7475 726e 2064 660a 2323      return df.##
+00015c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015cb0: 2323 0a64 6566 2072 6564 7563 655f 6d65  ##.def reduce_me
+00015cc0: 6d5f 7573 6167 6528 6466 293a 0a20 2020  m_usage(df):.   
+00015cd0: 2022 2222 0a20 2020 2023 2323 2323 2323   """.    #######
+00015ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015d10: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+00015d20: 2020 2047 7265 6174 6c79 2069 6e64 6562     Greatly indeb
+00015d30: 7465 6420 746f 203a 0a20 2020 2068 7474  ted to :.    htt
+00015d40: 7073 3a2f 2f77 7777 2e6b 6167 676c 652e  ps://www.kaggle.
+00015d50: 636f 6d2f 6172 6a61 6e73 6f2f 7265 6475  com/arjanso/redu
+00015d60: 6369 6e67 2d64 6174 6166 7261 6d65 2d6d  cing-dataframe-m
+00015d70: 656d 6f72 792d 7369 7a65 2d62 792d 3635  emory-size-by-65
+00015d80: 0a20 2020 2020 2020 2066 6f72 2074 6869  .        for thi
+00015d90: 7320 6675 6e63 7469 6f6e 2074 6f20 7265  s function to re
+00015da0: 6475 6365 206d 656d 6f72 7920 7573 6167  duce memory usag
+00015db0: 652e 0a20 2020 2023 2323 2323 2323 2323  e..    #########
+00015dc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015dd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015de0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00015df0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00015e00: 2049 7420 6973 2061 2062 6974 2073 6c6f   It is a bit slo
+00015e10: 7720 6173 2069 7420 6974 6572 6174 6573  w as it iterates
+00015e20: 2074 6872 6f75 6768 2061 6c6c 2074 6865   through all the
+00015e30: 2063 6f6c 756d 6e73 206f 6620 6120 6461   columns of a da
+00015e40: 7461 6672 616d 6520 616e 6420 6d6f 6469  taframe and modi
+00015e50: 6669 6573 2064 6174 6120 7479 7065 730a  fies data types.
+00015e60: 2020 2020 2020 2020 746f 2072 6564 7563          to reduc
+00015e70: 6520 6d65 6d6f 7279 2075 7361 6765 2e20  e memory usage. 
+00015e80: 4275 7420 6974 2068 6173 2062 6565 6e20  But it has been 
+00015e90: 7368 6f77 6e20 746f 2072 6564 7563 6520  shown to reduce 
+00015ea0: 6d65 6d6f 7279 2075 7361 6765 2062 7920  memory usage by 
+00015eb0: 3635 2520 6f72 2073 6f2e 2020 2020 2020  65% or so.      
+00015ec0: 200a 2020 2020 2222 220a 2020 2020 7374   .    """.    st
+00015ed0: 6172 745f 6d65 6d20 3d20 6466 2e6d 656d  art_mem = df.mem
+00015ee0: 6f72 795f 7573 6167 6528 292e 7375 6d28  ory_usage().sum(
+00015ef0: 2920 2f20 3130 3234 2a2a 320a 2020 2020  ) / 1024**2.    
+00015f00: 6966 2074 7970 6528 6466 2920 3d3d 2064  if type(df) == d
+00015f10: 6173 6b2e 6461 7461 6672 616d 652e 636f  ask.dataframe.co
+00015f20: 7265 2e44 6174 6146 7261 6d65 3a0a 2020  re.DataFrame:.  
+00015f30: 2020 2020 2020 7374 6172 745f 6d65 6d20        start_mem 
+00015f40: 3d20 7374 6172 745f 6d65 6d2e 636f 6d70  = start_mem.comp
+00015f50: 7574 6528 290a 2020 2020 7072 696e 7428  ute().    print(
+00015f60: 2720 2020 2043 6175 7469 6f6e 3a20 5765  '    Caution: We
+00015f70: 2077 696c 6c20 7472 7920 746f 2072 6564   will try to red
+00015f80: 7563 6520 7468 6520 6d65 6d6f 7279 2075  uce the memory u
+00015f90: 7361 6765 206f 6620 6461 7461 6672 616d  sage of datafram
+00015fa0: 6520 6672 6f6d 207b 3a2e 3266 7d20 4d42  e from {:.2f} MB
+00015fb0: 272e 666f 726d 6174 2873 7461 7274 5f6d  '.format(start_m
+00015fc0: 656d 2929 0a20 2020 2063 6f6c 7320 3d20  em)).    cols = 
+00015fd0: 6466 2e63 6f6c 756d 6e73 0a20 2020 2069  df.columns.    i
+00015fe0: 6620 7479 7065 2864 6629 203d 3d20 6461  f type(df) == da
+00015ff0: 736b 2e64 6174 6166 7261 6d65 2e63 6f72  sk.dataframe.cor
+00016000: 652e 4461 7461 4672 616d 653a 0a20 2020  e.DataFrame:.   
+00016010: 2020 2020 2063 6f6c 7320 3d20 636f 6c73       cols = cols
+00016020: 2e74 6f6c 6973 7428 290a 0a20 2020 2066  .tolist()..    f
+00016030: 6f72 2063 6f6c 2069 6e20 636f 6c73 3a0a  or col in cols:.
+00016040: 2020 2020 2020 2020 636f 6c5f 7479 7065          col_type
+00016050: 203d 2064 665b 636f 6c5d 2e64 7479 7065   = df[col].dtype
+00016060: 0a20 2020 2020 2020 2069 6620 636f 6c5f  .        if col_
+00016070: 7479 7065 2021 3d20 6f62 6a65 6374 3a0a  type != object:.
+00016080: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00016090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000160a0: 2063 5f6d 696e 203d 2064 665b 636f 6c5d   c_min = df[col]
+000160b0: 2e6d 696e 2829 0a20 2020 2020 2020 2020  .min().         
+000160c0: 2020 2020 2020 2063 5f6d 6178 203d 2064         c_max = d
+000160d0: 665b 636f 6c5d 2e6d 6178 2829 0a20 2020  f[col].max().   
+000160e0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+000160f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016100: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00016110: 2020 2020 2020 6966 2074 7970 6528 6466        if type(df
+00016120: 2920 3d3d 2064 6173 6b2e 6461 7461 6672  ) == dask.datafr
+00016130: 616d 652e 636f 7265 2e44 6174 6146 7261  ame.core.DataFra
+00016140: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00016150: 2020 2020 635f 6d69 6e20 3d20 635f 6d69      c_min = c_mi
+00016160: 6e2e 636f 6d70 7574 6528 290a 2020 2020  n.compute().    
+00016170: 2020 2020 2020 2020 2020 2020 635f 6d61              c_ma
+00016180: 7820 3d20 635f 6d61 782e 636f 6d70 7574  x = c_max.comput
+00016190: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000161a0: 6966 2073 7472 2863 6f6c 5f74 7970 6529  if str(col_type)
+000161b0: 5b3a 335d 203d 3d20 2769 6e74 273a 0a20  [:3] == 'int':. 
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000161d0: 6620 635f 6d69 6e20 3e20 6e70 2e69 696e  f c_min > np.iin
+000161e0: 666f 286e 702e 696e 7438 292e 6d69 6e20  fo(np.int8).min 
+000161f0: 616e 6420 635f 6d61 7820 3c20 6e70 2e69  and c_max < np.i
+00016200: 696e 666f 286e 702e 696e 7438 292e 6d61  info(np.int8).ma
+00016210: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00016220: 2020 2020 2020 2064 665b 636f 6c5d 203d         df[col] =
+00016230: 2064 665b 636f 6c5d 2e61 7374 7970 6528   df[col].astype(
+00016240: 6e70 2e69 6e74 3829 0a20 2020 2020 2020  np.int8).       
+00016250: 2020 2020 2020 2020 2065 6c69 6620 635f           elif c_
+00016260: 6d69 6e20 3e20 6e70 2e69 696e 666f 286e  min > np.iinfo(n
+00016270: 702e 696e 7431 3629 2e6d 696e 2061 6e64  p.int16).min and
+00016280: 2063 5f6d 6178 203c 206e 702e 6969 6e66   c_max < np.iinf
+00016290: 6f28 6e70 2e69 6e74 3136 292e 6d61 783a  o(np.int16).max:
+000162a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000162b0: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
+000162c0: 665b 636f 6c5d 2e61 7374 7970 6528 6e70  f[col].astype(np
+000162d0: 2e69 6e74 3136 290a 2020 2020 2020 2020  .int16).        
+000162e0: 2020 2020 2020 2020 656c 6966 2063 5f6d          elif c_m
+000162f0: 696e 203e 206e 702e 6969 6e66 6f28 6e70  in > np.iinfo(np
+00016300: 2e69 6e74 3332 292e 6d69 6e20 616e 6420  .int32).min and 
+00016310: 635f 6d61 7820 3c20 6e70 2e69 696e 666f  c_max < np.iinfo
+00016320: 286e 702e 696e 7433 3229 2e6d 6178 3a0a  (np.int32).max:.
+00016330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016340: 2020 2020 6466 5b63 6f6c 5d20 3d20 6466      df[col] = df
+00016350: 5b63 6f6c 5d2e 6173 7479 7065 286e 702e  [col].astype(np.
+00016360: 696e 7433 3229 0a20 2020 2020 2020 2020  int32).         
+00016370: 2020 2020 2020 2065 6c69 6620 635f 6d69         elif c_mi
+00016380: 6e20 3e20 6e70 2e69 696e 666f 286e 702e  n > np.iinfo(np.
+00016390: 696e 7436 3429 2e6d 696e 2061 6e64 2063  int64).min and c
+000163a0: 5f6d 6178 203c 206e 702e 6969 6e66 6f28  _max < np.iinfo(
+000163b0: 6e70 2e69 6e74 3634 292e 6d61 783a 0a20  np.int64).max:. 
+000163c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163d0: 2020 2064 665b 636f 6c5d 203d 2064 665b     df[col] = df[
+000163e0: 636f 6c5d 2e61 7374 7970 6528 6e70 2e69  col].astype(np.i
+000163f0: 6e74 3634 2920 200a 2020 2020 2020 2020  nt64)  .        
+00016400: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00016410: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00016420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016430: 2020 2069 6620 635f 6d69 6e20 3e20 6e70     if c_min > np
+00016440: 2e66 696e 666f 286e 702e 666c 6f61 7431  .finfo(np.float1
+00016450: 3629 2e6d 696e 2061 6e64 2063 5f6d 6178  6).min and c_max
+00016460: 203c 206e 702e 6669 6e66 6f28 6e70 2e66   < np.finfo(np.f
+00016470: 6c6f 6174 3136 292e 6d61 783a 0a20 2020  loat16).max:.   
+00016480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016490: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
+000164a0: 665b 636f 6c5d 2e61 7374 7970 6528 6e70  f[col].astype(np
+000164b0: 2e66 6c6f 6174 3136 290a 2020 2020 2020  .float16).      
+000164c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000164d0: 6966 2063 5f6d 696e 203e 206e 702e 6669  if c_min > np.fi
+000164e0: 6e66 6f28 6e70 2e66 6c6f 6174 3332 292e  nfo(np.float32).
+000164f0: 6d69 6e20 616e 6420 635f 6d61 7820 3c20  min and c_max < 
+00016500: 6e70 2e66 696e 666f 286e 702e 666c 6f61  np.finfo(np.floa
+00016510: 7433 3229 2e6d 6178 3a0a 2020 2020 2020  t32).max:.      
+00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016530: 2020 6466 5b63 6f6c 5d20 3d20 6466 5b63    df[col] = df[c
+00016540: 6f6c 5d2e 6173 7479 7065 286e 702e 666c  ol].astype(np.fl
+00016550: 6f61 7433 3229 0a20 2020 2020 2020 2020  oat32).         
+00016560: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00016570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016580: 2020 2020 2020 2020 2064 665b 636f 6c5d           df[col]
+00016590: 203d 2064 665b 636f 6c5d 2e61 7374 7970   = df[col].astyp
+000165a0: 6528 6e70 2e66 6c6f 6174 3634 290a 2020  e(np.float64).  
+000165b0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000165c0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+000165d0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000165e0: 7565 0a20 2020 2020 2020 2065 6c73 653a  ue.        else:
+000165f0: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00016600: 636f 6c5d 203d 2064 665b 636f 6c5d 2e61  col] = df[col].a
+00016610: 7374 7970 6528 2763 6174 6567 6f72 7927  stype('category'
+00016620: 290a 0a20 2020 2023 2323 2323 2323 2020  )..    #######  
+00016630: 5265 7375 6c74 7320 6166 7465 7220 6d65  Results after me
+00016640: 6d6f 7279 2075 7361 6765 2066 756e 6374  mory usage funct
+00016650: 696f 6e20 2323 2323 2323 2323 2323 2323  ion ############
+00016660: 2323 2323 2323 230a 2020 2020 656e 645f  #######.    end_
+00016670: 6d65 6d20 3d20 6466 2e6d 656d 6f72 795f  mem = df.memory_
+00016680: 7573 6167 6528 292e 7375 6d28 2920 2f20  usage().sum() / 
+00016690: 3130 3234 2a2a 320a 2020 2020 6966 2074  1024**2.    if t
+000166a0: 7970 6528 6466 2920 3d3d 2064 6173 6b2e  ype(df) == dask.
+000166b0: 6461 7461 6672 616d 652e 636f 7265 2e44  dataframe.core.D
+000166c0: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+000166d0: 2020 656e 645f 6d65 6d20 3d20 656e 645f    end_mem = end_
+000166e0: 6d65 6d2e 636f 6d70 7574 6528 290a 2020  mem.compute().  
+000166f0: 2020 7072 696e 7428 6627 2020 2020 2020    print(f'      
+00016700: 2020 6279 207b 2831 3030 202a 2028 7374    by {(100 * (st
+00016710: 6172 745f 6d65 6d20 2d20 656e 645f 6d65  art_mem - end_me
+00016720: 6d29 202f 2073 7461 7274 5f6d 656d 293a  m) / start_mem):
+00016730: 2e31 667d 252e 204d 656d 6f72 7920 7573  .1f}%. Memory us
+00016740: 6167 6520 6166 7465 7220 6973 3a20 7b65  age after is: {e
+00016750: 6e64 5f6d 656d 3a2e 3266 7d20 4d42 2729  nd_mem:.2f} MB')
+00016760: 2020 2020 0a20 2020 2072 6574 7572 6e20      .    return 
+00016770: 6466 0a23 2323 2323 2323 2323 2323 2323  df.#############
 00016780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000167a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000167b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000167c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000167d0: 0a64 6566 2046 455f 7374 6172 745f 656e  .def FE_start_en
-000167e0: 645f 6461 7465 5f74 696d 655f 6665 6174  d_date_time_feat
-000167f0: 7572 6573 2873 6d61 6c6c 6466 2c20 7374  ures(smalldf, st
-00016800: 6172 7454 696d 652c 2065 6e64 5469 6d65  artTime, endTime
-00016810: 2c20 7370 6c69 7474 6572 5f64 6174 655f  , splitter_date_
-00016820: 7374 7269 6e67 3d22 2f22 2c73 706c 6974  string="/",split
-00016830: 7465 725f 686f 7572 5f73 7472 696e 673d  ter_hour_string=
-00016840: 223a 2229 3a0a 2020 2020 2222 220a 2020  ":"):.    """.  
-00016850: 2020 4645 2073 7461 6e64 7320 666f 7220    FE stands for 
-00016860: 4665 6174 7572 6520 456e 6769 6e65 6572  Feature Engineer
-00016870: 696e 6720 2d20 6974 206d 6561 6e73 2074  ing - it means t
-00016880: 6869 7320 6675 6e63 7469 6f6e 2070 6572  his function per
-00016890: 666f 726d 7320 6665 6174 7572 6520 656e  forms feature en
-000168a0: 6769 6e65 6572 696e 670a 2020 2020 2323  gineering.    ##
+000167c0: 2323 2323 230a 6465 6620 4645 5f73 7461  #####.def FE_sta
+000167d0: 7274 5f65 6e64 5f64 6174 655f 7469 6d65  rt_end_date_time
+000167e0: 5f66 6561 7475 7265 7328 736d 616c 6c64  _features(smalld
+000167f0: 662c 2073 7461 7274 5469 6d65 2c20 656e  f, startTime, en
+00016800: 6454 696d 652c 2073 706c 6974 7465 725f  dTime, splitter_
+00016810: 6461 7465 5f73 7472 696e 673d 222f 222c  date_string="/",
+00016820: 7370 6c69 7474 6572 5f68 6f75 725f 7374  splitter_hour_st
+00016830: 7269 6e67 3d22 3a22 293a 0a20 2020 2022  ring=":"):.    "
+00016840: 2222 0a20 2020 2046 4520 7374 616e 6473  "".    FE stands
+00016850: 2066 6f72 2046 6561 7475 7265 2045 6e67   for Feature Eng
+00016860: 696e 6565 7269 6e67 202d 2069 7420 6d65  ineering - it me
+00016870: 616e 7320 7468 6973 2066 756e 6374 696f  ans this functio
+00016880: 6e20 7065 7266 6f72 6d73 2066 6561 7475  n performs featu
+00016890: 7265 2065 6e67 696e 6565 7269 6e67 0a20  re engineering. 
+000168a0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
 000168b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000168c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000168d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000168e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000168f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016900: 2323 2323 0a20 2020 2054 6869 7320 6675  ####.    This fu
-00016910: 6e63 7469 6f6e 2069 7320 7573 6564 2077  nction is used w
-00016920: 6865 6e20 796f 7520 6861 7665 2073 7461  hen you have sta
-00016930: 7274 2061 6e64 2065 6e64 2064 6174 6520  rt and end date 
-00016940: 7469 6d65 2073 7461 6d70 7320 696e 2079  time stamps in y
-00016950: 6f75 7220 6461 7461 7365 742e 0a20 2020  our dataset..   
-00016960: 2020 2020 202d 2049 6620 7468 6572 6520       - If there 
-00016970: 6973 206e 6f20 7374 6172 7420 616e 6420  is no start and 
-00016980: 656e 6420 7469 6d65 2066 6561 7475 7265  end time feature
-00016990: 732c 2064 6f6e 2774 2075 7365 2069 742e  s, don't use it.
-000169a0: 2042 6f74 6820 6d75 7374 2062 6520 7072   Both must be pr
-000169b0: 6573 656e 7421 0a20 2020 2020 2020 202d  esent!.        -
-000169c0: 2074 6869 7320 6d6f 6475 6c65 2077 696c   this module wil
-000169d0: 6c20 6372 6561 7465 2061 6464 6974 696f  l create additio
-000169e0: 6e61 6c20 6665 6174 7572 6573 2066 6f72  nal features for
-000169f0: 2073 7563 6820 6669 656c 6473 2e0a 2020   such fields..  
-00016a00: 2020 2020 2020 2d20 796f 7520 6d75 7374        - you must
-00016a10: 2070 726f 7669 6465 2061 2073 7461 7274   provide a start
-00016a20: 2064 6174 6520 7469 6d65 2073 7461 6d70   date time stamp
-00016a30: 2066 6965 6c64 2061 6e64 2061 6e20 656e   field and an en
-00016a40: 6420 6461 7465 2074 696d 6520 7374 616d  d date time stam
-00016a50: 7020 6669 656c 640a 2020 2020 4f74 6865  p field.    Othe
-00016a60: 7277 6973 652c 2079 6f75 2061 7265 2062  rwise, you are b
-00016a70: 6574 7465 7220 6f66 6620 7573 696e 6720  etter off using 
-00016a80: 7468 6520 4645 5f63 7265 6174 655f 6461  the FE_create_da
-00016a90: 7465 5f74 696d 655f 6665 6174 7572 6573  te_time_features
-00016aa0: 2829 206d 6f64 756c 6520 696e 2074 6869  () module in thi
-00016ab0: 7320 6c69 6272 6172 792e 0a0a 2020 2020  s library...    
-00016ac0: 496e 7075 7473 3a0a 2020 2020 736d 616c  Inputs:.    smal
-00016ad0: 6c64 663a 2044 6174 6166 7261 6d65 2063  ldf: Dataframe c
-00016ae0: 6f6e 7461 696e 696e 6720 796f 7572 2064  ontaining your d
-00016af0: 6174 6520 7469 6d65 2066 6965 6c64 730a  ate time fields.
-00016b00: 2020 2020 7374 6172 7454 696d 653a 2074      startTime: t
-00016b10: 6869 7320 6973 2068 6f70 6566 756c 6c79  his is hopefully
-00016b20: 2061 2073 7472 696e 6720 6669 656c 6420   a string field 
-00016b30: 7768 6963 6820 636f 6e76 6572 7473 2074  which converts t
-00016b40: 6f20 6120 6461 7465 2074 696d 6520 7374  o a date time st
-00016b50: 616d 7020 6561 7369 6c79 2e20 4d61 6b65  amp easily. Make
-00016b60: 2073 7572 6520 6974 2069 7320 6120 7374   sure it is a st
-00016b70: 7269 6e67 2e0a 2020 2020 656e 6454 696d  ring..    endTim
-00016b80: 653a 2074 6869 7320 616c 736f 206d 7573  e: this also mus
-00016b90: 7420 6265 2061 2073 7472 696e 6720 6669  t be a string fi
-00016ba0: 656c 6420 7768 6963 6820 636f 6e76 6572  eld which conver
-00016bb0: 7473 2074 6f20 6120 6461 7465 2074 696d  ts to a date tim
-00016bc0: 6520 7374 616d 7020 6561 7369 6c79 2e20  e stamp easily. 
-00016bd0: 4d61 6b65 2073 7572 6520 6974 2069 7320  Make sure it is 
-00016be0: 6120 7374 7269 6e67 2e0a 2020 2020 7370  a string..    sp
-00016bf0: 6c69 7474 6572 5f64 6174 655f 7374 7269  litter_date_stri
-00016c00: 6e67 3a20 7573 7561 6c6c 7920 7468 6572  ng: usually ther
-00016c10: 6520 6973 2061 2073 7472 696e 6720 7375  e is a string su
-00016c20: 6368 2061 7320 272f 2720 6f72 2027 2e27  ch as '/' or '.'
-00016c30: 2062 6574 7765 656e 2064 6179 2f6d 6f6e   between day/mon
-00016c40: 7468 2f79 6561 7220 6574 632e 2044 6566  th/year etc. Def
-00016c50: 6175 6c74 2069 7320 6173 7375 6d65 6420  ault is assumed 
-00016c60: 2f20 6865 7265 2e0a 2020 2020 7370 6c69  / here..    spli
-00016c70: 7474 6572 5f68 6f75 725f 7374 7269 6e67  tter_hour_string
-00016c80: 3a20 7573 7561 6c6c 7920 7468 6572 6520  : usually there 
-00016c90: 6973 2061 2073 7472 696e 6720 7375 6368  is a string such
-00016ca0: 2061 7320 273a 2720 6f72 2027 2e27 2062   as ':' or '.' b
-00016cb0: 6574 7765 656e 2068 6f75 723a 6d69 6e3a  etween hour:min:
-00016cc0: 7365 6320 6574 632e 2044 6566 6175 6c74  sec etc. Default
-00016cd0: 2069 7320 6173 7375 6d65 6420 3a20 6865   is assumed : he
-00016ce0: 7265 2e0a 0a20 2020 204f 7574 7075 7473  re...    Outputs
-00016cf0: 3a0a 2020 2020 5468 6520 6f72 6967 696e  :.    The origin
-00016d00: 616c 2070 616e 6461 7320 6461 7461 6672  al pandas datafr
-00016d10: 616d 6520 7769 7468 2061 6464 6974 696f  ame with additio
-00016d20: 6e61 6c20 6669 656c 6473 2063 7265 6174  nal fields creat
-00016d30: 6564 2062 7920 7370 6c69 7474 696e 6720  ed by splitting 
-00016d40: 7468 6520 7374 6172 7420 616e 6420 656e  the start and en
-00016d50: 6420 7469 6d65 2066 6965 6c64 730a 2020  d time fields.  
-00016d60: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+000168f0: 2323 2323 2323 2323 230a 2020 2020 5468  #########.    Th
+00016900: 6973 2066 756e 6374 696f 6e20 6973 2075  is function is u
+00016910: 7365 6420 7768 656e 2079 6f75 2068 6176  sed when you hav
+00016920: 6520 7374 6172 7420 616e 6420 656e 6420  e start and end 
+00016930: 6461 7465 2074 696d 6520 7374 616d 7073  date time stamps
+00016940: 2069 6e20 796f 7572 2064 6174 6173 6574   in your dataset
+00016950: 2e0a 2020 2020 2020 2020 2d20 4966 2074  ..        - If t
+00016960: 6865 7265 2069 7320 6e6f 2073 7461 7274  here is no start
+00016970: 2061 6e64 2065 6e64 2074 696d 6520 6665   and end time fe
+00016980: 6174 7572 6573 2c20 646f 6e27 7420 7573  atures, don't us
+00016990: 6520 6974 2e20 426f 7468 206d 7573 7420  e it. Both must 
+000169a0: 6265 2070 7265 7365 6e74 210a 2020 2020  be present!.    
+000169b0: 2020 2020 2d20 7468 6973 206d 6f64 756c      - this modul
+000169c0: 6520 7769 6c6c 2063 7265 6174 6520 6164  e will create ad
+000169d0: 6469 7469 6f6e 616c 2066 6561 7475 7265  ditional feature
+000169e0: 7320 666f 7220 7375 6368 2066 6965 6c64  s for such field
+000169f0: 732e 0a20 2020 2020 2020 202d 2079 6f75  s..        - you
+00016a00: 206d 7573 7420 7072 6f76 6964 6520 6120   must provide a 
+00016a10: 7374 6172 7420 6461 7465 2074 696d 6520  start date time 
+00016a20: 7374 616d 7020 6669 656c 6420 616e 6420  stamp field and 
+00016a30: 616e 2065 6e64 2064 6174 6520 7469 6d65  an end date time
+00016a40: 2073 7461 6d70 2066 6965 6c64 0a20 2020   stamp field.   
+00016a50: 204f 7468 6572 7769 7365 2c20 796f 7520   Otherwise, you 
+00016a60: 6172 6520 6265 7474 6572 206f 6666 2075  are better off u
+00016a70: 7369 6e67 2074 6865 2046 455f 6372 6561  sing the FE_crea
+00016a80: 7465 5f64 6174 655f 7469 6d65 5f66 6561  te_date_time_fea
+00016a90: 7475 7265 7328 2920 6d6f 6475 6c65 2069  tures() module i
+00016aa0: 6e20 7468 6973 206c 6962 7261 7279 2e0a  n this library..
+00016ab0: 0a20 2020 2049 6e70 7574 733a 0a20 2020  .    Inputs:.   
+00016ac0: 2073 6d61 6c6c 6466 3a20 4461 7461 6672   smalldf: Datafr
+00016ad0: 616d 6520 636f 6e74 6169 6e69 6e67 2079  ame containing y
+00016ae0: 6f75 7220 6461 7465 2074 696d 6520 6669  our date time fi
+00016af0: 656c 6473 0a20 2020 2073 7461 7274 5469  elds.    startTi
+00016b00: 6d65 3a20 7468 6973 2069 7320 686f 7065  me: this is hope
+00016b10: 6675 6c6c 7920 6120 7374 7269 6e67 2066  fully a string f
+00016b20: 6965 6c64 2077 6869 6368 2063 6f6e 7665  ield which conve
+00016b30: 7274 7320 746f 2061 2064 6174 6520 7469  rts to a date ti
+00016b40: 6d65 2073 7461 6d70 2065 6173 696c 792e  me stamp easily.
+00016b50: 204d 616b 6520 7375 7265 2069 7420 6973   Make sure it is
+00016b60: 2061 2073 7472 696e 672e 0a20 2020 2065   a string..    e
+00016b70: 6e64 5469 6d65 3a20 7468 6973 2061 6c73  ndTime: this als
+00016b80: 6f20 6d75 7374 2062 6520 6120 7374 7269  o must be a stri
+00016b90: 6e67 2066 6965 6c64 2077 6869 6368 2063  ng field which c
+00016ba0: 6f6e 7665 7274 7320 746f 2061 2064 6174  onverts to a dat
+00016bb0: 6520 7469 6d65 2073 7461 6d70 2065 6173  e time stamp eas
+00016bc0: 696c 792e 204d 616b 6520 7375 7265 2069  ily. Make sure i
+00016bd0: 7420 6973 2061 2073 7472 696e 672e 0a20  t is a string.. 
+00016be0: 2020 2073 706c 6974 7465 725f 6461 7465     splitter_date
+00016bf0: 5f73 7472 696e 673a 2075 7375 616c 6c79  _string: usually
+00016c00: 2074 6865 7265 2069 7320 6120 7374 7269   there is a stri
+00016c10: 6e67 2073 7563 6820 6173 2027 2f27 206f  ng such as '/' o
+00016c20: 7220 272e 2720 6265 7477 6565 6e20 6461  r '.' between da
+00016c30: 792f 6d6f 6e74 682f 7965 6172 2065 7463  y/month/year etc
+00016c40: 2e20 4465 6661 756c 7420 6973 2061 7373  . Default is ass
+00016c50: 756d 6564 202f 2068 6572 652e 0a20 2020  umed / here..   
+00016c60: 2073 706c 6974 7465 725f 686f 7572 5f73   splitter_hour_s
+00016c70: 7472 696e 673a 2075 7375 616c 6c79 2074  tring: usually t
+00016c80: 6865 7265 2069 7320 6120 7374 7269 6e67  here is a string
+00016c90: 2073 7563 6820 6173 2027 3a27 206f 7220   such as ':' or 
+00016ca0: 272e 2720 6265 7477 6565 6e20 686f 7572  '.' between hour
+00016cb0: 3a6d 696e 3a73 6563 2065 7463 2e20 4465  :min:sec etc. De
+00016cc0: 6661 756c 7420 6973 2061 7373 756d 6564  fault is assumed
+00016cd0: 203a 2068 6572 652e 0a0a 2020 2020 4f75   : here...    Ou
+00016ce0: 7470 7574 733a 0a20 2020 2054 6865 206f  tputs:.    The o
+00016cf0: 7269 6769 6e61 6c20 7061 6e64 6173 2064  riginal pandas d
+00016d00: 6174 6166 7261 6d65 2077 6974 6820 6164  ataframe with ad
+00016d10: 6469 7469 6f6e 616c 2066 6965 6c64 7320  ditional fields 
+00016d20: 6372 6561 7465 6420 6279 2073 706c 6974  created by split
+00016d30: 7469 6e67 2074 6865 2073 7461 7274 2061  ting the start a
+00016d40: 6e64 2065 6e64 2074 696d 6520 6669 656c  nd end time fiel
+00016d50: 6473 0a20 2020 2023 2323 2323 2323 2323  ds.    #########
+00016d60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016d70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016d80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00016d90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016da0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00016db0: 2323 2323 2323 2323 0a20 2020 2022 2222  ########.    """
-00016dc0: 0a20 2020 2073 6d61 6c6c 6466 203d 2073  .    smalldf = s
-00016dd0: 6d61 6c6c 6466 2e63 6f70 7928 290a 2020  malldf.copy().  
-00016de0: 2020 6164 645f 636f 6c73 203d 205b 5d0a    add_cols = [].
-00016df0: 2020 2020 6461 7465 5f74 696d 655f 7661      date_time_va
-00016e00: 7269 6162 6c65 5f66 6c61 6720 3d20 4661  riable_flag = Fa
-00016e10: 6c73 650a 2020 2020 6966 2073 6d61 6c6c  lse.    if small
-00016e20: 6466 5b73 7461 7274 5469 6d65 5d2e 6474  df[startTime].dt
-00016e30: 7970 6520 696e 205b 2764 6174 6574 696d  ype in ['datetim
-00016e40: 6536 345b 6e73 5d27 2c27 6461 7465 7469  e64[ns]','dateti
-00016e50: 6d65 3136 5b6e 735d 272c 2764 6174 6574  me16[ns]','datet
-00016e60: 696d 6533 325b 6e73 5d27 5d3a 0a20 2020  ime32[ns]']:.   
-00016e70: 2020 2020 2070 7269 6e74 2827 2573 2076       print('%s v
-00016e80: 6172 6961 626c 6520 6973 2061 2064 6174  ariable is a dat
-00016e90: 652d 7469 6d65 2076 6172 6961 626c 6527  e-time variable'
-00016ea0: 2025 7374 6172 7454 696d 6529 0a20 2020   %startTime).   
-00016eb0: 2020 2020 2064 6174 655f 7469 6d65 5f76       date_time_v
-00016ec0: 6172 6961 626c 655f 666c 6167 203d 2054  ariable_flag = T
-00016ed0: 7275 650a 2020 2020 6966 2064 6174 655f  rue.    if date_
-00016ee0: 7469 6d65 5f76 6172 6961 626c 655f 666c  time_variable_fl
-00016ef0: 6167 3a0a 2020 2020 2020 2020 7669 6577  ag:.        view
-00016f00: 5f64 6179 7320 3d20 2770 726f 6365 7373  _days = 'process
-00016f10: 696e 6727 2b73 7461 7274 5469 6d65 2b27  ing'+startTime+'
-00016f20: 5f65 6c61 7073 6564 5f64 6179 7327 0a20  _elapsed_days'. 
-00016f30: 2020 2020 2020 2073 6d61 6c6c 6466 5b76         smalldf[v
-00016f40: 6965 775f 6461 7973 5d20 3d20 2873 6d61  iew_days] = (sma
-00016f50: 6c6c 6466 5b65 6e64 5469 6d65 5d20 2d20  lldf[endTime] - 
-00016f60: 736d 616c 6c64 665b 7374 6172 7454 696d  smalldf[startTim
-00016f70: 655d 292e 6173 7479 7065 2827 7469 6d65  e]).astype('time
-00016f80: 6465 6c74 6136 345b 735d 2729 2f28 3630  delta64[s]')/(60
-00016f90: 2a36 302a 3234 290a 2020 2020 2020 2020  *60*24).        
-00016fa0: 736d 616c 6c64 665b 7669 6577 5f64 6179  smalldf[view_day
-00016fb0: 735d 203d 2073 6d61 6c6c 6466 5b76 6965  s] = smalldf[vie
-00016fc0: 775f 6461 7973 5d2e 6173 7479 7065 2869  w_days].astype(i
-00016fd0: 6e74 290a 2020 2020 2020 2020 6164 645f  nt).        add_
-00016fe0: 636f 6c73 2e61 7070 656e 6428 7669 6577  cols.append(view
-00016ff0: 5f64 6179 7329 0a20 2020 2020 2020 2076  _days).        v
-00017000: 6965 775f 7469 6d65 203d 2027 7072 6f63  iew_time = 'proc
-00017010: 6573 7369 6e67 272b 7374 6172 7454 696d  essing'+startTim
-00017020: 652b 275f 656c 6170 7365 645f 7469 6d65  e+'_elapsed_time
-00017030: 270a 2020 2020 2020 2020 736d 616c 6c64  '.        smalld
-00017040: 665b 7669 6577 5f74 696d 655d 203d 2028  f[view_time] = (
-00017050: 736d 616c 6c64 665b 656e 6454 696d 655d  smalldf[endTime]
-00017060: 202d 2073 6d61 6c6c 6466 5b73 7461 7274   - smalldf[start
-00017070: 5469 6d65 5d29 2e61 7374 7970 6528 2774  Time]).astype('t
-00017080: 696d 6564 656c 7461 3634 5b73 5d27 292e  imedelta64[s]').
-00017090: 7661 6c75 6573 0a20 2020 2020 2020 2061  values.        a
-000170a0: 6464 5f63 6f6c 732e 6170 7065 6e64 2876  dd_cols.append(v
-000170b0: 6965 775f 7469 6d65 290a 2020 2020 656c  iew_time).    el
-000170c0: 7365 3a0a 2020 2020 2020 2020 7374 6172  se:.        star
-000170d0: 745f 6461 7465 203d 2027 7072 6f63 6573  t_date = 'proces
-000170e0: 7369 6e67 272b 7374 6172 7454 696d 652b  sing'+startTime+
-000170f0: 275f 7374 6172 745f 6461 7465 270a 2020  '_start_date'.  
-00017100: 2020 2020 2020 736d 616c 6c64 665b 7374        smalldf[st
-00017110: 6172 745f 6461 7465 5d20 3d20 736d 616c  art_date] = smal
-00017120: 6c64 665b 7374 6172 7454 696d 655d 2e6d  ldf[startTime].m
-00017130: 6170 286c 616d 6264 6120 783a 2078 2e73  ap(lambda x: x.s
-00017140: 706c 6974 2822 2022 295b 305d 290a 2020  plit(" ")[0]).  
-00017150: 2020 2020 2020 6164 645f 636f 6c73 2e61        add_cols.a
-00017160: 7070 656e 6428 7374 6172 745f 6461 7465  ppend(start_date
-00017170: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-00017180: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00017190: 5f74 696d 6520 3d20 2770 726f 6365 7373  _time = 'process
-000171a0: 696e 6727 2b73 7461 7274 5469 6d65 2b27  ing'+startTime+'
-000171b0: 5f73 7461 7274 5f74 696d 6527 0a20 2020  _start_time'.   
-000171c0: 2020 2020 2020 2020 2073 6d61 6c6c 6466           smalldf
-000171d0: 5b73 7461 7274 5f74 696d 655d 203d 2073  [start_time] = s
-000171e0: 6d61 6c6c 6466 5b73 7461 7274 5469 6d65  malldf[startTime
-000171f0: 5d2e 6d61 7028 6c61 6d62 6461 2078 3a20  ].map(lambda x: 
-00017200: 782e 7370 6c69 7428 2220 2229 5b31 5d29  x.split(" ")[1])
-00017210: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-00017220: 5f63 6f6c 732e 6170 7065 6e64 2873 7461  _cols.append(sta
-00017230: 7274 5f74 696d 6529 0a20 2020 2020 2020  rt_time).       
-00017240: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00017250: 2020 2020 2023 2323 2074 6865 7265 2069       ### there i
-00017260: 7320 6e6f 2068 6f75 722d 6d69 6e75 7465  s no hour-minute
-00017270: 7320 7061 7274 206f 6620 7468 6973 2064  s part of this d
-00017280: 6174 6520 7469 6d65 2073 7461 6d70 2066  ate time stamp f
-00017290: 6965 6c64 2e20 596f 7520 6361 6e20 6a75  ield. You can ju
-000172a0: 7374 2073 6b69 7020 6974 2069 6620 6974  st skip it if it
-000172b0: 2069 7320 6e6f 7420 7468 6572 650a 2020   is not there.  
-000172c0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-000172d0: 2020 2020 2020 2065 6e64 5f64 6174 6520         end_date 
-000172e0: 3d20 2770 726f 6365 7373 696e 6727 2b65  = 'processing'+e
-000172f0: 6e64 5469 6d65 2b27 5f65 6e64 5f64 6174  ndTime+'_end_dat
-00017300: 6527 0a20 2020 2020 2020 2073 6d61 6c6c  e'.        small
-00017310: 6466 5b65 6e64 5f64 6174 655d 203d 2073  df[end_date] = s
-00017320: 6d61 6c6c 6466 5b65 6e64 5469 6d65 5d2e  malldf[endTime].
-00017330: 6d61 7028 6c61 6d62 6461 2078 3a20 782e  map(lambda x: x.
-00017340: 7370 6c69 7428 2220 2229 5b30 5d29 0a20  split(" ")[0]). 
-00017350: 2020 2020 2020 2061 6464 5f63 6f6c 732e         add_cols.
-00017360: 6170 7065 6e64 2865 6e64 5f64 6174 6529  append(end_date)
-00017370: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00017380: 2020 2020 2020 2020 2020 656e 645f 7469            end_ti
-00017390: 6d65 203d 2027 7072 6f63 6573 7369 6e67  me = 'processing
-000173a0: 272b 656e 6454 696d 652b 275f 656e 645f  '+endTime+'_end_
-000173b0: 7469 6d65 270a 2020 2020 2020 2020 2020  time'.          
-000173c0: 2020 736d 616c 6c64 665b 656e 645f 7469    smalldf[end_ti
-000173d0: 6d65 5d20 3d20 736d 616c 6c64 665b 656e  me] = smalldf[en
-000173e0: 6454 696d 655d 2e6d 6170 286c 616d 6264  dTime].map(lambd
-000173f0: 6120 783a 2078 2e73 706c 6974 2822 2022  a x: x.split(" "
-00017400: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-00017410: 2020 6164 645f 636f 6c73 2e61 7070 656e    add_cols.appen
-00017420: 6428 656e 645f 7469 6d65 290a 2020 2020  d(end_time).    
-00017430: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00017440: 2020 2020 2020 2020 2323 2320 7468 6572          ### ther
-00017450: 6520 6973 206e 6f20 686f 7572 2d6d 696e  e is no hour-min
-00017460: 7574 6573 2070 6172 7420 6f66 2074 6869  utes part of thi
-00017470: 7320 6461 7465 2074 696d 6520 7374 616d  s date time stam
-00017480: 7020 6669 656c 642e 2059 6f75 2063 616e  p field. You can
-00017490: 206a 7573 7420 736b 6970 2069 7420 6966   just skip it if
-000174a0: 2069 7420 6973 206e 6f74 2074 6865 7265   it is not there
-000174b0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-000174c0: 730a 2020 2020 2020 2020 7669 6577 5f64  s.        view_d
-000174d0: 6179 7320 3d20 2770 726f 6365 7373 696e  ays = 'processin
-000174e0: 6727 2b73 7461 7274 5469 6d65 2b27 5f65  g'+startTime+'_e
-000174f0: 6c61 7073 6564 5f64 6179 7327 0a20 2020  lapsed_days'.   
-00017500: 2020 2020 2073 6d61 6c6c 6466 5b76 6965       smalldf[vie
-00017510: 775f 6461 7973 5d20 3d20 2870 642e 746f  w_days] = (pd.to
-00017520: 5f64 6174 6574 696d 6528 736d 616c 6c64  _datetime(smalld
-00017530: 665b 656e 645f 6461 7465 5d29 202d 2070  f[end_date]) - p
-00017540: 642e 746f 5f64 6174 6574 696d 6528 736d  d.to_datetime(sm
-00017550: 616c 6c64 665b 7374 6172 745f 6461 7465  alldf[start_date
-00017560: 5d29 292e 7661 6c75 6573 2e61 7374 7970  ])).values.astyp
-00017570: 6528 696e 7429 0a20 2020 2020 2020 2061  e(int).        a
-00017580: 6464 5f63 6f6c 732e 6170 7065 6e64 2876  dd_cols.append(v
-00017590: 6965 775f 6461 7973 290a 2020 2020 2020  iew_days).      
-000175a0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000175b0: 2020 2076 6965 775f 7469 6d65 203d 2027     view_time = '
-000175c0: 7072 6f63 6573 7369 6e67 272b 7374 6172  processing'+star
-000175d0: 7454 696d 652b 275f 656c 6170 7365 645f  tTime+'_elapsed_
-000175e0: 7469 6d65 270a 2020 2020 2020 2020 2020  time'.          
-000175f0: 2020 736d 616c 6c64 665b 7669 6577 5f74    smalldf[view_t
-00017600: 696d 655d 203d 2028 7064 2e74 6f5f 6461  ime] = (pd.to_da
-00017610: 7465 7469 6d65 2873 6d61 6c6c 6466 5b65  tetime(smalldf[e
-00017620: 6e64 5f74 696d 655d 2920 2d20 7064 2e74  nd_time]) - pd.t
-00017630: 6f5f 6461 7465 7469 6d65 2873 6d61 6c6c  o_datetime(small
-00017640: 6466 5b73 7461 7274 5f74 696d 655d 2929  df[start_time]))
-00017650: 2e61 7374 7970 6528 2774 696d 6564 656c  .astype('timedel
-00017660: 7461 3634 5b73 5d27 292e 7661 6c75 6573  ta64[s]').values
-00017670: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-00017680: 5f63 6f6c 732e 6170 7065 6e64 2876 6965  _cols.append(vie
-00017690: 775f 7469 6d65 290a 2020 2020 2020 2020  w_time).        
-000176a0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-000176b0: 2020 2020 2323 2320 496e 2073 6f6d 6520      ### In some 
-000176c0: 6461 7465 2074 696d 6520 6669 656c 6473  date time fields
-000176d0: 2074 6869 7320 6769 7665 7320 616e 2065   this gives an e
-000176e0: 7272 6f72 2073 6f20 736b 6970 2069 7420  rror so skip it 
-000176f0: 696e 2074 6861 7420 6361 7365 0a20 2020  in that case.   
-00017700: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00017710: 2020 2020 2020 2323 2323 2054 6865 2072        #### The r
-00017720: 6561 736f 6e20 7765 2063 686f 7365 2065  eason we chose e
-00017730: 6e64 5469 6d65 2068 6572 6520 6973 2074  ndTime here is t
-00017740: 6861 7420 7374 6172 7454 696d 6520 6973  hat startTime is
-00017750: 2075 7375 616c 6c79 2074 616b 656e 2063   usually taken c
-00017760: 6172 6520 6f66 2062 7920 616e 6f74 6865  are of by anothe
-00017770: 7220 6c69 6272 6172 792e 2053 6f20 6265  r library. So be
-00017780: 7474 6572 2074 6f20 646f 2074 6869 7320  tter to do this 
-00017790: 616c 6f6e 652e 0a20 2020 2020 2020 2079  alone..        y
-000177a0: 6561 7220 3d20 2770 726f 6365 7373 696e  ear = 'processin
-000177b0: 6727 2b65 6e64 5469 6d65 2b27 5f65 6e64  g'+endTime+'_end
-000177c0: 5f79 6561 7227 0a20 2020 2020 2020 2073  _year'.        s
-000177d0: 6d61 6c6c 6466 5b79 6561 725d 203d 2073  malldf[year] = s
-000177e0: 6d61 6c6c 6466 5b65 6e64 5f64 6174 655d  malldf[end_date]
-000177f0: 2e6d 6170 286c 616d 6264 6120 783a 2073  .map(lambda x: s
-00017800: 7472 2878 292e 7370 6c69 7428 7370 6c69  tr(x).split(spli
-00017810: 7474 6572 5f64 6174 655f 7374 7269 6e67  tter_date_string
-00017820: 295b 305d 292e 7661 6c75 6573 0a20 2020  )[0]).values.   
-00017830: 2020 2020 2061 6464 5f63 6f6c 732e 6170       add_cols.ap
-00017840: 7065 6e64 2879 6561 7229 0a20 2020 2020  pend(year).     
-00017850: 2020 2023 2323 2320 5468 6520 7265 6173     #### The reas
-00017860: 6f6e 2077 6520 6368 6f73 6520 656e 6454  on we chose endT
-00017870: 696d 6520 6865 7265 2069 7320 7468 6174  ime here is that
-00017880: 2073 7461 7274 5469 6d65 2069 7320 7573   startTime is us
-00017890: 7561 6c6c 7920 7461 6b65 6e20 6361 7265  ually taken care
-000178a0: 206f 6620 6279 2061 6e6f 7468 6572 206c   of by another l
-000178b0: 6962 7261 7279 2e20 536f 2062 6574 7465  ibrary. So bette
-000178c0: 7220 746f 2064 6f20 7468 6973 2061 6c6f  r to do this alo
-000178d0: 6e65 2e0a 2020 2020 2020 2020 6d6f 6e74  ne..        mont
-000178e0: 6820 3d20 2770 726f 6365 7373 696e 6727  h = 'processing'
-000178f0: 2b65 6e64 5469 6d65 2b27 5f65 6e64 5f6d  +endTime+'_end_m
-00017900: 6f6e 7468 270a 2020 2020 2020 2020 736d  onth'.        sm
-00017910: 616c 6c64 665b 6d6f 6e74 685d 203d 2073  alldf[month] = s
-00017920: 6d61 6c6c 6466 5b65 6e64 5f64 6174 655d  malldf[end_date]
-00017930: 2e6d 6170 286c 616d 6264 6120 783a 2073  .map(lambda x: s
-00017940: 7472 2878 292e 7370 6c69 7428 7370 6c69  tr(x).split(spli
-00017950: 7474 6572 5f64 6174 655f 7374 7269 6e67  tter_date_string
-00017960: 295b 315d 292e 7661 6c75 6573 0a20 2020  )[1]).values.   
-00017970: 2020 2020 2061 6464 5f63 6f6c 732e 6170       add_cols.ap
-00017980: 7065 6e64 286d 6f6e 7468 290a 2020 2020  pend(month).    
-00017990: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000179a0: 2020 2020 2023 2323 2320 5468 6520 7265       #### The re
-000179b0: 6173 6f6e 2077 6520 6368 6f73 6520 656e  ason we chose en
-000179c0: 6454 696d 6520 6865 7265 2069 7320 7468  dTime here is th
-000179d0: 6174 2073 7461 7274 5469 6d65 2069 7320  at startTime is 
-000179e0: 7573 7561 6c6c 7920 7461 6b65 6e20 6361  usually taken ca
-000179f0: 7265 206f 6620 6279 2061 6e6f 7468 6572  re of by another
-00017a00: 206c 6962 7261 7279 2e20 536f 2062 6574   library. So bet
-00017a10: 7465 7220 746f 2064 6f20 7468 6973 2061  ter to do this a
-00017a20: 6c6f 6e65 2e0a 2020 2020 2020 2020 2020  lone..          
-00017a30: 2020 6461 796e 756d 203d 2027 7072 6f63    daynum = 'proc
-00017a40: 6573 7369 6e67 272b 656e 6454 696d 652b  essing'+endTime+
-00017a50: 275f 656e 645f 6461 795f 6e75 6d62 6572  '_end_day_number
-00017a60: 270a 2020 2020 2020 2020 2020 2020 736d  '.            sm
-00017a70: 616c 6c64 665b 6461 796e 756d 5d20 3d20  alldf[daynum] = 
-00017a80: 736d 616c 6c64 665b 656e 645f 6461 7465  smalldf[end_date
-00017a90: 5d2e 6d61 7028 6c61 6d62 6461 2078 3a20  ].map(lambda x: 
-00017aa0: 7374 7228 7829 2e73 706c 6974 2873 706c  str(x).split(spl
-00017ab0: 6974 7465 725f 6461 7465 5f73 7472 696e  itter_date_strin
-00017ac0: 6729 5b32 5d29 2e76 616c 7565 730a 2020  g)[2]).values.  
-00017ad0: 2020 2020 2020 2020 2020 6164 645f 636f            add_co
-00017ae0: 6c73 2e61 7070 656e 6428 6461 796e 756d  ls.append(daynum
-00017af0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00017b00: 3a0a 2020 2020 2020 2020 2020 2020 2323  :.            ##
-00017b10: 2320 496e 2073 6f6d 6520 6461 7465 2074  # In some date t
-00017b20: 696d 6520 6669 656c 6473 2074 6865 2064  ime fields the d
-00017b30: 6179 206e 756d 6265 7220 6973 206e 6f74  ay number is not
-00017b40: 2074 6865 7265 2e20 4966 206e 6f74 2c20   there. If not, 
-00017b50: 6a75 7374 2073 6b69 7020 6974 2023 2323  just skip it ###
-00017b60: 230a 2020 2020 2020 2020 2020 2020 7061  #.            pa
-00017b70: 7373 0a20 2020 2020 2020 2023 2323 2320  ss.        #### 
-00017b80: 496e 2073 6f6d 6520 6461 7465 2074 696d  In some date tim
-00017b90: 6520 6669 656c 6473 2c20 7468 6520 686f  e fields, the ho
-00017ba0: 7572 2061 6e64 206d 696e 7574 6520 6973  ur and minute is
-00017bb0: 206e 6f74 2074 6865 7265 2c20 736f 2073   not there, so s
-00017bc0: 6b69 7020 6974 2069 6e20 7468 6174 2063  kip it in that c
-00017bd0: 6173 6520 6966 2069 7420 6572 726f 7273  ase if it errors
-00017be0: 210a 2020 2020 2020 2020 7472 793a 0a20  !.        try:. 
-00017bf0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00017c00: 5f68 6f75 7220 3d20 2770 726f 6365 7373  _hour = 'process
-00017c10: 696e 6727 2b73 7461 7274 5469 6d65 2b27  ing'+startTime+'
-00017c20: 5f73 7461 7274 5f68 6f75 7227 0a20 2020  _start_hour'.   
-00017c30: 2020 2020 2020 2020 2073 6d61 6c6c 6466           smalldf
-00017c40: 5b73 7461 7274 5f68 6f75 725d 203d 2073  [start_hour] = s
-00017c50: 6d61 6c6c 6466 5b73 7461 7274 5f74 696d  malldf[start_tim
-00017c60: 655d 2e6d 6170 286c 616d 6264 6120 783a  e].map(lambda x:
-00017c70: 2073 7472 2878 292e 7370 6c69 7428 7370   str(x).split(sp
-00017c80: 6c69 7474 6572 5f68 6f75 725f 7374 7269  litter_hour_stri
-00017c90: 6e67 295b 305d 292e 7661 6c75 6573 0a20  ng)[0]).values. 
-00017ca0: 2020 2020 2020 2020 2020 2061 6464 5f63             add_c
-00017cb0: 6f6c 732e 6170 7065 6e64 2873 7461 7274  ols.append(start
-00017cc0: 5f68 6f75 7229 0a20 2020 2020 2020 2020  _hour).         
-00017cd0: 2020 2073 7461 7274 5f6d 696e 203d 2027     start_min = '
-00017ce0: 7072 6f63 6573 7369 6e67 272b 7374 6172  processing'+star
-00017cf0: 7454 696d 652b 275f 7374 6172 745f 686f  tTime+'_start_ho
-00017d00: 7572 270a 2020 2020 2020 2020 2020 2020  ur'.            
-00017d10: 736d 616c 6c64 665b 7374 6172 745f 6d69  smalldf[start_mi
-00017d20: 6e5d 203d 2073 6d61 6c6c 6466 5b73 7461  n] = smalldf[sta
-00017d30: 7274 5f74 696d 655d 2e6d 6170 286c 616d  rt_time].map(lam
-00017d40: 6264 6120 783a 2073 7472 2878 292e 7370  bda x: str(x).sp
-00017d50: 6c69 7428 7370 6c69 7474 6572 5f68 6f75  lit(splitter_hou
-00017d60: 725f 7374 7269 6e67 295b 315d 292e 7661  r_string)[1]).va
-00017d70: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
-00017d80: 2061 6464 5f63 6f6c 732e 6170 7065 6e64   add_cols.append
-00017d90: 2873 7461 7274 5f6d 696e 290a 2020 2020  (start_min).    
-00017da0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00017db0: 2020 2020 2020 2020 2323 2320 4966 2069          ### If i
-00017dc0: 7420 6572 726f 7273 2c20 736b 6970 2069  t errors, skip i
-00017dd0: 740a 2020 2020 2020 2020 2020 2020 7061  t.            pa
-00017de0: 7373 0a20 2020 2020 2020 2023 2323 2320  ss.        #### 
-00017df0: 4368 6563 6b20 6966 2074 6865 7265 2069  Check if there i
-00017e00: 7320 6120 7765 656b 6461 7920 616e 6420  s a weekday and 
-00017e10: 7765 656b 656e 6473 2069 6e20 6461 7465  weekends in date
-00017e20: 2074 696d 6520 636f 6c75 6d6e 7320 7573   time columns us
-00017e30: 696e 6720 656e 6454 696d 6520 6f6e 6c79  ing endTime only
-00017e40: 0a20 2020 2020 2020 2077 6565 6b64 6179  .        weekday
-00017e50: 5f6e 756d 203d 2027 7072 6f63 6573 7369  _num = 'processi
-00017e60: 6e67 272b 656e 6454 696d 652b 275f 656e  ng'+endTime+'_en
-00017e70: 645f 7765 656b 6461 795f 6e75 6d62 6572  d_weekday_number
-00017e80: 270a 2020 2020 2020 2020 736d 616c 6c64  '.        smalld
-00017e90: 665b 7765 656b 6461 795f 6e75 6d5d 203d  f[weekday_num] =
-00017ea0: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00017eb0: 736d 616c 6c64 665b 656e 645f 6461 7465  smalldf[end_date
-00017ec0: 5d29 2e64 742e 7765 656b 6461 792e 7661  ]).dt.weekday.va
-00017ed0: 6c75 6573 0a20 2020 2020 2020 2061 6464  lues.        add
-00017ee0: 5f63 6f6c 732e 6170 7065 6e64 2877 6565  _cols.append(wee
-00017ef0: 6b64 6179 5f6e 756d 290a 2020 2020 2020  kday_num).      
-00017f00: 2020 7765 656b 656e 6420 3d20 2770 726f    weekend = 'pro
-00017f10: 6365 7373 696e 6727 2b65 6e64 5469 6d65  cessing'+endTime
-00017f20: 2b27 5f65 6e64 5f77 6565 6b65 6e64 5f66  +'_end_weekend_f
-00017f30: 6c61 6727 0a20 2020 2020 2020 2073 6d61  lag'.        sma
-00017f40: 6c6c 6466 5b77 6565 6b65 6e64 5d20 3d20  lldf[weekend] = 
-00017f50: 736d 616c 6c64 665b 7765 656b 6461 795f  smalldf[weekday_
-00017f60: 6e75 6d5d 2e6d 6170 286c 616d 6264 6120  num].map(lambda 
-00017f70: 783a 2031 2069 6620 7820 696e 5b35 2c36  x: 1 if x in[5,6
-00017f80: 5d20 656c 7365 2030 290a 2020 2020 2020  ] else 0).      
-00017f90: 2020 6164 645f 636f 6c73 2e61 7070 656e    add_cols.appen
-00017fa0: 6428 7765 656b 656e 6429 0a20 2020 2023  d(weekend).    #
-00017fb0: 2323 2320 4966 2065 7665 7279 7468 696e  ### If everythin
-00017fc0: 6720 776f 726b 7320 7765 6c6c 2c20 7468  g works well, th
-00017fd0: 6572 6520 7368 6f75 6c64 2062 6520 3133  ere should be 13
-00017fe0: 206e 6577 2063 6f6c 756d 6e73 2061 6464   new columns add
-00017ff0: 6564 2062 7920 6d6f 6475 6c65 2e20 416c  ed by module. Al
-00018000: 6c20 7468 6520 6265 7374 210a 2020 2020  l the best!.    
-00018010: 7072 696e 7428 2725 6420 636f 6c75 6d6e  print('%d column
-00018020: 7320 6164 6465 6420 7573 696e 6720 7374  s added using st
-00018030: 6172 7420 6461 7465 3d25 7320 616e 6420  art date=%s and 
-00018040: 656e 6420 6461 7465 3d25 7320 7072 6f63  end date=%s proc
-00018050: 6573 7369 6e67 2e2e 2e27 2025 286c 656e  essing...' %(len
-00018060: 2861 6464 5f63 6f6c 7329 2c73 7461 7274  (add_cols),start
-00018070: 5469 6d65 2c65 6e64 5469 6d65 2929 0a20  Time,endTime)). 
-00018080: 2020 2072 6574 7572 6e20 736d 616c 6c64     return smalld
-00018090: 660a 2323 2323 2323 2323 2323 2323 2323  f.##############
+00016da0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00016db0: 2020 2222 220a 2020 2020 736d 616c 6c64    """.    smalld
+00016dc0: 6620 3d20 736d 616c 6c64 662e 636f 7079  f = smalldf.copy
+00016dd0: 2829 0a20 2020 2061 6464 5f63 6f6c 7320  ().    add_cols 
+00016de0: 3d20 5b5d 0a20 2020 2064 6174 655f 7469  = [].    date_ti
+00016df0: 6d65 5f76 6172 6961 626c 655f 666c 6167  me_variable_flag
+00016e00: 203d 2046 616c 7365 0a20 2020 2069 6620   = False.    if 
+00016e10: 736d 616c 6c64 665b 7374 6172 7454 696d  smalldf[startTim
+00016e20: 655d 2e64 7479 7065 2069 6e20 5b27 6461  e].dtype in ['da
+00016e30: 7465 7469 6d65 3634 5b6e 735d 272c 2764  tetime64[ns]','d
+00016e40: 6174 6574 696d 6531 365b 6e73 5d27 2c27  atetime16[ns]','
+00016e50: 6461 7465 7469 6d65 3332 5b6e 735d 275d  datetime32[ns]']
+00016e60: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00016e70: 2725 7320 7661 7269 6162 6c65 2069 7320  '%s variable is 
+00016e80: 6120 6461 7465 2d74 696d 6520 7661 7269  a date-time vari
+00016e90: 6162 6c65 2720 2573 7461 7274 5469 6d65  able' %startTime
+00016ea0: 290a 2020 2020 2020 2020 6461 7465 5f74  ).        date_t
+00016eb0: 696d 655f 7661 7269 6162 6c65 5f66 6c61  ime_variable_fla
+00016ec0: 6720 3d20 5472 7565 0a20 2020 2069 6620  g = True.    if 
+00016ed0: 6461 7465 5f74 696d 655f 7661 7269 6162  date_time_variab
+00016ee0: 6c65 5f66 6c61 673a 0a20 2020 2020 2020  le_flag:.       
+00016ef0: 2076 6965 775f 6461 7973 203d 2027 7072   view_days = 'pr
+00016f00: 6f63 6573 7369 6e67 272b 7374 6172 7454  ocessing'+startT
+00016f10: 696d 652b 275f 656c 6170 7365 645f 6461  ime+'_elapsed_da
+00016f20: 7973 270a 2020 2020 2020 2020 736d 616c  ys'.        smal
+00016f30: 6c64 665b 7669 6577 5f64 6179 735d 203d  ldf[view_days] =
+00016f40: 2028 736d 616c 6c64 665b 656e 6454 696d   (smalldf[endTim
+00016f50: 655d 202d 2073 6d61 6c6c 6466 5b73 7461  e] - smalldf[sta
+00016f60: 7274 5469 6d65 5d29 2e61 7374 7970 6528  rtTime]).astype(
+00016f70: 2774 696d 6564 656c 7461 3634 5b73 5d27  'timedelta64[s]'
+00016f80: 292f 2836 302a 3630 2a32 3429 0a20 2020  )/(60*60*24).   
+00016f90: 2020 2020 2073 6d61 6c6c 6466 5b76 6965       smalldf[vie
+00016fa0: 775f 6461 7973 5d20 3d20 736d 616c 6c64  w_days] = smalld
+00016fb0: 665b 7669 6577 5f64 6179 735d 2e61 7374  f[view_days].ast
+00016fc0: 7970 6528 696e 7429 0a20 2020 2020 2020  ype(int).       
+00016fd0: 2061 6464 5f63 6f6c 732e 6170 7065 6e64   add_cols.append
+00016fe0: 2876 6965 775f 6461 7973 290a 2020 2020  (view_days).    
+00016ff0: 2020 2020 7669 6577 5f74 696d 6520 3d20      view_time = 
+00017000: 2770 726f 6365 7373 696e 6727 2b73 7461  'processing'+sta
+00017010: 7274 5469 6d65 2b27 5f65 6c61 7073 6564  rtTime+'_elapsed
+00017020: 5f74 696d 6527 0a20 2020 2020 2020 2073  _time'.        s
+00017030: 6d61 6c6c 6466 5b76 6965 775f 7469 6d65  malldf[view_time
+00017040: 5d20 3d20 2873 6d61 6c6c 6466 5b65 6e64  ] = (smalldf[end
+00017050: 5469 6d65 5d20 2d20 736d 616c 6c64 665b  Time] - smalldf[
+00017060: 7374 6172 7454 696d 655d 292e 6173 7479  startTime]).asty
+00017070: 7065 2827 7469 6d65 6465 6c74 6136 345b  pe('timedelta64[
+00017080: 735d 2729 2e76 616c 7565 730a 2020 2020  s]').values.    
+00017090: 2020 2020 6164 645f 636f 6c73 2e61 7070      add_cols.app
+000170a0: 656e 6428 7669 6577 5f74 696d 6529 0a20  end(view_time). 
+000170b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000170c0: 2073 7461 7274 5f64 6174 6520 3d20 2770   start_date = 'p
+000170d0: 726f 6365 7373 696e 6727 2b73 7461 7274  rocessing'+start
+000170e0: 5469 6d65 2b27 5f73 7461 7274 5f64 6174  Time+'_start_dat
+000170f0: 6527 0a20 2020 2020 2020 2073 6d61 6c6c  e'.        small
+00017100: 6466 5b73 7461 7274 5f64 6174 655d 203d  df[start_date] =
+00017110: 2073 6d61 6c6c 6466 5b73 7461 7274 5469   smalldf[startTi
+00017120: 6d65 5d2e 6d61 7028 6c61 6d62 6461 2078  me].map(lambda x
+00017130: 3a20 782e 7370 6c69 7428 2220 2229 5b30  : x.split(" ")[0
+00017140: 5d29 0a20 2020 2020 2020 2061 6464 5f63  ]).        add_c
+00017150: 6f6c 732e 6170 7065 6e64 2873 7461 7274  ols.append(start
+00017160: 5f64 6174 6529 0a20 2020 2020 2020 2074  _date).        t
+00017170: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017180: 7374 6172 745f 7469 6d65 203d 2027 7072  start_time = 'pr
+00017190: 6f63 6573 7369 6e67 272b 7374 6172 7454  ocessing'+startT
+000171a0: 696d 652b 275f 7374 6172 745f 7469 6d65  ime+'_start_time
+000171b0: 270a 2020 2020 2020 2020 2020 2020 736d  '.            sm
+000171c0: 616c 6c64 665b 7374 6172 745f 7469 6d65  alldf[start_time
+000171d0: 5d20 3d20 736d 616c 6c64 665b 7374 6172  ] = smalldf[star
+000171e0: 7454 696d 655d 2e6d 6170 286c 616d 6264  tTime].map(lambd
+000171f0: 6120 783a 2078 2e73 706c 6974 2822 2022  a x: x.split(" "
+00017200: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+00017210: 2020 6164 645f 636f 6c73 2e61 7070 656e    add_cols.appen
+00017220: 6428 7374 6172 745f 7469 6d65 290a 2020  d(start_time).  
+00017230: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00017240: 2020 2020 2020 2020 2020 2323 2320 7468            ### th
+00017250: 6572 6520 6973 206e 6f20 686f 7572 2d6d  ere is no hour-m
+00017260: 696e 7574 6573 2070 6172 7420 6f66 2074  inutes part of t
+00017270: 6869 7320 6461 7465 2074 696d 6520 7374  his date time st
+00017280: 616d 7020 6669 656c 642e 2059 6f75 2063  amp field. You c
+00017290: 616e 206a 7573 7420 736b 6970 2069 7420  an just skip it 
+000172a0: 6966 2069 7420 6973 206e 6f74 2074 6865  if it is not the
+000172b0: 7265 0a20 2020 2020 2020 2020 2020 2070  re.            p
+000172c0: 6173 730a 2020 2020 2020 2020 656e 645f  ass.        end_
+000172d0: 6461 7465 203d 2027 7072 6f63 6573 7369  date = 'processi
+000172e0: 6e67 272b 656e 6454 696d 652b 275f 656e  ng'+endTime+'_en
+000172f0: 645f 6461 7465 270a 2020 2020 2020 2020  d_date'.        
+00017300: 736d 616c 6c64 665b 656e 645f 6461 7465  smalldf[end_date
+00017310: 5d20 3d20 736d 616c 6c64 665b 656e 6454  ] = smalldf[endT
+00017320: 696d 655d 2e6d 6170 286c 616d 6264 6120  ime].map(lambda 
+00017330: 783a 2078 2e73 706c 6974 2822 2022 295b  x: x.split(" ")[
+00017340: 305d 290a 2020 2020 2020 2020 6164 645f  0]).        add_
+00017350: 636f 6c73 2e61 7070 656e 6428 656e 645f  cols.append(end_
+00017360: 6461 7465 290a 2020 2020 2020 2020 7472  date).        tr
+00017370: 793a 0a20 2020 2020 2020 2020 2020 2065  y:.            e
+00017380: 6e64 5f74 696d 6520 3d20 2770 726f 6365  nd_time = 'proce
+00017390: 7373 696e 6727 2b65 6e64 5469 6d65 2b27  ssing'+endTime+'
+000173a0: 5f65 6e64 5f74 696d 6527 0a20 2020 2020  _end_time'.     
+000173b0: 2020 2020 2020 2073 6d61 6c6c 6466 5b65         smalldf[e
+000173c0: 6e64 5f74 696d 655d 203d 2073 6d61 6c6c  nd_time] = small
+000173d0: 6466 5b65 6e64 5469 6d65 5d2e 6d61 7028  df[endTime].map(
+000173e0: 6c61 6d62 6461 2078 3a20 782e 7370 6c69  lambda x: x.spli
+000173f0: 7428 2220 2229 5b31 5d29 0a20 2020 2020  t(" ")[1]).     
+00017400: 2020 2020 2020 2061 6464 5f63 6f6c 732e         add_cols.
+00017410: 6170 7065 6e64 2865 6e64 5f74 696d 6529  append(end_time)
+00017420: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00017430: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
+00017440: 2074 6865 7265 2069 7320 6e6f 2068 6f75   there is no hou
+00017450: 722d 6d69 6e75 7465 7320 7061 7274 206f  r-minutes part o
+00017460: 6620 7468 6973 2064 6174 6520 7469 6d65  f this date time
+00017470: 2073 7461 6d70 2066 6965 6c64 2e20 596f   stamp field. Yo
+00017480: 7520 6361 6e20 6a75 7374 2073 6b69 7020  u can just skip 
+00017490: 6974 2069 6620 6974 2069 7320 6e6f 7420  it if it is not 
+000174a0: 7468 6572 650a 2020 2020 2020 2020 2020  there.          
+000174b0: 2020 7061 7373 0a20 2020 2020 2020 2076    pass.        v
+000174c0: 6965 775f 6461 7973 203d 2027 7072 6f63  iew_days = 'proc
+000174d0: 6573 7369 6e67 272b 7374 6172 7454 696d  essing'+startTim
+000174e0: 652b 275f 656c 6170 7365 645f 6461 7973  e+'_elapsed_days
+000174f0: 270a 2020 2020 2020 2020 736d 616c 6c64  '.        smalld
+00017500: 665b 7669 6577 5f64 6179 735d 203d 2028  f[view_days] = (
+00017510: 7064 2e74 6f5f 6461 7465 7469 6d65 2873  pd.to_datetime(s
+00017520: 6d61 6c6c 6466 5b65 6e64 5f64 6174 655d  malldf[end_date]
+00017530: 2920 2d20 7064 2e74 6f5f 6461 7465 7469  ) - pd.to_dateti
+00017540: 6d65 2873 6d61 6c6c 6466 5b73 7461 7274  me(smalldf[start
+00017550: 5f64 6174 655d 2929 2e76 616c 7565 732e  _date])).values.
+00017560: 6173 7479 7065 2869 6e74 290a 2020 2020  astype(int).    
+00017570: 2020 2020 6164 645f 636f 6c73 2e61 7070      add_cols.app
+00017580: 656e 6428 7669 6577 5f64 6179 7329 0a20  end(view_days). 
+00017590: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000175a0: 2020 2020 2020 2020 7669 6577 5f74 696d          view_tim
+000175b0: 6520 3d20 2770 726f 6365 7373 696e 6727  e = 'processing'
+000175c0: 2b73 7461 7274 5469 6d65 2b27 5f65 6c61  +startTime+'_ela
+000175d0: 7073 6564 5f74 696d 6527 0a20 2020 2020  psed_time'.     
+000175e0: 2020 2020 2020 2073 6d61 6c6c 6466 5b76         smalldf[v
+000175f0: 6965 775f 7469 6d65 5d20 3d20 2870 642e  iew_time] = (pd.
+00017600: 746f 5f64 6174 6574 696d 6528 736d 616c  to_datetime(smal
+00017610: 6c64 665b 656e 645f 7469 6d65 5d29 202d  ldf[end_time]) -
+00017620: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
+00017630: 736d 616c 6c64 665b 7374 6172 745f 7469  smalldf[start_ti
+00017640: 6d65 5d29 292e 6173 7479 7065 2827 7469  me])).astype('ti
+00017650: 6d65 6465 6c74 6136 345b 735d 2729 2e76  medelta64[s]').v
+00017660: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
+00017670: 2020 6164 645f 636f 6c73 2e61 7070 656e    add_cols.appen
+00017680: 6428 7669 6577 5f74 696d 6529 0a20 2020  d(view_time).   
+00017690: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+000176a0: 2020 2020 2020 2020 2023 2323 2049 6e20           ### In 
+000176b0: 736f 6d65 2064 6174 6520 7469 6d65 2066  some date time f
+000176c0: 6965 6c64 7320 7468 6973 2067 6976 6573  ields this gives
+000176d0: 2061 6e20 6572 726f 7220 736f 2073 6b69   an error so ski
+000176e0: 7020 6974 2069 6e20 7468 6174 2063 6173  p it in that cas
+000176f0: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
+00017700: 7373 0a20 2020 2020 2020 2023 2323 2320  ss.        #### 
+00017710: 5468 6520 7265 6173 6f6e 2077 6520 6368  The reason we ch
+00017720: 6f73 6520 656e 6454 696d 6520 6865 7265  ose endTime here
+00017730: 2069 7320 7468 6174 2073 7461 7274 5469   is that startTi
+00017740: 6d65 2069 7320 7573 7561 6c6c 7920 7461  me is usually ta
+00017750: 6b65 6e20 6361 7265 206f 6620 6279 2061  ken care of by a
+00017760: 6e6f 7468 6572 206c 6962 7261 7279 2e20  nother library. 
+00017770: 536f 2062 6574 7465 7220 746f 2064 6f20  So better to do 
+00017780: 7468 6973 2061 6c6f 6e65 2e0a 2020 2020  this alone..    
+00017790: 2020 2020 7965 6172 203d 2027 7072 6f63      year = 'proc
+000177a0: 6573 7369 6e67 272b 656e 6454 696d 652b  essing'+endTime+
+000177b0: 275f 656e 645f 7965 6172 270a 2020 2020  '_end_year'.    
+000177c0: 2020 2020 736d 616c 6c64 665b 7965 6172      smalldf[year
+000177d0: 5d20 3d20 736d 616c 6c64 665b 656e 645f  ] = smalldf[end_
+000177e0: 6461 7465 5d2e 6d61 7028 6c61 6d62 6461  date].map(lambda
+000177f0: 2078 3a20 7374 7228 7829 2e73 706c 6974   x: str(x).split
+00017800: 2873 706c 6974 7465 725f 6461 7465 5f73  (splitter_date_s
+00017810: 7472 696e 6729 5b30 5d29 2e76 616c 7565  tring)[0]).value
+00017820: 730a 2020 2020 2020 2020 6164 645f 636f  s.        add_co
+00017830: 6c73 2e61 7070 656e 6428 7965 6172 290a  ls.append(year).
+00017840: 2020 2020 2020 2020 2323 2323 2054 6865          #### The
+00017850: 2072 6561 736f 6e20 7765 2063 686f 7365   reason we chose
+00017860: 2065 6e64 5469 6d65 2068 6572 6520 6973   endTime here is
+00017870: 2074 6861 7420 7374 6172 7454 696d 6520   that startTime 
+00017880: 6973 2075 7375 616c 6c79 2074 616b 656e  is usually taken
+00017890: 2063 6172 6520 6f66 2062 7920 616e 6f74   care of by anot
+000178a0: 6865 7220 6c69 6272 6172 792e 2053 6f20  her library. So 
+000178b0: 6265 7474 6572 2074 6f20 646f 2074 6869  better to do thi
+000178c0: 7320 616c 6f6e 652e 0a20 2020 2020 2020  s alone..       
+000178d0: 206d 6f6e 7468 203d 2027 7072 6f63 6573   month = 'proces
+000178e0: 7369 6e67 272b 656e 6454 696d 652b 275f  sing'+endTime+'_
+000178f0: 656e 645f 6d6f 6e74 6827 0a20 2020 2020  end_month'.     
+00017900: 2020 2073 6d61 6c6c 6466 5b6d 6f6e 7468     smalldf[month
+00017910: 5d20 3d20 736d 616c 6c64 665b 656e 645f  ] = smalldf[end_
+00017920: 6461 7465 5d2e 6d61 7028 6c61 6d62 6461  date].map(lambda
+00017930: 2078 3a20 7374 7228 7829 2e73 706c 6974   x: str(x).split
+00017940: 2873 706c 6974 7465 725f 6461 7465 5f73  (splitter_date_s
+00017950: 7472 696e 6729 5b31 5d29 2e76 616c 7565  tring)[1]).value
+00017960: 730a 2020 2020 2020 2020 6164 645f 636f  s.        add_co
+00017970: 6c73 2e61 7070 656e 6428 6d6f 6e74 6829  ls.append(month)
+00017980: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00017990: 2020 2020 2020 2020 2020 2323 2323 2054            #### T
+000179a0: 6865 2072 6561 736f 6e20 7765 2063 686f  he reason we cho
+000179b0: 7365 2065 6e64 5469 6d65 2068 6572 6520  se endTime here 
+000179c0: 6973 2074 6861 7420 7374 6172 7454 696d  is that startTim
+000179d0: 6520 6973 2075 7375 616c 6c79 2074 616b  e is usually tak
+000179e0: 656e 2063 6172 6520 6f66 2062 7920 616e  en care of by an
+000179f0: 6f74 6865 7220 6c69 6272 6172 792e 2053  other library. S
+00017a00: 6f20 6265 7474 6572 2074 6f20 646f 2074  o better to do t
+00017a10: 6869 7320 616c 6f6e 652e 0a20 2020 2020  his alone..     
+00017a20: 2020 2020 2020 2064 6179 6e75 6d20 3d20         daynum = 
+00017a30: 2770 726f 6365 7373 696e 6727 2b65 6e64  'processing'+end
+00017a40: 5469 6d65 2b27 5f65 6e64 5f64 6179 5f6e  Time+'_end_day_n
+00017a50: 756d 6265 7227 0a20 2020 2020 2020 2020  umber'.         
+00017a60: 2020 2073 6d61 6c6c 6466 5b64 6179 6e75     smalldf[daynu
+00017a70: 6d5d 203d 2073 6d61 6c6c 6466 5b65 6e64  m] = smalldf[end
+00017a80: 5f64 6174 655d 2e6d 6170 286c 616d 6264  _date].map(lambd
+00017a90: 6120 783a 2073 7472 2878 292e 7370 6c69  a x: str(x).spli
+00017aa0: 7428 7370 6c69 7474 6572 5f64 6174 655f  t(splitter_date_
+00017ab0: 7374 7269 6e67 295b 325d 292e 7661 6c75  string)[2]).valu
+00017ac0: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
+00017ad0: 6464 5f63 6f6c 732e 6170 7065 6e64 2864  dd_cols.append(d
+00017ae0: 6179 6e75 6d29 0a20 2020 2020 2020 2065  aynum).        e
+00017af0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+00017b00: 2020 2023 2323 2049 6e20 736f 6d65 2064     ### In some d
+00017b10: 6174 6520 7469 6d65 2066 6965 6c64 7320  ate time fields 
+00017b20: 7468 6520 6461 7920 6e75 6d62 6572 2069  the day number i
+00017b30: 7320 6e6f 7420 7468 6572 652e 2049 6620  s not there. If 
+00017b40: 6e6f 742c 206a 7573 7420 736b 6970 2069  not, just skip i
+00017b50: 7420 2323 2323 0a20 2020 2020 2020 2020  t ####.         
+00017b60: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00017b70: 2323 2323 2049 6e20 736f 6d65 2064 6174  #### In some dat
+00017b80: 6520 7469 6d65 2066 6965 6c64 732c 2074  e time fields, t
+00017b90: 6865 2068 6f75 7220 616e 6420 6d69 6e75  he hour and minu
+00017ba0: 7465 2069 7320 6e6f 7420 7468 6572 652c  te is not there,
+00017bb0: 2073 6f20 736b 6970 2069 7420 696e 2074   so skip it in t
+00017bc0: 6861 7420 6361 7365 2069 6620 6974 2065  hat case if it e
+00017bd0: 7272 6f72 7321 0a20 2020 2020 2020 2074  rrors!.        t
+00017be0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017bf0: 7374 6172 745f 686f 7572 203d 2027 7072  start_hour = 'pr
+00017c00: 6f63 6573 7369 6e67 272b 7374 6172 7454  ocessing'+startT
+00017c10: 696d 652b 275f 7374 6172 745f 686f 7572  ime+'_start_hour
+00017c20: 270a 2020 2020 2020 2020 2020 2020 736d  '.            sm
+00017c30: 616c 6c64 665b 7374 6172 745f 686f 7572  alldf[start_hour
+00017c40: 5d20 3d20 736d 616c 6c64 665b 7374 6172  ] = smalldf[star
+00017c50: 745f 7469 6d65 5d2e 6d61 7028 6c61 6d62  t_time].map(lamb
+00017c60: 6461 2078 3a20 7374 7228 7829 2e73 706c  da x: str(x).spl
+00017c70: 6974 2873 706c 6974 7465 725f 686f 7572  it(splitter_hour
+00017c80: 5f73 7472 696e 6729 5b30 5d29 2e76 616c  _string)[0]).val
+00017c90: 7565 730a 2020 2020 2020 2020 2020 2020  ues.            
+00017ca0: 6164 645f 636f 6c73 2e61 7070 656e 6428  add_cols.append(
+00017cb0: 7374 6172 745f 686f 7572 290a 2020 2020  start_hour).    
+00017cc0: 2020 2020 2020 2020 7374 6172 745f 6d69          start_mi
+00017cd0: 6e20 3d20 2770 726f 6365 7373 696e 6727  n = 'processing'
+00017ce0: 2b73 7461 7274 5469 6d65 2b27 5f73 7461  +startTime+'_sta
+00017cf0: 7274 5f68 6f75 7227 0a20 2020 2020 2020  rt_hour'.       
+00017d00: 2020 2020 2073 6d61 6c6c 6466 5b73 7461       smalldf[sta
+00017d10: 7274 5f6d 696e 5d20 3d20 736d 616c 6c64  rt_min] = smalld
+00017d20: 665b 7374 6172 745f 7469 6d65 5d2e 6d61  f[start_time].ma
+00017d30: 7028 6c61 6d62 6461 2078 3a20 7374 7228  p(lambda x: str(
+00017d40: 7829 2e73 706c 6974 2873 706c 6974 7465  x).split(splitte
+00017d50: 725f 686f 7572 5f73 7472 696e 6729 5b31  r_hour_string)[1
+00017d60: 5d29 2e76 616c 7565 730a 2020 2020 2020  ]).values.      
+00017d70: 2020 2020 2020 6164 645f 636f 6c73 2e61        add_cols.a
+00017d80: 7070 656e 6428 7374 6172 745f 6d69 6e29  ppend(start_min)
+00017d90: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00017da0: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
+00017db0: 2049 6620 6974 2065 7272 6f72 732c 2073   If it errors, s
+00017dc0: 6b69 7020 6974 0a20 2020 2020 2020 2020  kip it.         
+00017dd0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00017de0: 2323 2323 2043 6865 636b 2069 6620 7468  #### Check if th
+00017df0: 6572 6520 6973 2061 2077 6565 6b64 6179  ere is a weekday
+00017e00: 2061 6e64 2077 6565 6b65 6e64 7320 696e   and weekends in
+00017e10: 2064 6174 6520 7469 6d65 2063 6f6c 756d   date time colum
+00017e20: 6e73 2075 7369 6e67 2065 6e64 5469 6d65  ns using endTime
+00017e30: 206f 6e6c 790a 2020 2020 2020 2020 7765   only.        we
+00017e40: 656b 6461 795f 6e75 6d20 3d20 2770 726f  ekday_num = 'pro
+00017e50: 6365 7373 696e 6727 2b65 6e64 5469 6d65  cessing'+endTime
+00017e60: 2b27 5f65 6e64 5f77 6565 6b64 6179 5f6e  +'_end_weekday_n
+00017e70: 756d 6265 7227 0a20 2020 2020 2020 2073  umber'.        s
+00017e80: 6d61 6c6c 6466 5b77 6565 6b64 6179 5f6e  malldf[weekday_n
+00017e90: 756d 5d20 3d20 7064 2e74 6f5f 6461 7465  um] = pd.to_date
+00017ea0: 7469 6d65 2873 6d61 6c6c 6466 5b65 6e64  time(smalldf[end
+00017eb0: 5f64 6174 655d 292e 6474 2e77 6565 6b64  _date]).dt.weekd
+00017ec0: 6179 2e76 616c 7565 730a 2020 2020 2020  ay.values.      
+00017ed0: 2020 6164 645f 636f 6c73 2e61 7070 656e    add_cols.appen
+00017ee0: 6428 7765 656b 6461 795f 6e75 6d29 0a20  d(weekday_num). 
+00017ef0: 2020 2020 2020 2077 6565 6b65 6e64 203d         weekend =
+00017f00: 2027 7072 6f63 6573 7369 6e67 272b 656e   'processing'+en
+00017f10: 6454 696d 652b 275f 656e 645f 7765 656b  dTime+'_end_week
+00017f20: 656e 645f 666c 6167 270a 2020 2020 2020  end_flag'.      
+00017f30: 2020 736d 616c 6c64 665b 7765 656b 656e    smalldf[weeken
+00017f40: 645d 203d 2073 6d61 6c6c 6466 5b77 6565  d] = smalldf[wee
+00017f50: 6b64 6179 5f6e 756d 5d2e 6d61 7028 6c61  kday_num].map(la
+00017f60: 6d62 6461 2078 3a20 3120 6966 2078 2069  mbda x: 1 if x i
+00017f70: 6e5b 352c 365d 2065 6c73 6520 3029 0a20  n[5,6] else 0). 
+00017f80: 2020 2020 2020 2061 6464 5f63 6f6c 732e         add_cols.
+00017f90: 6170 7065 6e64 2877 6565 6b65 6e64 290a  append(weekend).
+00017fa0: 2020 2020 2323 2323 2049 6620 6576 6572      #### If ever
+00017fb0: 7974 6869 6e67 2077 6f72 6b73 2077 656c  ything works wel
+00017fc0: 6c2c 2074 6865 7265 2073 686f 756c 6420  l, there should 
+00017fd0: 6265 2031 3320 6e65 7720 636f 6c75 6d6e  be 13 new column
+00017fe0: 7320 6164 6465 6420 6279 206d 6f64 756c  s added by modul
+00017ff0: 652e 2041 6c6c 2074 6865 2062 6573 7421  e. All the best!
+00018000: 0a20 2020 2070 7269 6e74 2827 2564 2063  .    print('%d c
+00018010: 6f6c 756d 6e73 2061 6464 6564 2075 7369  olumns added usi
+00018020: 6e67 2073 7461 7274 2064 6174 653d 2573  ng start date=%s
+00018030: 2061 6e64 2065 6e64 2064 6174 653d 2573   and end date=%s
+00018040: 2070 726f 6365 7373 696e 672e 2e2e 2720   processing...' 
+00018050: 2528 6c65 6e28 6164 645f 636f 6c73 292c  %(len(add_cols),
+00018060: 7374 6172 7454 696d 652c 656e 6454 696d  startTime,endTim
+00018070: 6529 290a 2020 2020 7265 7475 726e 2073  e)).    return s
+00018080: 6d61 6c6c 6466 0a23 2323 2323 2323 2323  malldf.#########
+00018090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000180a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000180b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000180c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000180d0: 2323 2323 2323 2323 2323 2323 230a 6465  #############.de
-000180e0: 6620 4645 5f73 706c 6974 5f6f 6e65 5f66  f FE_split_one_f
-000180f0: 6965 6c64 5f69 6e74 6f5f 6d61 6e79 2864  ield_into_many(d
-00018100: 665f 696e 2c20 6669 656c 642c 2073 706c  f_in, field, spl
-00018110: 6974 7465 722c 2066 696c 6c65 722c 206e  itter, filler, n
-00018120: 6577 5f6e 616d 6573 5f6c 6973 743d 2727  ew_names_list=''
-00018130: 2c20 6164 645f 636f 756e 745f 6669 656c  , add_count_fiel
-00018140: 643d 4661 6c73 6529 3a0a 2020 2020 2222  d=False):.    ""
-00018150: 220a 2020 2020 4645 2073 7461 6e64 7320  ".    FE stands 
-00018160: 666f 7220 4665 6174 7572 6520 456e 6769  for Feature Engi
-00018170: 6e65 6572 696e 6720 2d20 6974 206d 6561  neering - it mea
-00018180: 6e73 2074 6869 7320 6675 6e63 7469 6f6e  ns this function
-00018190: 2070 6572 666f 726d 7320 6665 6174 7572   performs featur
-000181a0: 6520 656e 6769 6e65 6572 696e 670a 2020  e engineering.  
-000181b0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+000180d0: 2323 0a64 6566 2046 455f 7370 6c69 745f  ##.def FE_split_
+000180e0: 6f6e 655f 6669 656c 645f 696e 746f 5f6d  one_field_into_m
+000180f0: 616e 7928 6466 5f69 6e2c 2066 6965 6c64  any(df_in, field
+00018100: 2c20 7370 6c69 7474 6572 2c20 6669 6c6c  , splitter, fill
+00018110: 6572 2c20 6e65 775f 6e61 6d65 735f 6c69  er, new_names_li
+00018120: 7374 3d27 272c 2061 6464 5f63 6f75 6e74  st='', add_count
+00018130: 5f66 6965 6c64 3d46 616c 7365 293a 0a20  _field=False):. 
+00018140: 2020 2022 2222 0a20 2020 2046 4520 7374     """.    FE st
+00018150: 616e 6473 2066 6f72 2046 6561 7475 7265  ands for Feature
+00018160: 2045 6e67 696e 6565 7269 6e67 202d 2069   Engineering - i
+00018170: 7420 6d65 616e 7320 7468 6973 2066 756e  t means this fun
+00018180: 6374 696f 6e20 7065 7266 6f72 6d73 2066  ction performs f
+00018190: 6561 7475 7265 2065 6e67 696e 6565 7269  eature engineeri
+000181a0: 6e67 0a20 2020 2023 2323 2323 2323 2323  ng.    #########
+000181b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000181c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000181d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000181e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000181f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018200: 2323 2323 2323 2323 0a20 2020 2054 6869  ########.    Thi
-00018210: 7320 6675 6e63 7469 6f6e 2074 616b 6573  s function takes
-00018220: 2061 6e79 2064 6174 6120 6672 616d 6520   any data frame 
-00018230: 6669 656c 6420 2873 7472 696e 6720 7661  field (string va
-00018240: 7269 6162 6c65 7320 6f6e 6c79 2920 616e  riables only) an
-00018250: 6420 7370 6c69 7473 0a20 2020 2069 7420  d splits.    it 
-00018260: 696e 746f 2061 7320 6d61 6e79 2066 6965  into as many fie
-00018270: 6c64 7320 6173 2079 6f75 2077 616e 7420  lds as you want 
-00018280: 696e 2074 6865 206e 6577 5f6e 616d 6573  in the new_names
-00018290: 5f6c 6973 742e 0a0a 2020 2020 496e 7075  _list...    Inpu
-000182a0: 7473 3a0a 2020 2020 2020 2020 6466 743a  ts:.        dft:
-000182b0: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-000182c0: 650a 2020 2020 2020 2020 6669 656c 643a  e.        field:
-000182d0: 206e 616d 6520 6f66 2073 7472 696e 6720   name of string 
-000182e0: 636f 6c75 6d6e 2074 6861 7420 796f 7520  column that you 
-000182f0: 7761 6e74 2074 6f20 7370 6c69 7420 7573  want to split us
-00018300: 696e 6720 7468 6520 7370 6c69 7474 6572  ing the splitter
-00018310: 2073 7472 696e 6720 7370 6563 6966 6965   string specifie
-00018320: 640a 2020 2020 2020 2020 7370 6c69 7474  d.        splitt
-00018330: 6572 3a20 7370 6563 6966 7920 7768 6174  er: specify what
-00018340: 2073 7472 696e 6720 746f 2073 706c 6974   string to split
-00018350: 206f 6e20 7573 696e 6720 7468 6520 7370   on using the sp
-00018360: 6c69 7474 6572 2061 7267 756d 656e 742e  litter argument.
-00018370: 0a20 2020 2020 2020 2066 696c 6c65 723a  .        filler:
-00018380: 2059 6f75 2063 616e 2061 6c73 6f20 6669   You can also fi
-00018390: 6c6c 204e 756c 6c20 7661 6c75 6573 2074  ll Null values t
-000183a0: 6861 7420 6d61 7920 6861 7070 656e 2064  hat may happen d
-000183b0: 7565 2074 6f20 796f 7572 2073 706c 6974  ue to your split
-000183c0: 7469 6e67 2062 7920 7370 6563 6966 7969  ting by specifyi
-000183d0: 6e67 2061 2066 696c 6c65 722e 0a20 2020  ng a filler..   
-000183e0: 2020 2020 206e 6577 5f6e 616d 6573 5f6c       new_names_l
-000183f0: 6973 743a 2049 6620 6e6f 206e 6577 5f6e  ist: If no new_n
-00018400: 616d 6573 5f6c 6973 7420 6973 2067 6976  ames_list is giv
-00018410: 656e 2c20 7468 656e 2077 6520 7573 6520  en, then we use 
-00018420: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
-00018430: 6669 656c 6420 6974 7365 6c66 2074 6f20  field itself to 
-00018440: 6372 6561 7465 206e 6577 2063 6f6c 756d  create new colum
-00018450: 6e73 2e0a 2020 2020 2020 2020 6164 645f  ns..        add_
-00018460: 636f 756e 745f 6669 656c 643a 2046 616c  count_field: Fal
-00018470: 7365 2028 6465 6661 756c 7429 2e20 4966  se (default). If
-00018480: 2054 7275 652c 2069 7420 7769 6c6c 2063   True, it will c
-00018490: 6f75 6e74 2074 6865 206e 756d 6265 7220  ount the number 
-000184a0: 6f66 2069 7465 6d73 2069 6e0a 2020 2020  of items in.    
-000184b0: 2020 2020 2020 2020 7468 6520 2266 6965          the "fie
-000184c0: 6c64 2220 636f 6c75 6d6e 2062 6566 6f72  ld" column befor
-000184d0: 6520 7468 6520 7370 6c69 742e 2054 6869  e the split. Thi
-000184e0: 7320 6d61 7920 6265 206e 6565 6465 6420  s may be needed 
-000184f0: 696e 206e 6573 7465 6420 6469 6374 696f  in nested dictio
-00018500: 6e61 7279 2066 6965 6c64 732e 0a0a 2020  nary fields...  
-00018510: 2020 4f75 7470 7574 733a 0a20 2020 2020    Outputs:.     
-00018520: 2020 2064 6674 3a20 6f72 6967 696e 616c     dft: original
-00018530: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
-00018540: 6164 6469 7469 6f6e 616c 2063 6f6c 756d  additional colum
-00018550: 6e73 2063 7265 6174 6564 2062 7920 7370  ns created by sp
-00018560: 6c69 7474 696e 6720 7468 6520 6669 656c  litting the fiel
-00018570: 642e 0a20 2020 2020 2020 206e 6577 5f6e  d..        new_n
-00018580: 616d 6573 5f6c 6973 743a 2074 6865 206c  ames_list: the l
-00018590: 6973 7420 6f66 206e 6577 2063 6f6c 756d  ist of new colum
-000185a0: 6e73 2063 7265 6174 6564 2062 7920 7468  ns created by th
-000185b0: 6973 2066 756e 6374 696f 6e0a 2020 2020  is function.    
+000181f0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00018200: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+00018210: 7461 6b65 7320 616e 7920 6461 7461 2066  takes any data f
+00018220: 7261 6d65 2066 6965 6c64 2028 7374 7269  rame field (stri
+00018230: 6e67 2076 6172 6961 626c 6573 206f 6e6c  ng variables onl
+00018240: 7929 2061 6e64 2073 706c 6974 730a 2020  y) and splits.  
+00018250: 2020 6974 2069 6e74 6f20 6173 206d 616e    it into as man
+00018260: 7920 6669 656c 6473 2061 7320 796f 7520  y fields as you 
+00018270: 7761 6e74 2069 6e20 7468 6520 6e65 775f  want in the new_
+00018280: 6e61 6d65 735f 6c69 7374 2e0a 0a20 2020  names_list...   
+00018290: 2049 6e70 7574 733a 0a20 2020 2020 2020   Inputs:.       
+000182a0: 2064 6674 3a20 7061 6e64 6173 2044 6174   dft: pandas Dat
+000182b0: 6146 7261 6d65 0a20 2020 2020 2020 2066  aFrame.        f
+000182c0: 6965 6c64 3a20 6e61 6d65 206f 6620 7374  ield: name of st
+000182d0: 7269 6e67 2063 6f6c 756d 6e20 7468 6174  ring column that
+000182e0: 2079 6f75 2077 616e 7420 746f 2073 706c   you want to spl
+000182f0: 6974 2075 7369 6e67 2074 6865 2073 706c  it using the spl
+00018300: 6974 7465 7220 7374 7269 6e67 2073 7065  itter string spe
+00018310: 6369 6669 6564 0a20 2020 2020 2020 2073  cified.        s
+00018320: 706c 6974 7465 723a 2073 7065 6369 6679  plitter: specify
+00018330: 2077 6861 7420 7374 7269 6e67 2074 6f20   what string to 
+00018340: 7370 6c69 7420 6f6e 2075 7369 6e67 2074  split on using t
+00018350: 6865 2073 706c 6974 7465 7220 6172 6775  he splitter argu
+00018360: 6d65 6e74 2e0a 2020 2020 2020 2020 6669  ment..        fi
+00018370: 6c6c 6572 3a20 596f 7520 6361 6e20 616c  ller: You can al
+00018380: 736f 2066 696c 6c20 4e75 6c6c 2076 616c  so fill Null val
+00018390: 7565 7320 7468 6174 206d 6179 2068 6170  ues that may hap
+000183a0: 7065 6e20 6475 6520 746f 2079 6f75 7220  pen due to your 
+000183b0: 7370 6c69 7474 696e 6720 6279 2073 7065  splitting by spe
+000183c0: 6369 6679 696e 6720 6120 6669 6c6c 6572  cifying a filler
+000183d0: 2e0a 2020 2020 2020 2020 6e65 775f 6e61  ..        new_na
+000183e0: 6d65 735f 6c69 7374 3a20 4966 206e 6f20  mes_list: If no 
+000183f0: 6e65 775f 6e61 6d65 735f 6c69 7374 2069  new_names_list i
+00018400: 7320 6769 7665 6e2c 2074 6865 6e20 7765  s given, then we
+00018410: 2075 7365 2074 6865 206e 616d 6520 6f66   use the name of
+00018420: 2074 6865 2066 6965 6c64 2069 7473 656c   the field itsel
+00018430: 6620 746f 2063 7265 6174 6520 6e65 7720  f to create new 
+00018440: 636f 6c75 6d6e 732e 0a20 2020 2020 2020  columns..       
+00018450: 2061 6464 5f63 6f75 6e74 5f66 6965 6c64   add_count_field
+00018460: 3a20 4661 6c73 6520 2864 6566 6175 6c74  : False (default
+00018470: 292e 2049 6620 5472 7565 2c20 6974 2077  ). If True, it w
+00018480: 696c 6c20 636f 756e 7420 7468 6520 6e75  ill count the nu
+00018490: 6d62 6572 206f 6620 6974 656d 7320 696e  mber of items in
+000184a0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+000184b0: 2022 6669 656c 6422 2063 6f6c 756d 6e20   "field" column 
+000184c0: 6265 666f 7265 2074 6865 2073 706c 6974  before the split
+000184d0: 2e20 5468 6973 206d 6179 2062 6520 6e65  . This may be ne
+000184e0: 6564 6564 2069 6e20 6e65 7374 6564 2064  eded in nested d
+000184f0: 6963 7469 6f6e 6172 7920 6669 656c 6473  ictionary fields
+00018500: 2e0a 0a20 2020 204f 7574 7075 7473 3a0a  ...    Outputs:.
+00018510: 2020 2020 2020 2020 6466 743a 206f 7269          dft: ori
+00018520: 6769 6e61 6c20 6461 7461 6672 616d 6520  ginal dataframe 
+00018530: 7769 7468 2061 6464 6974 696f 6e61 6c20  with additional 
+00018540: 636f 6c75 6d6e 7320 6372 6561 7465 6420  columns created 
+00018550: 6279 2073 706c 6974 7469 6e67 2074 6865  by splitting the
+00018560: 2066 6965 6c64 2e0a 2020 2020 2020 2020   field..        
+00018570: 6e65 775f 6e61 6d65 735f 6c69 7374 3a20  new_names_list: 
+00018580: 7468 6520 6c69 7374 206f 6620 6e65 7720  the list of new 
+00018590: 636f 6c75 6d6e 7320 6372 6561 7465 6420  columns created 
+000185a0: 6279 2074 6869 7320 6675 6e63 7469 6f6e  by this function
+000185b0: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
 000185c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000185d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000185e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000185f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018610: 2323 2323 2323 0a20 2020 2022 2222 0a20  ######.    """. 
-00018620: 2020 2064 665f 6669 656c 6420 3d20 6466     df_field = df
-00018630: 5f69 6e5b 6669 656c 645d 2e76 616c 7565  _in[field].value
-00018640: 730a 2020 2020 6466 203d 2063 6f70 792e  s.    df = copy.
-00018650: 6465 6570 636f 7079 2864 665f 696e 290a  deepcopy(df_in).
-00018660: 2020 2020 2323 2320 4669 7273 7420 636f      ### First co
-00018670: 7079 2020 7768 6174 6576 6572 2069 7320  py  whatever is 
-00018680: 696e 2074 6861 7420 6669 656c 6420 736f  in that field so
-00018690: 2077 6520 6361 6e20 7361 7665 2069 7420   we can save it 
-000186a0: 666f 7220 6c61 7465 7220 2323 230a 2020  for later ###.  
-000186b0: 2020 2323 2320 5265 6d65 6d62 6572 2074    ### Remember t
-000186c0: 6861 7420 6669 6c6c 6e61 206f 6e6c 7920  hat fillna only 
-000186d0: 776f 726b 7320 6174 2064 6174 6166 7261  works at datafra
-000186e0: 6d65 206c 6576 656c 2120 2323 230a 2020  me level! ###.  
-000186f0: 2020 6466 5b5b 6669 656c 645d 5d20 3d20    df[[field]] = 
-00018700: 6466 5b5b 6669 656c 645d 5d2e 6669 6c6c  df[[field]].fill
-00018710: 6e61 2866 696c 6c65 7229 0a20 2020 2069  na(filler).    i
-00018720: 6620 6164 645f 636f 756e 745f 6669 656c  f add_count_fiel
-00018730: 643a 0a20 2020 2020 2020 2023 2323 2074  d:.        ### t
-00018740: 6865 7265 2077 696c 6c20 6265 206f 6e65  here will be one
-00018750: 2065 7874 7261 2066 6965 6c64 2063 7265   extra field cre
-00018760: 6174 6564 2077 6865 6e20 7765 2063 6f75  ated when we cou
-00018770: 6e74 2074 6865 206e 756d 6265 7220 6f66  nt the number of
-00018780: 2063 6f6e 7465 6e74 7320 696e 2065 6163   contents in eac
-00018790: 6820 6669 656c 6420 2323 230a 2020 2020  h field ###.    
-000187a0: 2020 2020 6d61 785f 7468 696e 6773 203d      max_things =
-000187b0: 2064 665b 6669 656c 645d 2e6d 6170 286c   df[field].map(l
-000187c0: 616d 6264 6120 783a 206c 656e 2878 2e73  ambda x: len(x.s
-000187d0: 706c 6974 2873 706c 6974 7465 7229 2929  plit(splitter)))
-000187e0: 2e6d 6178 2829 202b 2031 0a20 2020 2065  .max() + 1.    e
-000187f0: 6c73 653a 0a20 2020 2020 2020 206d 6178  lse:.        max
-00018800: 5f74 6869 6e67 7320 3d20 6466 5b66 6965  _things = df[fie
-00018810: 6c64 5d2e 6d61 7028 6c61 6d62 6461 2078  ld].map(lambda x
-00018820: 3a20 6c65 6e28 782e 7370 6c69 7428 7370  : len(x.split(sp
-00018830: 6c69 7474 6572 2929 292e 6d61 7828 290a  litter))).max().
-00018840: 2020 2020 6966 206c 656e 286e 6577 5f6e      if len(new_n
-00018850: 616d 6573 5f6c 6973 7429 203d 3d20 303a  ames_list) == 0:
-00018860: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00018870: 2020 2020 4d61 782e 2063 6f6c 756d 6e73      Max. columns
-00018880: 2063 7265 6174 6564 2062 7920 7370 6c69   created by spli
-00018890: 7474 696e 6720 2573 2066 6965 6c64 2069  tting %s field i
-000188a0: 7320 2564 2e27 2025 280a 2020 2020 2020  s %d.' %(.      
-000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188c0: 2020 2020 2020 6669 656c 642c 6d61 785f        field,max_
-000188d0: 7468 696e 6773 2929 0a20 2020 2065 6c73  things)).    els
-000188e0: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
-000188f0: 7420 6d61 785f 7468 696e 6773 203d 3d20  t max_things == 
-00018900: 6c65 6e28 6e65 775f 6e61 6d65 735f 6c69  len(new_names_li
-00018910: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-00018920: 2070 7269 6e74 2822 2222 2020 2020 4d61   print("""    Ma
-00018930: 782e 2063 6f6c 756d 6e73 2063 7265 6174  x. columns creat
-00018940: 6564 2062 7920 7370 6c69 7474 696e 6720  ed by splitting 
-00018950: 2573 2066 6965 6c64 2069 7320 2564 2062  %s field is %d b
-00018960: 7574 2079 6f75 2068 6176 6520 6769 7665  ut you have give
-00018970: 6e20 2564 0a20 2020 2020 2020 2020 2020  n %d.           
-00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
-000189a0: 6f6e 6c79 2e20 5365 6c65 6374 696e 6720  only. Selecting 
-000189b0: 6669 7273 7420 2564 2222 2220 2528 0a20  first %d""" %(. 
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189d0: 2020 2020 2020 2066 6965 6c64 2c6d 6178         field,max
-000189e0: 5f74 6869 6e67 732c 6c65 6e28 6e65 775f  _things,len(new_
-000189f0: 6e61 6d65 735f 6c69 7374 292c 6c65 6e28  names_list),len(
-00018a00: 6e65 775f 6e61 6d65 735f 6c69 7374 2929  new_names_list))
-00018a10: 290a 2020 2020 2323 2320 5468 6973 2063  ).    ### This c
-00018a20: 7265 6174 6573 2061 206e 6577 2066 6965  reates a new fie
-00018a30: 6c64 2074 6861 7420 636f 756e 7473 2074  ld that counts t
-00018a40: 6865 206e 756d 6265 7220 6f66 2074 6869  he number of thi
-00018a50: 6e67 7320 7468 6174 2061 7265 2069 6e20  ngs that are in 
-00018a60: 7468 6174 2066 6965 6c64 2e0a 2020 2020  that field..    
-00018a70: 6966 2061 6464 5f63 6f75 6e74 5f66 6965  if add_count_fie
-00018a80: 6c64 3a0a 2020 2020 2020 2020 2323 2323  ld:.        ####
-00018a90: 2074 6869 7320 636f 756e 7473 2074 6865   this counts the
-00018aa0: 206e 756d 6265 7220 6f66 2063 6f6e 7465   number of conte
-00018ab0: 6e74 7320 6166 7465 7220 7370 6c69 7474  nts after splitt
-00018ac0: 696e 6720 6561 6368 2072 6f77 2077 6869  ing each row whi
-00018ad0: 6368 2076 6172 6965 732e 2048 656e 6365  ch varies. Hence
-00018ae0: 2069 7420 6865 6c70 732e 0a20 2020 2020   it helps..     
-00018af0: 2020 206e 756d 5f70 726f 6475 6374 735f     num_products_
-00018b00: 7669 6577 6564 203d 2027 436f 6e74 656e  viewed = 'Conten
-00018b10: 745f 436f 756e 745f 696e 5f27 2b66 6965  t_Count_in_'+fie
-00018b20: 6c64 0a20 2020 2020 2020 2064 665b 6e75  ld.        df[nu
-00018b30: 6d5f 7072 6f64 7563 7473 5f76 6965 7765  m_products_viewe
-00018b40: 645d 203d 2064 665b 6669 656c 645d 2e6d  d] = df[field].m
-00018b50: 6170 286c 616d 6264 6120 783a 206c 656e  ap(lambda x: len
-00018b60: 2878 2e73 706c 6974 2873 706c 6974 7465  (x.split(splitte
-00018b70: 7229 2929 2e76 616c 7565 730a 2020 2020  r))).values.    
-00018b80: 2323 2320 436c 6561 6e20 7570 2074 6865  ### Clean up the
-00018b90: 2066 6965 6c64 2073 7563 6820 7468 6174   field such that
-00018ba0: 2069 7420 6861 7320 7468 6520 7269 6768   it has the righ
-00018bb0: 7420 6e75 6d62 6572 206f 6620 7370 6c69  t number of spli
-00018bc0: 7420 6368 6172 7320 6f74 6865 7277 6973  t chars otherwis
-00018bd0: 6520 6164 6420 746f 2069 740a 2020 2020  e add to it.    
-00018be0: 2323 2320 5468 6973 2066 696c 6c73 2075  ### This fills u
-00018bf0: 7020 7468 6520 6669 656c 6420 7769 7468  p the field with
-00018c00: 2065 6d70 7479 2073 7472 696e 6773 2062   empty strings b
-00018c10: 6574 7765 656e 2065 6163 6820 7370 6c69  etween each spli
-00018c20: 7474 6572 2e20 596f 7520 6361 6e27 7420  tter. You can't 
-00018c30: 646f 206d 7563 6820 6162 6f75 7420 6974  do much about it
-00018c40: 2e0a 2020 2020 2323 2323 204c 6561 7665  ..    #### Leave
-00018c50: 2074 6869 7320 6173 2069 7420 6973 2e20   this as it is. 
-00018c60: 4974 2069 7320 6e6f 7420 736f 6d65 7468  It is not someth
-00018c70: 696e 6720 796f 7520 6361 6e20 646f 2072  ing you can do r
-00018c80: 6967 6874 206e 6f77 2e20 4974 2077 6f72  ight now. It wor
-00018c90: 6b73 2e0a 2020 2020 6669 6c6c 5f73 7472  ks..    fill_str
-00018ca0: 696e 6720 3d20 7370 6c69 7474 6572 202b  ing = splitter +
-00018cb0: 2066 696c 6c65 720a 2020 2020 6466 5b66   filler.    df[f
-00018cc0: 6965 6c64 5d20 3d20 6466 5b66 6965 6c64  ield] = df[field
-00018cd0: 5d2e 6d61 7028 6c61 6d62 6461 2078 3a20  ].map(lambda x: 
-00018ce0: 782b 6669 6c6c 5f73 7472 696e 672a 286d  x+fill_string*(m
-00018cf0: 6178 5f74 6869 6e67 732d 6c65 6e28 782e  ax_things-len(x.
-00018d00: 7370 6c69 7428 7370 6c69 7474 6572 2929  split(splitter))
-00018d10: 2920 6966 206c 656e 280a 2020 2020 2020  ) if len(.      
+00018600: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
+00018610: 2222 220a 2020 2020 6466 5f66 6965 6c64  """.    df_field
+00018620: 203d 2064 665f 696e 5b66 6965 6c64 5d2e   = df_in[field].
+00018630: 7661 6c75 6573 0a20 2020 2064 6620 3d20  values.    df = 
+00018640: 636f 7079 2e64 6565 7063 6f70 7928 6466  copy.deepcopy(df
+00018650: 5f69 6e29 0a20 2020 2023 2323 2046 6972  _in).    ### Fir
+00018660: 7374 2063 6f70 7920 2077 6861 7465 7665  st copy  whateve
+00018670: 7220 6973 2069 6e20 7468 6174 2066 6965  r is in that fie
+00018680: 6c64 2073 6f20 7765 2063 616e 2073 6176  ld so we can sav
+00018690: 6520 6974 2066 6f72 206c 6174 6572 2023  e it for later #
+000186a0: 2323 0a20 2020 2023 2323 2052 656d 656d  ##.    ### Remem
+000186b0: 6265 7220 7468 6174 2066 696c 6c6e 6120  ber that fillna 
+000186c0: 6f6e 6c79 2077 6f72 6b73 2061 7420 6461  only works at da
+000186d0: 7461 6672 616d 6520 6c65 7665 6c21 2023  taframe level! #
+000186e0: 2323 0a20 2020 2064 665b 5b66 6965 6c64  ##.    df[[field
+000186f0: 5d5d 203d 2064 665b 5b66 6965 6c64 5d5d  ]] = df[[field]]
+00018700: 2e66 696c 6c6e 6128 6669 6c6c 6572 290a  .fillna(filler).
+00018710: 2020 2020 6966 2061 6464 5f63 6f75 6e74      if add_count
+00018720: 5f66 6965 6c64 3a0a 2020 2020 2020 2020  _field:.        
+00018730: 2323 2320 7468 6572 6520 7769 6c6c 2062  ### there will b
+00018740: 6520 6f6e 6520 6578 7472 6120 6669 656c  e one extra fiel
+00018750: 6420 6372 6561 7465 6420 7768 656e 2077  d created when w
+00018760: 6520 636f 756e 7420 7468 6520 6e75 6d62  e count the numb
+00018770: 6572 206f 6620 636f 6e74 656e 7473 2069  er of contents i
+00018780: 6e20 6561 6368 2066 6965 6c64 2023 2323  n each field ###
+00018790: 0a20 2020 2020 2020 206d 6178 5f74 6869  .        max_thi
+000187a0: 6e67 7320 3d20 6466 5b66 6965 6c64 5d2e  ngs = df[field].
+000187b0: 6d61 7028 6c61 6d62 6461 2078 3a20 6c65  map(lambda x: le
+000187c0: 6e28 782e 7370 6c69 7428 7370 6c69 7474  n(x.split(splitt
+000187d0: 6572 2929 292e 6d61 7828 2920 2b20 310a  er))).max() + 1.
+000187e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000187f0: 2020 6d61 785f 7468 696e 6773 203d 2064    max_things = d
+00018800: 665b 6669 656c 645d 2e6d 6170 286c 616d  f[field].map(lam
+00018810: 6264 6120 783a 206c 656e 2878 2e73 706c  bda x: len(x.spl
+00018820: 6974 2873 706c 6974 7465 7229 2929 2e6d  it(splitter))).m
+00018830: 6178 2829 0a20 2020 2069 6620 6c65 6e28  ax().    if len(
+00018840: 6e65 775f 6e61 6d65 735f 6c69 7374 2920  new_names_list) 
+00018850: 3d3d 2030 3a0a 2020 2020 2020 2020 7072  == 0:.        pr
+00018860: 696e 7428 2720 2020 204d 6178 2e20 636f  int('    Max. co
+00018870: 6c75 6d6e 7320 6372 6561 7465 6420 6279  lumns created by
+00018880: 2073 706c 6974 7469 6e67 2025 7320 6669   splitting %s fi
+00018890: 656c 6420 6973 2025 642e 2720 2528 0a20  eld is %d.' %(. 
+000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188b0: 2020 2020 2020 2020 2020 2066 6965 6c64             field
+000188c0: 2c6d 6178 5f74 6869 6e67 7329 290a 2020  ,max_things)).  
+000188d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000188e0: 6966 206e 6f74 206d 6178 5f74 6869 6e67  if not max_thing
+000188f0: 7320 3d3d 206c 656e 286e 6577 5f6e 616d  s == len(new_nam
+00018900: 6573 5f6c 6973 7429 3a0a 2020 2020 2020  es_list):.      
+00018910: 2020 2020 2020 7072 696e 7428 2222 2220        print(""" 
+00018920: 2020 204d 6178 2e20 636f 6c75 6d6e 7320     Max. columns 
+00018930: 6372 6561 7465 6420 6279 2073 706c 6974  created by split
+00018940: 7469 6e67 2025 7320 6669 656c 6420 6973  ting %s field is
+00018950: 2025 6420 6275 7420 796f 7520 6861 7665   %d but you have
+00018960: 2067 6976 656e 2025 640a 2020 2020 2020   given %d.      
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018980: 2020 2020 2020 7661 7269 6162 6c65 206e        variable n
+00018990: 616d 6573 206f 6e6c 792e 2053 656c 6563  ames only. Selec
+000189a0: 7469 6e67 2066 6972 7374 2025 6422 2222  ting first %d"""
+000189b0: 2025 280a 2020 2020 2020 2020 2020 2020   %(.            
+000189c0: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+000189d0: 642c 6d61 785f 7468 696e 6773 2c6c 656e  d,max_things,len
+000189e0: 286e 6577 5f6e 616d 6573 5f6c 6973 7429  (new_names_list)
+000189f0: 2c6c 656e 286e 6577 5f6e 616d 6573 5f6c  ,len(new_names_l
+00018a00: 6973 7429 2929 0a20 2020 2023 2323 2054  ist))).    ### T
+00018a10: 6869 7320 6372 6561 7465 7320 6120 6e65  his creates a ne
+00018a20: 7720 6669 656c 6420 7468 6174 2063 6f75  w field that cou
+00018a30: 6e74 7320 7468 6520 6e75 6d62 6572 206f  nts the number o
+00018a40: 6620 7468 696e 6773 2074 6861 7420 6172  f things that ar
+00018a50: 6520 696e 2074 6861 7420 6669 656c 642e  e in that field.
+00018a60: 0a20 2020 2069 6620 6164 645f 636f 756e  .    if add_coun
+00018a70: 745f 6669 656c 643a 0a20 2020 2020 2020  t_field:.       
+00018a80: 2023 2323 2320 7468 6973 2063 6f75 6e74   #### this count
+00018a90: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
+00018aa0: 636f 6e74 656e 7473 2061 6674 6572 2073  contents after s
+00018ab0: 706c 6974 7469 6e67 2065 6163 6820 726f  plitting each ro
+00018ac0: 7720 7768 6963 6820 7661 7269 6573 2e20  w which varies. 
+00018ad0: 4865 6e63 6520 6974 2068 656c 7073 2e0a  Hence it helps..
+00018ae0: 2020 2020 2020 2020 6e75 6d5f 7072 6f64          num_prod
+00018af0: 7563 7473 5f76 6965 7765 6420 3d20 2743  ucts_viewed = 'C
+00018b00: 6f6e 7465 6e74 5f43 6f75 6e74 5f69 6e5f  ontent_Count_in_
+00018b10: 272b 6669 656c 640a 2020 2020 2020 2020  '+field.        
+00018b20: 6466 5b6e 756d 5f70 726f 6475 6374 735f  df[num_products_
+00018b30: 7669 6577 6564 5d20 3d20 6466 5b66 6965  viewed] = df[fie
+00018b40: 6c64 5d2e 6d61 7028 6c61 6d62 6461 2078  ld].map(lambda x
+00018b50: 3a20 6c65 6e28 782e 7370 6c69 7428 7370  : len(x.split(sp
+00018b60: 6c69 7474 6572 2929 292e 7661 6c75 6573  litter))).values
+00018b70: 0a20 2020 2023 2323 2043 6c65 616e 2075  .    ### Clean u
+00018b80: 7020 7468 6520 6669 656c 6420 7375 6368  p the field such
+00018b90: 2074 6861 7420 6974 2068 6173 2074 6865   that it has the
+00018ba0: 2072 6967 6874 206e 756d 6265 7220 6f66   right number of
+00018bb0: 2073 706c 6974 2063 6861 7273 206f 7468   split chars oth
+00018bc0: 6572 7769 7365 2061 6464 2074 6f20 6974  erwise add to it
+00018bd0: 0a20 2020 2023 2323 2054 6869 7320 6669  .    ### This fi
+00018be0: 6c6c 7320 7570 2074 6865 2066 6965 6c64  lls up the field
+00018bf0: 2077 6974 6820 656d 7074 7920 7374 7269   with empty stri
+00018c00: 6e67 7320 6265 7477 6565 6e20 6561 6368  ngs between each
+00018c10: 2073 706c 6974 7465 722e 2059 6f75 2063   splitter. You c
+00018c20: 616e 2774 2064 6f20 6d75 6368 2061 626f  an't do much abo
+00018c30: 7574 2069 742e 0a20 2020 2023 2323 2320  ut it..    #### 
+00018c40: 4c65 6176 6520 7468 6973 2061 7320 6974  Leave this as it
+00018c50: 2069 732e 2049 7420 6973 206e 6f74 2073   is. It is not s
+00018c60: 6f6d 6574 6869 6e67 2079 6f75 2063 616e  omething you can
+00018c70: 2064 6f20 7269 6768 7420 6e6f 772e 2049   do right now. I
+00018c80: 7420 776f 726b 732e 0a20 2020 2066 696c  t works..    fil
+00018c90: 6c5f 7374 7269 6e67 203d 2073 706c 6974  l_string = split
+00018ca0: 7465 7220 2b20 6669 6c6c 6572 0a20 2020  ter + filler.   
+00018cb0: 2064 665b 6669 656c 645d 203d 2064 665b   df[field] = df[
+00018cc0: 6669 656c 645d 2e6d 6170 286c 616d 6264  field].map(lambd
+00018cd0: 6120 783a 2078 2b66 696c 6c5f 7374 7269  a x: x+fill_stri
+00018ce0: 6e67 2a28 6d61 785f 7468 696e 6773 2d6c  ng*(max_things-l
+00018cf0: 656e 2878 2e73 706c 6974 2873 706c 6974  en(x.split(split
+00018d00: 7465 7229 2929 2069 6620 6c65 6e28 0a20  ter))) if len(. 
+00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d30: 2020 2020 2020 2020 2020 2020 2020 782e                x.
-00018d40: 7370 6c69 7428 7370 6c69 7474 6572 2929  split(splitter))
-00018d50: 203c 206d 6178 5f74 6869 6e67 7320 656c   < max_things el
-00018d60: 7365 2078 290a 2020 2020 2323 2323 2323  se x).    ######
-00018d70: 204e 6f77 2079 6f75 2063 7265 6174 6520   Now you create 
-00018d80: 6e65 7720 6669 656c 6473 2062 7920 7370  new fields by sp
-00018d90: 6c69 7420 7468 6520 6f6e 6520 6c61 7267  lit the one larg
-00018da0: 6520 6669 656c 6420 2323 2323 2323 2323  e field ########
-00018db0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00018dc0: 6365 286e 6577 5f6e 616d 6573 5f6c 6973  ce(new_names_lis
-00018dd0: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
-00018de0: 2069 6620 6e65 775f 6e61 6d65 735f 6c69   if new_names_li
-00018df0: 7374 203d 3d20 2727 3a0a 2020 2020 2020  st == '':.      
-00018e00: 2020 2020 2020 6e65 775f 6e61 6d65 735f        new_names_
-00018e10: 6c69 7374 203d 205b 6669 656c 642b 275f  list = [field+'_
-00018e20: 272b 7374 7228 6929 2066 6f72 2069 2069  '+str(i) for i i
-00018e30: 6e20 7261 6e67 6528 312c 6d61 785f 7468  n range(1,max_th
-00018e40: 696e 6773 2b31 295d 0a20 2020 2020 2020  ings+1)].       
-00018e50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00018e60: 2020 206e 6577 5f6e 616d 6573 5f6c 6973     new_names_lis
-00018e70: 7420 3d20 5b6e 6577 5f6e 616d 6573 5f6c  t = [new_names_l
-00018e80: 6973 745d 0a20 2020 2023 2323 2046 6972  ist].    ### Fir
-00018e90: 7374 2066 696c 6c20 656d 7074 7920 7370  st fill empty sp
-00018ea0: 6163 6573 206f 7220 4e61 4e73 2077 6974  aces or NaNs wit
-00018eb0: 6820 6669 6c6c 6572 2023 2323 0a20 2020  h filler ###.   
-00018ec0: 2064 662e 6c6f 635b 6466 5b66 6965 6c64   df.loc[df[field
-00018ed0: 5d20 3d3d 2073 706c 6974 7465 722c 2066  ] == splitter, f
-00018ee0: 6965 6c64 5d20 3d20 6669 6c6c 6572 0a20  ield] = filler. 
-00018ef0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00018f00: 6528 6c65 6e28 6e65 775f 6e61 6d65 735f  e(len(new_names_
-00018f10: 6c69 7374 2929 3a0a 2020 2020 2020 2020  list)):.        
-00018f20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00018f30: 2064 665b 6e65 775f 6e61 6d65 735f 6c69   df[new_names_li
-00018f40: 7374 5b69 5d5d 203d 2064 665b 6669 656c  st[i]] = df[fiel
-00018f50: 645d 2e6d 6170 286c 616d 6264 6120 783a  d].map(lambda x:
-00018f60: 2078 2e73 706c 6974 2873 706c 6974 7465   x.split(splitte
-00018f70: 7229 5b69 5d0a 2020 2020 2020 2020 2020  r)[i].          
+00018d30: 2020 2078 2e73 706c 6974 2873 706c 6974     x.split(split
+00018d40: 7465 7229 2920 3c20 6d61 785f 7468 696e  ter)) < max_thin
+00018d50: 6773 2065 6c73 6520 7829 0a20 2020 2023  gs else x).    #
+00018d60: 2323 2323 2320 4e6f 7720 796f 7520 6372  ##### Now you cr
+00018d70: 6561 7465 206e 6577 2066 6965 6c64 7320  eate new fields 
+00018d80: 6279 2073 706c 6974 2074 6865 206f 6e65  by split the one
+00018d90: 206c 6172 6765 2066 6965 6c64 2023 2323   large field ###
+00018da0: 2323 2323 230a 2020 2020 6966 2069 7369  #####.    if isi
+00018db0: 6e73 7461 6e63 6528 6e65 775f 6e61 6d65  nstance(new_name
+00018dc0: 735f 6c69 7374 2c20 7374 7229 3a0a 2020  s_list, str):.  
+00018dd0: 2020 2020 2020 6966 206e 6577 5f6e 616d        if new_nam
+00018de0: 6573 5f6c 6973 7420 3d3d 2027 273a 0a20  es_list == '':. 
+00018df0: 2020 2020 2020 2020 2020 206e 6577 5f6e             new_n
+00018e00: 616d 6573 5f6c 6973 7420 3d20 5b66 6965  ames_list = [fie
+00018e10: 6c64 2b27 5f27 2b73 7472 2869 2920 666f  ld+'_'+str(i) fo
+00018e20: 7220 6920 696e 2072 616e 6765 2831 2c6d  r i in range(1,m
+00018e30: 6178 5f74 6869 6e67 732b 3129 5d0a 2020  ax_things+1)].  
+00018e40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00018e50: 2020 2020 2020 2020 6e65 775f 6e61 6d65          new_name
+00018e60: 735f 6c69 7374 203d 205b 6e65 775f 6e61  s_list = [new_na
+00018e70: 6d65 735f 6c69 7374 5d0a 2020 2020 2323  mes_list].    ##
+00018e80: 2320 4669 7273 7420 6669 6c6c 2065 6d70  # First fill emp
+00018e90: 7479 2073 7061 6365 7320 6f72 204e 614e  ty spaces or NaN
+00018ea0: 7320 7769 7468 2066 696c 6c65 7220 2323  s with filler ##
+00018eb0: 230a 2020 2020 6466 2e6c 6f63 5b64 665b  #.    df.loc[df[
+00018ec0: 6669 656c 645d 203d 3d20 7370 6c69 7474  field] == splitt
+00018ed0: 6572 2c20 6669 656c 645d 203d 2066 696c  er, field] = fil
+00018ee0: 6c65 720a 2020 2020 666f 7220 6920 696e  ler.    for i in
+00018ef0: 2072 616e 6765 286c 656e 286e 6577 5f6e   range(len(new_n
+00018f00: 616d 6573 5f6c 6973 7429 293a 0a20 2020  ames_list)):.   
+00018f10: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00018f20: 2020 2020 2020 6466 5b6e 6577 5f6e 616d        df[new_nam
+00018f30: 6573 5f6c 6973 745b 695d 5d20 3d20 6466  es_list[i]] = df
+00018f40: 5b66 6965 6c64 5d2e 6d61 7028 6c61 6d62  [field].map(lamb
+00018f50: 6461 2078 3a20 782e 7370 6c69 7428 7370  da x: x.split(sp
+00018f60: 6c69 7474 6572 295b 695d 0a20 2020 2020  litter)[i].     
+00018f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 6966 2073 706c 6974 7465 7220 696e 2078  if splitter in x
-00018fb0: 2065 6c73 6520 6669 6c6c 6572 290a 2020   else filler).  
-00018fc0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00018fd0: 2020 2020 2020 2020 2020 6466 5b6e 6577            df[new
-00018fe0: 5f6e 616d 6573 5f6c 6973 745b 695d 5d20  _names_list[i]] 
-00018ff0: 3d20 6669 6c6c 6572 0a20 2020 2020 2020  = filler.       
-00019000: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00019010: 2020 2323 2320 7468 6572 6520 6973 2072    ### there is r
-00019020: 6561 6c6c 7920 6e6f 7468 696e 6720 796f  eally nothing yo
-00019030: 7520 6361 6e20 646f 2074 6f20 6669 6c6c  u can do to fill
-00019040: 2075 7020 7369 6e63 6520 7468 6579 2061   up since they a
-00019050: 7265 2066 696c 6c65 6420 7769 7468 2065  re filled with e
-00019060: 6d70 7479 2073 7472 696e 6773 2e0a 2020  mpty strings..  
-00019070: 2020 2323 2323 204c 6561 7665 2074 6869    #### Leave thi
-00019080: 7320 6173 2069 7420 6973 2e20 4974 2069  s as it is. It i
-00019090: 7320 6e6f 7420 736f 6d65 7468 696e 6720  s not something 
-000190a0: 796f 7520 6361 6e20 646f 2072 6967 6874  you can do right
-000190b0: 206e 6f77 2e20 4974 2077 6f72 6b73 2e0a   now. It works..
-000190c0: 2020 2020 6466 5b66 6965 6c64 5d20 3d20      df[field] = 
-000190d0: 6466 5f66 6965 6c64 0a20 2020 2072 6574  df_field.    ret
-000190e0: 7572 6e20 6466 2c20 6e65 775f 6e61 6d65  urn df, new_name
-000190f0: 735f 6c69 7374 0a23 2323 2323 2323 2323  s_list.#########
+00018f90: 2020 2020 2069 6620 7370 6c69 7474 6572       if splitter
+00018fa0: 2069 6e20 7820 656c 7365 2066 696c 6c65   in x else fille
+00018fb0: 7229 0a20 2020 2020 2020 2065 7863 6570  r).        excep
+00018fc0: 743a 0a20 2020 2020 2020 2020 2020 2064  t:.            d
+00018fd0: 665b 6e65 775f 6e61 6d65 735f 6c69 7374  f[new_names_list
+00018fe0: 5b69 5d5d 203d 2066 696c 6c65 720a 2020  [i]] = filler.  
+00018ff0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00019000: 7565 0a20 2020 2023 2323 2074 6865 7265  ue.    ### there
+00019010: 2069 7320 7265 616c 6c79 206e 6f74 6869   is really nothi
+00019020: 6e67 2079 6f75 2063 616e 2064 6f20 746f  ng you can do to
+00019030: 2066 696c 6c20 7570 2073 696e 6365 2074   fill up since t
+00019040: 6865 7920 6172 6520 6669 6c6c 6564 2077  hey are filled w
+00019050: 6974 6820 656d 7074 7920 7374 7269 6e67  ith empty string
+00019060: 732e 0a20 2020 2023 2323 2320 4c65 6176  s..    #### Leav
+00019070: 6520 7468 6973 2061 7320 6974 2069 732e  e this as it is.
+00019080: 2049 7420 6973 206e 6f74 2073 6f6d 6574   It is not somet
+00019090: 6869 6e67 2079 6f75 2063 616e 2064 6f20  hing you can do 
+000190a0: 7269 6768 7420 6e6f 772e 2049 7420 776f  right now. It wo
+000190b0: 726b 732e 0a20 2020 2064 665b 6669 656c  rks..    df[fiel
+000190c0: 645d 203d 2064 665f 6669 656c 640a 2020  d] = df_field.  
+000190d0: 2020 7265 7475 726e 2064 662c 206e 6577    return df, new
+000190e0: 5f6e 616d 6573 5f6c 6973 740a 2323 2323  _names_list.####
+000190f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019130: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019140: 2323 0a64 6566 2046 455f 6164 645f 6772  ##.def FE_add_gr
-00019150: 6f75 7062 795f 6665 6174 7572 6573 5f61  oupby_features_a
-00019160: 6767 7265 6761 7465 645f 746f 5f64 6174  ggregated_to_dat
-00019170: 6166 7261 6d65 2874 7261 696e 2c0a 2020  aframe(train,.  
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 6167 675f 7479 7065 732c 2020 6772    agg_types,  gr
-000191a0: 6f75 7062 795f 636f 6c75 6d6e 732c 2069  oupby_columns, i
-000191b0: 676e 6f72 655f 7661 7269 6162 6c65 732c  gnore_variables,
-000191c0: 2074 6573 743d 2222 293a 0a20 2020 2022   test=""):.    "
-000191d0: 2222 0a20 2020 2046 4520 7374 616e 6473  "".    FE stands
-000191e0: 2066 6f72 2046 6561 7475 7265 2045 6e67   for Feature Eng
-000191f0: 696e 6565 7269 6e67 2e20 5468 6973 2066  ineering. This f
-00019200: 756e 6374 696f 6e20 7065 7266 6f72 6d73  unction performs
-00019210: 2066 6561 7475 7265 2065 6e67 696e 6565   feature enginee
-00019220: 7269 6e67 206f 6e20 6461 7461 2e0a 2020  ring on data..  
-00019230: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+00019130: 2323 2323 2323 230a 6465 6620 4645 5f61  #######.def FE_a
+00019140: 6464 5f67 726f 7570 6279 5f66 6561 7475  dd_groupby_featu
+00019150: 7265 735f 6167 6772 6567 6174 6564 5f74  res_aggregated_t
+00019160: 6f5f 6461 7461 6672 616d 6528 7472 6169  o_dataframe(trai
+00019170: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00019180: 2020 2020 2020 2061 6767 5f74 7970 6573         agg_types
+00019190: 2c20 2067 726f 7570 6279 5f63 6f6c 756d  ,  groupby_colum
+000191a0: 6e73 2c20 6967 6e6f 7265 5f76 6172 6961  ns, ignore_varia
+000191b0: 626c 6573 2c20 7465 7374 3d22 2229 3a0a  bles, test=""):.
+000191c0: 2020 2020 2222 220a 2020 2020 4645 2073      """.    FE s
+000191d0: 7461 6e64 7320 666f 7220 4665 6174 7572  tands for Featur
+000191e0: 6520 456e 6769 6e65 6572 696e 672e 2054  e Engineering. T
+000191f0: 6869 7320 6675 6e63 7469 6f6e 2070 6572  his function per
+00019200: 666f 726d 7320 6665 6174 7572 6520 656e  forms feature en
+00019210: 6769 6e65 6572 696e 6720 6f6e 2064 6174  gineering on dat
+00019220: 612e 0a20 2020 2023 2323 2323 2323 2323  a..    #########
+00019230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019280: 2323 2323 2323 2323 0a20 2020 2023 2323  ########.    ###
-00019290: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-000192a0: 2069 7320 6120 7665 7279 2066 6173 7420   is a very fast 
-000192b0: 6675 6e63 7469 6f6e 2074 6861 7420 7769  function that wi
-000192c0: 6c6c 2063 6f6d 7075 7465 2061 6767 7265  ll compute aggre
-000192d0: 6761 7465 7320 666f 7220 6e75 6d65 7269  gates for numeri
-000192e0: 6373 0a20 2020 2023 2323 2020 2049 7420  cs.    ###   It 
-000192f0: 7265 7475 726e 7320 6f72 6967 696e 616c  returns original
-00019300: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
-00019310: 6164 6465 6420 6665 6174 7572 6573 2066  added features f
-00019320: 726f 6d20 6e75 6d65 7269 6320 7661 7269  rom numeric vari
-00019330: 6162 6c65 7320 6167 6772 6567 6174 6564  ables aggregated
-00019340: 0a20 2020 2023 2323 2020 2057 6861 7420  .    ###   What 
-00019350: 646f 2079 6f75 206d 6561 6e20 6167 6772  do you mean aggr
-00019360: 6567 6174 653f 2061 6767 7265 6761 7465  egate? aggregate
-00019370: 7320 6361 6e20 6265 2022 636f 756e 742c  s can be "count,
-00019380: 2022 6d65 616e 222c 2022 6d65 6469 616e   "mean", "median
-00019390: 222c 2065 7463 2e0a 2020 2020 2323 2320  ", etc..    ### 
-000193a0: 2020 5768 6174 2064 6f20 796f 7520 6167    What do you ag
-000193b0: 6772 6567 7261 7465 3f20 616c 6c20 6e75  gregrate? all nu
-000193c0: 6d65 7269 6320 636f 6c75 6d6e 7320 696e  meric columns in
-000193d0: 2079 6f75 7220 6461 7461 0a20 2020 2023   your data.    #
-000193e0: 2323 2020 2057 6861 7420 646f 2079 6f75  ##   What do you
-000193f0: 2067 726f 7570 6279 3f20 6f6e 6520 6772   groupby? one gr
-00019400: 6f75 7062 7920 636f 6c75 6d6e 2061 7420  oupby column at 
-00019410: 6120 7469 6d65 206f 7220 6d75 6c74 6970  a time or multip
-00019420: 6c65 2063 6f6c 756d 6e73 206f 6e65 2062  le columns one b
-00019430: 7920 6f6e 650a 2020 2020 2323 2320 2020  y one.    ###   
-00019440: 2020 2d2d 2069 6620 796f 7520 6769 7665    -- if you give
-00019450: 2069 7420 6120 6c69 7374 206f 6620 636f   it a list of co
-00019460: 6c75 6d6e 732c 2069 7420 7769 6c6c 2065  lumns, it will e
-00019470: 7865 6375 7465 2074 6865 2067 726f 7570  xecute the group
-00019480: 696e 6720 6f6e 6520 6279 206f 6e65 0a20  ing one by one. 
-00019490: 2020 2023 2323 2020 2057 6861 7420 6973     ###   What is
-000194a0: 2074 6865 2069 676e 6f72 655f 7661 7269   the ignore_vari
-000194b0: 6162 6c65 7320 666f 723f 2069 7420 7769  ables for? it wi
-000194c0: 6c6c 2069 676e 6f72 6520 7468 6573 6520  ll ignore these 
-000194d0: 7661 7269 6162 6c65 7320 6672 6f6d 2067  variables from g
-000194e0: 726f 7570 696e 672e 0a20 2020 2023 2323  rouping..    ###
-000194f0: 2020 204d 616b 6520 7375 7265 2074 6f20     Make sure to 
-00019500: 7265 6475 6365 2063 6f72 7265 6c61 7465  reduce correlate
-00019510: 6420 6665 6174 7572 6573 2075 7369 6e67  d features using
-00019520: 2046 455f 7265 6d6f 7665 5f76 6172 6961   FE_remove_varia
-00019530: 626c 6573 5f75 7369 6e67 5f53 554c 4f56  bles_using_SULOV
-00019540: 5f6d 6574 686f 6428 290a 2020 2020 2323  _method().    ##
+00019270: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+00019280: 2020 2323 2320 2020 5468 6973 2066 756e    ###   This fun
+00019290: 6374 696f 6e20 6973 2061 2076 6572 7920  ction is a very 
+000192a0: 6661 7374 2066 756e 6374 696f 6e20 7468  fast function th
+000192b0: 6174 2077 696c 6c20 636f 6d70 7574 6520  at will compute 
+000192c0: 6167 6772 6567 6174 6573 2066 6f72 206e  aggregates for n
+000192d0: 756d 6572 6963 730a 2020 2020 2323 2320  umerics.    ### 
+000192e0: 2020 4974 2072 6574 7572 6e73 206f 7269    It returns ori
+000192f0: 6769 6e61 6c20 6461 7461 6672 616d 6520  ginal dataframe 
+00019300: 7769 7468 2061 6464 6564 2066 6561 7475  with added featu
+00019310: 7265 7320 6672 6f6d 206e 756d 6572 6963  res from numeric
+00019320: 2076 6172 6961 626c 6573 2061 6767 7265   variables aggre
+00019330: 6761 7465 640a 2020 2020 2323 2320 2020  gated.    ###   
+00019340: 5768 6174 2064 6f20 796f 7520 6d65 616e  What do you mean
+00019350: 2061 6767 7265 6761 7465 3f20 6167 6772   aggregate? aggr
+00019360: 6567 6174 6573 2063 616e 2062 6520 2263  egates can be "c
+00019370: 6f75 6e74 2c20 226d 6561 6e22 2c20 226d  ount, "mean", "m
+00019380: 6564 6961 6e22 2c20 6574 632e 0a20 2020  edian", etc..   
+00019390: 2023 2323 2020 2057 6861 7420 646f 2079   ###   What do y
+000193a0: 6f75 2061 6767 7265 6772 6174 653f 2061  ou aggregrate? a
+000193b0: 6c6c 206e 756d 6572 6963 2063 6f6c 756d  ll numeric colum
+000193c0: 6e73 2069 6e20 796f 7572 2064 6174 610a  ns in your data.
+000193d0: 2020 2020 2323 2320 2020 5768 6174 2064      ###   What d
+000193e0: 6f20 796f 7520 6772 6f75 7062 793f 206f  o you groupby? o
+000193f0: 6e65 2067 726f 7570 6279 2063 6f6c 756d  ne groupby colum
+00019400: 6e20 6174 2061 2074 696d 6520 6f72 206d  n at a time or m
+00019410: 756c 7469 706c 6520 636f 6c75 6d6e 7320  ultiple columns 
+00019420: 6f6e 6520 6279 206f 6e65 0a20 2020 2023  one by one.    #
+00019430: 2323 2020 2020 202d 2d20 6966 2079 6f75  ##     -- if you
+00019440: 2067 6976 6520 6974 2061 206c 6973 7420   give it a list 
+00019450: 6f66 2063 6f6c 756d 6e73 2c20 6974 2077  of columns, it w
+00019460: 696c 6c20 6578 6563 7574 6520 7468 6520  ill execute the 
+00019470: 6772 6f75 7069 6e67 206f 6e65 2062 7920  grouping one by 
+00019480: 6f6e 650a 2020 2020 2323 2320 2020 5768  one.    ###   Wh
+00019490: 6174 2069 7320 7468 6520 6967 6e6f 7265  at is the ignore
+000194a0: 5f76 6172 6961 626c 6573 2066 6f72 3f20  _variables for? 
+000194b0: 6974 2077 696c 6c20 6967 6e6f 7265 2074  it will ignore t
+000194c0: 6865 7365 2076 6172 6961 626c 6573 2066  hese variables f
+000194d0: 726f 6d20 6772 6f75 7069 6e67 2e0a 2020  rom grouping..  
+000194e0: 2020 2323 2320 2020 4d61 6b65 2073 7572    ###   Make sur
+000194f0: 6520 746f 2072 6564 7563 6520 636f 7272  e to reduce corr
+00019500: 656c 6174 6564 2066 6561 7475 7265 7320  elated features 
+00019510: 7573 696e 6720 4645 5f72 656d 6f76 655f  using FE_remove_
+00019520: 7661 7269 6162 6c65 735f 7573 696e 675f  variables_using_
+00019530: 5355 4c4f 565f 6d65 7468 6f64 2829 0a20  SULOV_method(). 
+00019540: 2020 2023 2323 2323 2323 2323 2323 2323     #############
 00019550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000195a0: 2323 2323 0a20 2020 2023 2323 2049 6e70  ####.    ### Inp
-000195b0: 7574 733a 0a20 2020 2023 2323 2020 2074  uts:.    ###   t
-000195c0: 7261 696e 3a20 4a75 7374 2073 656e 7420  rain: Just sent 
-000195d0: 696e 2074 6865 2064 6174 6120 6672 616d  in the data fram
-000195e0: 6520 7768 6572 6520 796f 7520 7761 6e74  e where you want
-000195f0: 2061 6767 7265 6761 7465 6420 6665 6174   aggregated feat
-00019600: 7572 6573 2066 6f72 2e0a 2020 2020 2323  ures for..    ##
-00019610: 2320 2020 6167 675f 7479 7065 733a 206c  #   agg_types: l
-00019620: 6973 7420 6f66 2063 6f6d 7075 7461 7469  ist of computati
-00019630: 6f6e 616c 2074 7970 6573 3a20 276d 6561  onal types: 'mea
-00019640: 6e27 2c27 6d65 6469 616e 272c 2763 6f75  n','median','cou
-00019650: 6e74 272c 200a 2020 2020 2323 2320 2020  nt', .    ###   
-00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 2020 276d 6178 272c 2027 6d69 6e27 2c20    'max', 'min', 
-00019680: 2773 756d 272c 2065 7463 2e0a 2020 2020  'sum', etc..    
-00019690: 2323 2320 2020 2020 2020 2020 4f6e 6520  ###         One 
-000196a0: 6361 7665 6174 3a20 7468 6573 6520 6167  caveat: these ag
-000196b0: 675f 7479 7065 7320 6d75 7374 2062 6520  g_types must be 
-000196c0: 666f 756e 6420 696e 2074 6865 2066 6f6c  found in the fol
-000196d0: 6c6f 7769 6e67 2061 6767 5f66 756e 6320  lowing agg_func 
-000196e0: 6f66 200a 2020 2020 2323 2320 2020 2020  of .    ###     
-000196f0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-00019700: 6d70 7920 6f72 2070 616e 6461 7320 6772  mpy or pandas gr
-00019710: 6f75 7062 7920 7374 6174 656d 656e 742e  oupby statement.
-00019720: 0a20 2020 2023 2323 2020 2020 2020 2020  .    ###        
-00019730: 204c 6973 7420 6f66 2061 6767 7265 6761   List of aggrega
-00019740: 7465 7320 6176 6169 6c61 626c 653a 207b  tes available: {
-00019750: 2763 6f75 6e74 272c 2773 756d 272c 276d  'count','sum','m
-00019760: 6561 6e27 2c27 6d61 6427 2c27 6d65 6469  ean','mad','medi
-00019770: 616e 272c 276d 696e 272c 276d 6178 272c  an','min','max',
-00019780: 0a20 2020 2023 2323 2020 2020 2020 2020  .    ###        
-00019790: 2020 2020 2020 2027 6d6f 6465 272c 2761         'mode','a
-000197a0: 6273 272c 2027 7072 6f64 272c 2773 7464  bs', 'prod','std
-000197b0: 272c 2776 6172 272c 2773 656d 272c 2773  ','var','sem','s
-000197c0: 6b65 7727 2c27 6b75 7274 272c 0a20 2020  kew','kurt',.   
-000197d0: 2023 2323 2020 2020 2020 2020 2020 2020   ###            
-000197e0: 2020 2020 2771 7561 6e74 696c 6527 2c27      'quantile','
-000197f0: 6375 6d73 756d 272c 2763 756d 7072 6f64  cumsum','cumprod
-00019800: 272c 2763 756d 6d61 7827 2c27 6375 6d6d  ','cummax','cumm
-00019810: 696e 277d 0a20 2020 2023 2323 2020 2067  in'}.    ###   g
-00019820: 726f 7570 6279 5f63 6f6c 756d 6e73 3a20  roupby_columns: 
-00019830: 6361 6e20 6265 2061 2073 7472 696e 6720  can be a string 
-00019840: 7265 7072 6573 656e 7469 6e67 2061 2073  representing a s
-00019850: 696e 676c 6520 636f 6c75 6d6e 206f 7220  ingle column or 
-00019860: 6120 6c69 7374 206f 6620 0a20 2020 2023  a list of .    #
-00019870: 2323 2020 2020 2020 2020 2020 2020 2020  ##              
-00019880: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
-00019890: 636f 6c75 6d6e 730a 2020 2020 2323 2320  columns.    ### 
-000198a0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-000198b0: 6974 2077 696c 6c20 6772 6f75 7062 7920  it will groupby 
-000198c0: 616c 6c20 7468 6520 6e75 6d65 7269 6320  all the numeric 
-000198d0: 6665 6174 7572 6573 2075 7369 6e67 206f  features using o
-000198e0: 6e65 2067 726f 7570 6279 2063 6f6c 756d  ne groupby colum
-000198f0: 6e20 0a20 2020 2023 2323 2020 2020 2020  n .    ###      
-00019900: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00019910: 2061 2074 696d 6520 696e 2061 206c 6f6f   a time in a loo
-00019920: 702e 0a20 2020 2023 2323 2020 2069 676e  p..    ###   ign
-00019930: 6f72 655f 7661 7269 6162 6c65 733a 206c  ore_variables: l
-00019940: 6973 7420 6f66 2076 6172 6961 626c 6573  ist of variables
-00019950: 2074 6f20 6967 6e6f 7265 2061 6d6f 6e67   to ignore among
-00019960: 206e 756d 6572 6963 2076 6172 6961 626c   numeric variabl
-00019970: 6573 2069 6e0a 2020 2020 2323 2320 2020  es in.    ###   
-00019980: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00019990: 6120 7369 6e63 6520 7468 6579 206d 6179  a since they may
-000199a0: 2062 6520 4944 2076 6172 6961 626c 6573   be ID variables
-000199b0: 2e0a 2020 2020 2323 2320 4f75 7470 7574  ..    ### Output
-000199c0: 733a 0a20 2020 2023 2323 2020 2020 2052  s:.    ###     R
-000199d0: 6574 7572 6e73 2074 6865 206f 7269 6769  eturns the origi
-000199e0: 6e61 6c20 6461 7461 6672 616d 6520 7769  nal dataframe wi
-000199f0: 7468 2061 6464 6974 696f 6e61 6c20 6665  th additional fe
-00019a00: 6174 7572 6573 2063 7265 6174 6564 2062  atures created b
-00019a10: 7920 7468 6973 2066 756e 6374 696f 6e2e  y this function.
-00019a20: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
+00019590: 2323 2323 2323 2323 230a 2020 2020 2323  #########.    ##
+000195a0: 2320 496e 7075 7473 3a0a 2020 2020 2323  # Inputs:.    ##
+000195b0: 2320 2020 7472 6169 6e3a 204a 7573 7420  #   train: Just 
+000195c0: 7365 6e74 2069 6e20 7468 6520 6461 7461  sent in the data
+000195d0: 2066 7261 6d65 2077 6865 7265 2079 6f75   frame where you
+000195e0: 2077 616e 7420 6167 6772 6567 6174 6564   want aggregated
+000195f0: 2066 6561 7475 7265 7320 666f 722e 0a20   features for.. 
+00019600: 2020 2023 2323 2020 2061 6767 5f74 7970     ###   agg_typ
+00019610: 6573 3a20 6c69 7374 206f 6620 636f 6d70  es: list of comp
+00019620: 7574 6174 696f 6e61 6c20 7479 7065 733a  utational types:
+00019630: 2027 6d65 616e 272c 276d 6564 6961 6e27   'mean','median'
+00019640: 2c27 636f 756e 7427 2c20 0a20 2020 2023  ,'count', .    #
+00019650: 2323 2020 2020 2020 2020 2020 2020 2020  ##              
+00019660: 2020 2020 2020 2027 6d61 7827 2c20 276d         'max', 'm
+00019670: 696e 272c 2027 7375 6d27 2c20 6574 632e  in', 'sum', etc.
+00019680: 0a20 2020 2023 2323 2020 2020 2020 2020  .    ###        
+00019690: 204f 6e65 2063 6176 6561 743a 2074 6865   One caveat: the
+000196a0: 7365 2061 6767 5f74 7970 6573 206d 7573  se agg_types mus
+000196b0: 7420 6265 2066 6f75 6e64 2069 6e20 7468  t be found in th
+000196c0: 6520 666f 6c6c 6f77 696e 6720 6167 675f  e following agg_
+000196d0: 6675 6e63 206f 6620 0a20 2020 2023 2323  func of .    ###
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2020 206e 756d 7079 206f 7220 7061 6e64     numpy or pand
+00019700: 6173 2067 726f 7570 6279 2073 7461 7465  as groupby state
+00019710: 6d65 6e74 2e0a 2020 2020 2323 2320 2020  ment..    ###   
+00019720: 2020 2020 2020 4c69 7374 206f 6620 6167        List of ag
+00019730: 6772 6567 6174 6573 2061 7661 696c 6162  gregates availab
+00019740: 6c65 3a20 7b27 636f 756e 7427 2c27 7375  le: {'count','su
+00019750: 6d27 2c27 6d65 616e 272c 276d 6164 272c  m','mean','mad',
+00019760: 276d 6564 6961 6e27 2c27 6d69 6e27 2c27  'median','min','
+00019770: 6d61 7827 2c0a 2020 2020 2323 2320 2020  max',.    ###   
+00019780: 2020 2020 2020 2020 2020 2020 276d 6f64              'mod
+00019790: 6527 2c27 6162 7327 2c20 2770 726f 6427  e','abs', 'prod'
+000197a0: 2c27 7374 6427 2c27 7661 7227 2c27 7365  ,'std','var','se
+000197b0: 6d27 2c27 736b 6577 272c 276b 7572 7427  m','skew','kurt'
+000197c0: 2c0a 2020 2020 2323 2320 2020 2020 2020  ,.    ###       
+000197d0: 2020 2020 2020 2020 2027 7175 616e 7469           'quanti
+000197e0: 6c65 272c 2763 756d 7375 6d27 2c27 6375  le','cumsum','cu
+000197f0: 6d70 726f 6427 2c27 6375 6d6d 6178 272c  mprod','cummax',
+00019800: 2763 756d 6d69 6e27 7d0a 2020 2020 2323  'cummin'}.    ##
+00019810: 2320 2020 6772 6f75 7062 795f 636f 6c75  #   groupby_colu
+00019820: 6d6e 733a 2063 616e 2062 6520 6120 7374  mns: can be a st
+00019830: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
+00019840: 6720 6120 7369 6e67 6c65 2063 6f6c 756d  g a single colum
+00019850: 6e20 6f72 2061 206c 6973 7420 6f66 200a  n or a list of .
+00019860: 2020 2020 2323 2320 2020 2020 2020 2020      ###         
+00019870: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+00019880: 6970 6c65 2063 6f6c 756d 6e73 0a20 2020  iple columns.   
+00019890: 2023 2323 2020 2020 2020 2020 2020 2020   ###            
+000198a0: 2020 202d 2069 7420 7769 6c6c 2067 726f     - it will gro
+000198b0: 7570 6279 2061 6c6c 2074 6865 206e 756d  upby all the num
+000198c0: 6572 6963 2066 6561 7475 7265 7320 7573  eric features us
+000198d0: 696e 6720 6f6e 6520 6772 6f75 7062 7920  ing one groupby 
+000198e0: 636f 6c75 6d6e 200a 2020 2020 2323 2320  column .    ### 
+000198f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019900: 2020 2061 7420 6120 7469 6d65 2069 6e20     at a time in 
+00019910: 6120 6c6f 6f70 2e0a 2020 2020 2323 2320  a loop..    ### 
+00019920: 2020 6967 6e6f 7265 5f76 6172 6961 626c    ignore_variabl
+00019930: 6573 3a20 6c69 7374 206f 6620 7661 7269  es: list of vari
+00019940: 6162 6c65 7320 746f 2069 676e 6f72 6520  ables to ignore 
+00019950: 616d 6f6e 6720 6e75 6d65 7269 6320 7661  among numeric va
+00019960: 7269 6162 6c65 7320 696e 0a20 2020 2023  riables in.    #
+00019970: 2323 2020 2020 2020 2020 2020 2020 2020  ##              
+00019980: 2020 6461 7461 2073 696e 6365 2074 6865    data since the
+00019990: 7920 6d61 7920 6265 2049 4420 7661 7269  y may be ID vari
+000199a0: 6162 6c65 732e 0a20 2020 2023 2323 204f  ables..    ### O
+000199b0: 7574 7075 7473 3a0a 2020 2020 2323 2320  utputs:.    ### 
+000199c0: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
+000199d0: 6f72 6967 696e 616c 2064 6174 6166 7261  original datafra
+000199e0: 6d65 2077 6974 6820 6164 6469 7469 6f6e  me with addition
+000199f0: 616c 2066 6561 7475 7265 7320 6372 6561  al features crea
+00019a00: 7465 6420 6279 2074 6869 7320 6675 6e63  ted by this func
+00019a10: 7469 6f6e 2e0a 2020 2020 2323 2323 2323  tion..    ######
+00019a20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019a30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019a40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019a50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019a60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019a70: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00019a80: 2222 220a 2020 2020 7472 6169 6e78 203d  """.    trainx =
-00019a90: 2063 6f70 792e 6465 6570 636f 7079 2874   copy.deepcopy(t
-00019aa0: 7261 696e 290a 2020 2020 7465 7374 7820  rain).    testx 
-00019ab0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00019ac0: 7465 7374 290a 2020 2020 6966 2069 7369  test).    if isi
-00019ad0: 6e73 7461 6e63 6528 6772 6f75 7062 795f  nstance(groupby_
-00019ae0: 636f 6c75 6d6e 732c 2073 7472 293a 0a20  columns, str):. 
-00019af0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
-00019b00: 6f6c 756d 6e73 203d 205b 6772 6f75 7062  olumns = [groupb
-00019b10: 795f 636f 6c75 6d6e 735d 0a20 2020 206e  y_columns].    n
-00019b20: 756d 6572 6963 7320 3d20 7472 6169 6e78  umerics = trainx
-00019b30: 2e73 656c 6563 745f 6474 7970 6573 2869  .select_dtypes(i
-00019b40: 6e63 6c75 6465 3d27 6e75 6d62 6572 2729  nclude='number')
-00019b50: 2e63 6f6c 756d 6e73 2e74 6f6c 6973 7428  .columns.tolist(
-00019b60: 290a 2020 2020 6e75 6d65 7269 6373 203d  ).    numerics =
-00019b70: 205b 7820 666f 7220 7820 696e 206e 756d   [x for x in num
-00019b80: 6572 6963 7320 6966 2078 206e 6f74 2069  erics if x not i
-00019b90: 6e20 6967 6e6f 7265 5f76 6172 6961 626c  n ignore_variabl
-00019ba0: 6573 5d0a 2020 2020 4d47 4220 3d20 4772  es].    MGB = Gr
-00019bb0: 6f75 7062 795f 4167 6772 6567 6174 6f72  oupby_Aggregator
-00019bc0: 2863 6174 6567 6f72 6963 616c 733d 6772  (categoricals=gr
-00019bd0: 6f75 7062 795f 636f 6c75 6d6e 732c 0a20  oupby_columns,. 
-00019be0: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
-00019bf0: 6761 7465 733d 6167 675f 7479 7065 732c  gates=agg_types,
-00019c00: 206e 756d 6572 6963 733d 6e75 6d65 7269   numerics=numeri
-00019c10: 6373 290a 2020 2020 7472 6169 6e5f 636f  cs).    train_co
-00019c20: 7079 203d 204d 4742 2e66 6974 5f74 7261  py = MGB.fit_tra
-00019c30: 6e73 666f 726d 2874 7261 696e 7829 0a20  nsform(trainx). 
-00019c40: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00019c50: 2874 6573 7478 2c20 7374 7229 206f 7220  (testx, str) or 
-00019c60: 7465 7374 7820 6973 204e 6f6e 653a 0a20  testx is None:. 
-00019c70: 2020 2020 2020 2074 6573 745f 636f 7079         test_copy
-00019c80: 203d 2074 6573 7478 0a20 2020 2065 6c73   = testx.    els
-00019c90: 653a 0a20 2020 2020 2020 2074 6573 745f  e:.        test_
-00019ca0: 636f 7079 203d 204d 4742 2e74 7261 6e73  copy = MGB.trans
-00019cb0: 666f 726d 2874 6573 7478 290a 2020 2020  form(testx).    
-00019cc0: 2323 2320 7265 7475 726e 2074 6865 2064  ### return the d
-00019cd0: 6174 6166 7261 6d65 7320 2323 2323 2323  ataframes ######
-00019ce0: 2323 2323 230a 2020 2020 7265 7475 726e  #####.    return
-00019cf0: 2074 7261 696e 5f63 6f70 792c 2074 6573   train_copy, tes
-00019d00: 745f 636f 7079 0a23 2323 2323 2323 2323  t_copy.#########
+00019a70: 0a20 2020 2022 2222 0a20 2020 2074 7261  .    """.    tra
+00019a80: 696e 7820 3d20 636f 7079 2e64 6565 7063  inx = copy.deepc
+00019a90: 6f70 7928 7472 6169 6e29 0a20 2020 2074  opy(train).    t
+00019aa0: 6573 7478 203d 2063 6f70 792e 6465 6570  estx = copy.deep
+00019ab0: 636f 7079 2874 6573 7429 0a20 2020 2069  copy(test).    i
+00019ac0: 6620 6973 696e 7374 616e 6365 2867 726f  f isinstance(gro
+00019ad0: 7570 6279 5f63 6f6c 756d 6e73 2c20 7374  upby_columns, st
+00019ae0: 7229 3a0a 2020 2020 2020 2020 6772 6f75  r):.        grou
+00019af0: 7062 795f 636f 6c75 6d6e 7320 3d20 5b67  pby_columns = [g
+00019b00: 726f 7570 6279 5f63 6f6c 756d 6e73 5d0a  roupby_columns].
+00019b10: 2020 2020 6e75 6d65 7269 6373 203d 2074      numerics = t
+00019b20: 7261 696e 782e 7365 6c65 6374 5f64 7479  rainx.select_dty
+00019b30: 7065 7328 696e 636c 7564 653d 276e 756d  pes(include='num
+00019b40: 6265 7227 292e 636f 6c75 6d6e 732e 746f  ber').columns.to
+00019b50: 6c69 7374 2829 0a20 2020 206e 756d 6572  list().    numer
+00019b60: 6963 7320 3d20 5b78 2066 6f72 2078 2069  ics = [x for x i
+00019b70: 6e20 6e75 6d65 7269 6373 2069 6620 7820  n numerics if x 
+00019b80: 6e6f 7420 696e 2069 676e 6f72 655f 7661  not in ignore_va
+00019b90: 7269 6162 6c65 735d 0a20 2020 204d 4742  riables].    MGB
+00019ba0: 203d 2047 726f 7570 6279 5f41 6767 7265   = Groupby_Aggre
+00019bb0: 6761 746f 7228 6361 7465 676f 7269 6361  gator(categorica
+00019bc0: 6c73 3d67 726f 7570 6279 5f63 6f6c 756d  ls=groupby_colum
+00019bd0: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+00019be0: 6167 6772 6567 6174 6573 3d61 6767 5f74  aggregates=agg_t
+00019bf0: 7970 6573 2c20 6e75 6d65 7269 6373 3d6e  ypes, numerics=n
+00019c00: 756d 6572 6963 7329 0a20 2020 2074 7261  umerics).    tra
+00019c10: 696e 5f63 6f70 7920 3d20 4d47 422e 6669  in_copy = MGB.fi
+00019c20: 745f 7472 616e 7366 6f72 6d28 7472 6169  t_transform(trai
+00019c30: 6e78 290a 2020 2020 6966 2069 7369 6e73  nx).    if isins
+00019c40: 7461 6e63 6528 7465 7374 782c 2073 7472  tance(testx, str
+00019c50: 2920 6f72 2074 6573 7478 2069 7320 4e6f  ) or testx is No
+00019c60: 6e65 3a0a 2020 2020 2020 2020 7465 7374  ne:.        test
+00019c70: 5f63 6f70 7920 3d20 7465 7374 780a 2020  _copy = testx.  
+00019c80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00019c90: 7465 7374 5f63 6f70 7920 3d20 4d47 422e  test_copy = MGB.
+00019ca0: 7472 616e 7366 6f72 6d28 7465 7374 7829  transform(testx)
+00019cb0: 0a20 2020 2023 2323 2072 6574 7572 6e20  .    ### return 
+00019cc0: 7468 6520 6461 7461 6672 616d 6573 2023  the dataframes #
+00019cd0: 2323 2323 2323 2323 2323 0a20 2020 2072  ##########.    r
+00019ce0: 6574 7572 6e20 7472 6169 6e5f 636f 7079  eturn train_copy
+00019cf0: 2c20 7465 7374 5f63 6f70 790a 2323 2323  , test_copy.####
+00019d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00019d50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019d60: 2323 2323 2323 2323 2323 2323 0a64 6566  ############.def
-00019d70: 2046 455f 636f 6d62 696e 655f 7261 7265   FE_combine_rare
-00019d80: 5f63 6174 6567 6f72 6965 7328 7472 6169  _categories(trai
-00019d90: 6e5f 6466 2c20 6361 7465 676f 7269 6361  n_df, categorica
-00019da0: 6c5f 6665 6174 7572 6573 2c20 7465 7374  l_features, test
-00019db0: 5f64 663d 2222 293a 0a20 2020 2022 2222  _df=""):.    """
-00019dc0: 0a20 2020 2049 6e20 7468 6973 2066 756e  .    In this fun
-00019dd0: 6374 696f 6e2c 2077 6520 7769 6c6c 2073  ction, we will s
-00019de0: 656c 6563 7420 616c 6c20 7261 7265 2063  elect all rare c
-00019df0: 6c61 7373 6573 2068 6176 696e 6720 7265  lasses having re
-00019e00: 7072 6573 656e 7461 7469 6f6e 203c 3125  presentation <1%
-00019e10: 206f 6620 706f 7075 6c61 7469 6f6e 2061   of population a
-00019e20: 6e64 0a20 2020 2067 726f 7570 2074 6865  nd.    group the
-00019e30: 6d20 746f 6765 7468 6572 2075 6e64 6572  m together under
-00019e40: 2061 206e 6577 206c 6162 656c 2063 616c   a new label cal
-00019e50: 6c65 6420 2752 4152 4527 2e20 5765 2077  led 'RARE'. We w
-00019e60: 696c 6c20 6170 706c 7920 7468 6973 206f  ill apply this o
-00019e70: 6e20 7472 6169 6e20 616e 6420 7465 7374  n train and test
-00019e80: 2028 6f70 7469 6f6e 616c 290a 2020 2020   (optional).    
-00019e90: 2222 220a 2020 2020 7472 6169 6e5f 6466  """.    train_df
-00019ea0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-00019eb0: 2874 7261 696e 5f64 6629 0a20 2020 2074  (train_df).    t
-00019ec0: 6573 745f 6466 203d 2063 6f70 792e 6465  est_df = copy.de
-00019ed0: 6570 636f 7079 2874 6573 745f 6466 290a  epcopy(test_df).
-00019ee0: 2020 2020 7472 6169 6e5f 6466 5b63 6174      train_df[cat
-00019ef0: 6567 6f72 6963 616c 5f66 6561 7475 7265  egorical_feature
-00019f00: 735d 203d 2074 7261 696e 5f64 665b 6361  s] = train_df[ca
-00019f10: 7465 676f 7269 6361 6c5f 6665 6174 7572  tegorical_featur
-00019f20: 6573 5d2e 6170 706c 7928 0a20 2020 2020  es].apply(.     
-00019f30: 2020 2020 2020 206c 616d 6264 6120 783a         lambda x:
-00019f40: 2078 2e6d 6173 6b28 782e 6d61 7028 782e   x.mask(x.map(x.
-00019f50: 7661 6c75 655f 636f 756e 7473 2829 293c  value_counts())<
-00019f60: 2028 302e 3031 2a74 7261 696e 5f64 662e   (0.01*train_df.
-00019f70: 7368 6170 655b 305d 292c 2027 5241 5245  shape[0]), 'RARE
-00019f80: 2729 290a 2020 2020 666f 7220 636f 6c20  ')).    for col 
-00019f90: 696e 2063 6174 6567 6f72 6963 616c 5f66  in categorical_f
-00019fa0: 6561 7475 7265 733a 0a20 2020 2020 2020  eatures:.       
-00019fb0: 2076 616c 7320 3d20 6c69 7374 2874 7261   vals = list(tra
-00019fc0: 696e 5f64 665b 636f 6c5d 2e75 6e69 7175  in_df[col].uniqu
-00019fd0: 6528 2929 0a20 2020 2020 2020 2069 6620  e()).        if 
-00019fe0: 6973 696e 7374 616e 6365 2874 6573 745f  isinstance(test_
-00019ff0: 6466 2c20 7374 7229 206f 7220 7465 7374  df, str) or test
-0001a000: 5f64 6620 6973 204e 6f6e 653a 0a20 2020  _df is None:.   
-0001a010: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001a020: 7472 6169 6e5f 6466 2c20 7465 7374 5f64  train_df, test_d
-0001a030: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
-0001a040: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0001a050: 5f64 665b 636f 6c5d 203d 2074 6573 745f  _df[col] = test_
-0001a060: 6466 5b63 6f6c 5d2e 6170 706c 7928 6c61  df[col].apply(la
-0001a070: 6d62 6461 2078 3a20 2752 4152 4527 2069  mbda x: 'RARE' i
-0001a080: 6620 7820 6e6f 7420 696e 2076 616c 7320  f x not in vals 
-0001a090: 656c 7365 2078 290a 2020 2020 2020 2020  else x).        
-0001a0a0: 2020 2020 7265 7475 726e 2074 7261 696e      return train
-0001a0b0: 5f64 662c 2074 6573 745f 6466 0a0a 2323  _df, test_df..##
+00019d60: 230a 6465 6620 4645 5f63 6f6d 6269 6e65  #.def FE_combine
+00019d70: 5f72 6172 655f 6361 7465 676f 7269 6573  _rare_categories
+00019d80: 2874 7261 696e 5f64 662c 2063 6174 6567  (train_df, categ
+00019d90: 6f72 6963 616c 5f66 6561 7475 7265 732c  orical_features,
+00019da0: 2074 6573 745f 6466 3d22 2229 3a0a 2020   test_df=""):.  
+00019db0: 2020 2222 220a 2020 2020 496e 2074 6869    """.    In thi
+00019dc0: 7320 6675 6e63 7469 6f6e 2c20 7765 2077  s function, we w
+00019dd0: 696c 6c20 7365 6c65 6374 2061 6c6c 2072  ill select all r
+00019de0: 6172 6520 636c 6173 7365 7320 6861 7669  are classes havi
+00019df0: 6e67 2072 6570 7265 7365 6e74 6174 696f  ng representatio
+00019e00: 6e20 3c31 2520 6f66 2070 6f70 756c 6174  n <1% of populat
+00019e10: 696f 6e20 616e 640a 2020 2020 6772 6f75  ion and.    grou
+00019e20: 7020 7468 656d 2074 6f67 6574 6865 7220  p them together 
+00019e30: 756e 6465 7220 6120 6e65 7720 6c61 6265  under a new labe
+00019e40: 6c20 6361 6c6c 6564 2027 5241 5245 272e  l called 'RARE'.
+00019e50: 2057 6520 7769 6c6c 2061 7070 6c79 2074   We will apply t
+00019e60: 6869 7320 6f6e 2074 7261 696e 2061 6e64  his on train and
+00019e70: 2074 6573 7420 286f 7074 696f 6e61 6c29   test (optional)
+00019e80: 0a20 2020 2022 2222 0a20 2020 2074 7261  .    """.    tra
+00019e90: 696e 5f64 6620 3d20 636f 7079 2e64 6565  in_df = copy.dee
+00019ea0: 7063 6f70 7928 7472 6169 6e5f 6466 290a  pcopy(train_df).
+00019eb0: 2020 2020 7465 7374 5f64 6620 3d20 636f      test_df = co
+00019ec0: 7079 2e64 6565 7063 6f70 7928 7465 7374  py.deepcopy(test
+00019ed0: 5f64 6629 0a20 2020 2074 7261 696e 5f64  _df).    train_d
+00019ee0: 665b 6361 7465 676f 7269 6361 6c5f 6665  f[categorical_fe
+00019ef0: 6174 7572 6573 5d20 3d20 7472 6169 6e5f  atures] = train_
+00019f00: 6466 5b63 6174 6567 6f72 6963 616c 5f66  df[categorical_f
+00019f10: 6561 7475 7265 735d 2e61 7070 6c79 280a  eatures].apply(.
+00019f20: 2020 2020 2020 2020 2020 2020 6c61 6d62              lamb
+00019f30: 6461 2078 3a20 782e 6d61 736b 2878 2e6d  da x: x.mask(x.m
+00019f40: 6170 2878 2e76 616c 7565 5f63 6f75 6e74  ap(x.value_count
+00019f50: 7328 2929 3c20 2830 2e30 312a 7472 6169  s())< (0.01*trai
+00019f60: 6e5f 6466 2e73 6861 7065 5b30 5d29 2c20  n_df.shape[0]), 
+00019f70: 2752 4152 4527 2929 0a20 2020 2066 6f72  'RARE')).    for
+00019f80: 2063 6f6c 2069 6e20 6361 7465 676f 7269   col in categori
+00019f90: 6361 6c5f 6665 6174 7572 6573 3a0a 2020  cal_features:.  
+00019fa0: 2020 2020 2020 7661 6c73 203d 206c 6973        vals = lis
+00019fb0: 7428 7472 6169 6e5f 6466 5b63 6f6c 5d2e  t(train_df[col].
+00019fc0: 756e 6971 7565 2829 290a 2020 2020 2020  unique()).      
+00019fd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00019fe0: 7465 7374 5f64 662c 2073 7472 2920 6f72  test_df, str) or
+00019ff0: 2074 6573 745f 6466 2069 7320 4e6f 6e65   test_df is None
+0001a000: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001a010: 7475 726e 2074 7261 696e 5f64 662c 2074  turn train_df, t
+0001a020: 6573 745f 6466 0a20 2020 2020 2020 2065  est_df.        e
+0001a030: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a040: 2074 6573 745f 6466 5b63 6f6c 5d20 3d20   test_df[col] = 
+0001a050: 7465 7374 5f64 665b 636f 6c5d 2e61 7070  test_df[col].app
+0001a060: 6c79 286c 616d 6264 6120 783a 2027 5241  ly(lambda x: 'RA
+0001a070: 5245 2720 6966 2078 206e 6f74 2069 6e20  RE' if x not in 
+0001a080: 7661 6c73 2065 6c73 6520 7829 0a20 2020  vals else x).   
+0001a090: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001a0a0: 7472 6169 6e5f 6466 2c20 7465 7374 5f64  train_df, test_d
+0001a0b0: 660a 0a23 2323 2323 2323 2323 2323 2323  f..#############
 0001a0c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a0d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a0e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a0f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a120: 2323 230a 6465 6620 4645 5f67 6574 5f6c  ###.def FE_get_l
-0001a130: 6174 6573 745f 7661 6c75 6573 5f62 6173  atest_values_bas
-0001a140: 6564 5f6f 6e5f 6461 7465 5f63 6f6c 756d  ed_on_date_colum
-0001a150: 6e28 6466 742c 2069 645f 636f 6c2c 2064  n(dft, id_col, d
-0001a160: 6174 655f 636f 6c2c 2063 6f6c 732c 2061  ate_col, cols, a
-0001a170: 7363 656e 6469 6e67 3d46 616c 7365 293a  scending=False):
-0001a180: 0a20 2020 2022 2222 0a20 2020 2046 4520  .    """.    FE 
-0001a190: 6d65 616e 7320 4645 4154 5552 4520 454e  means FEATURE EN
-0001a1a0: 4749 4e45 4552 494e 4720 2d20 5468 6174  GINEERING - That
-0001a1b0: 206d 6561 6e73 2074 6869 7320 6675 6e63   means this func
-0001a1c0: 7469 6f6e 2077 696c 6c20 6372 6561 7465  tion will create
-0001a1d0: 206e 6577 2066 6561 7475 7265 730a 2020   new features.  
-0001a1e0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0001a110: 2323 2323 2323 2323 0a64 6566 2046 455f  ########.def FE_
+0001a120: 6765 745f 6c61 7465 7374 5f76 616c 7565  get_latest_value
+0001a130: 735f 6261 7365 645f 6f6e 5f64 6174 655f  s_based_on_date_
+0001a140: 636f 6c75 6d6e 2864 6674 2c20 6964 5f63  column(dft, id_c
+0001a150: 6f6c 2c20 6461 7465 5f63 6f6c 2c20 636f  ol, date_col, co
+0001a160: 6c73 2c20 6173 6365 6e64 696e 673d 4661  ls, ascending=Fa
+0001a170: 6c73 6529 3a0a 2020 2020 2222 220a 2020  lse):.    """.  
+0001a180: 2020 4645 206d 6561 6e73 2046 4541 5455    FE means FEATU
+0001a190: 5245 2045 4e47 494e 4545 5249 4e47 202d  RE ENGINEERING -
+0001a1a0: 2054 6861 7420 6d65 616e 7320 7468 6973   That means this
+0001a1b0: 2066 756e 6374 696f 6e20 7769 6c6c 2063   function will c
+0001a1c0: 7265 6174 6520 6e65 7720 6665 6174 7572  reate new featur
+0001a1d0: 6573 0a20 2020 2023 2323 2323 2323 2323  es.    #########
+0001a1e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a1f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a230: 2323 2323 2323 2323 0a20 2020 2054 6869  ########.    Thi
-0001a240: 7320 6675 6e63 7469 6f6e 2067 6574 7320  s function gets 
-0001a250: 796f 7520 7468 6520 6c61 7465 7374 2076  you the latest v
-0001a260: 616c 7565 7320 6f66 2074 6865 2063 6f6c  alues of the col
-0001a270: 756d 6e73 2069 6e20 636f 6c73 2066 726f  umns in cols fro
-0001a280: 6d20 6120 6461 7465 2063 6f6c 756d 6e20  m a date column 
-0001a290: 6461 7465 5f63 6f6c 2e0a 0a20 2020 2049  date_col...    I
-0001a2a0: 6e70 7574 733a 0a20 2020 2064 6674 3a20  nputs:.    dft: 
-0001a2b0: 6461 7461 6672 616d 652c 2070 616e 6461  dataframe, panda
-0001a2c0: 730a 2020 2020 6964 5f63 6f6c 3a20 796f  s.    id_col: yo
-0001a2d0: 7520 6e65 6564 2074 6f20 7072 6f76 6964  u need to provid
-0001a2e0: 6520 616e 2049 4420 636f 6c75 6d6e 2074  e an ID column t
-0001a2f0: 6f20 6772 6f75 7062 7920 7468 6520 636f  o groupby the co
-0001a300: 6c73 2061 6e64 2074 6865 6e20 736f 7274  ls and then sort
-0001a310: 2074 6865 6d20 6279 2064 6174 655f 636f   them by date_co
-0001a320: 6c2e 0a20 2020 2064 6174 655f 636f 6c3a  l..    date_col:
-0001a330: 2074 6869 7320 6d75 7374 2062 6520 6120   this must be a 
-0001a340: 7661 6c69 6420 7061 6e64 6173 2064 6174  valid pandas dat
-0001a350: 652d 7469 6d65 2063 6f6c 756d 6e2e 2049  e-time column. I
-0001a360: 6620 6974 2069 7320 6120 7374 7269 6e67  f it is a string
-0001a370: 2063 6f6c 756d 6e2c 0a20 2020 2020 2020   column,.       
-0001a380: 2020 2020 6d61 6b65 2073 7572 6520 796f      make sure yo
-0001a390: 7520 6368 616e 6765 2069 7420 746f 2061  u change it to a
-0001a3a0: 2064 6174 652d 7469 6d65 2063 6f6c 756d   date-time colum
-0001a3b0: 6e2e 0a20 2020 2020 2020 2020 2049 7420  n..          It 
-0001a3c0: 736f 7274 7320 6561 6368 2067 726f 7570  sorts each group
-0001a3d0: 2062 7920 7468 6520 6c61 7465 7374 2064   by the latest d
-0001a3e0: 6174 6520 2864 6573 6365 6e64 696e 6729  ate (descending)
-0001a3f0: 2061 6e64 2073 656c 6563 7473 2074 6861   and selects tha
-0001a400: 7420 746f 7020 726f 772e 0a20 2020 2063  t top row..    c
-0001a410: 6f6c 733a 2074 6865 7365 2061 7265 2074  ols: these are t
-0001a420: 6865 206c 6973 7420 6f66 2063 6f6c 756d  he list of colum
-0001a430: 6e73 2079 6f75 2077 616e 7420 7468 6569  ns you want thei
-0001a440: 7220 6c61 7465 7374 2076 616c 7565 2062  r latest value b
-0001a450: 6173 6564 206f 6e20 7468 6520 6461 7465  ased on the date
-0001a460: 2d63 6f6c 2079 6f75 2073 7065 6369 6679  -col you specify
-0001a470: 2e0a 2020 2020 2020 2020 2054 6865 7365  ..         These
-0001a480: 2063 6f6c 7320 6361 6e20 6265 2061 6e79   cols can be any
-0001a490: 2074 7970 6520 6f66 2063 6f6c 756d 6e3a   type of column:
-0001a4a0: 206e 756d 6572 6963 206f 7220 7374 7269   numeric or stri
-0001a4b0: 6e67 2e0a 2020 2020 6173 6365 6e64 696e  ng..    ascendin
-0001a4c0: 673a 2053 6574 2074 6869 7320 6173 2054  g: Set this as T
-0001a4d0: 7275 6520 6f72 2046 616c 7365 2064 6570  rue or False dep
-0001a4e0: 656e 6469 6e67 206f 6e20 7768 6574 6865  ending on whethe
-0001a4f0: 7220 796f 7520 7761 6e74 2073 6d61 6c6c  r you want small
-0001a500: 6573 7420 6f72 2062 6967 6765 7374 206f  est or biggest o
-0001a510: 6e20 746f 702e 0a0a 2020 2020 4f75 7470  n top...    Outp
-0001a520: 7574 733a 0a20 2020 2052 6574 7572 6e73  uts:.    Returns
-0001a530: 2061 2064 6174 6166 7261 6d65 2074 6861   a dataframe tha
-0001a540: 7420 6973 2073 6d61 6c6c 6572 2074 6861  t is smaller tha
-0001a550: 6e20 696e 7075 7420 6461 7461 6672 616d  n input datafram
-0001a560: 6520 7369 6e63 6520 6974 2067 726f 7570  e since it group
-0001a570: 7320 636f 6c73 2062 7920 4944 5f63 6f6c  s cols by ID_col
-0001a580: 756d 6e2e 0a20 2020 2023 2323 2323 2323  umn..    #######
+0001a220: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+0001a230: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+0001a240: 6765 7473 2079 6f75 2074 6865 206c 6174  gets you the lat
+0001a250: 6573 7420 7661 6c75 6573 206f 6620 7468  est values of th
+0001a260: 6520 636f 6c75 6d6e 7320 696e 2063 6f6c  e columns in col
+0001a270: 7320 6672 6f6d 2061 2064 6174 6520 636f  s from a date co
+0001a280: 6c75 6d6e 2064 6174 655f 636f 6c2e 0a0a  lumn date_col...
+0001a290: 2020 2020 496e 7075 7473 3a0a 2020 2020      Inputs:.    
+0001a2a0: 6466 743a 2064 6174 6166 7261 6d65 2c20  dft: dataframe, 
+0001a2b0: 7061 6e64 6173 0a20 2020 2069 645f 636f  pandas.    id_co
+0001a2c0: 6c3a 2079 6f75 206e 6565 6420 746f 2070  l: you need to p
+0001a2d0: 726f 7669 6465 2061 6e20 4944 2063 6f6c  rovide an ID col
+0001a2e0: 756d 6e20 746f 2067 726f 7570 6279 2074  umn to groupby t
+0001a2f0: 6865 2063 6f6c 7320 616e 6420 7468 656e  he cols and then
+0001a300: 2073 6f72 7420 7468 656d 2062 7920 6461   sort them by da
+0001a310: 7465 5f63 6f6c 2e0a 2020 2020 6461 7465  te_col..    date
+0001a320: 5f63 6f6c 3a20 7468 6973 206d 7573 7420  _col: this must 
+0001a330: 6265 2061 2076 616c 6964 2070 616e 6461  be a valid panda
+0001a340: 7320 6461 7465 2d74 696d 6520 636f 6c75  s date-time colu
+0001a350: 6d6e 2e20 4966 2069 7420 6973 2061 2073  mn. If it is a s
+0001a360: 7472 696e 6720 636f 6c75 6d6e 2c0a 2020  tring column,.  
+0001a370: 2020 2020 2020 2020 206d 616b 6520 7375           make su
+0001a380: 7265 2079 6f75 2063 6861 6e67 6520 6974  re you change it
+0001a390: 2074 6f20 6120 6461 7465 2d74 696d 6520   to a date-time 
+0001a3a0: 636f 6c75 6d6e 2e0a 2020 2020 2020 2020  column..        
+0001a3b0: 2020 4974 2073 6f72 7473 2065 6163 6820    It sorts each 
+0001a3c0: 6772 6f75 7020 6279 2074 6865 206c 6174  group by the lat
+0001a3d0: 6573 7420 6461 7465 2028 6465 7363 656e  est date (descen
+0001a3e0: 6469 6e67 2920 616e 6420 7365 6c65 6374  ding) and select
+0001a3f0: 7320 7468 6174 2074 6f70 2072 6f77 2e0a  s that top row..
+0001a400: 2020 2020 636f 6c73 3a20 7468 6573 6520      cols: these 
+0001a410: 6172 6520 7468 6520 6c69 7374 206f 6620  are the list of 
+0001a420: 636f 6c75 6d6e 7320 796f 7520 7761 6e74  columns you want
+0001a430: 2074 6865 6972 206c 6174 6573 7420 7661   their latest va
+0001a440: 6c75 6520 6261 7365 6420 6f6e 2074 6865  lue based on the
+0001a450: 2064 6174 652d 636f 6c20 796f 7520 7370   date-col you sp
+0001a460: 6563 6966 792e 0a20 2020 2020 2020 2020  ecify..         
+0001a470: 5468 6573 6520 636f 6c73 2063 616e 2062  These cols can b
+0001a480: 6520 616e 7920 7479 7065 206f 6620 636f  e any type of co
+0001a490: 6c75 6d6e 3a20 6e75 6d65 7269 6320 6f72  lumn: numeric or
+0001a4a0: 2073 7472 696e 672e 0a20 2020 2061 7363   string..    asc
+0001a4b0: 656e 6469 6e67 3a20 5365 7420 7468 6973  ending: Set this
+0001a4c0: 2061 7320 5472 7565 206f 7220 4661 6c73   as True or Fals
+0001a4d0: 6520 6465 7065 6e64 696e 6720 6f6e 2077  e depending on w
+0001a4e0: 6865 7468 6572 2079 6f75 2077 616e 7420  hether you want 
+0001a4f0: 736d 616c 6c65 7374 206f 7220 6269 6767  smallest or bigg
+0001a500: 6573 7420 6f6e 2074 6f70 2e0a 0a20 2020  est on top...   
+0001a510: 204f 7574 7075 7473 3a0a 2020 2020 5265   Outputs:.    Re
+0001a520: 7475 726e 7320 6120 6461 7461 6672 616d  turns a datafram
+0001a530: 6520 7468 6174 2069 7320 736d 616c 6c65  e that is smalle
+0001a540: 7220 7468 616e 2069 6e70 7574 2064 6174  r than input dat
+0001a550: 6166 7261 6d65 2073 696e 6365 2069 7420  aframe since it 
+0001a560: 6772 6f75 7073 2063 6f6c 7320 6279 2049  groups cols by I
+0001a570: 445f 636f 6c75 6d6e 2e0a 2020 2020 2323  D_column..    ##
+0001a580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a5c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a5d0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0001a5e0: 2020 2020 4265 7761 7265 2120 596f 7520      Beware! You 
-0001a5f0: 7769 6c6c 2067 6574 2061 2064 6174 6166  will get a dataf
-0001a600: 7261 6d65 2074 6861 7420 6861 7320 6665  rame that has fe
-0001a610: 7765 7220 636f 6c73 2074 6861 6e20 796f  wer cols than yo
-0001a620: 7572 2069 6e70 7574 2077 6974 6820 6665  ur input with fe
-0001a630: 7765 7220 726f 7773 2074 6861 6e20 696e  wer rows than in
-0001a640: 7075 742e 0a20 2020 2022 2222 0a20 2020  put..    """.   
-0001a650: 2064 6674 203d 2063 6f70 792e 6465 6570   dft = copy.deep
-0001a660: 636f 7079 2864 6674 290a 2020 2020 7472  copy(dft).    tr
-0001a670: 793a 0a20 2020 2020 2020 2069 6620 6973  y:.        if is
-0001a680: 696e 7374 616e 6365 2863 6f6c 732c 2073  instance(cols, s
-0001a690: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-0001a6a0: 2063 6f6c 7320 3d20 5b63 6f6c 735d 0a20   cols = [cols]. 
-0001a6b0: 2020 2020 2020 2074 7261 696e 5f61 6464         train_add
-0001a6c0: 203d 2064 6674 2e67 726f 7570 6279 285b   = dft.groupby([
-0001a6d0: 6964 5f63 6f6c 5d2c 2073 6f72 743d 4661  id_col], sort=Fa
-0001a6e0: 6c73 6529 2e61 7070 6c79 286c 616d 6264  lse).apply(lambd
-0001a6f0: 6120 783a 2078 2e73 6f72 745f 7661 6c75  a x: x.sort_valu
-0001a700: 6573 285b 6461 7465 5f63 6f6c 5d2c 0a20  es([date_col],. 
+0001a5d0: 2323 2323 0a20 2020 2042 6577 6172 6521  ####.    Beware!
+0001a5e0: 2059 6f75 2077 696c 6c20 6765 7420 6120   You will get a 
+0001a5f0: 6461 7461 6672 616d 6520 7468 6174 2068  dataframe that h
+0001a600: 6173 2066 6577 6572 2063 6f6c 7320 7468  as fewer cols th
+0001a610: 616e 2079 6f75 7220 696e 7075 7420 7769  an your input wi
+0001a620: 7468 2066 6577 6572 2072 6f77 7320 7468  th fewer rows th
+0001a630: 616e 2069 6e70 7574 2e0a 2020 2020 2222  an input..    ""
+0001a640: 220a 2020 2020 6466 7420 3d20 636f 7079  ".    dft = copy
+0001a650: 2e64 6565 7063 6f70 7928 6466 7429 0a20  .deepcopy(dft). 
+0001a660: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001a670: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
+0001a680: 6c73 2c20 7374 7229 3a0a 2020 2020 2020  ls, str):.      
+0001a690: 2020 2020 2020 636f 6c73 203d 205b 636f        cols = [co
+0001a6a0: 6c73 5d0a 2020 2020 2020 2020 7472 6169  ls].        trai
+0001a6b0: 6e5f 6164 6420 3d20 6466 742e 6772 6f75  n_add = dft.grou
+0001a6c0: 7062 7928 5b69 645f 636f 6c5d 2c20 736f  pby([id_col], so
+0001a6d0: 7274 3d46 616c 7365 292e 6170 706c 7928  rt=False).apply(
+0001a6e0: 6c61 6d62 6461 2078 3a20 782e 736f 7274  lambda x: x.sort
+0001a6f0: 5f76 616c 7565 7328 5b64 6174 655f 636f  _values([date_co
+0001a700: 6c5d 2c0a 2020 2020 2020 2020 2020 2020  l],.            
 0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a750: 2020 2020 2020 2061 7363 656e 6469 6e67         ascending
-0001a760: 3d61 7363 656e 6469 6e67 2929 0a20 2020  =ascending)).   
-0001a770: 2020 2020 2074 7261 696e 5f61 6464 203d       train_add =
-0001a780: 2074 7261 696e 5f61 6464 5b63 6f6c 735d   train_add[cols]
-0001a790: 2e72 6573 6574 5f69 6e64 6578 2829 0a20  .reset_index(). 
-0001a7a0: 2020 2020 2020 2074 7261 696e 5f61 6464         train_add
-0001a7b0: 203d 2074 7261 696e 5f61 6464 2e67 726f   = train_add.gro
-0001a7c0: 7570 6279 2869 645f 636f 6c29 2e68 6561  upby(id_col).hea
-0001a7d0: 6428 3129 2e72 6573 6574 5f69 6e64 6578  d(1).reset_index
-0001a7e0: 2864 726f 703d 5472 7565 292e 6472 6f70  (drop=True).drop
-0001a7f0: 2827 6c65 7665 6c5f 3127 2c61 7869 733d  ('level_1',axis=
-0001a800: 3129 0a20 2020 2065 7863 6570 743a 0a20  1).    except:. 
-0001a810: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
-0001a820: 2020 4572 726f 7220 696e 2067 6574 7469    Error in getti
-0001a830: 6e67 206c 6174 6573 7420 7374 6174 7573  ng latest status
-0001a840: 206f 6620 636f 6c75 6d6e 7320 6261 7365   of columns base
-0001a850: 6420 6f6e 2025 732e 2052 6574 7572 6e69  d on %s. Returni
-0001a860: 6e67 2e2e 2e27 2025 6461 7465 5f63 6f6c  ng...' %date_col
-0001a870: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001a880: 2064 6674 0a20 2020 2072 6574 7572 6e20   dft.    return 
-0001a890: 7472 6169 6e5f 6164 640a 2323 2323 2323  train_add.######
+0001a740: 2020 2020 2020 2020 2020 2020 6173 6365              asce
+0001a750: 6e64 696e 673d 6173 6365 6e64 696e 6729  nding=ascending)
+0001a760: 290a 2020 2020 2020 2020 7472 6169 6e5f  ).        train_
+0001a770: 6164 6420 3d20 7472 6169 6e5f 6164 645b  add = train_add[
+0001a780: 636f 6c73 5d2e 7265 7365 745f 696e 6465  cols].reset_inde
+0001a790: 7828 290a 2020 2020 2020 2020 7472 6169  x().        trai
+0001a7a0: 6e5f 6164 6420 3d20 7472 6169 6e5f 6164  n_add = train_ad
+0001a7b0: 642e 6772 6f75 7062 7928 6964 5f63 6f6c  d.groupby(id_col
+0001a7c0: 292e 6865 6164 2831 292e 7265 7365 745f  ).head(1).reset_
+0001a7d0: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+0001a7e0: 2e64 726f 7028 276c 6576 656c 5f31 272c  .drop('level_1',
+0001a7f0: 6178 6973 3d31 290a 2020 2020 6578 6365  axis=1).    exce
+0001a800: 7074 3a0a 2020 2020 2020 2020 7072 696e  pt:.        prin
+0001a810: 7428 2720 2020 2045 7272 6f72 2069 6e20  t('    Error in 
+0001a820: 6765 7474 696e 6720 6c61 7465 7374 2073  getting latest s
+0001a830: 7461 7475 7320 6f66 2063 6f6c 756d 6e73  tatus of columns
+0001a840: 2062 6173 6564 206f 6e20 2573 2e20 5265   based on %s. Re
+0001a850: 7475 726e 696e 672e 2e2e 2720 2564 6174  turning...' %dat
+0001a860: 655f 636f 6c29 0a20 2020 2020 2020 2072  e_col).        r
+0001a870: 6574 7572 6e20 6466 740a 2020 2020 7265  eturn dft.    re
+0001a880: 7475 726e 2074 7261 696e 5f61 6464 0a23  turn train_add.#
+0001a890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a8e0: 2323 2323 2323 2323 2323 230a 6672 6f6d  ###########.from
-0001a8f0: 2066 756e 6374 6f6f 6c73 2069 6d70 6f72   functools impor
-0001a900: 7420 7265 6475 6365 0a64 6566 2046 455f  t reduce.def FE_
-0001a910: 7370 6c69 745f 6164 645f 636f 6c75 6d6e  split_add_column
-0001a920: 2864 6674 2c20 636f 6c2c 2073 706c 6974  (dft, col, split
-0001a930: 7465 723d 272c 272c 2061 6374 696f 6e3d  ter=',', action=
-0001a940: 2761 6464 2729 3a0a 2020 2020 2222 220a  'add'):.    """.
-0001a950: 2020 2020 4645 206d 6561 6e73 2046 4541      FE means FEA
-0001a960: 5455 5245 2045 4e47 494e 4545 5249 4e47  TURE ENGINEERING
-0001a970: 202d 2054 6861 7420 6d65 616e 7320 7468   - That means th
-0001a980: 6973 2066 756e 6374 696f 6e20 7769 6c6c  is function will
-0001a990: 2063 7265 6174 6520 6e65 7720 6665 6174   create new feat
-0001a9a0: 7572 6573 0a20 2020 2023 2323 2323 2323  ures.    #######
+0001a8e0: 0a66 726f 6d20 6675 6e63 746f 6f6c 7320  .from functools 
+0001a8f0: 696d 706f 7274 2072 6564 7563 650a 6465  import reduce.de
+0001a900: 6620 4645 5f73 706c 6974 5f61 6464 5f63  f FE_split_add_c
+0001a910: 6f6c 756d 6e28 6466 742c 2063 6f6c 2c20  olumn(dft, col, 
+0001a920: 7370 6c69 7474 6572 3d27 2c27 2c20 6163  splitter=',', ac
+0001a930: 7469 6f6e 3d27 6164 6427 293a 0a20 2020  tion='add'):.   
+0001a940: 2022 2222 0a20 2020 2046 4520 6d65 616e   """.    FE mean
+0001a950: 7320 4645 4154 5552 4520 454e 4749 4e45  s FEATURE ENGINE
+0001a960: 4552 494e 4720 2d20 5468 6174 206d 6561  ERING - That mea
+0001a970: 6e73 2074 6869 7320 6675 6e63 7469 6f6e  ns this function
+0001a980: 2077 696c 6c20 6372 6561 7465 206e 6577   will create new
+0001a990: 2066 6561 7475 7265 730a 2020 2020 2323   features.    ##
+0001a9a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a9b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a9c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a9d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001a9e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a9f0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-0001aa00: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-0001aa10: 6e20 7769 6c6c 2073 706c 6974 2061 2063  n will split a c
-0001aa20: 6f6c 756d 6e27 7320 7661 6c75 6573 2062  olumn's values b
-0001aa30: 6173 6564 206f 6e20 6120 7370 6c69 7474  ased on a splitt
-0001aa40: 6572 2079 6f75 2073 7065 6369 6679 2061  er you specify a
-0001aa50: 6e64 0a20 2020 2077 696c 6c20 6569 7468  nd.    will eith
-0001aa60: 6572 2061 6464 2074 6865 6d20 6f72 2063  er add them or c
-0001aa70: 6f6e 6361 7465 6e61 7465 2074 6865 6d20  oncatenate them 
-0001aa80: 6173 2079 6f75 2073 7065 6369 6679 2069  as you specify i
-0001aa90: 6e20 7468 6520 6163 7469 6f6e 2061 7267  n the action arg
-0001aaa0: 756d 656e 742e 0a0a 2020 2020 496e 7075  ument...    Inpu
-0001aab0: 7473 3a0a 2020 2020 6466 743a 2070 616e  ts:.    dft: pan
-0001aac0: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
-0001aad0: 2020 636f 6c3a 206e 616d 6520 6f66 2063    col: name of c
-0001aae0: 6f6c 756d 6e20 7468 6174 2079 6f75 2077  olumn that you w
-0001aaf0: 616e 7420 746f 2073 706c 6974 2069 6e74  ant to split int
-0001ab00: 6f20 6974 7320 636f 6e73 7469 7475 656e  o its constituen
-0001ab10: 7420 7061 7274 732e 2049 7420 6d75 7374  t parts. It must
-0001ab20: 2062 6520 6120 7374 7269 6e67 2063 6f6c   be a string col
-0001ab30: 756d 6e2e 0a20 2020 2073 706c 6974 7465  umn..    splitte
-0001ab40: 723a 2073 706c 6974 7465 7220 6361 6e20  r: splitter can 
-0001ab50: 6265 2061 6e79 2073 7472 696e 6720 7468  be any string th
-0001ab60: 6174 2069 7320 666f 756e 6420 696e 2079  at is found in y
-0001ab70: 6f75 7220 636f 6c75 6d6e 2061 6e64 2074  our column and t
-0001ab80: 6861 7420 796f 7520 7761 6e74 2074 6f20  hat you want to 
-0001ab90: 7370 6c69 7420 6279 2e0a 2020 2020 6163  split by..    ac
-0001aba0: 7469 6f6e 3a20 6361 6e20 6265 2061 6e79  tion: can be any
-0001abb0: 206f 6e65 206f 6620 666f 6c6c 6f77 696e   one of followin
-0001abc0: 673a 207b 2761 6464 272c 2027 7375 6274  g: {'add', 'subt
-0001abd0: 7261 6374 272c 2027 6d75 6c74 6970 6c79  ract', 'multiply
-0001abe0: 272c 2027 6469 7669 6465 272c 2027 636f  ', 'divide', 'co
-0001abf0: 6e63 6174 272c 2027 636f 6e63 6174 656e  ncat', 'concaten
-0001ac00: 6174 6527 7d0a 2020 2020 2323 2323 2323  ate'}.    ######
+0001a9f0: 2323 2323 0a20 2020 2054 6869 7320 6675  ####.    This fu
+0001aa00: 6e63 7469 6f6e 2077 696c 6c20 7370 6c69  nction will spli
+0001aa10: 7420 6120 636f 6c75 6d6e 2773 2076 616c  t a column's val
+0001aa20: 7565 7320 6261 7365 6420 6f6e 2061 2073  ues based on a s
+0001aa30: 706c 6974 7465 7220 796f 7520 7370 6563  plitter you spec
+0001aa40: 6966 7920 616e 640a 2020 2020 7769 6c6c  ify and.    will
+0001aa50: 2065 6974 6865 7220 6164 6420 7468 656d   either add them
+0001aa60: 206f 7220 636f 6e63 6174 656e 6174 6520   or concatenate 
+0001aa70: 7468 656d 2061 7320 796f 7520 7370 6563  them as you spec
+0001aa80: 6966 7920 696e 2074 6865 2061 6374 696f  ify in the actio
+0001aa90: 6e20 6172 6775 6d65 6e74 2e0a 0a20 2020  n argument...   
+0001aaa0: 2049 6e70 7574 733a 0a20 2020 2064 6674   Inputs:.    dft
+0001aab0: 3a20 7061 6e64 6173 2044 6174 6146 7261  : pandas DataFra
+0001aac0: 6d65 0a20 2020 2063 6f6c 3a20 6e61 6d65  me.    col: name
+0001aad0: 206f 6620 636f 6c75 6d6e 2074 6861 7420   of column that 
+0001aae0: 796f 7520 7761 6e74 2074 6f20 7370 6c69  you want to spli
+0001aaf0: 7420 696e 746f 2069 7473 2063 6f6e 7374  t into its const
+0001ab00: 6974 7565 6e74 2070 6172 7473 2e20 4974  ituent parts. It
+0001ab10: 206d 7573 7420 6265 2061 2073 7472 696e   must be a strin
+0001ab20: 6720 636f 6c75 6d6e 2e0a 2020 2020 7370  g column..    sp
+0001ab30: 6c69 7474 6572 3a20 7370 6c69 7474 6572  litter: splitter
+0001ab40: 2063 616e 2062 6520 616e 7920 7374 7269   can be any stri
+0001ab50: 6e67 2074 6861 7420 6973 2066 6f75 6e64  ng that is found
+0001ab60: 2069 6e20 796f 7572 2063 6f6c 756d 6e20   in your column 
+0001ab70: 616e 6420 7468 6174 2079 6f75 2077 616e  and that you wan
+0001ab80: 7420 746f 2073 706c 6974 2062 792e 0a20  t to split by.. 
+0001ab90: 2020 2061 6374 696f 6e3a 2063 616e 2062     action: can b
+0001aba0: 6520 616e 7920 6f6e 6520 6f66 2066 6f6c  e any one of fol
+0001abb0: 6c6f 7769 6e67 3a20 7b27 6164 6427 2c20  lowing: {'add', 
+0001abc0: 2773 7562 7472 6163 7427 2c20 276d 756c  'subtract', 'mul
+0001abd0: 7469 706c 7927 2c20 2764 6976 6964 6527  tiply', 'divide'
+0001abe0: 2c20 2763 6f6e 6361 7427 2c20 2763 6f6e  , 'concat', 'con
+0001abf0: 6361 7465 6e61 7465 277d 0a20 2020 2023  catenate'}.    #
+0001ac00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ac10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ac20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ac30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ac40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ac50: 2323 2323 2323 2323 2323 0a20 2020 2052  ##########.    R
-0001ac60: 6574 7572 6e73 2061 2064 6174 6166 7261  eturns a datafra
-0001ac70: 6d65 2077 6974 6820 6120 6e65 7720 636f  me with a new co
-0001ac80: 6c75 6d6e 2074 6861 7420 6973 2061 206d  lumn that is a m
-0001ac90: 6f64 6966 6963 6174 696f 6e20 6f66 2074  odification of t
-0001aca0: 6865 206f 6c64 2063 6f6c 756d 6e0a 2020  he old column.  
-0001acb0: 2020 2222 220a 2020 2020 6466 7420 3d20    """.    dft = 
-0001acc0: 636f 7079 2e64 6565 7063 6f70 7928 6466  copy.deepcopy(df
-0001acd0: 7429 0a20 2020 206e 6577 5f63 6f6c 203d  t).    new_col =
-0001ace0: 2063 6f6c 202b 2027 5f73 706c 6974 5f61   col + '_split_a
-0001acf0: 7070 6c79 270a 2020 2020 7072 696e 7428  pply'.    print(
-0001ad00: 2743 7265 6174 696e 6720 636f 6c75 6d6e  'Creating column
-0001ad10: 203d 2025 7320 7573 696e 6720 7370 6c69   = %s using spli
-0001ad20: 745f 6164 6420 6665 6174 7572 6520 656e  t_add feature en
-0001ad30: 6769 6e65 6572 696e 672e 2e2e 2720 256e  gineering...' %n
-0001ad40: 6577 5f63 6f6c 290a 2020 2020 6966 2061  ew_col).    if a
-0001ad50: 6374 696f 6e20 696e 205b 272b 272c 272d  ction in ['+','-
-0001ad60: 272c 272a 272c 272f 272c 2761 6464 272c  ','*','/','add',
-0001ad70: 2773 7562 7472 6163 7427 2c27 6d75 6c74  'subtract','mult
-0001ad80: 6970 6c79 272c 2764 6976 6964 6527 5d3a  iply','divide']:
-0001ad90: 0a20 2020 2020 2020 2069 6620 6163 7469  .        if acti
-0001ada0: 6f6e 2069 6e20 5b27 6164 6427 2c27 2b27  on in ['add','+'
-0001adb0: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
-0001adc0: 6967 6e20 3d20 272b 270a 2020 2020 2020  ign = '+'.      
-0001add0: 2020 656c 6966 2061 6374 696f 6e20 696e    elif action in
-0001ade0: 205b 272d 272c 2027 7375 6274 7261 6374   ['-', 'subtract
-0001adf0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0001ae00: 7369 676e 203d 2027 2d27 0a20 2020 2020  sign = '-'.     
-0001ae10: 2020 2065 6c69 6620 6163 7469 6f6e 2069     elif action i
-0001ae20: 6e20 5b27 2a27 2c20 276d 756c 7469 706c  n ['*', 'multipl
-0001ae30: 7927 5d3a 0a20 2020 2020 2020 2020 2020  y']:.           
-0001ae40: 2073 6967 6e20 3d20 272a 270a 2020 2020   sign = '*'.    
-0001ae50: 2020 2020 656c 6966 2061 6374 696f 6e20      elif action 
-0001ae60: 696e 205b 272f 272c 2027 6469 7669 6465  in ['/', 'divide
-0001ae70: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0001ae80: 7369 676e 203d 2027 2f27 0a20 2020 2020  sign = '/'.     
-0001ae90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001aea0: 2020 2020 2073 6967 6e20 3d20 272b 270a       sign = '+'.
-0001aeb0: 2020 2020 2020 2020 2320 7573 696e 6720          # using 
-0001aec0: 7265 6475 6365 2074 6f20 636f 6d70 7574  reduce to comput
-0001aed0: 6520 7375 6d20 6f66 206c 6973 740a 2020  e sum of list.  
-0001aee0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001aef0: 2020 2020 2020 2074 7261 696e 7820 3d20         trainx = 
-0001af00: 6466 745b 636f 6c5d 2e61 7374 7970 6528  dft[col].astype(
-0001af10: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
-0001af20: 2074 7261 696e 7820 3d20 7472 6169 6e78   trainx = trainx
-0001af30: 2e6d 6170 286c 616d 6264 6120 783a 2020  .map(lambda x:  
-0001af40: 3020 6966 2078 2069 7320 6e70 2e6e 616e  0 if x is np.nan
-0001af50: 2065 6c73 6520 3020 6966 2078 203d 3d20   else 0 if x == 
-0001af60: 2727 2065 6c73 6520 782e 7370 6c69 7428  '' else x.split(
-0001af70: 7370 6c69 7474 6572 2929 2e6d 6170 280a  splitter)).map(.
+0001ac40: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0001ac50: 2020 2020 5265 7475 726e 7320 6120 6461      Returns a da
+0001ac60: 7461 6672 616d 6520 7769 7468 2061 206e  taframe with a n
+0001ac70: 6577 2063 6f6c 756d 6e20 7468 6174 2069  ew column that i
+0001ac80: 7320 6120 6d6f 6469 6669 6361 7469 6f6e  s a modification
+0001ac90: 206f 6620 7468 6520 6f6c 6420 636f 6c75   of the old colu
+0001aca0: 6d6e 0a20 2020 2022 2222 0a20 2020 2064  mn.    """.    d
+0001acb0: 6674 203d 2063 6f70 792e 6465 6570 636f  ft = copy.deepco
+0001acc0: 7079 2864 6674 290a 2020 2020 6e65 775f  py(dft).    new_
+0001acd0: 636f 6c20 3d20 636f 6c20 2b20 275f 7370  col = col + '_sp
+0001ace0: 6c69 745f 6170 706c 7927 0a20 2020 2070  lit_apply'.    p
+0001acf0: 7269 6e74 2827 4372 6561 7469 6e67 2063  rint('Creating c
+0001ad00: 6f6c 756d 6e20 3d20 2573 2075 7369 6e67  olumn = %s using
+0001ad10: 2073 706c 6974 5f61 6464 2066 6561 7475   split_add featu
+0001ad20: 7265 2065 6e67 696e 6565 7269 6e67 2e2e  re engineering..
+0001ad30: 2e27 2025 6e65 775f 636f 6c29 0a20 2020  .' %new_col).   
+0001ad40: 2069 6620 6163 7469 6f6e 2069 6e20 5b27   if action in ['
+0001ad50: 2b27 2c27 2d27 2c27 2a27 2c27 2f27 2c27  +','-','*','/','
+0001ad60: 6164 6427 2c27 7375 6274 7261 6374 272c  add','subtract',
+0001ad70: 276d 756c 7469 706c 7927 2c27 6469 7669  'multiply','divi
+0001ad80: 6465 275d 3a0a 2020 2020 2020 2020 6966  de']:.        if
+0001ad90: 2061 6374 696f 6e20 696e 205b 2761 6464   action in ['add
+0001ada0: 272c 272b 275d 3a0a 2020 2020 2020 2020  ','+']:.        
+0001adb0: 2020 2020 7369 676e 203d 2027 2b27 0a20      sign = '+'. 
+0001adc0: 2020 2020 2020 2065 6c69 6620 6163 7469         elif acti
+0001add0: 6f6e 2069 6e20 5b27 2d27 2c20 2773 7562  on in ['-', 'sub
+0001ade0: 7472 6163 7427 5d3a 0a20 2020 2020 2020  tract']:.       
+0001adf0: 2020 2020 2073 6967 6e20 3d20 272d 270a       sign = '-'.
+0001ae00: 2020 2020 2020 2020 656c 6966 2061 6374          elif act
+0001ae10: 696f 6e20 696e 205b 272a 272c 2027 6d75  ion in ['*', 'mu
+0001ae20: 6c74 6970 6c79 275d 3a0a 2020 2020 2020  ltiply']:.      
+0001ae30: 2020 2020 2020 7369 676e 203d 2027 2a27        sign = '*'
+0001ae40: 0a20 2020 2020 2020 2065 6c69 6620 6163  .        elif ac
+0001ae50: 7469 6f6e 2069 6e20 5b27 2f27 2c20 2764  tion in ['/', 'd
+0001ae60: 6976 6964 6527 5d3a 0a20 2020 2020 2020  ivide']:.       
+0001ae70: 2020 2020 2073 6967 6e20 3d20 272f 270a       sign = '/'.
+0001ae80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001ae90: 2020 2020 2020 2020 2020 7369 676e 203d            sign =
+0001aea0: 2027 2b27 0a20 2020 2020 2020 2023 2075   '+'.        # u
+0001aeb0: 7369 6e67 2072 6564 7563 6520 746f 2063  sing reduce to c
+0001aec0: 6f6d 7075 7465 2073 756d 206f 6620 6c69  ompute sum of li
+0001aed0: 7374 0a20 2020 2020 2020 2074 7279 3a0a  st.        try:.
+0001aee0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0001aef0: 6e78 203d 2064 6674 5b63 6f6c 5d2e 6173  nx = dft[col].as
+0001af00: 7479 7065 2873 7472 290a 2020 2020 2020  type(str).      
+0001af10: 2020 2020 2020 7472 6169 6e78 203d 2074        trainx = t
+0001af20: 7261 696e 782e 6d61 7028 6c61 6d62 6461  rainx.map(lambda
+0001af30: 2078 3a20 2030 2069 6620 7820 6973 206e   x:  0 if x is n
+0001af40: 702e 6e61 6e20 656c 7365 2030 2069 6620  p.nan else 0 if 
+0001af50: 7820 3d3d 2027 2720 656c 7365 2078 2e73  x == '' else x.s
+0001af60: 706c 6974 2873 706c 6974 7465 7229 292e  plit(splitter)).
+0001af70: 6d61 7028 0a20 2020 2020 2020 2020 2020  map(.           
 0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afa0: 6c61 6d62 6461 206c 6973 7478 3a20 5b69  lambda listx: [i
-0001afb0: 6e74 2878 2920 6966 2078 2021 3d20 2727  nt(x) if x != ''
-0001afc0: 2065 6c73 6520 3020 666f 7220 7820 696e   else 0 for x in
-0001afd0: 206c 6973 7478 205d 2069 6620 6973 696e   listx ] if isin
-0001afe0: 7374 616e 6365 286c 6973 7478 2c6c 6973  stance(listx,lis
-0001aff0: 7429 2065 6c73 6520 5b30 2c30 5d29 0a20  t) else [0,0]). 
-0001b000: 2020 2020 2020 2020 2020 2064 6674 5b6e             dft[n
-0001b010: 6577 5f63 6f6c 5d20 3d20 7472 6169 6e78  ew_col] = trainx
-0001b020: 2e6d 6170 286c 616d 6264 6120 6c69 733a  .map(lambda lis:
-0001b030: 2072 6564 7563 6528 6c61 6d62 6461 2061   reduce(lambda a
-0001b040: 2c62 203a 2065 7661 6c28 2761 272b 7369  ,b : eval('a'+si
-0001b050: 676e 2b27 6227 292c 206c 6973 2920 6966  gn+'b'), lis) if
-0001b060: 2069 7369 6e73 7461 6e63 6528 6c69 732c   isinstance(lis,
-0001b070: 6c69 7374 2920 656c 7365 2030 292e 7661  list) else 0).va
-0001b080: 6c75 6573 0a20 2020 2020 2020 2065 7863  lues.        exc
-0001b090: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0001b0a0: 2070 7269 6e74 2827 2020 2020 4572 726f   print('    Erro
-0001b0b0: 723a 2072 6574 7572 6e69 6e67 2077 6974  r: returning wit
-0001b0c0: 686f 7574 2063 7265 6174 696e 6720 6e65  hout creating ne
-0001b0d0: 7720 636f 6c75 6d6e 2729 0a20 2020 2020  w column').     
-0001b0e0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-0001b0f0: 740a 2020 2020 656c 6966 2061 6374 696f  t.    elif actio
-0001b100: 6e20 696e 205b 2763 6f6e 6361 7427 2c27  n in ['concat','
-0001b110: 636f 6e63 6174 656e 6174 6527 5d3a 0a20  concatenate']:. 
-0001b120: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001b130: 2020 2020 2020 2020 6466 745b 6e65 775f          dft[new_
-0001b140: 636f 6c5d 203d 2064 6674 5b63 6f6c 5d2e  col] = dft[col].
-0001b150: 6d61 7028 6c61 6d62 6461 2078 3a20 2022  map(lambda x:  "
-0001b160: 2022 2069 6620 7820 6973 206e 702e 6e61   " if x is np.na
-0001b170: 6e20 656c 7365 2022 2022 2069 6620 7820  n else " " if x 
-0001b180: 3d3d 2027 2720 656c 7365 2078 2e73 706c  == '' else x.spl
-0001b190: 6974 2873 706c 6974 7465 7229 292e 6d61  it(splitter)).ma
-0001b1a0: 7028 0a20 2020 2020 2020 2020 2020 2020  p(.             
-0001b1b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001b1c0: 616d 6264 6120 6c69 7374 783a 206e 702e  ambda listx: np.
-0001b1d0: 636f 6e63 6174 656e 6174 6528 5b73 7472  concatenate([str
-0001b1e0: 2878 2920 6966 2078 2021 3d20 2727 2065  (x) if x != '' e
-0001b1f0: 6c73 6520 2220 2220 666f 7220 7820 696e  lse " " for x in
-0001b200: 206c 6973 7478 5d20 6966 2069 7369 6e73   listx] if isins
-0001b210: 7461 6e63 6528 6c69 7374 782c 6c69 7374  tance(listx,list
-0001b220: 2920 656c 7365 2022 2022 2929 2e76 616c  ) else " ")).val
-0001b230: 7565 730a 2020 2020 2020 2020 6578 6365  ues.        exce
-0001b240: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-0001b250: 7072 696e 7428 2720 2020 2045 7272 6f72  print('    Error
-0001b260: 3a20 7265 7475 726e 696e 6720 7769 7468  : returning with
-0001b270: 6f75 7420 6372 6561 7469 6e67 206e 6577  out creating new
-0001b280: 2063 6f6c 756d 6e27 290a 2020 2020 656c   column').    el
-0001b290: 7365 3a0a 2020 2020 2020 2020 7072 696e  se:.        prin
-0001b2a0: 7428 2743 6f75 6c64 206e 6f74 2070 6572  t('Could not per
-0001b2b0: 666f 726d 2061 6374 696f 6e2e 2050 6c65  form action. Ple
-0001b2c0: 6173 6520 6368 6563 6b20 796f 7572 2069  ase check your i
-0001b2d0: 6e70 7574 7320 616e 6420 7472 7920 6167  nputs and try ag
-0001b2e0: 6169 6e27 290a 2020 2020 2020 2020 7265  ain').        re
-0001b2f0: 7475 726e 2064 6674 0a20 2020 2072 6574  turn dft.    ret
-0001b300: 7572 6e20 6466 740a 2323 2323 2323 2323  urn dft.########
+0001af90: 2020 2020 206c 616d 6264 6120 6c69 7374       lambda list
+0001afa0: 783a 205b 696e 7428 7829 2069 6620 7820  x: [int(x) if x 
+0001afb0: 213d 2027 2720 656c 7365 2030 2066 6f72  != '' else 0 for
+0001afc0: 2078 2069 6e20 6c69 7374 7820 5d20 6966   x in listx ] if
+0001afd0: 2069 7369 6e73 7461 6e63 6528 6c69 7374   isinstance(list
+0001afe0: 782c 6c69 7374 2920 656c 7365 205b 302c  x,list) else [0,
+0001aff0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001b000: 6466 745b 6e65 775f 636f 6c5d 203d 2074  dft[new_col] = t
+0001b010: 7261 696e 782e 6d61 7028 6c61 6d62 6461  rainx.map(lambda
+0001b020: 206c 6973 3a20 7265 6475 6365 286c 616d   lis: reduce(lam
+0001b030: 6264 6120 612c 6220 3a20 6576 616c 2827  bda a,b : eval('
+0001b040: 6127 2b73 6967 6e2b 2762 2729 2c20 6c69  a'+sign+'b'), li
+0001b050: 7329 2069 6620 6973 696e 7374 616e 6365  s) if isinstance
+0001b060: 286c 6973 2c6c 6973 7429 2065 6c73 6520  (lis,list) else 
+0001b070: 3029 2e76 616c 7565 730a 2020 2020 2020  0).values.      
+0001b080: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0001b090: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
+0001b0a0: 2045 7272 6f72 3a20 7265 7475 726e 696e   Error: returnin
+0001b0b0: 6720 7769 7468 6f75 7420 6372 6561 7469  g without creati
+0001b0c0: 6e67 206e 6577 2063 6f6c 756d 6e27 290a  ng new column').
+0001b0d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001b0e0: 726e 2064 6674 0a20 2020 2065 6c69 6620  rn dft.    elif 
+0001b0f0: 6163 7469 6f6e 2069 6e20 5b27 636f 6e63  action in ['conc
+0001b100: 6174 272c 2763 6f6e 6361 7465 6e61 7465  at','concatenate
+0001b110: 275d 3a0a 2020 2020 2020 2020 7472 793a  ']:.        try:
+0001b120: 0a20 2020 2020 2020 2020 2020 2064 6674  .            dft
+0001b130: 5b6e 6577 5f63 6f6c 5d20 3d20 6466 745b  [new_col] = dft[
+0001b140: 636f 6c5d 2e6d 6170 286c 616d 6264 6120  col].map(lambda 
+0001b150: 783a 2020 2220 2220 6966 2078 2069 7320  x:  " " if x is 
+0001b160: 6e70 2e6e 616e 2065 6c73 6520 2220 2220  np.nan else " " 
+0001b170: 6966 2078 203d 3d20 2727 2065 6c73 6520  if x == '' else 
+0001b180: 782e 7370 6c69 7428 7370 6c69 7474 6572  x.split(splitter
+0001b190: 2929 2e6d 6170 280a 2020 2020 2020 2020  )).map(.        
+0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1b0: 2020 2020 6c61 6d62 6461 206c 6973 7478      lambda listx
+0001b1c0: 3a20 6e70 2e63 6f6e 6361 7465 6e61 7465  : np.concatenate
+0001b1d0: 285b 7374 7228 7829 2069 6620 7820 213d  ([str(x) if x !=
+0001b1e0: 2027 2720 656c 7365 2022 2022 2066 6f72   '' else " " for
+0001b1f0: 2078 2069 6e20 6c69 7374 785d 2069 6620   x in listx] if 
+0001b200: 6973 696e 7374 616e 6365 286c 6973 7478  isinstance(listx
+0001b210: 2c6c 6973 7429 2065 6c73 6520 2220 2229  ,list) else " ")
+0001b220: 292e 7661 6c75 6573 0a20 2020 2020 2020  ).values.       
+0001b230: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+0001b240: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+0001b250: 4572 726f 723a 2072 6574 7572 6e69 6e67  Error: returning
+0001b260: 2077 6974 686f 7574 2063 7265 6174 696e   without creatin
+0001b270: 6720 6e65 7720 636f 6c75 6d6e 2729 0a20  g new column'). 
+0001b280: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001b290: 2070 7269 6e74 2827 436f 756c 6420 6e6f   print('Could no
+0001b2a0: 7420 7065 7266 6f72 6d20 6163 7469 6f6e  t perform action
+0001b2b0: 2e20 506c 6561 7365 2063 6865 636b 2079  . Please check y
+0001b2c0: 6f75 7220 696e 7075 7473 2061 6e64 2074  our inputs and t
+0001b2d0: 7279 2061 6761 696e 2729 0a20 2020 2020  ry again').     
+0001b2e0: 2020 2072 6574 7572 6e20 6466 740a 2020     return dft.  
+0001b2f0: 2020 7265 7475 726e 2064 6674 0a23 2323    return dft.###
+0001b300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b350: 2323 2323 2323 2323 0a64 6566 2046 455f  ########.def FE_
-0001b360: 6164 645f 6167 655f 6279 5f64 6174 655f  add_age_by_date_
-0001b370: 636f 6c28 6466 742c 2064 6174 655f 636f  col(dft, date_co
-0001b380: 6c2c 2061 6765 5f66 6f72 6d61 7429 3a0a  l, age_format):.
-0001b390: 2020 2020 2222 220a 2020 2020 4645 206d      """.    FE m
-0001b3a0: 6561 6e73 2046 4541 5455 5245 2045 4e47  eans FEATURE ENG
-0001b3b0: 494e 4545 5249 4e47 202d 2054 6861 7420  INEERING - That 
-0001b3c0: 6d65 616e 7320 7468 6973 2066 756e 6374  means this funct
-0001b3d0: 696f 6e20 7769 6c6c 2063 7265 6174 6520  ion will create 
-0001b3e0: 6e65 7720 6665 6174 7572 6573 0a20 2020  new features.   
-0001b3f0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+0001b340: 2323 2323 2323 2323 2323 2323 230a 6465  #############.de
+0001b350: 6620 4645 5f61 6464 5f61 6765 5f62 795f  f FE_add_age_by_
+0001b360: 6461 7465 5f63 6f6c 2864 6674 2c20 6461  date_col(dft, da
+0001b370: 7465 5f63 6f6c 2c20 6167 655f 666f 726d  te_col, age_form
+0001b380: 6174 293a 0a20 2020 2022 2222 0a20 2020  at):.    """.   
+0001b390: 2046 4520 6d65 616e 7320 4645 4154 5552   FE means FEATUR
+0001b3a0: 4520 454e 4749 4e45 4552 494e 4720 2d20  E ENGINEERING - 
+0001b3b0: 5468 6174 206d 6561 6e73 2074 6869 7320  That means this 
+0001b3c0: 6675 6e63 7469 6f6e 2077 696c 6c20 6372  function will cr
+0001b3d0: 6561 7465 206e 6577 2066 6561 7475 7265  eate new feature
+0001b3e0: 730a 2020 2020 2323 2323 2323 2323 2323  s.    ##########
+0001b3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b440: 2323 2323 2323 230a 2020 2020 5468 6973  #######.    This
-0001b450: 2068 616e 6479 2066 756e 6374 696f 6e20   handy function 
-0001b460: 6765 7473 2079 6f75 2061 6765 2066 726f  gets you age fro
-0001b470: 6d20 7468 6520 6461 7465 5f63 6f6c 2074  m the date_col t
-0001b480: 6f20 746f 6461 792e 2049 7420 6361 6e20  o today. It can 
-0001b490: 6265 2063 6f75 6e74 6564 2069 6e20 6d6f  be counted in mo
-0001b4a0: 6e74 6873 206f 7220 7965 6172 7320 6f72  nths or years or
-0001b4b0: 2064 6179 732e 0a20 2020 2023 2323 2323   days..    #####
+0001b430: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+0001b440: 2054 6869 7320 6861 6e64 7920 6675 6e63   This handy func
+0001b450: 7469 6f6e 2067 6574 7320 796f 7520 6167  tion gets you ag
+0001b460: 6520 6672 6f6d 2074 6865 2064 6174 655f  e from the date_
+0001b470: 636f 6c20 746f 2074 6f64 6179 2e20 4974  col to today. It
+0001b480: 2063 616e 2062 6520 636f 756e 7465 6420   can be counted 
+0001b490: 696e 206d 6f6e 7468 7320 6f72 2079 6561  in months or yea
+0001b4a0: 7273 206f 7220 6461 7973 2e0a 2020 2020  rs or days..    
+0001b4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b510: 230a 2020 2020 4974 2072 6574 7572 6e73  #.    It returns
-0001b520: 2074 6865 2073 616d 6520 6461 7461 6672   the same datafr
-0001b530: 616d 6520 7769 7468 2061 6e20 6578 7472  ame with an extr
-0001b540: 6120 636f 6c75 6d6e 2061 6464 6564 2074  a column added t
-0001b550: 6861 7420 6769 7665 7320 796f 7520 6167  hat gives you ag
-0001b560: 650a 2020 2020 2222 220a 2020 2020 6966  e.    """.    if
-0001b570: 206e 6f74 2061 6765 5f66 6f72 6d61 7420   not age_format 
-0001b580: 696e 205b 274d 272c 2744 272c 2759 275d  in ['M','D','Y']
-0001b590: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0001b5a0: 2741 6765 2069 7320 6e6f 7420 6769 7665  'Age is not give
-0001b5b0: 6e20 696e 2072 6967 6874 2066 6f72 6d61  n in right forma
-0001b5c0: 742e 204d 7573 7420 6265 206f 6e65 206f  t. Must be one o
-0001b5d0: 6620 442c 2059 206f 7220 4d27 290a 2020  f D, Y or M').  
-0001b5e0: 2020 2020 2020 7265 7475 726e 2064 6674        return dft
-0001b5f0: 0a20 2020 206e 6577 5f64 6174 655f 636f  .    new_date_co
-0001b600: 6c20 3d20 276c 6173 745f 272b 6461 7465  l = 'last_'+date
-0001b610: 5f63 6f6c 2b27 5f69 6e5f 6d6f 6e74 6873  _col+'_in_months
-0001b620: 270a 2020 2020 7472 793a 0a20 2020 2020  '.    try:.     
-0001b630: 2020 206e 6f77 203d 2070 642e 5469 6d65     now = pd.Time
-0001b640: 7374 616d 7028 276e 6f77 2729 0a20 2020  stamp('now').   
-0001b650: 2020 2020 2064 6674 5b64 6174 655f 636f       dft[date_co
-0001b660: 6c5d 203d 2070 642e 746f 5f64 6174 6574  l] = pd.to_datet
-0001b670: 696d 6528 6466 745b 6461 7465 5f63 6f6c  ime(dft[date_col
-0001b680: 5d2c 2066 6f72 6d61 743d 2725 792d 256d  ], format='%y-%m
-0001b690: 2d25 6427 290a 2020 2020 2020 2020 6466  -%d').        df
-0001b6a0: 745b 6461 7465 5f63 6f6c 5d20 3d20 6466  t[date_col] = df
-0001b6b0: 745b 6461 7465 5f63 6f6c 5d2e 7768 6572  t[date_col].wher
-0001b6c0: 6528 6466 745b 6461 7465 5f63 6f6c 5d20  e(dft[date_col] 
-0001b6d0: 3c20 6e6f 772c 2064 6674 5b64 6174 655f  < now, dft[date_
-0001b6e0: 636f 6c5d 202d 2020 6e70 2e74 696d 6564  col] -  np.timed
-0001b6f0: 656c 7461 3634 2831 3030 2c20 6167 655f  elta64(100, age_
-0001b700: 666f 726d 6174 2929 0a20 2020 2020 2020  format)).       
-0001b710: 2069 6620 6167 655f 666f 726d 6174 203d   if age_format =
-0001b720: 3d20 274d 273a 0a20 2020 2020 2020 2020  = 'M':.         
-0001b730: 2020 2064 6674 5b6e 6577 5f64 6174 655f     dft[new_date_
-0001b740: 636f 6c5d 203d 2028 6e6f 7720 2d20 6466  col] = (now - df
-0001b750: 745b 6461 7465 5f63 6f6c 5d29 2e61 7374  t[date_col]).ast
-0001b760: 7970 6528 273c 6d38 5b4d 5d27 290a 2020  ype('<m8[M]').  
-0001b770: 2020 2020 2020 656c 6966 2061 6765 5f66        elif age_f
-0001b780: 6f72 6d61 7420 3d3d 2027 5927 3a0a 2020  ormat == 'Y':.  
-0001b790: 2020 2020 2020 2020 2020 6466 745b 6e65            dft[ne
-0001b7a0: 775f 6461 7465 5f63 6f6c 5d20 3d20 286e  w_date_col] = (n
-0001b7b0: 6f77 202d 2064 6674 5b64 6174 655f 636f  ow - dft[date_co
-0001b7c0: 6c5d 292e 6173 7479 7065 2827 3c6d 385b  l]).astype('<m8[
-0001b7d0: 595d 2729 0a20 2020 2020 2020 2065 6c69  Y]').        eli
-0001b7e0: 6620 6167 655f 666f 726d 6174 203d 3d20  f age_format == 
-0001b7f0: 2744 273a 0a20 2020 2020 2020 2020 2020  'D':.           
-0001b800: 2064 6674 5b6e 6577 5f64 6174 655f 636f   dft[new_date_co
-0001b810: 6c5d 203d 2028 6e6f 7720 2d20 6466 745b  l] = (now - dft[
-0001b820: 6461 7465 5f63 6f6c 5d29 2e61 7374 7970  date_col]).astyp
-0001b830: 6528 273c 6d38 5b44 5d27 290a 2020 2020  e('<m8[D]').    
-0001b840: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0001b850: 7072 696e 7428 2720 2020 2045 7272 6f72  print('    Error
-0001b860: 2069 6e20 6461 7465 2066 6f72 6d61 7474   in date formatt
-0001b870: 696e 672e 2050 6c65 6173 6520 6368 6563  ing. Please chec
-0001b880: 6b20 796f 7572 2069 6e70 7574 2061 6e64  k your input and
-0001b890: 2074 7279 2061 6761 696e 2729 0a20 2020   try again').   
-0001b8a0: 2072 6574 7572 6e20 6466 740a 2323 2323   return dft.####
+0001b500: 2323 2323 2323 0a20 2020 2049 7420 7265  ######.    It re
+0001b510: 7475 726e 7320 7468 6520 7361 6d65 2064  turns the same d
+0001b520: 6174 6166 7261 6d65 2077 6974 6820 616e  ataframe with an
+0001b530: 2065 7874 7261 2063 6f6c 756d 6e20 6164   extra column ad
+0001b540: 6465 6420 7468 6174 2067 6976 6573 2079  ded that gives y
+0001b550: 6f75 2061 6765 0a20 2020 2022 2222 0a20  ou age.    """. 
+0001b560: 2020 2069 6620 6e6f 7420 6167 655f 666f     if not age_fo
+0001b570: 726d 6174 2069 6e20 5b27 4d27 2c27 4427  rmat in ['M','D'
+0001b580: 2c27 5927 5d3a 0a20 2020 2020 2020 2070  ,'Y']:.        p
+0001b590: 7269 6e74 2827 4167 6520 6973 206e 6f74  rint('Age is not
+0001b5a0: 2067 6976 656e 2069 6e20 7269 6768 7420   given in right 
+0001b5b0: 666f 726d 6174 2e20 4d75 7374 2062 6520  format. Must be 
+0001b5c0: 6f6e 6520 6f66 2044 2c20 5920 6f72 204d  one of D, Y or M
+0001b5d0: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
+0001b5e0: 6e20 6466 740a 2020 2020 6e65 775f 6461  n dft.    new_da
+0001b5f0: 7465 5f63 6f6c 203d 2027 6c61 7374 5f27  te_col = 'last_'
+0001b600: 2b64 6174 655f 636f 6c2b 275f 696e 5f6d  +date_col+'_in_m
+0001b610: 6f6e 7468 7327 0a20 2020 2074 7279 3a0a  onths'.    try:.
+0001b620: 2020 2020 2020 2020 6e6f 7720 3d20 7064          now = pd
+0001b630: 2e54 696d 6573 7461 6d70 2827 6e6f 7727  .Timestamp('now'
+0001b640: 290a 2020 2020 2020 2020 6466 745b 6461  ).        dft[da
+0001b650: 7465 5f63 6f6c 5d20 3d20 7064 2e74 6f5f  te_col] = pd.to_
+0001b660: 6461 7465 7469 6d65 2864 6674 5b64 6174  datetime(dft[dat
+0001b670: 655f 636f 6c5d 2c20 666f 726d 6174 3d27  e_col], format='
+0001b680: 2579 2d25 6d2d 2564 2729 0a20 2020 2020  %y-%m-%d').     
+0001b690: 2020 2064 6674 5b64 6174 655f 636f 6c5d     dft[date_col]
+0001b6a0: 203d 2064 6674 5b64 6174 655f 636f 6c5d   = dft[date_col]
+0001b6b0: 2e77 6865 7265 2864 6674 5b64 6174 655f  .where(dft[date_
+0001b6c0: 636f 6c5d 203c 206e 6f77 2c20 6466 745b  col] < now, dft[
+0001b6d0: 6461 7465 5f63 6f6c 5d20 2d20 206e 702e  date_col] -  np.
+0001b6e0: 7469 6d65 6465 6c74 6136 3428 3130 302c  timedelta64(100,
+0001b6f0: 2061 6765 5f66 6f72 6d61 7429 290a 2020   age_format)).  
+0001b700: 2020 2020 2020 6966 2061 6765 5f66 6f72        if age_for
+0001b710: 6d61 7420 3d3d 2027 4d27 3a0a 2020 2020  mat == 'M':.    
+0001b720: 2020 2020 2020 2020 6466 745b 6e65 775f          dft[new_
+0001b730: 6461 7465 5f63 6f6c 5d20 3d20 286e 6f77  date_col] = (now
+0001b740: 202d 2064 6674 5b64 6174 655f 636f 6c5d   - dft[date_col]
+0001b750: 292e 6173 7479 7065 2827 3c6d 385b 4d5d  ).astype('<m8[M]
+0001b760: 2729 0a20 2020 2020 2020 2065 6c69 6620  ').        elif 
+0001b770: 6167 655f 666f 726d 6174 203d 3d20 2759  age_format == 'Y
+0001b780: 273a 0a20 2020 2020 2020 2020 2020 2064  ':.            d
+0001b790: 6674 5b6e 6577 5f64 6174 655f 636f 6c5d  ft[new_date_col]
+0001b7a0: 203d 2028 6e6f 7720 2d20 6466 745b 6461   = (now - dft[da
+0001b7b0: 7465 5f63 6f6c 5d29 2e61 7374 7970 6528  te_col]).astype(
+0001b7c0: 273c 6d38 5b59 5d27 290a 2020 2020 2020  '<m8[Y]').      
+0001b7d0: 2020 656c 6966 2061 6765 5f66 6f72 6d61    elif age_forma
+0001b7e0: 7420 3d3d 2027 4427 3a0a 2020 2020 2020  t == 'D':.      
+0001b7f0: 2020 2020 2020 6466 745b 6e65 775f 6461        dft[new_da
+0001b800: 7465 5f63 6f6c 5d20 3d20 286e 6f77 202d  te_col] = (now -
+0001b810: 2064 6674 5b64 6174 655f 636f 6c5d 292e   dft[date_col]).
+0001b820: 6173 7479 7065 2827 3c6d 385b 445d 2729  astype('<m8[D]')
+0001b830: 0a20 2020 2065 7863 6570 743a 0a20 2020  .    except:.   
+0001b840: 2020 2020 2070 7269 6e74 2827 2020 2020       print('    
+0001b850: 4572 726f 7220 696e 2064 6174 6520 666f  Error in date fo
+0001b860: 726d 6174 7469 6e67 2e20 506c 6561 7365  rmatting. Please
+0001b870: 2063 6865 636b 2079 6f75 7220 696e 7075   check your inpu
+0001b880: 7420 616e 6420 7472 7920 6167 6169 6e27  t and try again'
+0001b890: 290a 2020 2020 7265 7475 726e 2064 6674  ).    return dft
+0001b8a0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
 0001b8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b8e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b8f0: 2323 2323 2323 2323 2323 2323 230a 6465  #############.de
-0001b900: 6620 4645 5f63 6f75 6e74 5f72 6f77 735f  f FE_count_rows_
-0001b910: 666f 725f 616c 6c5f 636f 6c75 6d6e 735f  for_all_columns_
-0001b920: 6279 5f67 726f 7570 2864 6674 2c20 6964  by_group(dft, id
-0001b930: 5f63 6f6c 293a 0a20 2020 2022 2222 0a20  _col):.    """. 
-0001b940: 2020 2046 4520 6d65 616e 7320 4645 4154     FE means FEAT
-0001b950: 5552 4520 454e 4749 4e45 4552 494e 4720  URE ENGINEERING 
-0001b960: 2d20 5468 6174 206d 6561 6e73 2074 6869  - That means thi
-0001b970: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
-0001b980: 6372 6561 7465 206e 6577 2066 6561 7475  create new featu
-0001b990: 7265 730a 2020 2020 2323 2323 2323 2323  res.    ########
+0001b8f0: 2323 0a64 6566 2046 455f 636f 756e 745f  ##.def FE_count_
+0001b900: 726f 7773 5f66 6f72 5f61 6c6c 5f63 6f6c  rows_for_all_col
+0001b910: 756d 6e73 5f62 795f 6772 6f75 7028 6466  umns_by_group(df
+0001b920: 742c 2069 645f 636f 6c29 3a0a 2020 2020  t, id_col):.    
+0001b930: 2222 220a 2020 2020 4645 206d 6561 6e73  """.    FE means
+0001b940: 2046 4541 5455 5245 2045 4e47 494e 4545   FEATURE ENGINEE
+0001b950: 5249 4e47 202d 2054 6861 7420 6d65 616e  RING - That mean
+0001b960: 7320 7468 6973 2066 756e 6374 696f 6e20  s this function 
+0001b970: 7769 6c6c 2063 7265 6174 6520 6e65 7720  will create new 
+0001b980: 6665 6174 7572 6573 0a20 2020 2023 2323  features.    ###
+0001b990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001b9d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b9e0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0001b9f0: 2020 2054 6869 7320 6861 6e64 7920 6675     This handy fu
-0001ba00: 6e63 7469 6f6e 2067 6976 6573 2079 6f75  nction gives you
-0001ba10: 2061 2063 6f75 6e74 206f 6620 616c 6c20   a count of all 
-0001ba20: 726f 7773 2062 7920 6772 6f75 7073 2062  rows by groups b
-0001ba30: 6173 6564 206f 6e20 6964 5f63 6f6c 2069  ased on id_col i
-0001ba40: 6e20 796f 7572 2064 6174 6166 7261 6d65  n your dataframe
-0001ba50: 2e0a 2020 2020 5265 6d65 6d62 6572 2074  ..    Remember t
-0001ba60: 6861 7420 6974 2063 6f75 6e74 7320 6f6e  hat it counts on
-0001ba70: 6c79 206e 6f6e 2d6e 756c 6c20 726f 7773  ly non-null rows
-0001ba80: 2e20 4865 6e63 6520 6974 2069 7320 6120  . Hence it is a 
-0001ba90: 6469 6666 6572 656e 7420 636f 756e 7420  different count 
-0001baa0: 7468 616e 206f 7468 6572 2063 6f75 6e74  than other count
-0001bab0: 2066 756e 6374 696f 6e2e 0a20 2020 2023   function..    #
+0001b9e0: 2323 230a 2020 2020 5468 6973 2068 616e  ###.    This han
+0001b9f0: 6479 2066 756e 6374 696f 6e20 6769 7665  dy function give
+0001ba00: 7320 796f 7520 6120 636f 756e 7420 6f66  s you a count of
+0001ba10: 2061 6c6c 2072 6f77 7320 6279 2067 726f   all rows by gro
+0001ba20: 7570 7320 6261 7365 6420 6f6e 2069 645f  ups based on id_
+0001ba30: 636f 6c20 696e 2079 6f75 7220 6461 7461  col in your data
+0001ba40: 6672 616d 652e 0a20 2020 2052 656d 656d  frame..    Remem
+0001ba50: 6265 7220 7468 6174 2069 7420 636f 756e  ber that it coun
+0001ba60: 7473 206f 6e6c 7920 6e6f 6e2d 6e75 6c6c  ts only non-null
+0001ba70: 2072 6f77 732e 2048 656e 6365 2069 7420   rows. Hence it 
+0001ba80: 6973 2061 2064 6966 6665 7265 6e74 2063  is a different c
+0001ba90: 6f75 6e74 2074 6861 6e20 6f74 6865 7220  ount than other 
+0001baa0: 636f 756e 7420 6675 6e63 7469 6f6e 2e0a  count function..
+0001bab0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
 0001bac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001baf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001bb00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001bb10: 2323 2323 230a 2020 2020 4974 2072 6574  #####.    It ret
-0001bb20: 7572 6e73 2061 2064 6174 6166 7261 6d65  urns a dataframe
-0001bb30: 2077 6974 6820 6964 5f63 6f6c 2061 7320   with id_col as 
-0001bb40: 7468 6520 696e 6465 7820 616e 6420 6120  the index and a 
-0001bb50: 6275 6e63 6820 6f66 206e 6577 2063 6f6c  bunch of new col
-0001bb60: 756d 6e73 2074 6861 7420 6769 7665 2079  umns that give y
-0001bb70: 6f75 2063 6f75 6e74 7320 6f66 2067 726f  ou counts of gro
-0001bb80: 7570 732e 0a20 2020 2022 2222 0a20 2020  ups..    """.   
-0001bb90: 206e 6577 5f63 6f6c 203d 2027 726f 775f   new_col = 'row_
-0001bba0: 636f 756e 745f 270a 2020 2020 6966 2069  count_'.    if i
-0001bbb0: 7369 6e73 7461 6e63 6528 6964 5f63 6f6c  sinstance(id_col
-0001bbc0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-0001bbd0: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
-0001bbe0: 3d20 205b 6964 5f63 6f6c 5d0a 2020 2020  =  [id_col].    
-0001bbf0: 656c 7365 3a0a 2020 2020 2020 2020 6772  else:.        gr
-0001bc00: 6f75 7062 795f 636f 6c75 6d6e 7320 3d20  oupby_columns = 
-0001bc10: 636f 7079 2e64 6565 7063 6f70 7928 6964  copy.deepcopy(id
-0001bc20: 5f63 6f6c 290a 2020 2020 6772 6f75 7065  _col).    groupe
-0001bc30: 645f 636f 756e 7420 3d20 6466 742e 6772  d_count = dft.gr
-0001bc40: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
-0001bc50: 6c75 6d6e 7329 2e63 6f75 6e74 2829 2e61  lumns).count().a
-0001bc60: 6464 5f70 7265 6669 7828 6e65 775f 636f  dd_prefix(new_co
-0001bc70: 6c29 0a20 2020 2072 6574 7572 6e20 6772  l).    return gr
-0001bc80: 6f75 7065 645f 636f 756e 740a 2323 2323  ouped_count.####
+0001bb00: 2323 2323 2323 2323 2323 0a20 2020 2049  ##########.    I
+0001bb10: 7420 7265 7475 726e 7320 6120 6461 7461  t returns a data
+0001bb20: 6672 616d 6520 7769 7468 2069 645f 636f  frame with id_co
+0001bb30: 6c20 6173 2074 6865 2069 6e64 6578 2061  l as the index a
+0001bb40: 6e64 2061 2062 756e 6368 206f 6620 6e65  nd a bunch of ne
+0001bb50: 7720 636f 6c75 6d6e 7320 7468 6174 2067  w columns that g
+0001bb60: 6976 6520 796f 7520 636f 756e 7473 206f  ive you counts o
+0001bb70: 6620 6772 6f75 7073 2e0a 2020 2020 2222  f groups..    ""
+0001bb80: 220a 2020 2020 6e65 775f 636f 6c20 3d20  ".    new_col = 
+0001bb90: 2772 6f77 5f63 6f75 6e74 5f27 0a20 2020  'row_count_'.   
+0001bba0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+0001bbb0: 645f 636f 6c2c 2073 7472 293a 0a20 2020  d_col, str):.   
+0001bbc0: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
+0001bbd0: 756d 6e73 203d 2020 5b69 645f 636f 6c5d  umns =  [id_col]
+0001bbe0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001bbf0: 2020 2067 726f 7570 6279 5f63 6f6c 756d     groupby_colum
+0001bc00: 6e73 203d 2063 6f70 792e 6465 6570 636f  ns = copy.deepco
+0001bc10: 7079 2869 645f 636f 6c29 0a20 2020 2067  py(id_col).    g
+0001bc20: 726f 7570 6564 5f63 6f75 6e74 203d 2064  rouped_count = d
+0001bc30: 6674 2e67 726f 7570 6279 2867 726f 7570  ft.groupby(group
+0001bc40: 6279 5f63 6f6c 756d 6e73 292e 636f 756e  by_columns).coun
+0001bc50: 7428 292e 6164 645f 7072 6566 6978 286e  t().add_prefix(n
+0001bc60: 6577 5f63 6f6c 290a 2020 2020 7265 7475  ew_col).    retu
+0001bc70: 726e 2067 726f 7570 6564 5f63 6f75 6e74  rn grouped_count
+0001bc80: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
 0001bc90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bcb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bcc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001bcd0: 2323 2323 2323 2323 2323 2323 230a 6465  #############.de
-0001bce0: 6620 636f 756e 745f 726f 7773 5f62 795f  f count_rows_by_
-0001bcf0: 6772 6f75 705f 696e 636c 5f6e 756c 6c73  group_incl_nulls
-0001bd00: 2864 6674 2c20 6964 5f63 6f6c 293a 0a20  (dft, id_col):. 
-0001bd10: 2020 2022 2222 0a20 2020 2023 2323 2323     """.    #####
+0001bcd0: 2323 0a64 6566 2063 6f75 6e74 5f72 6f77  ##.def count_row
+0001bce0: 735f 6279 5f67 726f 7570 5f69 6e63 6c5f  s_by_group_incl_
+0001bcf0: 6e75 6c6c 7328 6466 742c 2069 645f 636f  nulls(dft, id_co
+0001bd00: 6c29 3a0a 2020 2020 2222 220a 2020 2020  l):.    """.    
+0001bd10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bd20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bd30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bd40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001bd50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001bd60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001bd70: 230a 2020 2020 5468 6973 2066 756e 6374  #.    This funct
-0001bd80: 696f 6e20 6769 7665 7320 796f 7520 7468  ion gives you th
-0001bd90: 6520 636f 756e 7420 6f66 2061 6c6c 2074  e count of all t
-0001bda0: 6865 2072 6f77 7320 696e 636c 7564 696e  he rows includin
-0001bdb0: 6720 6e75 6c6c 2072 6f77 7320 696e 2079  g null rows in y
-0001bdc0: 6f75 7220 6461 7461 2e0a 2020 2020 4974  our data..    It
-0001bdd0: 2072 6574 7572 6e73 2061 2064 6174 6166   returns a dataf
-0001bde0: 7261 6d65 2077 6974 6820 6964 5f63 6f6c  rame with id_col
-0001bdf0: 2061 7320 7468 6520 696e 6465 7820 616e   as the index an
-0001be00: 6420 7468 6520 636f 756e 7473 206f 6620  d the counts of 
-0001be10: 726f 7773 2028 696e 636c 206e 756c 6c20  rows (incl null 
-0001be20: 726f 7773 2920 6173 2061 206e 6577 2063  rows) as a new c
-0001be30: 6f6c 756d 6e0a 2020 2020 2323 2323 2323  olumn.    ######
+0001bd60: 2323 2323 2323 0a20 2020 2054 6869 7320  ######.    This 
+0001bd70: 6675 6e63 7469 6f6e 2067 6976 6573 2079  function gives y
+0001bd80: 6f75 2074 6865 2063 6f75 6e74 206f 6620  ou the count of 
+0001bd90: 616c 6c20 7468 6520 726f 7773 2069 6e63  all the rows inc
+0001bda0: 6c75 6469 6e67 206e 756c 6c20 726f 7773  luding null rows
+0001bdb0: 2069 6e20 796f 7572 2064 6174 612e 0a20   in your data.. 
+0001bdc0: 2020 2049 7420 7265 7475 726e 7320 6120     It returns a 
+0001bdd0: 6461 7461 6672 616d 6520 7769 7468 2069  dataframe with i
+0001bde0: 645f 636f 6c20 6173 2074 6865 2069 6e64  d_col as the ind
+0001bdf0: 6578 2061 6e64 2074 6865 2063 6f75 6e74  ex and the count
+0001be00: 7320 6f66 2072 6f77 7320 2869 6e63 6c20  s of rows (incl 
+0001be10: 6e75 6c6c 2072 6f77 7329 2061 7320 6120  null rows) as a 
+0001be20: 6e65 7720 636f 6c75 6d6e 0a20 2020 2023  new column.    #
+0001be30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001be40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001be50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001be60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001be70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001be80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001be90: 0a20 2020 2022 2222 0a20 2020 206e 6577  .    """.    new
-0001bea0: 5f63 6f6c 203d 2027 726f 775f 636f 756e  _col = 'row_coun
-0001beb0: 745f 696e 636c 5f6e 756c 6c5f 726f 7773  t_incl_null_rows
-0001bec0: 270a 2020 2020 6966 2069 7369 6e73 7461  '.    if isinsta
-0001bed0: 6e63 6528 6964 5f63 6f6c 2c20 7374 7229  nce(id_col, str)
-0001bee0: 3a0a 2020 2020 2020 2020 6772 6f75 7062  :.        groupb
-0001bef0: 795f 636f 6c75 6d6e 7320 3d20 205b 6964  y_columns =  [id
-0001bf00: 5f63 6f6c 5d0a 2020 2020 656c 7365 3a0a  _col].    else:.
-0001bf10: 2020 2020 2020 2020 6772 6f75 7062 795f          groupby_
-0001bf20: 636f 6c75 6d6e 7320 3d20 636f 7079 2e64  columns = copy.d
-0001bf30: 6565 7063 6f70 7928 6964 5f63 6f6c 290a  eepcopy(id_col).
-0001bf40: 2020 2020 2323 2320 6c65 6e20 6769 7665      ### len give
-0001bf50: 7320 796f 7520 636f 756e 7420 6f66 2061  s you count of a
-0001bf60: 6c6c 2074 6865 2072 6f77 7320 696e 636c  ll the rows incl
-0001bf70: 7564 696e 6720 6e75 6c6c 2072 6f77 7320  uding null rows 
-0001bf80: 696e 2079 6f75 7220 6461 7461 0a20 2020  in your data.   
-0001bf90: 2067 726f 7570 6564 5f6c 656e 203d 2064   grouped_len = d
-0001bfa0: 6674 2e67 726f 7570 6279 2867 726f 7570  ft.groupby(group
-0001bfb0: 6279 5f63 6f6c 756d 6e73 292e 6170 706c  by_columns).appl
-0001bfc0: 7928 6c65 6e29 0a20 2020 2067 726f 7570  y(len).    group
-0001bfd0: 6564 5f76 616c 203d 2067 726f 7570 6564  ed_val = grouped
-0001bfe0: 5f6c 656e 2e76 616c 7565 730a 2020 2020  _len.values.    
-0001bff0: 6772 6f75 7065 645f 6c65 6e20 3d20 7064  grouped_len = pd
-0001c000: 2e44 6174 6146 7261 6d65 2867 726f 7570  .DataFrame(group
-0001c010: 6564 5f76 616c 2c20 636f 6c75 6d6e 733d  ed_val, columns=
-0001c020: 5b6e 6577 5f63 6f6c 5d2c 696e 6465 783d  [new_col],index=
-0001c030: 6772 6f75 7065 645f 6c65 6e2e 696e 6465  grouped_len.inde
-0001c040: 7829 0a20 2020 2072 6574 7572 6e20 6772  x).    return gr
-0001c050: 6f75 7065 645f 6c65 6e0a 2323 2323 2323  ouped_len.######
+0001be80: 2323 2323 230a 2020 2020 2222 220a 2020  #####.    """.  
+0001be90: 2020 6e65 775f 636f 6c20 3d20 2772 6f77    new_col = 'row
+0001bea0: 5f63 6f75 6e74 5f69 6e63 6c5f 6e75 6c6c  _count_incl_null
+0001beb0: 5f72 6f77 7327 0a20 2020 2069 6620 6973  _rows'.    if is
+0001bec0: 696e 7374 616e 6365 2869 645f 636f 6c2c  instance(id_col,
+0001bed0: 2073 7472 293a 0a20 2020 2020 2020 2067   str):.        g
+0001bee0: 726f 7570 6279 5f63 6f6c 756d 6e73 203d  roupby_columns =
+0001bef0: 2020 5b69 645f 636f 6c5d 0a20 2020 2065    [id_col].    e
+0001bf00: 6c73 653a 0a20 2020 2020 2020 2067 726f  lse:.        gro
+0001bf10: 7570 6279 5f63 6f6c 756d 6e73 203d 2063  upby_columns = c
+0001bf20: 6f70 792e 6465 6570 636f 7079 2869 645f  opy.deepcopy(id_
+0001bf30: 636f 6c29 0a20 2020 2023 2323 206c 656e  col).    ### len
+0001bf40: 2067 6976 6573 2079 6f75 2063 6f75 6e74   gives you count
+0001bf50: 206f 6620 616c 6c20 7468 6520 726f 7773   of all the rows
+0001bf60: 2069 6e63 6c75 6469 6e67 206e 756c 6c20   including null 
+0001bf70: 726f 7773 2069 6e20 796f 7572 2064 6174  rows in your dat
+0001bf80: 610a 2020 2020 6772 6f75 7065 645f 6c65  a.    grouped_le
+0001bf90: 6e20 3d20 6466 742e 6772 6f75 7062 7928  n = dft.groupby(
+0001bfa0: 6772 6f75 7062 795f 636f 6c75 6d6e 7329  groupby_columns)
+0001bfb0: 2e61 7070 6c79 286c 656e 290a 2020 2020  .apply(len).    
+0001bfc0: 6772 6f75 7065 645f 7661 6c20 3d20 6772  grouped_val = gr
+0001bfd0: 6f75 7065 645f 6c65 6e2e 7661 6c75 6573  ouped_len.values
+0001bfe0: 0a20 2020 2067 726f 7570 6564 5f6c 656e  .    grouped_len
+0001bff0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+0001c000: 6772 6f75 7065 645f 7661 6c2c 2063 6f6c  grouped_val, col
+0001c010: 756d 6e73 3d5b 6e65 775f 636f 6c5d 2c69  umns=[new_col],i
+0001c020: 6e64 6578 3d67 726f 7570 6564 5f6c 656e  ndex=grouped_len
+0001c030: 2e69 6e64 6578 290a 2020 2020 7265 7475  .index).    retu
+0001c040: 726e 2067 726f 7570 6564 5f6c 656e 0a23  rn grouped_len.#
+0001c050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c0a0: 2323 2323 2323 2323 2323 230a 2320 4361  ###########.# Ca
-0001c0b0: 6e20 7765 2073 6565 2069 6620 6120 6665  n we see if a fe
-0001c0c0: 6174 7572 6520 6f72 2066 6561 7475 7265  ature or feature
-0001c0d0: 7320 6861 7320 736f 6d65 206f 7574 6c69  s has some outli
-0001c0e0: 6572 7320 616e 6420 686f 7720 6361 6e20  ers and how can 
-0001c0f0: 7765 2063 6170 2074 6865 6d3f 0a66 726f  we cap them?.fro
-0001c100: 6d20 636f 6c6c 6563 7469 6f6e 7320 696d  m collections im
-0001c110: 706f 7274 2043 6f75 6e74 6572 0a64 6566  port Counter.def
-0001c120: 2046 455f 6361 7070 696e 675f 6f75 746c   FE_capping_outl
-0001c130: 6965 7273 5f62 6579 6f6e 645f 4951 525f  iers_beyond_IQR_
-0001c140: 5261 6e67 6528 6466 2c20 6665 6174 7572  Range(df, featur
-0001c150: 6573 2c20 6361 705f 6174 5f6e 7468 5f6c  es, cap_at_nth_l
-0001c160: 6172 6765 7374 3d35 2c20 4951 525f 6d75  argest=5, IQR_mu
-0001c170: 6c74 6970 6c69 6572 3d31 2e35 2c0a 2020  ltiplier=1.5,.  
+0001c0a0: 0a23 2043 616e 2077 6520 7365 6520 6966  .# Can we see if
+0001c0b0: 2061 2066 6561 7475 7265 206f 7220 6665   a feature or fe
+0001c0c0: 6174 7572 6573 2068 6173 2073 6f6d 6520  atures has some 
+0001c0d0: 6f75 746c 6965 7273 2061 6e64 2068 6f77  outliers and how
+0001c0e0: 2063 616e 2077 6520 6361 7020 7468 656d   can we cap them
+0001c0f0: 3f0a 6672 6f6d 2063 6f6c 6c65 6374 696f  ?.from collectio
+0001c100: 6e73 2069 6d70 6f72 7420 436f 756e 7465  ns import Counte
+0001c110: 720a 6465 6620 4645 5f63 6170 7069 6e67  r.def FE_capping
+0001c120: 5f6f 7574 6c69 6572 735f 6265 796f 6e64  _outliers_beyond
+0001c130: 5f49 5152 5f52 616e 6765 2864 662c 2066  _IQR_Range(df, f
+0001c140: 6561 7475 7265 732c 2063 6170 5f61 745f  eatures, cap_at_
+0001c150: 6e74 685f 6c61 7267 6573 743d 352c 2049  nth_largest=5, I
+0001c160: 5152 5f6d 756c 7469 706c 6965 723d 312e  QR_multiplier=1.
+0001c170: 352c 0a20 2020 2020 2020 2020 2020 2020  5,.             
 0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1a0: 2020 2020 2020 2064 726f 703d 4661 6c73         drop=Fals
-0001c1b0: 652c 2076 6572 626f 7365 3d46 616c 7365  e, verbose=False
-0001c1c0: 293a 0a20 2020 2022 2222 0a20 2020 2046  ):.    """.    F
-0001c1d0: 4520 6174 2074 6865 2062 6567 696e 6e69  E at the beginni
-0001c1e0: 6e67 206f 6620 6675 6e63 7469 6f6e 206e  ng of function n
-0001c1f0: 616d 6520 7374 616e 6473 2066 6f72 2046  ame stands for F
-0001c200: 6561 7475 7265 2045 6e67 696e 6565 7269  eature Engineeri
-0001c210: 6e67 2e20 4645 2066 756e 6374 696f 6e73  ng. FE functions
-0001c220: 2061 6464 206f 7220 6472 6f70 2066 6561   add or drop fea
-0001c230: 7475 7265 732e 0a20 2020 2023 2323 2323  tures..    #####
+0001c190: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+0001c1a0: 3d46 616c 7365 2c20 7665 7262 6f73 653d  =False, verbose=
+0001c1b0: 4661 6c73 6529 3a0a 2020 2020 2222 220a  False):.    """.
+0001c1c0: 2020 2020 4645 2061 7420 7468 6520 6265      FE at the be
+0001c1d0: 6769 6e6e 696e 6720 6f66 2066 756e 6374  ginning of funct
+0001c1e0: 696f 6e20 6e61 6d65 2073 7461 6e64 7320  ion name stands 
+0001c1f0: 666f 7220 4665 6174 7572 6520 456e 6769  for Feature Engi
+0001c200: 6e65 6572 696e 672e 2046 4520 6675 6e63  neering. FE func
+0001c210: 7469 6f6e 7320 6164 6420 6f72 2064 726f  tions add or dro
+0001c220: 7020 6665 6174 7572 6573 2e0a 2020 2020  p features..    
+0001c230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c290: 2323 2323 0a20 2020 2054 7970 6963 616c  ####.    Typical
-0001c2a0: 6c79 2077 6520 7468 696e 6b20 6f66 206f  ly we think of o
-0001c2b0: 7574 6c69 6572 7320 6173 2062 6569 6e67  utliers as being
-0001c2c0: 206f 6273 6572 7661 7469 6f6e 7320 6265   observations be
-0001c2d0: 796f 6e64 2074 6865 2031 2e35 2049 6e74  yond the 1.5 Int
-0001c2e0: 6572 2051 7561 7274 696c 6520 5261 6e67  er Quartile Rang
-0001c2f0: 6520 2849 5152 290a 2020 2020 4275 7420  e (IQR).    But 
-0001c300: 7468 6973 2066 756e 6374 696f 6e20 7769  this function wi
-0001c310: 6c6c 2061 6c6c 6f77 2079 6f75 2074 6f20  ll allow you to 
-0001c320: 6361 7020 616e 7920 6f62 7365 7276 6174  cap any observat
-0001c330: 696f 6e20 7468 6174 2069 7320 6d75 6c74  ion that is mult
-0001c340: 6970 6c65 206f 6620 4951 5220 7261 6e67  iple of IQR rang
-0001c350: 652c 2073 7563 6820 6173 2031 2e35 2c20  e, such as 1.5, 
-0001c360: 322c 2065 7463 2e0a 2020 2020 496e 2061  2, etc..    In a
-0001c370: 6464 6974 696f 6e2c 2074 6869 7320 7574  ddition, this ut
-0001c380: 696c 6974 7920 6865 6c70 7320 796f 7520  ility helps you 
-0001c390: 7365 6c65 6374 2074 6865 2076 616c 7565  select the value
-0001c3a0: 2074 6f20 6361 7020 6974 2061 742e 0a20   to cap it at.. 
-0001c3b0: 2020 2054 6865 2076 616c 7565 2074 6f20     The value to 
-0001c3c0: 6265 2063 6170 7065 6420 6973 2062 6173  be capped is bas
-0001c3d0: 6564 206f 6e20 226e 2220 7468 6174 2079  ed on "n" that y
-0001c3e0: 6f75 2069 6e70 7574 2e0a 2020 2020 6e20  ou input..    n 
-0001c3f0: 7265 7072 6573 656e 7473 2074 6865 206e  represents the n
-0001c400: 7468 5f6c 6172 6765 7374 206e 756d 6265  th_largest numbe
-0001c410: 7220 6265 6c6f 7720 7468 6520 6d61 7869  r below the maxi
-0001c420: 6d75 6d20 7661 6c75 6520 746f 2063 6170  mum value to cap
-0001c430: 2061 7421 0a20 2020 204e 6f74 6963 6520   at!.    Notice 
-0001c440: 7468 6174 2069 7420 646f 6573 206e 6f74  that it does not
-0001c450: 2070 7574 2061 2066 6c6f 6f72 2075 6e64   put a floor und
-0001c460: 6572 206d 696e 696d 756d 732e 2059 6f75  er minimums. You
-0001c470: 2068 6176 6520 746f 2064 6f20 7468 6174   have to do that
-0001c480: 2079 6f75 7273 656c 662e 0a20 2020 2022   yourself..    "
-0001c490: 6361 705f 6174 5f6e 7468 5f6c 6172 6765  cap_at_nth_large
-0001c4a0: 7374 2220 7370 6563 6966 6965 7320 7468  st" specifies th
-0001c4b0: 6520 6d61 7820 6e75 6d62 6572 2062 656c  e max number bel
-0001c4c0: 6f77 2074 6865 206c 6172 6765 7374 2028  ow the largest (
-0001c4d0: 6d61 7829 206e 756d 6265 7220 696e 2079  max) number in y
-0001c4e0: 6f75 7220 636f 6c75 6d6e 2074 6f20 6361  our column to ca
-0001c4f0: 7020 7468 6174 2066 6561 7475 7265 2e0a  p that feature..
-0001c500: 2020 2020 4f70 7469 6f6e 616c 6c79 2c20      Optionally, 
-0001c510: 796f 7520 6361 6e20 6472 6f70 2063 6572  you can drop cer
-0001c520: 7461 696e 206f 6273 6572 7661 7469 6f6e  tain observation
-0001c530: 7320 7468 6174 2068 6176 6520 746f 6f20  s that have too 
-0001c540: 6d61 6e79 206f 7574 6c69 6572 7320 696e  many outliers in
-0001c550: 2061 7420 6c65 6173 7420 3320 636f 6c75   at least 3 colu
-0001c560: 6d6e 732e 0a20 2020 2023 2323 2323 2323  mns..    #######
+0001c280: 2323 2323 2323 2323 230a 2020 2020 5479  #########.    Ty
+0001c290: 7069 6361 6c6c 7920 7765 2074 6869 6e6b  pically we think
+0001c2a0: 206f 6620 6f75 746c 6965 7273 2061 7320   of outliers as 
+0001c2b0: 6265 696e 6720 6f62 7365 7276 6174 696f  being observatio
+0001c2c0: 6e73 2062 6579 6f6e 6420 7468 6520 312e  ns beyond the 1.
+0001c2d0: 3520 496e 7465 7220 5175 6172 7469 6c65  5 Inter Quartile
+0001c2e0: 2052 616e 6765 2028 4951 5229 0a20 2020   Range (IQR).   
+0001c2f0: 2042 7574 2074 6869 7320 6675 6e63 7469   But this functi
+0001c300: 6f6e 2077 696c 6c20 616c 6c6f 7720 796f  on will allow yo
+0001c310: 7520 746f 2063 6170 2061 6e79 206f 6273  u to cap any obs
+0001c320: 6572 7661 7469 6f6e 2074 6861 7420 6973  ervation that is
+0001c330: 206d 756c 7469 706c 6520 6f66 2049 5152   multiple of IQR
+0001c340: 2072 616e 6765 2c20 7375 6368 2061 7320   range, such as 
+0001c350: 312e 352c 2032 2c20 6574 632e 0a20 2020  1.5, 2, etc..   
+0001c360: 2049 6e20 6164 6469 7469 6f6e 2c20 7468   In addition, th
+0001c370: 6973 2075 7469 6c69 7479 2068 656c 7073  is utility helps
+0001c380: 2079 6f75 2073 656c 6563 7420 7468 6520   you select the 
+0001c390: 7661 6c75 6520 746f 2063 6170 2069 7420  value to cap it 
+0001c3a0: 6174 2e0a 2020 2020 5468 6520 7661 6c75  at..    The valu
+0001c3b0: 6520 746f 2062 6520 6361 7070 6564 2069  e to be capped i
+0001c3c0: 7320 6261 7365 6420 6f6e 2022 6e22 2074  s based on "n" t
+0001c3d0: 6861 7420 796f 7520 696e 7075 742e 0a20  hat you input.. 
+0001c3e0: 2020 206e 2072 6570 7265 7365 6e74 7320     n represents 
+0001c3f0: 7468 6520 6e74 685f 6c61 7267 6573 7420  the nth_largest 
+0001c400: 6e75 6d62 6572 2062 656c 6f77 2074 6865  number below the
+0001c410: 206d 6178 696d 756d 2076 616c 7565 2074   maximum value t
+0001c420: 6f20 6361 7020 6174 210a 2020 2020 4e6f  o cap at!.    No
+0001c430: 7469 6365 2074 6861 7420 6974 2064 6f65  tice that it doe
+0001c440: 7320 6e6f 7420 7075 7420 6120 666c 6f6f  s not put a floo
+0001c450: 7220 756e 6465 7220 6d69 6e69 6d75 6d73  r under minimums
+0001c460: 2e20 596f 7520 6861 7665 2074 6f20 646f  . You have to do
+0001c470: 2074 6861 7420 796f 7572 7365 6c66 2e0a   that yourself..
+0001c480: 2020 2020 2263 6170 5f61 745f 6e74 685f      "cap_at_nth_
+0001c490: 6c61 7267 6573 7422 2073 7065 6369 6669  largest" specifi
+0001c4a0: 6573 2074 6865 206d 6178 206e 756d 6265  es the max numbe
+0001c4b0: 7220 6265 6c6f 7720 7468 6520 6c61 7267  r below the larg
+0001c4c0: 6573 7420 286d 6178 2920 6e75 6d62 6572  est (max) number
+0001c4d0: 2069 6e20 796f 7572 2063 6f6c 756d 6e20   in your column 
+0001c4e0: 746f 2063 6170 2074 6861 7420 6665 6174  to cap that feat
+0001c4f0: 7572 652e 0a20 2020 204f 7074 696f 6e61  ure..    Optiona
+0001c500: 6c6c 792c 2079 6f75 2063 616e 2064 726f  lly, you can dro
+0001c510: 7020 6365 7274 6169 6e20 6f62 7365 7276  p certain observ
+0001c520: 6174 696f 6e73 2074 6861 7420 6861 7665  ations that have
+0001c530: 2074 6f6f 206d 616e 7920 6f75 746c 6965   too many outlie
+0001c540: 7273 2069 6e20 6174 206c 6561 7374 2033  rs in at least 3
+0001c550: 2063 6f6c 756d 6e73 2e0a 2020 2020 2323   columns..    ##
+0001c560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c5c0: 2323 0a20 2020 2049 6e70 7574 733a 0a20  ##.    Inputs:. 
-0001c5d0: 2020 2064 6620 3a20 7061 6e64 6173 2044     df : pandas D
-0001c5e0: 6174 6146 7261 6d65 0a20 2020 2066 6561  ataFrame.    fea
-0001c5f0: 7475 7265 733a 2061 2073 696e 676c 6520  tures: a single 
-0001c600: 636f 6c75 6d6e 206f 7220 6120 6c69 7374  column or a list
-0001c610: 206f 6620 636f 6c75 6d6e 7320 696e 2079   of columns in y
-0001c620: 6f75 7220 4461 7461 4672 616d 650a 2020  our DataFrame.  
-0001c630: 2020 6361 705f 6174 5f6e 7468 5f6c 6172    cap_at_nth_lar
-0001c640: 6765 7374 3a20 6465 6661 756c 7420 6973  gest: default is
-0001c650: 2035 203d 2079 6f75 2063 616e 2073 6574   5 = you can set
-0001c660: 2069 7420 746f 2061 6e79 2069 6e74 6567   it to any integ
-0001c670: 6572 2073 7563 6820 6173 2031 2c20 322c  er such as 1, 2,
-0001c680: 2033 2c20 342c 2035 2c20 6574 632e 0a20   3, 4, 5, etc.. 
-0001c690: 2020 2049 5152 5f6d 756c 7469 706c 6965     IQR_multiplie
-0001c6a0: 723a 2064 6566 6175 6c74 2069 7320 312e  r: default is 1.
-0001c6b0: 3520 3d20 6275 7420 796f 7520 6361 6e20  5 = but you can 
-0001c6c0: 7365 7420 6974 2074 6f20 616e 7920 666c  set it to any fl
-0001c6d0: 6f61 7420 7661 6c75 6520 7375 6368 2061  oat value such a
-0001c6e0: 7320 312c 2031 2e32 352e 2031 2e35 2c20  s 1, 1.25. 1.5, 
-0001c6f0: 322e 302c 2065 7463 2e0a 0a20 2020 204f  2.0, etc...    O
-0001c700: 7574 7075 7473 3a0a 2020 2020 6466 3a20  utputs:.    df: 
-0001c710: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
-0001c720: 0a20 2020 2049 7420 7265 7475 726e 7320  .    It returns 
-0001c730: 7468 6520 7361 6d65 2064 6174 6166 7261  the same datafra
-0001c740: 6d65 2061 7320 796f 7520 696e 7075 7420  me as you input 
-0001c750: 756e 6c65 7373 2079 6f75 2063 6861 6e67  unless you chang
-0001c760: 6520 6472 6f70 2074 6f20 5472 7565 2069  e drop to True i
-0001c770: 6e20 7468 6520 696e 7075 7420 6172 6775  n the input argu
-0001c780: 6d65 6e74 2e0a 0a20 2020 204f 7074 696f  ment...    Optio
-0001c790: 6e61 6c6c 792c 2069 7420 6361 6e20 6472  nally, it can dr
-0001c7a0: 6f70 2063 6572 7461 696e 2072 6f77 7320  op certain rows 
-0001c7b0: 7468 6174 2068 6176 6520 746f 6f20 6d61  that have too ma
-0001c7c0: 6e79 206f 7574 6c69 6572 7320 696e 2061  ny outliers in a
-0001c7d0: 7420 6c65 6173 7420 3320 636f 6c75 6d6e  t least 3 column
-0001c7e0: 7320 7369 6d75 6c74 616e 656f 7573 6c79  s simultaneously
-0001c7f0: 2e0a 2020 2020 4966 2064 726f 703d 5472  ..    If drop=Tr
-0001c800: 7565 2c20 6974 2077 696c 6c20 7265 7475  ue, it will retu
-0001c810: 726e 2061 2073 6d61 6c6c 6572 206e 756d  rn a smaller num
-0001c820: 6265 7220 6f66 2072 6f77 7320 696e 2079  ber of rows in y
-0001c830: 6f75 7220 6461 7461 6672 616d 6520 7468  our dataframe th
-0001c840: 616e 2077 6861 7420 796f 7520 7365 6e74  an what you sent
-0001c850: 2069 6e2e 2042 6520 6361 7265 6675 6c21   in. Be careful!
-0001c860: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
+0001c5b0: 2323 2323 2323 230a 2020 2020 496e 7075  #######.    Inpu
+0001c5c0: 7473 3a0a 2020 2020 6466 203a 2070 616e  ts:.    df : pan
+0001c5d0: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
+0001c5e0: 2020 6665 6174 7572 6573 3a20 6120 7369    features: a si
+0001c5f0: 6e67 6c65 2063 6f6c 756d 6e20 6f72 2061  ngle column or a
+0001c600: 206c 6973 7420 6f66 2063 6f6c 756d 6e73   list of columns
+0001c610: 2069 6e20 796f 7572 2044 6174 6146 7261   in your DataFra
+0001c620: 6d65 0a20 2020 2063 6170 5f61 745f 6e74  me.    cap_at_nt
+0001c630: 685f 6c61 7267 6573 743a 2064 6566 6175  h_largest: defau
+0001c640: 6c74 2069 7320 3520 3d20 796f 7520 6361  lt is 5 = you ca
+0001c650: 6e20 7365 7420 6974 2074 6f20 616e 7920  n set it to any 
+0001c660: 696e 7465 6765 7220 7375 6368 2061 7320  integer such as 
+0001c670: 312c 2032 2c20 332c 2034 2c20 352c 2065  1, 2, 3, 4, 5, e
+0001c680: 7463 2e0a 2020 2020 4951 525f 6d75 6c74  tc..    IQR_mult
+0001c690: 6970 6c69 6572 3a20 6465 6661 756c 7420  iplier: default 
+0001c6a0: 6973 2031 2e35 203d 2062 7574 2079 6f75  is 1.5 = but you
+0001c6b0: 2063 616e 2073 6574 2069 7420 746f 2061   can set it to a
+0001c6c0: 6e79 2066 6c6f 6174 2076 616c 7565 2073  ny float value s
+0001c6d0: 7563 6820 6173 2031 2c20 312e 3235 2e20  uch as 1, 1.25. 
+0001c6e0: 312e 352c 2032 2e30 2c20 6574 632e 0a0a  1.5, 2.0, etc...
+0001c6f0: 2020 2020 4f75 7470 7574 733a 0a20 2020      Outputs:.   
+0001c700: 2064 663a 2070 616e 6461 7320 4461 7461   df: pandas Data
+0001c710: 4672 616d 650a 2020 2020 4974 2072 6574  Frame.    It ret
+0001c720: 7572 6e73 2074 6865 2073 616d 6520 6461  urns the same da
+0001c730: 7461 6672 616d 6520 6173 2079 6f75 2069  taframe as you i
+0001c740: 6e70 7574 2075 6e6c 6573 7320 796f 7520  nput unless you 
+0001c750: 6368 616e 6765 2064 726f 7020 746f 2054  change drop to T
+0001c760: 7275 6520 696e 2074 6865 2069 6e70 7574  rue in the input
+0001c770: 2061 7267 756d 656e 742e 0a0a 2020 2020   argument...    
+0001c780: 4f70 7469 6f6e 616c 6c79 2c20 6974 2063  Optionally, it c
+0001c790: 616e 2064 726f 7020 6365 7274 6169 6e20  an drop certain 
+0001c7a0: 726f 7773 2074 6861 7420 6861 7665 2074  rows that have t
+0001c7b0: 6f6f 206d 616e 7920 6f75 746c 6965 7273  oo many outliers
+0001c7c0: 2069 6e20 6174 206c 6561 7374 2033 2063   in at least 3 c
+0001c7d0: 6f6c 756d 6e73 2073 696d 756c 7461 6e65  olumns simultane
+0001c7e0: 6f75 736c 792e 0a20 2020 2049 6620 6472  ously..    If dr
+0001c7f0: 6f70 3d54 7275 652c 2069 7420 7769 6c6c  op=True, it will
+0001c800: 2072 6574 7572 6e20 6120 736d 616c 6c65   return a smalle
+0001c810: 7220 6e75 6d62 6572 206f 6620 726f 7773  r number of rows
+0001c820: 2069 6e20 796f 7572 2064 6174 6166 7261   in your datafra
+0001c830: 6d65 2074 6861 6e20 7768 6174 2079 6f75  me than what you
+0001c840: 2073 656e 7420 696e 2e20 4265 2063 6172   sent in. Be car
+0001c850: 6566 756c 210a 2020 2020 2323 2323 2323  eful!.    ######
+0001c860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001c8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001c8b0: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0001c8c0: 2020 2022 2222 0a20 2020 206f 7574 6c69     """.    outli
-0001c8d0: 6572 5f69 6e64 6963 6573 203d 205b 5d0a  er_indices = [].
-0001c8e0: 2020 2020 6466 203d 2064 662e 636f 7079      df = df.copy
-0001c8f0: 2864 6565 703d 5472 7565 290a 2020 2020  (deep=True).    
-0001c900: 6966 2069 7369 6e73 7461 6e63 6528 6665  if isinstance(fe
-0001c910: 6174 7572 6573 2c20 7374 7229 3a0a 2020  atures, str):.  
-0001c920: 2020 2020 2020 6665 6174 7572 6573 203d        features =
-0001c930: 205b 6665 6174 7572 6573 5d0a 2020 2020   [features].    
-0001c940: 2320 6974 6572 6174 6520 6f76 6572 2066  # iterate over f
-0001c950: 6561 7475 7265 7328 636f 6c75 6d6e 7329  eatures(columns)
-0001c960: 0a20 2020 2066 6f72 2063 6f6c 2069 6e20  .    for col in 
-0001c970: 6665 6174 7572 6573 3a0a 2020 2020 2020  features:.      
-0001c980: 2020 2323 2320 7468 6973 2069 7320 686f    ### this is ho
-0001c990: 7720 7468 6520 636f 6c75 6d6e 206c 6f6f  w the column loo
-0001c9a0: 6b73 206e 6f77 2062 6566 6f72 6520 6361  ks now before ca
-0001c9b0: 7070 696e 6720 6f75 746c 6965 7273 0a20  pping outliers. 
-0001c9c0: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-0001c9d0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-0001c9e0: 6967 2c20 2861 7831 2c61 7832 2920 3d20  ig, (ax1,ax2) = 
-0001c9f0: 706c 742e 7375 6270 6c6f 7473 2831 2c32  plt.subplots(1,2
-0001ca00: 2c66 6967 7369 7a65 3d28 3132 2c35 2929  ,figsize=(12,5))
-0001ca10: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
-0001ca20: 636f 6c5d 2e70 6c6f 7428 6b69 6e64 3d27  col].plot(kind='
-0001ca30: 626f 7827 2c20 7469 746c 6520 3d20 2725  box', title = '%
-0001ca40: 7320 6265 666f 7265 2063 6170 7069 6e67  s before capping
-0001ca50: 206f 7574 6c69 6572 7327 2025 636f 6c2c   outliers' %col,
-0001ca60: 2061 783d 6178 3129 0a20 2020 2020 2020   ax=ax1).       
-0001ca70: 2023 2031 7374 2071 7561 7274 696c 6520   # 1st quartile 
-0001ca80: 2832 3525 290a 2020 2020 2020 2020 5131  (25%).        Q1
-0001ca90: 203d 206e 702e 7065 7263 656e 7469 6c65   = np.percentile
-0001caa0: 2864 665b 636f 6c5d 2c20 3235 290a 2020  (df[col], 25).  
-0001cab0: 2020 2020 2020 2320 3372 6420 7175 6172        # 3rd quar
-0001cac0: 7469 6c65 2028 3735 2529 0a20 2020 2020  tile (75%).     
-0001cad0: 2020 2051 3320 3d20 6e70 2e70 6572 6365     Q3 = np.perce
-0001cae0: 6e74 696c 6528 6466 5b63 6f6c 5d2c 3735  ntile(df[col],75
-0001caf0: 290a 2020 2020 2020 2020 2320 496e 7465  ).        # Inte
-0001cb00: 7271 7561 7274 696c 6520 7261 6e67 6520  rquartile range 
-0001cb10: 2849 5152 290a 2020 2020 2020 2020 4951  (IQR).        IQ
-0001cb20: 5220 3d20 5133 202d 2051 310a 0a20 2020  R = Q3 - Q1..   
-0001cb30: 2020 2020 2023 206f 7574 6c69 6572 2073       # outlier s
-0001cb40: 7465 7020 7573 696e 6720 6d75 6c74 6970  tep using multip
-0001cb50: 6c69 6572 0a20 2020 2020 2020 206f 7574  lier.        out
-0001cb60: 6c69 6572 5f73 7465 7020 3d20 4951 525f  lier_step = IQR_
-0001cb70: 6d75 6c74 6970 6c69 6572 202a 2049 5152  multiplier * IQR
-0001cb80: 0a0a 2020 2020 2020 2020 6c6f 7765 725f  ..        lower_
-0001cb90: 6c69 6d69 7420 3d20 5131 202d 206f 7574  limit = Q1 - out
-0001cba0: 6c69 6572 5f73 7465 700a 2020 2020 2020  lier_step.      
-0001cbb0: 2020 7570 7065 725f 6c69 6d69 7420 3d20    upper_limit = 
-0001cbc0: 5133 202b 206f 7574 6c69 6572 5f73 7465  Q3 + outlier_ste
-0001cbd0: 700a 0a20 2020 2020 2020 2023 2044 6574  p..        # Det
-0001cbe0: 6572 6d69 6e65 2061 206c 6973 7420 6f66  ermine a list of
-0001cbf0: 2069 6e64 6963 6573 206f 6620 6f75 746c   indices of outl
-0001cc00: 6965 7273 2066 6f72 2066 6561 7475 7265  iers for feature
-0001cc10: 2063 6f6c 0a20 2020 2020 2020 206f 7574   col.        out
-0001cc20: 6c69 6572 5f6c 6973 745f 636f 6c20 3d20  lier_list_col = 
-0001cc30: 6466 5b28 6466 5b63 6f6c 5d20 3c20 6c6f  df[(df[col] < lo
-0001cc40: 7765 725f 6c69 6d69 7429 207c 2028 6466  wer_limit) | (df
-0001cc50: 5b63 6f6c 5d20 3e20 7570 7065 725f 6c69  [col] > upper_li
-0001cc60: 6d69 7420 295d 2e69 6e64 6578 0a0a 2020  mit )].index..  
-0001cc70: 2020 2020 2020 2323 2320 4361 7070 696e        ### Cappin
-0001cc80: 6720 7573 696e 6720 7468 6520 6e20 6c61  g using the n la
-0001cc90: 7267 6573 7420 7661 6c75 6520 6261 7365  rgest value base
-0001cca0: 6420 6f6e 206e 2067 6976 656e 2069 6e20  d on n given in 
-0001ccb0: 696e 7075 742e 0a20 2020 2020 2020 206d  input..        m
-0001ccc0: 6178 7661 6c20 3d20 6466 5b63 6f6c 5d2e  axval = df[col].
-0001ccd0: 6d61 7828 2920 2023 2320 7768 6174 2069  max()  ## what i
-0001cce0: 7320 7468 6520 6d61 7869 6d75 6d20 7661  s the maximum va
-0001ccf0: 6c75 6520 696e 2074 6869 7320 636f 6c75  lue in this colu
-0001cd00: 6d6e 3f0a 2020 2020 2020 2020 6e75 6d5f  mn?.        num_
-0001cd10: 6d61 7873 203d 2064 665b 6466 5b63 6f6c  maxs = df[df[col
-0001cd20: 5d3d 3d6d 6178 7661 6c5d 2e73 6861 7065  ]==maxval].shape
-0001cd30: 5b30 5d20 2323 206e 756d 6265 7220 6f66  [0] ## number of
-0001cd40: 2072 6f77 7320 7468 6174 2068 6176 6520   rows that have 
-0001cd50: 6d61 7820 7661 6c75 650a 2020 2020 2020  max value.      
-0001cd60: 2020 2323 2320 6669 6e64 2074 6865 206e    ### find the n
-0001cd70: 5f6c 6172 6765 7374 2076 616c 7565 7320  _largest values 
-0001cd80: 6166 7465 7220 7468 6520 6d61 7869 6d75  after the maximu
-0001cd90: 6d20 7661 6c75 6520 6261 7365 6420 6f6e  m value based on
-0001cda0: 2067 6976 656e 2069 6e70 7574 206e 0a20   given input n. 
-0001cdb0: 2020 2020 2020 206e 756d 5f6c 6172 6765         num_large
-0001cdc0: 7374 5f61 6674 6572 5f6d 6178 203d 206e  st_after_max = n
-0001cdd0: 756d 5f6d 6178 7320 2b20 6361 705f 6174  um_maxs + cap_at
-0001cde0: 5f6e 7468 5f6c 6172 6765 7374 0a20 2020  _nth_largest.   
-0001cdf0: 2020 2020 2063 6170 7065 645f 7661 6c75       capped_valu
-0001ce00: 6520 3d20 6466 5b63 6f6c 5d2e 6e6c 6172  e = df[col].nlar
-0001ce10: 6765 7374 286e 756d 5f6c 6172 6765 7374  gest(num_largest
-0001ce20: 5f61 6674 6572 5f6d 6178 292e 696c 6f63  _after_max).iloc
-0001ce30: 5b2d 315d 2023 2320 7468 6973 2069 7320  [-1] ## this is 
-0001ce40: 7468 6520 7661 6c75 6520 7765 2063 6170  the value we cap
-0001ce50: 2069 7420 6167 6169 6e73 740a 2020 2020   it against.    
-0001ce60: 2020 2020 6466 2e6c 6f63 5b64 665b 636f      df.loc[df[co
-0001ce70: 6c5d 3d3d 6d61 7876 616c 2c20 636f 6c5d  l]==maxval, col]
-0001ce80: 203d 2020 6361 7070 6564 5f76 616c 7565   =  capped_value
-0001ce90: 2023 2320 6d61 7869 6d75 6d20 7661 6c75   ## maximum valu
-0001cea0: 6573 2061 7265 206e 6f77 2063 6170 7065  es are now cappe
-0001ceb0: 640a 2020 2020 2020 2020 2323 2320 796f  d.        ### yo
-0001cec0: 7520 6172 6520 6e6f 7720 676f 6f64 2074  u are now good t
-0001ced0: 6f20 676f 202d 2079 6f75 2063 616e 2073  o go - you can s
-0001cee0: 686f 7720 686f 7720 7468 6579 2061 7265  how how they are
-0001cef0: 2063 6170 7065 6420 7573 696e 6720 6265   capped using be
-0001cf00: 666f 7265 2061 6e64 2061 6674 6572 2070  fore and after p
-0001cf10: 6963 730a 2020 2020 2020 2020 6966 2076  ics.        if v
-0001cf20: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-0001cf30: 2020 2020 6466 5b63 6f6c 5d2e 706c 6f74      df[col].plot
-0001cf40: 286b 696e 643d 2762 6f78 272c 2074 6974  (kind='box', tit
-0001cf50: 6c65 203d 2027 2573 2061 6674 6572 2063  le = '%s after c
-0001cf60: 6170 7069 6e67 206f 7574 6c69 6572 7327  apping outliers'
-0001cf70: 2025 636f 6c2c 2061 783d 6178 3229 0a20   %col, ax=ax2). 
-0001cf80: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
-0001cf90: 686f 7728 290a 0a20 2020 2020 2020 2023  how()..        #
-0001cfa0: 204c 6574 2773 2073 6176 6520 7468 6520   Let's save the 
-0001cfb0: 6c69 7374 206f 6620 6f75 746c 6965 7273  list of outliers
-0001cfc0: 2061 6e64 2073 6565 2069 6620 7468 6572   and see if ther
-0001cfd0: 6520 6172 6520 736f 6d65 2077 6974 6820  e are some with 
-0001cfe0: 6f75 746c 6965 7273 2069 6e20 6d75 6c74  outliers in mult
-0001cff0: 6970 6c65 2063 6f6c 756d 6e73 0a20 2020  iple columns.   
-0001d000: 2020 2020 206f 7574 6c69 6572 5f69 6e64       outlier_ind
-0001d010: 6963 6573 2e65 7874 656e 6428 6f75 746c  ices.extend(outl
-0001d020: 6965 725f 6c69 7374 5f63 6f6c 290a 0a20  ier_list_col).. 
-0001d030: 2020 2023 2073 656c 6563 7420 6365 7274     # select cert
-0001d040: 6169 6e20 6f62 7365 7276 6174 696f 6e73  ain observations
-0001d050: 2063 6f6e 7461 696e 696e 6720 6d6f 7265   containing more
-0001d060: 2074 6861 6e20 6f6e 6520 6f75 746c 6965   than one outlie
-0001d070: 7220 696e 2032 2063 6f6c 756d 6e73 206f  r in 2 columns o
-0001d080: 7220 6d6f 7265 2e20 5765 2063 616e 2064  r more. We can d
-0001d090: 726f 7020 7468 656d 210a 2020 2020 6f75  rop them!.    ou
-0001d0a0: 746c 6965 725f 696e 6469 6365 7320 3d20  tlier_indices = 
-0001d0b0: 436f 756e 7465 7228 6f75 746c 6965 725f  Counter(outlier_
-0001d0c0: 696e 6469 6365 7329 0a20 2020 206d 756c  indices).    mul
-0001d0d0: 7469 706c 655f 6f75 746c 6965 7273 203d  tiple_outliers =
-0001d0e0: 206c 6973 7428 206b 2066 6f72 206b 2c20   list( k for k, 
-0001d0f0: 7620 696e 206f 7574 6c69 6572 5f69 6e64  v in outlier_ind
-0001d100: 6963 6573 2e69 7465 6d73 2829 2069 6620  ices.items() if 
-0001d110: 7620 3e20 3320 290a 2020 2020 2323 2320  v > 3 ).    ### 
-0001d120: 6e6f 7720 6472 6f70 2074 6865 7365 2072  now drop these r
-0001d130: 6f77 7320 616c 746f 6765 7468 6572 2023  ows altogether #
-0001d140: 2323 230a 2020 2020 6966 2064 726f 703a  ###.    if drop:
-0001d150: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-0001d160: 5368 6170 6520 6f66 2064 6174 6166 7261  Shape of datafra
-0001d170: 6d65 2062 6566 6f72 6520 6f75 746c 6965  me before outlie
-0001d180: 7273 2062 6569 6e67 2064 726f 7070 6564  rs being dropped
-0001d190: 3a20 2573 2720 2528 6466 2e73 6861 7065  : %s' %(df.shape
-0001d1a0: 2c29 290a 2020 2020 2020 2020 6e75 6d62  ,)).        numb
-0001d1b0: 6572 5f6f 665f 726f 7773 203d 2064 662e  er_of_rows = df.
-0001d1c0: 7368 6170 655b 305d 0a20 2020 2020 2020  shape[0].       
-0001d1d0: 2064 6620 3d20 6466 2e64 726f 7028 6d75   df = df.drop(mu
-0001d1e0: 6c74 6970 6c65 5f6f 7574 6c69 6572 732c  ltiple_outliers,
-0001d1f0: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
-0001d200: 2070 7269 6e74 2827 5368 6170 6520 6f66   print('Shape of
-0001d210: 2064 6174 6166 7261 6d65 2061 6674 6572   dataframe after
-0001d220: 206f 7574 6c69 6572 7320 6265 696e 6720   outliers being 
-0001d230: 6472 6f70 7065 643a 2025 7327 2025 2864  dropped: %s' %(d
-0001d240: 662e 7368 6170 652c 2929 0a20 2020 2020  f.shape,)).     
-0001d250: 2020 2070 7269 6e74 2827 5c6e 4e75 6d62     print('\nNumb
-0001d260: 6572 5f6f 665f 726f 7773 2077 6974 6820  er_of_rows with 
-0001d270: 6d75 6c74 6970 6c65 206f 7574 6c69 6572  multiple outlier
-0001d280: 7320 696e 206d 6f72 6520 7468 616e 2033  s in more than 3
-0001d290: 2063 6f6c 756d 6e73 2077 6869 6368 2077   columns which w
-0001d2a0: 6572 6520 6472 6f70 7065 6420 3d20 2564  ere dropped = %d
-0001d2b0: 2720 2528 6e75 6d62 6572 5f6f 665f 726f  ' %(number_of_ro
-0001d2c0: 7773 2d64 662e 7368 6170 655b 305d 2929  ws-df.shape[0]))
-0001d2d0: 0a20 2020 2072 6574 7572 6e20 6466 0a23  .    return df.#
+0001c8b0: 2323 230a 2020 2020 2222 220a 2020 2020  ###.    """.    
+0001c8c0: 6f75 746c 6965 725f 696e 6469 6365 7320  outlier_indices 
+0001c8d0: 3d20 5b5d 0a20 2020 2064 6620 3d20 6466  = [].    df = df
+0001c8e0: 2e63 6f70 7928 6465 6570 3d54 7275 6529  .copy(deep=True)
+0001c8f0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+0001c900: 6365 2866 6561 7475 7265 732c 2073 7472  ce(features, str
+0001c910: 293a 0a20 2020 2020 2020 2066 6561 7475  ):.        featu
+0001c920: 7265 7320 3d20 5b66 6561 7475 7265 735d  res = [features]
+0001c930: 0a20 2020 2023 2069 7465 7261 7465 206f  .    # iterate o
+0001c940: 7665 7220 6665 6174 7572 6573 2863 6f6c  ver features(col
+0001c950: 756d 6e73 290a 2020 2020 666f 7220 636f  umns).    for co
+0001c960: 6c20 696e 2066 6561 7475 7265 733a 0a20  l in features:. 
+0001c970: 2020 2020 2020 2023 2323 2074 6869 7320         ### this 
+0001c980: 6973 2068 6f77 2074 6865 2063 6f6c 756d  is how the colum
+0001c990: 6e20 6c6f 6f6b 7320 6e6f 7720 6265 666f  n looks now befo
+0001c9a0: 7265 2063 6170 7069 6e67 206f 7574 6c69  re capping outli
+0001c9b0: 6572 730a 2020 2020 2020 2020 6966 2076  ers.        if v
+0001c9c0: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0001c9d0: 2020 2020 6669 672c 2028 6178 312c 6178      fig, (ax1,ax
+0001c9e0: 3229 203d 2070 6c74 2e73 7562 706c 6f74  2) = plt.subplot
+0001c9f0: 7328 312c 322c 6669 6773 697a 653d 2831  s(1,2,figsize=(1
+0001ca00: 322c 3529 290a 2020 2020 2020 2020 2020  2,5)).          
+0001ca10: 2020 6466 5b63 6f6c 5d2e 706c 6f74 286b    df[col].plot(k
+0001ca20: 696e 643d 2762 6f78 272c 2074 6974 6c65  ind='box', title
+0001ca30: 203d 2027 2573 2062 6566 6f72 6520 6361   = '%s before ca
+0001ca40: 7070 696e 6720 6f75 746c 6965 7273 2720  pping outliers' 
+0001ca50: 2563 6f6c 2c20 6178 3d61 7831 290a 2020  %col, ax=ax1).  
+0001ca60: 2020 2020 2020 2320 3173 7420 7175 6172        # 1st quar
+0001ca70: 7469 6c65 2028 3235 2529 0a20 2020 2020  tile (25%).     
+0001ca80: 2020 2051 3120 3d20 6e70 2e70 6572 6365     Q1 = np.perce
+0001ca90: 6e74 696c 6528 6466 5b63 6f6c 5d2c 2032  ntile(df[col], 2
+0001caa0: 3529 0a20 2020 2020 2020 2023 2033 7264  5).        # 3rd
+0001cab0: 2071 7561 7274 696c 6520 2837 3525 290a   quartile (75%).
+0001cac0: 2020 2020 2020 2020 5133 203d 206e 702e          Q3 = np.
+0001cad0: 7065 7263 656e 7469 6c65 2864 665b 636f  percentile(df[co
+0001cae0: 6c5d 2c37 3529 0a20 2020 2020 2020 2023  l],75).        #
+0001caf0: 2049 6e74 6572 7175 6172 7469 6c65 2072   Interquartile r
+0001cb00: 616e 6765 2028 4951 5229 0a20 2020 2020  ange (IQR).     
+0001cb10: 2020 2049 5152 203d 2051 3320 2d20 5131     IQR = Q3 - Q1
+0001cb20: 0a0a 2020 2020 2020 2020 2320 6f75 746c  ..        # outl
+0001cb30: 6965 7220 7374 6570 2075 7369 6e67 206d  ier step using m
+0001cb40: 756c 7469 706c 6965 720a 2020 2020 2020  ultiplier.      
+0001cb50: 2020 6f75 746c 6965 725f 7374 6570 203d    outlier_step =
+0001cb60: 2049 5152 5f6d 756c 7469 706c 6965 7220   IQR_multiplier 
+0001cb70: 2a20 4951 520a 0a20 2020 2020 2020 206c  * IQR..        l
+0001cb80: 6f77 6572 5f6c 696d 6974 203d 2051 3120  ower_limit = Q1 
+0001cb90: 2d20 6f75 746c 6965 725f 7374 6570 0a20  - outlier_step. 
+0001cba0: 2020 2020 2020 2075 7070 6572 5f6c 696d         upper_lim
+0001cbb0: 6974 203d 2051 3320 2b20 6f75 746c 6965  it = Q3 + outlie
+0001cbc0: 725f 7374 6570 0a0a 2020 2020 2020 2020  r_step..        
+0001cbd0: 2320 4465 7465 726d 696e 6520 6120 6c69  # Determine a li
+0001cbe0: 7374 206f 6620 696e 6469 6365 7320 6f66  st of indices of
+0001cbf0: 206f 7574 6c69 6572 7320 666f 7220 6665   outliers for fe
+0001cc00: 6174 7572 6520 636f 6c0a 2020 2020 2020  ature col.      
+0001cc10: 2020 6f75 746c 6965 725f 6c69 7374 5f63    outlier_list_c
+0001cc20: 6f6c 203d 2064 665b 2864 665b 636f 6c5d  ol = df[(df[col]
+0001cc30: 203c 206c 6f77 6572 5f6c 696d 6974 2920   < lower_limit) 
+0001cc40: 7c20 2864 665b 636f 6c5d 203e 2075 7070  | (df[col] > upp
+0001cc50: 6572 5f6c 696d 6974 2029 5d2e 696e 6465  er_limit )].inde
+0001cc60: 780a 0a20 2020 2020 2020 2023 2323 2043  x..        ### C
+0001cc70: 6170 7069 6e67 2075 7369 6e67 2074 6865  apping using the
+0001cc80: 206e 206c 6172 6765 7374 2076 616c 7565   n largest value
+0001cc90: 2062 6173 6564 206f 6e20 6e20 6769 7665   based on n give
+0001cca0: 6e20 696e 2069 6e70 7574 2e0a 2020 2020  n in input..    
+0001ccb0: 2020 2020 6d61 7876 616c 203d 2064 665b      maxval = df[
+0001ccc0: 636f 6c5d 2e6d 6178 2829 2020 2323 2077  col].max()  ## w
+0001ccd0: 6861 7420 6973 2074 6865 206d 6178 696d  hat is the maxim
+0001cce0: 756d 2076 616c 7565 2069 6e20 7468 6973  um value in this
+0001ccf0: 2063 6f6c 756d 6e3f 0a20 2020 2020 2020   column?.       
+0001cd00: 206e 756d 5f6d 6178 7320 3d20 6466 5b64   num_maxs = df[d
+0001cd10: 665b 636f 6c5d 3d3d 6d61 7876 616c 5d2e  f[col]==maxval].
+0001cd20: 7368 6170 655b 305d 2023 2320 6e75 6d62  shape[0] ## numb
+0001cd30: 6572 206f 6620 726f 7773 2074 6861 7420  er of rows that 
+0001cd40: 6861 7665 206d 6178 2076 616c 7565 0a20  have max value. 
+0001cd50: 2020 2020 2020 2023 2323 2066 696e 6420         ### find 
+0001cd60: 7468 6520 6e5f 6c61 7267 6573 7420 7661  the n_largest va
+0001cd70: 6c75 6573 2061 6674 6572 2074 6865 206d  lues after the m
+0001cd80: 6178 696d 756d 2076 616c 7565 2062 6173  aximum value bas
+0001cd90: 6564 206f 6e20 6769 7665 6e20 696e 7075  ed on given inpu
+0001cda0: 7420 6e0a 2020 2020 2020 2020 6e75 6d5f  t n.        num_
+0001cdb0: 6c61 7267 6573 745f 6166 7465 725f 6d61  largest_after_ma
+0001cdc0: 7820 3d20 6e75 6d5f 6d61 7873 202b 2063  x = num_maxs + c
+0001cdd0: 6170 5f61 745f 6e74 685f 6c61 7267 6573  ap_at_nth_larges
+0001cde0: 740a 2020 2020 2020 2020 6361 7070 6564  t.        capped
+0001cdf0: 5f76 616c 7565 203d 2064 665b 636f 6c5d  _value = df[col]
+0001ce00: 2e6e 6c61 7267 6573 7428 6e75 6d5f 6c61  .nlargest(num_la
+0001ce10: 7267 6573 745f 6166 7465 725f 6d61 7829  rgest_after_max)
+0001ce20: 2e69 6c6f 635b 2d31 5d20 2323 2074 6869  .iloc[-1] ## thi
+0001ce30: 7320 6973 2074 6865 2076 616c 7565 2077  s is the value w
+0001ce40: 6520 6361 7020 6974 2061 6761 696e 7374  e cap it against
+0001ce50: 0a20 2020 2020 2020 2064 662e 6c6f 635b  .        df.loc[
+0001ce60: 6466 5b63 6f6c 5d3d 3d6d 6178 7661 6c2c  df[col]==maxval,
+0001ce70: 2063 6f6c 5d20 3d20 2063 6170 7065 645f   col] =  capped_
+0001ce80: 7661 6c75 6520 2323 206d 6178 696d 756d  value ## maximum
+0001ce90: 2076 616c 7565 7320 6172 6520 6e6f 7720   values are now 
+0001cea0: 6361 7070 6564 0a20 2020 2020 2020 2023  capped.        #
+0001ceb0: 2323 2079 6f75 2061 7265 206e 6f77 2067  ## you are now g
+0001cec0: 6f6f 6420 746f 2067 6f20 2d20 796f 7520  ood to go - you 
+0001ced0: 6361 6e20 7368 6f77 2068 6f77 2074 6865  can show how the
+0001cee0: 7920 6172 6520 6361 7070 6564 2075 7369  y are capped usi
+0001cef0: 6e67 2062 6566 6f72 6520 616e 6420 6166  ng before and af
+0001cf00: 7465 7220 7069 6373 0a20 2020 2020 2020  ter pics.       
+0001cf10: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+0001cf20: 2020 2020 2020 2020 2064 665b 636f 6c5d           df[col]
+0001cf30: 2e70 6c6f 7428 6b69 6e64 3d27 626f 7827  .plot(kind='box'
+0001cf40: 2c20 7469 746c 6520 3d20 2725 7320 6166  , title = '%s af
+0001cf50: 7465 7220 6361 7070 696e 6720 6f75 746c  ter capping outl
+0001cf60: 6965 7273 2720 2563 6f6c 2c20 6178 3d61  iers' %col, ax=a
+0001cf70: 7832 290a 2020 2020 2020 2020 2020 2020  x2).            
+0001cf80: 706c 742e 7368 6f77 2829 0a0a 2020 2020  plt.show()..    
+0001cf90: 2020 2020 2320 4c65 7427 7320 7361 7665      # Let's save
+0001cfa0: 2074 6865 206c 6973 7420 6f66 206f 7574   the list of out
+0001cfb0: 6c69 6572 7320 616e 6420 7365 6520 6966  liers and see if
+0001cfc0: 2074 6865 7265 2061 7265 2073 6f6d 6520   there are some 
+0001cfd0: 7769 7468 206f 7574 6c69 6572 7320 696e  with outliers in
+0001cfe0: 206d 756c 7469 706c 6520 636f 6c75 6d6e   multiple column
+0001cff0: 730a 2020 2020 2020 2020 6f75 746c 6965  s.        outlie
+0001d000: 725f 696e 6469 6365 732e 6578 7465 6e64  r_indices.extend
+0001d010: 286f 7574 6c69 6572 5f6c 6973 745f 636f  (outlier_list_co
+0001d020: 6c29 0a0a 2020 2020 2320 7365 6c65 6374  l)..    # select
+0001d030: 2063 6572 7461 696e 206f 6273 6572 7661   certain observa
+0001d040: 7469 6f6e 7320 636f 6e74 6169 6e69 6e67  tions containing
+0001d050: 206d 6f72 6520 7468 616e 206f 6e65 206f   more than one o
+0001d060: 7574 6c69 6572 2069 6e20 3220 636f 6c75  utlier in 2 colu
+0001d070: 6d6e 7320 6f72 206d 6f72 652e 2057 6520  mns or more. We 
+0001d080: 6361 6e20 6472 6f70 2074 6865 6d21 0a20  can drop them!. 
+0001d090: 2020 206f 7574 6c69 6572 5f69 6e64 6963     outlier_indic
+0001d0a0: 6573 203d 2043 6f75 6e74 6572 286f 7574  es = Counter(out
+0001d0b0: 6c69 6572 5f69 6e64 6963 6573 290a 2020  lier_indices).  
+0001d0c0: 2020 6d75 6c74 6970 6c65 5f6f 7574 6c69    multiple_outli
+0001d0d0: 6572 7320 3d20 6c69 7374 2820 6b20 666f  ers = list( k fo
+0001d0e0: 7220 6b2c 2076 2069 6e20 6f75 746c 6965  r k, v in outlie
+0001d0f0: 725f 696e 6469 6365 732e 6974 656d 7328  r_indices.items(
+0001d100: 2920 6966 2076 203e 2033 2029 0a20 2020  ) if v > 3 ).   
+0001d110: 2023 2323 206e 6f77 2064 726f 7020 7468   ### now drop th
+0001d120: 6573 6520 726f 7773 2061 6c74 6f67 6574  ese rows altoget
+0001d130: 6865 7220 2323 2323 0a20 2020 2069 6620  her ####.    if 
+0001d140: 6472 6f70 3a0a 2020 2020 2020 2020 7072  drop:.        pr
+0001d150: 696e 7428 2753 6861 7065 206f 6620 6461  int('Shape of da
+0001d160: 7461 6672 616d 6520 6265 666f 7265 206f  taframe before o
+0001d170: 7574 6c69 6572 7320 6265 696e 6720 6472  utliers being dr
+0001d180: 6f70 7065 643a 2025 7327 2025 2864 662e  opped: %s' %(df.
+0001d190: 7368 6170 652c 2929 0a20 2020 2020 2020  shape,)).       
+0001d1a0: 206e 756d 6265 725f 6f66 5f72 6f77 7320   number_of_rows 
+0001d1b0: 3d20 6466 2e73 6861 7065 5b30 5d0a 2020  = df.shape[0].  
+0001d1c0: 2020 2020 2020 6466 203d 2064 662e 6472        df = df.dr
+0001d1d0: 6f70 286d 756c 7469 706c 655f 6f75 746c  op(multiple_outl
+0001d1e0: 6965 7273 2c20 6178 6973 3d30 290a 2020  iers, axis=0).  
+0001d1f0: 2020 2020 2020 7072 696e 7428 2753 6861        print('Sha
+0001d200: 7065 206f 6620 6461 7461 6672 616d 6520  pe of dataframe 
+0001d210: 6166 7465 7220 6f75 746c 6965 7273 2062  after outliers b
+0001d220: 6569 6e67 2064 726f 7070 6564 3a20 2573  eing dropped: %s
+0001d230: 2720 2528 6466 2e73 6861 7065 2c29 290a  ' %(df.shape,)).
+0001d240: 2020 2020 2020 2020 7072 696e 7428 275c          print('\
+0001d250: 6e4e 756d 6265 725f 6f66 5f72 6f77 7320  nNumber_of_rows 
+0001d260: 7769 7468 206d 756c 7469 706c 6520 6f75  with multiple ou
+0001d270: 746c 6965 7273 2069 6e20 6d6f 7265 2074  tliers in more t
+0001d280: 6861 6e20 3320 636f 6c75 6d6e 7320 7768  han 3 columns wh
+0001d290: 6963 6820 7765 7265 2064 726f 7070 6564  ich were dropped
+0001d2a0: 203d 2025 6427 2025 286e 756d 6265 725f   = %d' %(number_
+0001d2b0: 6f66 5f72 6f77 732d 6466 2e73 6861 7065  of_rows-df.shape
+0001d2c0: 5b30 5d29 290a 2020 2020 7265 7475 726e  [0])).    return
+0001d2d0: 2064 660a 2323 2323 2323 2323 2323 2323   df.############
 0001d2e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d2f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d330: 0a64 6566 2045 4441 5f63 6c61 7373 6966  .def EDA_classif
-0001d340: 795f 616e 645f 7265 7475 726e 5f63 6f6c  y_and_return_col
-0001d350: 735f 6279 5f74 7970 6528 6466 3129 3a0a  s_by_type(df1):.
-0001d360: 2020 2020 2222 220a 2020 2020 4544 4120      """.    EDA 
-0001d370: 7374 616e 6473 2066 6f72 2045 7870 6c6f  stands for Explo
-0001d380: 7261 746f 7279 2064 6174 6120 616e 616c  ratory data anal
-0001d390: 7973 6973 2e20 5468 6973 2066 756e 6374  ysis. This funct
-0001d3a0: 696f 6e20 7065 7266 6f72 6d73 2045 4441  ion performs EDA
-0001d3b0: 202d 2068 656e 6365 2074 6865 206e 616d   - hence the nam
-0001d3c0: 650a 2020 2020 2323 2323 2323 2323 2323  e.    ##########
+0001d320: 2323 2323 230a 6465 6620 4544 415f 636c  #####.def EDA_cl
+0001d330: 6173 7369 6679 5f61 6e64 5f72 6574 7572  assify_and_retur
+0001d340: 6e5f 636f 6c73 5f62 795f 7479 7065 2864  n_cols_by_type(d
+0001d350: 6631 293a 0a20 2020 2022 2222 0a20 2020  f1):.    """.   
+0001d360: 2045 4441 2073 7461 6e64 7320 666f 7220   EDA stands for 
+0001d370: 4578 706c 6f72 6174 6f72 7920 6461 7461  Exploratory data
+0001d380: 2061 6e61 6c79 7369 732e 2054 6869 7320   analysis. This 
+0001d390: 6675 6e63 7469 6f6e 2070 6572 666f 726d  function perform
+0001d3a0: 7320 4544 4120 2d20 6865 6e63 6520 7468  s EDA - hence th
+0001d3b0: 6520 6e61 6d65 0a20 2020 2023 2323 2323  e name.    #####
+0001d3c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d3d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d410: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0001d420: 2020 2054 6869 7320 6861 6e64 7920 6675     This handy fu
-0001d430: 6e63 7469 6f6e 2063 6c61 7373 6966 6965  nction classifie
-0001d440: 7320 796f 7572 2063 6f6c 756d 6e73 2069  s your columns i
-0001d450: 6e74 6f20 6469 6666 6572 656e 7420 7479  nto different ty
-0001d460: 7065 7320 3a20 6d61 6b65 2073 7572 6520  pes : make sure 
-0001d470: 796f 7520 7365 6e64 206f 6e6c 7920 7072  you send only pr
-0001d480: 6564 6963 746f 7273 2e0a 2020 2020 4265  edictors..    Be
-0001d490: 7761 7265 2073 656e 6469 6e67 2074 6172  ware sending tar
-0001d4a0: 6765 7420 636f 6c75 6d6e 2069 6e74 6f20  get column into 
-0001d4b0: 7468 6520 6461 7461 6672 616d 652e 2059  the dataframe. Y
-0001d4c0: 6f75 2064 6f6e 2774 2077 616e 7420 746f  ou don't want to
-0001d4d0: 2073 7461 7274 206d 6f64 6966 7969 6e67   start modifying
-0001d4e0: 2069 742e 0a20 2020 2023 2323 2323 2323   it..    #######
+0001d410: 2323 230a 2020 2020 5468 6973 2068 616e  ###.    This han
+0001d420: 6479 2066 756e 6374 696f 6e20 636c 6173  dy function clas
+0001d430: 7369 6669 6573 2079 6f75 7220 636f 6c75  sifies your colu
+0001d440: 6d6e 7320 696e 746f 2064 6966 6665 7265  mns into differe
+0001d450: 6e74 2074 7970 6573 203a 206d 616b 6520  nt types : make 
+0001d460: 7375 7265 2079 6f75 2073 656e 6420 6f6e  sure you send on
+0001d470: 6c79 2070 7265 6469 6374 6f72 732e 0a20  ly predictors.. 
+0001d480: 2020 2042 6577 6172 6520 7365 6e64 696e     Beware sendin
+0001d490: 6720 7461 7267 6574 2063 6f6c 756d 6e20  g target column 
+0001d4a0: 696e 746f 2074 6865 2064 6174 6166 7261  into the datafra
+0001d4b0: 6d65 2e20 596f 7520 646f 6e27 7420 7761  me. You don't wa
+0001d4c0: 6e74 2074 6f20 7374 6172 7420 6d6f 6469  nt to start modi
+0001d4d0: 6679 696e 6720 6974 2e0a 2020 2020 2323  fying it..    ##
+0001d4e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d4f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d530: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0001d540: 2020 2049 7420 7265 7475 726e 7320 6120     It returns a 
-0001d550: 6c69 7374 206f 6620 6361 7465 676f 7269  list of categori
-0001d560: 6361 6c20 636f 6c75 6d6e 732c 2069 6e74  cal columns, int
-0001d570: 6567 6572 2063 6f6c 7320 616e 6420 666c  eger cols and fl
-0001d580: 6f61 7420 636f 6c75 6d6e 7320 696e 2074  oat columns in t
-0001d590: 6861 7420 6f72 6465 722e 0a20 2020 2022  hat order..    "
-0001d5a0: 2222 0a20 2020 2023 2323 204c 6574 2773  "".    ### Let's
-0001d5b0: 2066 696e 6420 616c 6c20 7468 6520 6361   find all the ca
-0001d5c0: 7465 676f 7269 6361 6c20 6578 636c 7564  tegorical exclud
-0001d5d0: 696e 6720 696e 7465 6765 7220 636f 6c75  ing integer colu
-0001d5e0: 6d6e 7320 696e 2064 6174 6173 6574 3a20  mns in dataset: 
-0001d5f0: 756e 666f 7274 756e 6174 656c 7920 6e6f  unfortunately no
-0001d600: 7420 616c 6c20 696e 7465 6765 7273 2061  t all integers a
-0001d610: 7265 2063 6174 6567 6f72 6963 616c 210a  re categorical!.
-0001d620: 2020 2020 6361 7463 6f6c 7320 3d20 6466      catcols = df
-0001d630: 312e 7365 6c65 6374 5f64 7479 7065 7328  1.select_dtypes(
-0001d640: 696e 636c 7564 653d 276f 626a 6563 7427  include='object'
-0001d650: 292e 636f 6c75 6d6e 732e 746f 6c69 7374  ).columns.tolist
-0001d660: 2829 202b 2064 6631 2e73 656c 6563 745f  () + df1.select_
-0001d670: 6474 7970 6573 2869 6e63 6c75 6465 3d27  dtypes(include='
-0001d680: 6361 7465 676f 7279 2729 2e63 6f6c 756d  category').colum
-0001d690: 6e73 2e74 6f6c 6973 7428 290a 2020 2020  ns.tolist().    
-0001d6a0: 6361 7473 203d 2063 6f70 792e 6465 6570  cats = copy.deep
-0001d6b0: 636f 7079 2863 6174 636f 6c73 290a 2020  copy(catcols).  
-0001d6c0: 2020 6e6c 7063 6f6c 7320 3d20 5b5d 0a20    nlpcols = []. 
-0001d6d0: 2020 2066 6f72 2065 6163 685f 6361 7420     for each_cat 
-0001d6e0: 696e 2063 6174 733a 0a20 2020 2020 2020  in cats:.       
-0001d6f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001d700: 2020 6966 2064 6631 5b5b 6561 6368 5f63    if df1[[each_c
-0001d710: 6174 5d5d 2e66 696c 6c6e 6128 276d 6973  at]].fillna('mis
-0001d720: 7369 6e67 2729 2e6d 6170 286c 656e 292e  sing').map(len).
-0001d730: 6d65 616e 2829 203e 3d20 3430 3a0a 2020  mean() >= 40:.  
-0001d740: 2020 2020 2020 2020 2020 2020 2020 6e6c                nl
-0001d750: 7063 6f6c 732e 6170 7065 6e64 2865 6163  pcols.append(eac
-0001d760: 685f 6361 7429 0a20 2020 2020 2020 2020  h_cat).         
-0001d770: 2020 2020 2020 2063 6174 636f 6c73 2e72         catcols.r
-0001d780: 656d 6f76 6528 6561 6368 5f63 6174 290a  emove(each_cat).
-0001d790: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-0001d7a0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001d7b0: 696e 7565 0a20 2020 2069 6e74 636f 6c73  inue.    intcols
-0001d7c0: 203d 2064 6631 2e73 656c 6563 745f 6474   = df1.select_dt
-0001d7d0: 7970 6573 2869 6e63 6c75 6465 3d27 696e  ypes(include='in
-0001d7e0: 7465 6765 7227 292e 636f 6c75 6d6e 732e  teger').columns.
-0001d7f0: 746f 6c69 7374 2829 0a20 2020 2023 206c  tolist().    # l
-0001d800: 6574 2773 2066 696e 6420 616c 6c20 7468  et's find all th
-0001d810: 6520 666c 6f61 7420 6e75 6d65 7269 6320  e float numeric 
-0001d820: 636f 6c75 6d6e 7320 696e 2064 6174 610a  columns in data.
-0001d830: 2020 2020 666c 6f61 7463 6f6c 7320 3d20      floatcols = 
-0001d840: 6466 312e 7365 6c65 6374 5f64 7479 7065  df1.select_dtype
-0001d850: 7328 696e 636c 7564 653d 2766 6c6f 6174  s(include='float
-0001d860: 2729 2e63 6f6c 756d 6e73 2e74 6f6c 6973  ').columns.tolis
-0001d870: 7428 290a 2020 2020 7265 7475 726e 2063  t().    return c
-0001d880: 6174 636f 6c73 2c20 696e 7463 6f6c 732c  atcols, intcols,
-0001d890: 2066 6c6f 6174 636f 6c73 2c20 6e6c 7063   floatcols, nlpc
-0001d8a0: 6f6c 730a 2323 2323 2323 2323 2323 2323  ols.############
+0001d530: 2323 230a 2020 2020 4974 2072 6574 7572  ###.    It retur
+0001d540: 6e73 2061 206c 6973 7420 6f66 2063 6174  ns a list of cat
+0001d550: 6567 6f72 6963 616c 2063 6f6c 756d 6e73  egorical columns
+0001d560: 2c20 696e 7465 6765 7220 636f 6c73 2061  , integer cols a
+0001d570: 6e64 2066 6c6f 6174 2063 6f6c 756d 6e73  nd float columns
+0001d580: 2069 6e20 7468 6174 206f 7264 6572 2e0a   in that order..
+0001d590: 2020 2020 2222 220a 2020 2020 2323 2320      """.    ### 
+0001d5a0: 4c65 7427 7320 6669 6e64 2061 6c6c 2074  Let's find all t
+0001d5b0: 6865 2063 6174 6567 6f72 6963 616c 2065  he categorical e
+0001d5c0: 7863 6c75 6469 6e67 2069 6e74 6567 6572  xcluding integer
+0001d5d0: 2063 6f6c 756d 6e73 2069 6e20 6461 7461   columns in data
+0001d5e0: 7365 743a 2075 6e66 6f72 7475 6e61 7465  set: unfortunate
+0001d5f0: 6c79 206e 6f74 2061 6c6c 2069 6e74 6567  ly not all integ
+0001d600: 6572 7320 6172 6520 6361 7465 676f 7269  ers are categori
+0001d610: 6361 6c21 0a20 2020 2063 6174 636f 6c73  cal!.    catcols
+0001d620: 203d 2064 6631 2e73 656c 6563 745f 6474   = df1.select_dt
+0001d630: 7970 6573 2869 6e63 6c75 6465 3d27 6f62  ypes(include='ob
+0001d640: 6a65 6374 2729 2e63 6f6c 756d 6e73 2e74  ject').columns.t
+0001d650: 6f6c 6973 7428 2920 2b20 6466 312e 7365  olist() + df1.se
+0001d660: 6c65 6374 5f64 7479 7065 7328 696e 636c  lect_dtypes(incl
+0001d670: 7564 653d 2763 6174 6567 6f72 7927 292e  ude='category').
+0001d680: 636f 6c75 6d6e 732e 746f 6c69 7374 2829  columns.tolist()
+0001d690: 0a20 2020 2063 6174 7320 3d20 636f 7079  .    cats = copy
+0001d6a0: 2e64 6565 7063 6f70 7928 6361 7463 6f6c  .deepcopy(catcol
+0001d6b0: 7329 0a20 2020 206e 6c70 636f 6c73 203d  s).    nlpcols =
+0001d6c0: 205b 5d0a 2020 2020 666f 7220 6561 6368   [].    for each
+0001d6d0: 5f63 6174 2069 6e20 6361 7473 3a0a 2020  _cat in cats:.  
+0001d6e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001d6f0: 2020 2020 2020 2069 6620 6466 315b 5b65         if df1[[e
+0001d700: 6163 685f 6361 745d 5d2e 6669 6c6c 6e61  ach_cat]].fillna
+0001d710: 2827 6d69 7373 696e 6727 292e 6d61 7028  ('missing').map(
+0001d720: 6c65 6e29 2e6d 6561 6e28 2920 3e3d 2034  len).mean() >= 4
+0001d730: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0001d740: 2020 206e 6c70 636f 6c73 2e61 7070 656e     nlpcols.appen
+0001d750: 6428 6561 6368 5f63 6174 290a 2020 2020  d(each_cat).    
+0001d760: 2020 2020 2020 2020 2020 2020 6361 7463              catc
+0001d770: 6f6c 732e 7265 6d6f 7665 2865 6163 685f  ols.remove(each_
+0001d780: 6361 7429 0a20 2020 2020 2020 2065 7863  cat).        exc
+0001d790: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0001d7a0: 2063 6f6e 7469 6e75 650a 2020 2020 696e   continue.    in
+0001d7b0: 7463 6f6c 7320 3d20 6466 312e 7365 6c65  tcols = df1.sele
+0001d7c0: 6374 5f64 7479 7065 7328 696e 636c 7564  ct_dtypes(includ
+0001d7d0: 653d 2769 6e74 6567 6572 2729 2e63 6f6c  e='integer').col
+0001d7e0: 756d 6e73 2e74 6f6c 6973 7428 290a 2020  umns.tolist().  
+0001d7f0: 2020 2320 6c65 7427 7320 6669 6e64 2061    # let's find a
+0001d800: 6c6c 2074 6865 2066 6c6f 6174 206e 756d  ll the float num
+0001d810: 6572 6963 2063 6f6c 756d 6e73 2069 6e20  eric columns in 
+0001d820: 6461 7461 0a20 2020 2066 6c6f 6174 636f  data.    floatco
+0001d830: 6c73 203d 2064 6631 2e73 656c 6563 745f  ls = df1.select_
+0001d840: 6474 7970 6573 2869 6e63 6c75 6465 3d27  dtypes(include='
+0001d850: 666c 6f61 7427 292e 636f 6c75 6d6e 732e  float').columns.
+0001d860: 746f 6c69 7374 2829 0a20 2020 2072 6574  tolist().    ret
+0001d870: 7572 6e20 6361 7463 6f6c 732c 2069 6e74  urn catcols, int
+0001d880: 636f 6c73 2c20 666c 6f61 7463 6f6c 732c  cols, floatcols,
+0001d890: 206e 6c70 636f 6c73 0a23 2323 2323 2323   nlpcols.#######
+0001d8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d8e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d8f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d900: 0a64 6566 2045 4441 5f63 6c61 7373 6966  .def EDA_classif
-0001d910: 795f 6665 6174 7572 6573 5f66 6f72 5f64  y_features_for_d
-0001d920: 6565 705f 6c65 6172 6e69 6e67 2874 7261  eep_learning(tra
-0001d930: 696e 2c20 7461 7267 6574 2c20 6964 636f  in, target, idco
-0001d940: 6c73 293a 0a20 2020 2022 2222 0a20 2020  ls):.    """.   
-0001d950: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+0001d8f0: 2323 2323 230a 6465 6620 4544 415f 636c  #####.def EDA_cl
+0001d900: 6173 7369 6679 5f66 6561 7475 7265 735f  assify_features_
+0001d910: 666f 725f 6465 6570 5f6c 6561 726e 696e  for_deep_learnin
+0001d920: 6728 7472 6169 6e2c 2074 6172 6765 742c  g(train, target,
+0001d930: 2069 6463 6f6c 7329 3a0a 2020 2020 2222   idcols):.    ""
+0001d940: 220a 2020 2020 2323 2323 2323 2323 2323  ".    ##########
+0001d950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001d980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001d9a0: 2323 2323 2323 230a 2020 2020 5468 6973  #######.    This
-0001d9b0: 2069 7320 6120 7369 6d70 6c65 206d 6574   is a simple met
-0001d9c0: 686f 6420 6f66 2063 6c61 7373 6966 7969  hod of classifyi
-0001d9d0: 6e67 2066 6561 7475 7265 7320 696e 746f  ng features into
-0001d9e0: 2034 2074 7970 6573 3a20 6361 7473 2c20   4 types: cats, 
-0001d9f0: 696e 7465 6765 7273 2c20 666c 6f61 7473  integers, floats
-0001da00: 2061 6e64 204e 4c50 730a 2020 2020 5468   and NLPs.    Th
-0001da10: 6973 2069 7320 6e65 6564 6564 2066 6f72  is is needed for
-0001da20: 2064 6565 7020 6c65 6172 6e69 6e67 2070   deep learning p
-0001da30: 726f 626c 656d 7320 7768 6572 6520 7765  roblems where we
-0001da40: 206e 6565 6420 6665 7765 7220 7479 7065   need fewer type
-0001da50: 7320 6f66 2076 6172 6961 626c 6573 2074  s of variables t
-0001da60: 6f20 7472 616e 7366 6f72 6d2e 0a20 2020  o transform..   
-0001da70: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+0001d990: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+0001d9a0: 2054 6869 7320 6973 2061 2073 696d 706c   This is a simpl
+0001d9b0: 6520 6d65 7468 6f64 206f 6620 636c 6173  e method of clas
+0001d9c0: 7369 6679 696e 6720 6665 6174 7572 6573  sifying features
+0001d9d0: 2069 6e74 6f20 3420 7479 7065 733a 2063   into 4 types: c
+0001d9e0: 6174 732c 2069 6e74 6567 6572 732c 2066  ats, integers, f
+0001d9f0: 6c6f 6174 7320 616e 6420 4e4c 5073 0a20  loats and NLPs. 
+0001da00: 2020 2054 6869 7320 6973 206e 6565 6465     This is neede
+0001da10: 6420 666f 7220 6465 6570 206c 6561 726e  d for deep learn
+0001da20: 696e 6720 7072 6f62 6c65 6d73 2077 6865  ing problems whe
+0001da30: 7265 2077 6520 6e65 6564 2066 6577 6572  re we need fewer
+0001da40: 2074 7970 6573 206f 6620 7661 7269 6162   types of variab
+0001da50: 6c65 7320 746f 2074 7261 6e73 666f 726d  les to transform
+0001da60: 2e0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
+0001da70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001da80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001da90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001daa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dab0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dac0: 2323 2323 2323 230a 2020 2020 2222 220a  #######.    """.
-0001dad0: 2020 2020 2323 2320 5465 7374 204c 6162      ### Test Lab
-0001dae0: 656c 6572 2069 7320 6120 7665 7279 2069  eler is a very i
-0001daf0: 6d70 6f72 7461 6e74 2064 6963 7469 6f6e  mportant diction
-0001db00: 6172 7920 7468 6174 2077 696c 6c20 6865  ary that will he
-0001db10: 6c70 2074 7261 6e73 666f 726d 2074 6573  lp transform tes
-0001db20: 7420 6461 7461 2073 616d 6520 6173 2074  t data same as t
-0001db30: 7261 696e 2023 2323 230a 2020 2020 7465  rain ####.    te
-0001db40: 7374 5f6c 6162 656c 6572 203d 2064 6566  st_labeler = def
-0001db50: 6175 6c74 6469 6374 286c 6973 7429 0a0a  aultdict(list)..
-0001db60: 2020 2020 2323 2323 2061 6c6c 2063 6f6c      #### all col
-0001db70: 756d 6e73 2061 7265 2066 6561 7475 7265  umns are feature
-0001db80: 7320 6578 6365 7074 2074 6865 2074 6172  s except the tar
-0001db90: 6765 7420 636f 6c75 6d6e 2061 6e64 2074  get column and t
-0001dba0: 6865 2066 6f6c 6473 2063 6f6c 756d 6e20  he folds column 
-0001dbb0: 2323 230a 2020 2020 6966 2069 7369 6e73  ###.    if isins
-0001dbc0: 7461 6e63 6528 7461 7267 6574 2c20 7374  tance(target, st
-0001dbd0: 7229 3a0a 2020 2020 2020 2020 6665 6174  r):.        feat
-0001dbe0: 7572 6573 203d 205b 7820 666f 7220 7820  ures = [x for x 
-0001dbf0: 696e 206c 6973 7428 7472 6169 6e29 2069  in list(train) i
-0001dc00: 6620 7820 6e6f 7420 696e 205b 7461 7267  f x not in [targ
-0001dc10: 6574 5d2b 6964 636f 6c73 5d0a 2020 2020  et]+idcols].    
-0001dc20: 656c 7365 3a0a 2020 2020 2020 2020 2323  else:.        ##
-0001dc30: 2320 696e 2074 6869 7320 6361 7365 2074  # in this case t
-0001dc40: 6172 6765 7420 6973 2061 206c 6973 7420  arget is a list 
-0001dc50: 616e 6420 6865 6e63 6520 6361 6e20 6265  and hence can be
-0001dc60: 2061 6464 6564 2074 6f20 6964 636f 6c73   added to idcols
-0001dc70: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-0001dc80: 7320 3d20 5b78 2066 6f72 2078 2069 6e20  s = [x for x in 
-0001dc90: 6c69 7374 2874 7261 696e 2920 6966 2078  list(train) if x
-0001dca0: 206e 6f74 2069 6e20 7461 7267 6574 2b69   not in target+i
-0001dcb0: 6463 6f6c 735d 0a0a 2020 2020 2323 2320  dcols]..    ### 
-0001dcc0: 6669 7273 7420 6669 6e64 2061 6c6c 2074  first find all t
-0001dcd0: 6865 2074 7970 6573 206f 6620 636f 6c75  he types of colu
-0001dce0: 6d6e 7320 696e 2079 6f75 7220 6461 7461  mns in your data
-0001dcf0: 2073 6574 2023 2323 230a 2020 2020 6361   set ####.    ca
-0001dd00: 7473 2c20 696e 7473 2c20 666c 6f61 7473  ts, ints, floats
-0001dd10: 2c20 6e6c 7073 203d 2045 4441 5f63 6c61  , nlps = EDA_cla
-0001dd20: 7373 6966 795f 616e 645f 7265 7475 726e  ssify_and_return
-0001dd30: 5f63 6f6c 735f 6279 5f74 7970 6528 7472  _cols_by_type(tr
-0001dd40: 6169 6e5b 6665 6174 7572 6573 5d29 0a0a  ain[features])..
-0001dd50: 2020 2020 6e75 6d65 7269 635f 6665 6174      numeric_feat
-0001dd60: 7572 6573 203d 2069 6e74 7320 2b20 666c  ures = ints + fl
-0001dd70: 6f61 7473 0a20 2020 2063 6174 6567 6f72  oats.    categor
-0001dd80: 6963 616c 735f 6665 6174 7572 6573 203d  icals_features =
-0001dd90: 2063 6f70 792e 6465 6570 636f 7079 2863   copy.deepcopy(c
-0001dda0: 6174 7329 0a20 2020 206e 6c70 5f66 6561  ats).    nlp_fea
-0001ddb0: 7475 7265 7320 3d20 636f 7079 2e64 6565  tures = copy.dee
-0001ddc0: 7063 6f70 7928 6e6c 7073 290a 0a20 2020  pcopy(nlps)..   
-0001ddd0: 2074 6573 745f 6c61 6265 6c65 725b 2763   test_labeler['c
-0001dde0: 6174 6567 6f72 6963 616c 735f 6665 6174  ategoricals_feat
-0001ddf0: 7572 6573 275d 203d 2063 6174 6567 6f72  ures'] = categor
-0001de00: 6963 616c 735f 6665 6174 7572 6573 0a20  icals_features. 
-0001de10: 2020 2074 6573 745f 6c61 6265 6c65 725b     test_labeler[
-0001de20: 276e 756d 6572 6963 5f66 6561 7475 7265  'numeric_feature
-0001de30: 7327 5d20 3d20 6e75 6d65 7269 635f 6665  s'] = numeric_fe
-0001de40: 6174 7572 6573 0a20 2020 2074 6573 745f  atures.    test_
-0001de50: 6c61 6265 6c65 725b 276e 6c70 5f66 6561  labeler['nlp_fea
-0001de60: 7475 7265 7327 5d20 3d20 6e6c 705f 6665  tures'] = nlp_fe
-0001de70: 6174 7572 6573 0a0a 2020 2020 7265 7475  atures..    retu
-0001de80: 726e 2063 6174 732c 2069 6e74 732c 2066  rn cats, ints, f
-0001de90: 6c6f 6174 732c 206e 6c70 730a 2323 2323  loats, nlps.####
+0001dab0: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+0001dac0: 2022 2222 0a20 2020 2023 2323 2054 6573   """.    ### Tes
+0001dad0: 7420 4c61 6265 6c65 7220 6973 2061 2076  t Labeler is a v
+0001dae0: 6572 7920 696d 706f 7274 616e 7420 6469  ery important di
+0001daf0: 6374 696f 6e61 7279 2074 6861 7420 7769  ctionary that wi
+0001db00: 6c6c 2068 656c 7020 7472 616e 7366 6f72  ll help transfor
+0001db10: 6d20 7465 7374 2064 6174 6120 7361 6d65  m test data same
+0001db20: 2061 7320 7472 6169 6e20 2323 2323 0a20   as train ####. 
+0001db30: 2020 2074 6573 745f 6c61 6265 6c65 7220     test_labeler 
+0001db40: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
+0001db50: 7374 290a 0a20 2020 2023 2323 2320 616c  st)..    #### al
+0001db60: 6c20 636f 6c75 6d6e 7320 6172 6520 6665  l columns are fe
+0001db70: 6174 7572 6573 2065 7863 6570 7420 7468  atures except th
+0001db80: 6520 7461 7267 6574 2063 6f6c 756d 6e20  e target column 
+0001db90: 616e 6420 7468 6520 666f 6c64 7320 636f  and the folds co
+0001dba0: 6c75 6d6e 2023 2323 0a20 2020 2069 6620  lumn ###.    if 
+0001dbb0: 6973 696e 7374 616e 6365 2874 6172 6765  isinstance(targe
+0001dbc0: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
+0001dbd0: 2066 6561 7475 7265 7320 3d20 5b78 2066   features = [x f
+0001dbe0: 6f72 2078 2069 6e20 6c69 7374 2874 7261  or x in list(tra
+0001dbf0: 696e 2920 6966 2078 206e 6f74 2069 6e20  in) if x not in 
+0001dc00: 5b74 6172 6765 745d 2b69 6463 6f6c 735d  [target]+idcols]
+0001dc10: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001dc20: 2020 2023 2323 2069 6e20 7468 6973 2063     ### in this c
+0001dc30: 6173 6520 7461 7267 6574 2069 7320 6120  ase target is a 
+0001dc40: 6c69 7374 2061 6e64 2068 656e 6365 2063  list and hence c
+0001dc50: 616e 2062 6520 6164 6465 6420 746f 2069  an be added to i
+0001dc60: 6463 6f6c 730a 2020 2020 2020 2020 6665  dcols.        fe
+0001dc70: 6174 7572 6573 203d 205b 7820 666f 7220  atures = [x for 
+0001dc80: 7820 696e 206c 6973 7428 7472 6169 6e29  x in list(train)
+0001dc90: 2069 6620 7820 6e6f 7420 696e 2074 6172   if x not in tar
+0001dca0: 6765 742b 6964 636f 6c73 5d0a 0a20 2020  get+idcols]..   
+0001dcb0: 2023 2323 2066 6972 7374 2066 696e 6420   ### first find 
+0001dcc0: 616c 6c20 7468 6520 7479 7065 7320 6f66  all the types of
+0001dcd0: 2063 6f6c 756d 6e73 2069 6e20 796f 7572   columns in your
+0001dce0: 2064 6174 6120 7365 7420 2323 2323 0a20   data set ####. 
+0001dcf0: 2020 2063 6174 732c 2069 6e74 732c 2066     cats, ints, f
+0001dd00: 6c6f 6174 732c 206e 6c70 7320 3d20 4544  loats, nlps = ED
+0001dd10: 415f 636c 6173 7369 6679 5f61 6e64 5f72  A_classify_and_r
+0001dd20: 6574 7572 6e5f 636f 6c73 5f62 795f 7479  eturn_cols_by_ty
+0001dd30: 7065 2874 7261 696e 5b66 6561 7475 7265  pe(train[feature
+0001dd40: 735d 290a 0a20 2020 206e 756d 6572 6963  s])..    numeric
+0001dd50: 5f66 6561 7475 7265 7320 3d20 696e 7473  _features = ints
+0001dd60: 202b 2066 6c6f 6174 730a 2020 2020 6361   + floats.    ca
+0001dd70: 7465 676f 7269 6361 6c73 5f66 6561 7475  tegoricals_featu
+0001dd80: 7265 7320 3d20 636f 7079 2e64 6565 7063  res = copy.deepc
+0001dd90: 6f70 7928 6361 7473 290a 2020 2020 6e6c  opy(cats).    nl
+0001dda0: 705f 6665 6174 7572 6573 203d 2063 6f70  p_features = cop
+0001ddb0: 792e 6465 6570 636f 7079 286e 6c70 7329  y.deepcopy(nlps)
+0001ddc0: 0a0a 2020 2020 7465 7374 5f6c 6162 656c  ..    test_label
+0001ddd0: 6572 5b27 6361 7465 676f 7269 6361 6c73  er['categoricals
+0001dde0: 5f66 6561 7475 7265 7327 5d20 3d20 6361  _features'] = ca
+0001ddf0: 7465 676f 7269 6361 6c73 5f66 6561 7475  tegoricals_featu
+0001de00: 7265 730a 2020 2020 7465 7374 5f6c 6162  res.    test_lab
+0001de10: 656c 6572 5b27 6e75 6d65 7269 635f 6665  eler['numeric_fe
+0001de20: 6174 7572 6573 275d 203d 206e 756d 6572  atures'] = numer
+0001de30: 6963 5f66 6561 7475 7265 730a 2020 2020  ic_features.    
+0001de40: 7465 7374 5f6c 6162 656c 6572 5b27 6e6c  test_labeler['nl
+0001de50: 705f 6665 6174 7572 6573 275d 203d 206e  p_features'] = n
+0001de60: 6c70 5f66 6561 7475 7265 730a 0a20 2020  lp_features..   
+0001de70: 2072 6574 7572 6e20 6361 7473 2c20 696e   return cats, in
+0001de80: 7473 2c20 666c 6f61 7473 2c20 6e6c 7073  ts, floats, nlps
+0001de90: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
 0001dea0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001deb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ded0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001def0: 2323 2323 2323 2323 230a 6672 6f6d 2069  #########.from i
-0001df00: 7465 7274 6f6f 6c73 2069 6d70 6f72 7420  tertools import 
-0001df10: 636f 6d62 696e 6174 696f 6e73 0a64 6566  combinations.def
-0001df20: 2046 455f 6372 6561 7465 5f63 6174 6567   FE_create_categ
-0001df30: 6f72 6963 616c 5f66 6561 7475 7265 5f63  orical_feature_c
-0001df40: 726f 7373 6573 2864 6663 2c20 6361 7473  rosses(dfc, cats
-0001df50: 293a 0a20 2020 2022 2222 0a20 2020 2046  ):.    """.    F
-0001df60: 4520 6d65 616e 7320 4645 4154 5552 4520  E means FEATURE 
-0001df70: 454e 4749 4e45 4552 494e 4720 2d20 5468  ENGINEERING - Th
-0001df80: 6174 206d 6561 6e73 2074 6869 7320 6675  at means this fu
-0001df90: 6e63 7469 6f6e 2077 696c 6c20 6372 6561  nction will crea
-0001dfa0: 7465 206e 6577 2066 6561 7475 7265 730a  te new features.
-0001dfb0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0001dee0: 2323 2323 2323 2323 2323 2323 2323 0a66  ##############.f
+0001def0: 726f 6d20 6974 6572 746f 6f6c 7320 696d  rom itertools im
+0001df00: 706f 7274 2063 6f6d 6269 6e61 7469 6f6e  port combination
+0001df10: 730a 6465 6620 4645 5f63 7265 6174 655f  s.def FE_create_
+0001df20: 6361 7465 676f 7269 6361 6c5f 6665 6174  categorical_feat
+0001df30: 7572 655f 6372 6f73 7365 7328 6466 632c  ure_crosses(dfc,
+0001df40: 2063 6174 7329 3a0a 2020 2020 2222 220a   cats):.    """.
+0001df50: 2020 2020 4645 206d 6561 6e73 2046 4541      FE means FEA
+0001df60: 5455 5245 2045 4e47 494e 4545 5249 4e47  TURE ENGINEERING
+0001df70: 202d 2054 6861 7420 6d65 616e 7320 7468   - That means th
+0001df80: 6973 2066 756e 6374 696f 6e20 7769 6c6c  is function will
+0001df90: 2063 7265 6174 6520 6e65 7720 6665 6174   create new feat
+0001dfa0: 7572 6573 0a20 2020 2023 2323 2323 2323  ures.    #######
+0001dfb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dfc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001dfe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001dff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e000: 2323 2323 2323 2323 2323 0a20 2020 2054  ##########.    T
-0001e010: 6869 7320 6372 6561 7465 7320 6665 6174  his creates feat
-0001e020: 7572 6520 6372 6f73 7365 7320 666f 7220  ure crosses for 
-0001e030: 6561 6368 2070 6169 7220 6f66 2063 6174  each pair of cat
-0001e040: 6567 6f72 6963 616c 2076 6172 6961 626c  egorical variabl
-0001e050: 6573 2069 6e20 6361 7473 2e0a 2020 2020  es in cats..    
-0001e060: 5468 6520 6e75 6d62 6572 206f 6620 6665  The number of fe
-0001e070: 6174 7572 6573 2063 7265 6174 6564 2077  atures created w
-0001e080: 696c 6c20 6265 206e 2a28 6e2d 3129 2f32  ill be n*(n-1)/2
-0001e090: 2077 6869 6368 206d 6561 6e73 2033 2063   which means 3 c
-0001e0a0: 6174 2066 6561 7475 7265 7320 7769 6c6c  at features will
-0001e0b0: 2063 7265 6174 650a 2020 2020 332a 322f   create.    3*2/
-0001e0c0: 3220 3d20 3320 6e65 7720 6665 6174 7572  2 = 3 new featur
-0001e0d0: 6573 2e20 596f 7520 6d75 7374 2062 6520  es. You must be 
-0001e0e0: 6361 7265 6675 6c20 7769 7468 2074 6869  careful with thi
-0001e0f0: 7320 6675 6e63 7469 6f6e 2073 6f20 6974  s function so it
-0001e100: 2064 6f65 736e 2774 2063 7265 6174 6520   doesn't create 
-0001e110: 746f 6f20 6d61 6e79 2e0a 0a20 2020 2049  too many...    I
-0001e120: 6e70 7574 733a 0a20 2020 2064 6663 203a  nputs:.    dfc :
-0001e130: 2064 6174 6166 7261 6d65 2063 6f6e 7461   dataframe conta
-0001e140: 696e 696e 6720 616c 6c20 7468 6520 6665  ining all the fe
-0001e150: 6174 7572 6573 0a20 2020 2063 6174 733a  atures.    cats:
-0001e160: 2061 206c 6973 7420 6f66 2063 6174 6567   a list of categ
-0001e170: 6f72 6963 616c 2066 6561 7475 7265 7320  orical features 
-0001e180: 696e 2074 6865 2064 6174 6166 7261 6d65  in the dataframe
-0001e190: 2061 626f 7665 2028 6466 6329 0a0a 2020   above (dfc)..  
-0001e1a0: 2020 4f75 7470 7574 733a 0a20 2020 2064    Outputs:.    d
-0001e1b0: 6663 3a20 7265 7475 726e 7320 7468 6520  fc: returns the 
-0001e1c0: 6461 7461 6672 616d 6520 7769 7468 206e  dataframe with n
-0001e1d0: 6577 6c79 2061 6464 6564 2066 6561 7475  ewly added featu
-0001e1e0: 7265 732e 204f 7269 6769 6e61 6c20 6665  res. Original fe
-0001e1f0: 6174 7572 6573 2061 7265 2075 6e74 6f75  atures are untou
-0001e200: 6368 6564 2e0a 0a20 2020 2023 2323 2323  ched...    #####
+0001dff0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+0001e000: 2020 2020 5468 6973 2063 7265 6174 6573      This creates
+0001e010: 2066 6561 7475 7265 2063 726f 7373 6573   feature crosses
+0001e020: 2066 6f72 2065 6163 6820 7061 6972 206f   for each pair o
+0001e030: 6620 6361 7465 676f 7269 6361 6c20 7661  f categorical va
+0001e040: 7269 6162 6c65 7320 696e 2063 6174 732e  riables in cats.
+0001e050: 0a20 2020 2054 6865 206e 756d 6265 7220  .    The number 
+0001e060: 6f66 2066 6561 7475 7265 7320 6372 6561  of features crea
+0001e070: 7465 6420 7769 6c6c 2062 6520 6e2a 286e  ted will be n*(n
+0001e080: 2d31 292f 3220 7768 6963 6820 6d65 616e  -1)/2 which mean
+0001e090: 7320 3320 6361 7420 6665 6174 7572 6573  s 3 cat features
+0001e0a0: 2077 696c 6c20 6372 6561 7465 0a20 2020   will create.   
+0001e0b0: 2033 2a32 2f32 203d 2033 206e 6577 2066   3*2/2 = 3 new f
+0001e0c0: 6561 7475 7265 732e 2059 6f75 206d 7573  eatures. You mus
+0001e0d0: 7420 6265 2063 6172 6566 756c 2077 6974  t be careful wit
+0001e0e0: 6820 7468 6973 2066 756e 6374 696f 6e20  h this function 
+0001e0f0: 736f 2069 7420 646f 6573 6e27 7420 6372  so it doesn't cr
+0001e100: 6561 7465 2074 6f6f 206d 616e 792e 0a0a  eate too many...
+0001e110: 2020 2020 496e 7075 7473 3a0a 2020 2020      Inputs:.    
+0001e120: 6466 6320 3a20 6461 7461 6672 616d 6520  dfc : dataframe 
+0001e130: 636f 6e74 6169 6e69 6e67 2061 6c6c 2074  containing all t
+0001e140: 6865 2066 6561 7475 7265 730a 2020 2020  he features.    
+0001e150: 6361 7473 3a20 6120 6c69 7374 206f 6620  cats: a list of 
+0001e160: 6361 7465 676f 7269 6361 6c20 6665 6174  categorical feat
+0001e170: 7572 6573 2069 6e20 7468 6520 6461 7461  ures in the data
+0001e180: 6672 616d 6520 6162 6f76 6520 2864 6663  frame above (dfc
+0001e190: 290a 0a20 2020 204f 7574 7075 7473 3a0a  )..    Outputs:.
+0001e1a0: 2020 2020 6466 633a 2072 6574 7572 6e73      dfc: returns
+0001e1b0: 2074 6865 2064 6174 6166 7261 6d65 2077   the dataframe w
+0001e1c0: 6974 6820 6e65 776c 7920 6164 6465 6420  ith newly added 
+0001e1d0: 6665 6174 7572 6573 2e20 4f72 6967 696e  features. Origin
+0001e1e0: 616c 2066 6561 7475 7265 7320 6172 6520  al features are 
+0001e1f0: 756e 746f 7563 6865 642e 0a0a 2020 2020  untouched...    
+0001e200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e210: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e220: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e230: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e260: 230a 2020 2020 5573 6167 653a 0a20 2020  #.    Usage:.   
-0001e270: 2064 6663 203d 2046 455f 6372 6561 7465   dfc = FE_create
-0001e280: 5f66 6561 7475 7265 5f63 726f 7373 6573  _feature_crosses
-0001e290: 2864 6663 2c20 6361 7473 290a 2020 2020  (dfc, cats).    
-0001e2a0: 2222 220a 2020 2020 6466 6320 3d20 636f  """.    dfc = co
-0001e2b0: 7079 2e64 6565 7063 6f70 7928 6466 6329  py.deepcopy(dfc)
-0001e2c0: 0a20 2020 2063 6f6d 626f 7320 3d20 6c69  .    combos = li
-0001e2d0: 7374 2863 6f6d 6269 6e61 7469 6f6e 7328  st(combinations(
-0001e2e0: 6361 7473 2c20 3229 290a 2020 2020 666f  cats, 2)).    fo
-0001e2f0: 7220 6361 7431 2c20 6361 7432 2069 6e20  r cat1, cat2 in 
-0001e300: 636f 6d62 6f73 3a0a 2020 2020 2020 2020  combos:.        
-0001e310: 6466 632e 6c6f 635b 3a2c 6361 7431 2b27  dfc.loc[:,cat1+'
-0001e320: 5f63 726f 7373 5f27 2b63 6174 325d 203d  _cross_'+cat2] =
-0001e330: 2064 6663 5b63 6174 315d 2e61 7374 7970   dfc[cat1].astyp
-0001e340: 6528 7374 7229 2b22 2022 2b64 6663 5b63  e(str)+" "+dfc[c
-0001e350: 6174 325d 2e61 7374 7970 6528 7374 7229  at2].astype(str)
-0001e360: 0a20 2020 2072 6574 7572 6e20 6466 630a  .    return dfc.
+0001e250: 2323 2323 2323 0a20 2020 2055 7361 6765  ######.    Usage
+0001e260: 3a0a 2020 2020 6466 6320 3d20 4645 5f63  :.    dfc = FE_c
+0001e270: 7265 6174 655f 6665 6174 7572 655f 6372  reate_feature_cr
+0001e280: 6f73 7365 7328 6466 632c 2063 6174 7329  osses(dfc, cats)
+0001e290: 0a20 2020 2022 2222 0a20 2020 2064 6663  .    """.    dfc
+0001e2a0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0001e2b0: 2864 6663 290a 2020 2020 636f 6d62 6f73  (dfc).    combos
+0001e2c0: 203d 206c 6973 7428 636f 6d62 696e 6174   = list(combinat
+0001e2d0: 696f 6e73 2863 6174 732c 2032 2929 0a20  ions(cats, 2)). 
+0001e2e0: 2020 2066 6f72 2063 6174 312c 2063 6174     for cat1, cat
+0001e2f0: 3220 696e 2063 6f6d 626f 733a 0a20 2020  2 in combos:.   
+0001e300: 2020 2020 2064 6663 2e6c 6f63 5b3a 2c63       dfc.loc[:,c
+0001e310: 6174 312b 275f 6372 6f73 735f 272b 6361  at1+'_cross_'+ca
+0001e320: 7432 5d20 3d20 6466 635b 6361 7431 5d2e  t2] = dfc[cat1].
+0001e330: 6173 7479 7065 2873 7472 292b 2220 222b  astype(str)+" "+
+0001e340: 6466 635b 6361 7432 5d2e 6173 7479 7065  dfc[cat2].astype
+0001e350: 2873 7472 290a 2020 2020 7265 7475 726e  (str).    return
+0001e360: 2064 6663 0a23 2323 2323 2323 2323 2323   dfc.###########
 0001e370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e3a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e3c0: 2323 2323 2323 2323 2323 2323 230a 6672  #############.fr
-0001e3d0: 6f6d 2073 6369 7079 2e73 7461 7473 2069  om scipy.stats i
-0001e3e0: 6d70 6f72 7420 7072 6f62 706c 6f74 2c73  mport probplot,s
-0001e3f0: 6b65 770a 6465 6620 4544 415f 6669 6e64  kew.def EDA_find
-0001e400: 5f73 6b65 7765 645f 7661 7269 6162 6c65  _skewed_variable
-0001e410: 7328 6466 742c 2073 6b65 775f 6c69 6d69  s(dft, skew_limi
-0001e420: 743d 312e 3129 3a0a 2020 2020 2222 220a  t=1.1):.    """.
-0001e430: 2020 2020 4544 4120 7374 616e 6473 2066      EDA stands f
-0001e440: 6f72 2045 7870 6c6f 7261 746f 7279 2044  or Exploratory D
-0001e450: 6174 6120 416e 616c 7973 6973 203a 2074  ata Analysis : t
-0001e460: 6869 7320 6675 6e63 7469 6f6e 2070 6572  his function per
-0001e470: 666f 726d 7320 4544 410a 2020 2020 2323  forms EDA.    ##
+0001e3c0: 2323 0a66 726f 6d20 7363 6970 792e 7374  ##.from scipy.st
+0001e3d0: 6174 7320 696d 706f 7274 2070 726f 6270  ats import probp
+0001e3e0: 6c6f 742c 736b 6577 0a64 6566 2045 4441  lot,skew.def EDA
+0001e3f0: 5f66 696e 645f 736b 6577 6564 5f76 6172  _find_skewed_var
+0001e400: 6961 626c 6573 2864 6674 2c20 736b 6577  iables(dft, skew
+0001e410: 5f6c 696d 6974 3d31 2e31 293a 0a20 2020  _limit=1.1):.   
+0001e420: 2022 2222 0a20 2020 2045 4441 2073 7461   """.    EDA sta
+0001e430: 6e64 7320 666f 7220 4578 706c 6f72 6174  nds for Explorat
+0001e440: 6f72 7920 4461 7461 2041 6e61 6c79 7369  ory Data Analysi
+0001e450: 7320 3a20 7468 6973 2066 756e 6374 696f  s : this functio
+0001e460: 6e20 7065 7266 6f72 6d73 2045 4441 0a20  n performs EDA. 
+0001e470: 2020 2023 2323 2323 2323 2323 2323 2323     #############
 0001e480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e4b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e4d0: 2323 2323 0a20 2020 2054 6869 7320 6675  ####.    This fu
-0001e4e0: 6e63 7469 6f6e 2066 696e 6473 2061 6c6c  nction finds all
-0001e4f0: 2074 6865 2068 6967 686c 7920 736b 6577   the highly skew
-0001e500: 6564 2066 6c6f 6174 2028 636f 6e74 696e  ed float (contin
-0001e510: 756f 7573 2920 7661 7269 6162 6c65 7320  uous) variables 
-0001e520: 696e 2079 6f75 7220 4461 7461 4672 616d  in your DataFram
-0001e530: 650a 2020 2020 4974 2073 656c 6563 7473  e.    It selects
-0001e540: 2074 6865 6d20 6261 7365 6420 6f6e 2074   them based on t
-0001e550: 6865 2073 6b65 775f 6c69 6d69 7420 796f  he skew_limit yo
-0001e560: 7520 7365 743a 2061 6e79 7468 696e 6720  u set: anything 
-0001e570: 6f76 6572 2073 6b65 7720 312e 3120 6973  over skew 1.1 is
-0001e580: 2074 6865 2064 6566 6175 6c74 2073 6574   the default set
-0001e590: 7469 6e67 2e0a 2020 2020 2323 2323 2323  ting..    ######
+0001e4c0: 2323 2323 2323 2323 230a 2020 2020 5468  #########.    Th
+0001e4d0: 6973 2066 756e 6374 696f 6e20 6669 6e64  is function find
+0001e4e0: 7320 616c 6c20 7468 6520 6869 6768 6c79  s all the highly
+0001e4f0: 2073 6b65 7765 6420 666c 6f61 7420 2863   skewed float (c
+0001e500: 6f6e 7469 6e75 6f75 7329 2076 6172 6961  ontinuous) varia
+0001e510: 626c 6573 2069 6e20 796f 7572 2044 6174  bles in your Dat
+0001e520: 6146 7261 6d65 0a20 2020 2049 7420 7365  aFrame.    It se
+0001e530: 6c65 6374 7320 7468 656d 2062 6173 6564  lects them based
+0001e540: 206f 6e20 7468 6520 736b 6577 5f6c 696d   on the skew_lim
+0001e550: 6974 2079 6f75 2073 6574 3a20 616e 7974  it you set: anyt
+0001e560: 6869 6e67 206f 7665 7220 736b 6577 2031  hing over skew 1
+0001e570: 2e31 2069 7320 7468 6520 6465 6661 756c  .1 is the defaul
+0001e580: 7420 7365 7474 696e 672e 0a20 2020 2023  t setting..    #
+0001e590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e5a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e5c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e5d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e5e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e5f0: 0a20 2020 2049 6e70 7574 733a 0a20 2020  .    Inputs:.   
-0001e600: 2064 663a 2070 616e 6461 7320 4461 7461   df: pandas Data
-0001e610: 4672 616d 650a 2020 2020 736b 6577 5f6c  Frame.    skew_l
-0001e620: 696d 6974 3a20 6465 6661 756c 7420 312e  imit: default 1.
-0001e630: 3120 3d20 616e 7974 6869 6e67 206f 7665  1 = anything ove
-0001e640: 7220 7468 6973 206c 696d 6974 2061 6e64  r this limit and
-0001e650: 2069 7420 6465 7465 6374 7320 6974 2061   it detects it a
-0001e660: 7320 6120 6869 6768 6c79 2073 6b65 7765  s a highly skewe
-0001e670: 6420 7661 722e 0a0a 2020 2020 4f75 7470  d var...    Outp
-0001e680: 7574 733a 0a20 2020 206c 6973 7420 6f66  uts:.    list of
-0001e690: 2061 2076 6172 6961 626c 6573 2066 6f75   a variables fou
-0001e6a0: 6e64 2074 6861 7420 6861 7665 2068 6967  nd that have hig
-0001e6b0: 6820 736b 6577 2069 6e20 6461 7461 2073  h skew in data s
-0001e6c0: 6574 2e0a 2020 2020 2323 2323 2323 2323  et..    ########
+0001e5e0: 2323 2323 230a 2020 2020 496e 7075 7473  #####.    Inputs
+0001e5f0: 3a0a 2020 2020 6466 3a20 7061 6e64 6173  :.    df: pandas
+0001e600: 2044 6174 6146 7261 6d65 0a20 2020 2073   DataFrame.    s
+0001e610: 6b65 775f 6c69 6d69 743a 2064 6566 6175  kew_limit: defau
+0001e620: 6c74 2031 2e31 203d 2061 6e79 7468 696e  lt 1.1 = anythin
+0001e630: 6720 6f76 6572 2074 6869 7320 6c69 6d69  g over this limi
+0001e640: 7420 616e 6420 6974 2064 6574 6563 7473  t and it detects
+0001e650: 2069 7420 6173 2061 2068 6967 686c 7920   it as a highly 
+0001e660: 736b 6577 6564 2076 6172 2e0a 0a20 2020  skewed var...   
+0001e670: 204f 7574 7075 7473 3a0a 2020 2020 6c69   Outputs:.    li
+0001e680: 7374 206f 6620 6120 7661 7269 6162 6c65  st of a variable
+0001e690: 7320 666f 756e 6420 7468 6174 2068 6176  s found that hav
+0001e6a0: 6520 6869 6768 2073 6b65 7720 696e 2064  e high skew in d
+0001e6b0: 6174 6120 7365 742e 0a20 2020 2023 2323  ata set..    ###
+0001e6c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e6d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e6e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e6f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e710: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
-0001e720: 2020 2059 6f75 2063 616e 2075 7365 2046     You can use F
-0001e730: 455f 6361 7070 696e 675f 6f75 746c 6965  E_capping_outlie
-0001e740: 7273 5f62 6579 6f6e 645f 4951 525f 5261  rs_beyond_IQR_Ra
-0001e750: 6e67 6528 2920 6675 6e63 7469 6f6e 2074  nge() function t
-0001e760: 6f20 6361 7020 6f75 746c 6965 7273 2069  o cap outliers i
-0001e770: 6e20 7468 6573 6520 7661 7269 6162 6c65  n these variable
-0001e780: 732e 0a20 2020 2022 2222 0a20 2020 2073  s..    """.    s
-0001e790: 6b65 7765 645f 7661 7273 203d 205b 5d0a  kewed_vars = [].
-0001e7a0: 2020 2020 636f 6e74 6920 3d20 6466 742e      conti = dft.
-0001e7b0: 7365 6c65 6374 5f64 7479 7065 7328 696e  select_dtypes(in
-0001e7c0: 636c 7564 653d 2766 6c6f 6174 2729 2e63  clude='float').c
-0001e7d0: 6f6c 756d 6e73 2e74 6f6c 6973 7428 290a  olumns.tolist().
-0001e7e0: 2020 2020 666f 7220 6561 6368 5f63 6f6e      for each_con
-0001e7f0: 7469 2069 6e20 636f 6e74 693a 0a20 2020  ti in conti:.   
-0001e800: 2020 2020 2073 6b65 775f 7661 6c3d 726f       skew_val=ro
-0001e810: 756e 6428 6466 745b 6561 6368 5f63 6f6e  und(dft[each_con
-0001e820: 7469 5d2e 736b 6577 2829 2c20 3129 0a20  ti].skew(), 1). 
-0001e830: 2020 2020 2020 2069 6620 736b 6577 5f76         if skew_v
-0001e840: 616c 203e 3d20 736b 6577 5f6c 696d 6974  al >= skew_limit
-0001e850: 3a0a 2020 2020 2020 2020 2020 2020 736b  :.            sk
-0001e860: 6577 6564 5f76 6172 732e 6170 7065 6e64  ewed_vars.append
-0001e870: 2865 6163 685f 636f 6e74 6929 0a20 2020  (each_conti).   
-0001e880: 2070 7269 6e74 2827 466f 756e 6420 2564   print('Found %d
-0001e890: 2073 6b65 7765 6420 7661 7269 6162 6c65   skewed variable
-0001e8a0: 7320 696e 2064 6174 6120 6261 7365 6420  s in data based 
-0001e8b0: 6f6e 2073 6b65 775f 6c69 6d69 7420 3e3d  on skew_limit >=
-0001e8c0: 2025 7327 2025 286c 656e 2873 6b65 7765   %s' %(len(skewe
-0001e8d0: 645f 7661 7273 292c 736b 6577 5f6c 696d  d_vars),skew_lim
-0001e8e0: 6974 2929 0a20 2020 2072 6574 7572 6e20  it)).    return 
-0001e8f0: 736b 6577 6564 5f76 6172 730a 2323 2323  skewed_vars.####
+0001e710: 2323 230a 2020 2020 596f 7520 6361 6e20  ###.    You can 
+0001e720: 7573 6520 4645 5f63 6170 7069 6e67 5f6f  use FE_capping_o
+0001e730: 7574 6c69 6572 735f 6265 796f 6e64 5f49  utliers_beyond_I
+0001e740: 5152 5f52 616e 6765 2829 2066 756e 6374  QR_Range() funct
+0001e750: 696f 6e20 746f 2063 6170 206f 7574 6c69  ion to cap outli
+0001e760: 6572 7320 696e 2074 6865 7365 2076 6172  ers in these var
+0001e770: 6961 626c 6573 2e0a 2020 2020 2222 220a  iables..    """.
+0001e780: 2020 2020 736b 6577 6564 5f76 6172 7320      skewed_vars 
+0001e790: 3d20 5b5d 0a20 2020 2063 6f6e 7469 203d  = [].    conti =
+0001e7a0: 2064 6674 2e73 656c 6563 745f 6474 7970   dft.select_dtyp
+0001e7b0: 6573 2869 6e63 6c75 6465 3d27 666c 6f61  es(include='floa
+0001e7c0: 7427 292e 636f 6c75 6d6e 732e 746f 6c69  t').columns.toli
+0001e7d0: 7374 2829 0a20 2020 2066 6f72 2065 6163  st().    for eac
+0001e7e0: 685f 636f 6e74 6920 696e 2063 6f6e 7469  h_conti in conti
+0001e7f0: 3a0a 2020 2020 2020 2020 736b 6577 5f76  :.        skew_v
+0001e800: 616c 3d72 6f75 6e64 2864 6674 5b65 6163  al=round(dft[eac
+0001e810: 685f 636f 6e74 695d 2e73 6b65 7728 292c  h_conti].skew(),
+0001e820: 2031 290a 2020 2020 2020 2020 6966 2073   1).        if s
+0001e830: 6b65 775f 7661 6c20 3e3d 2073 6b65 775f  kew_val >= skew_
+0001e840: 6c69 6d69 743a 0a20 2020 2020 2020 2020  limit:.         
+0001e850: 2020 2073 6b65 7765 645f 7661 7273 2e61     skewed_vars.a
+0001e860: 7070 656e 6428 6561 6368 5f63 6f6e 7469  ppend(each_conti
+0001e870: 290a 2020 2020 7072 696e 7428 2746 6f75  ).    print('Fou
+0001e880: 6e64 2025 6420 736b 6577 6564 2076 6172  nd %d skewed var
+0001e890: 6961 626c 6573 2069 6e20 6461 7461 2062  iables in data b
+0001e8a0: 6173 6564 206f 6e20 736b 6577 5f6c 696d  ased on skew_lim
+0001e8b0: 6974 203e 3d20 2573 2720 2528 6c65 6e28  it >= %s' %(len(
+0001e8c0: 736b 6577 6564 5f76 6172 7329 2c73 6b65  skewed_vars),ske
+0001e8d0: 775f 6c69 6d69 7429 290a 2020 2020 7265  w_limit)).    re
+0001e8e0: 7475 726e 2073 6b65 7765 645f 7661 7273  turn skewed_vars
+0001e8f0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
 0001e900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001e930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001e950: 2323 2323 2323 2323 230a 6465 6620 6973  #########.def is
-0001e960: 5f6f 7574 6c69 6572 2864 6174 6166 7261  _outlier(datafra
-0001e970: 6d65 2c20 7468 7265 7368 3d33 2e35 293a  me, thresh=3.5):
-0001e980: 0a20 2020 2069 6620 6c65 6e28 6461 7461  .    if len(data
-0001e990: 6672 616d 652e 7368 6170 6529 203d 3d20  frame.shape) == 
-0001e9a0: 313a 0a20 2020 2020 2020 2064 6174 6166  1:.        dataf
-0001e9b0: 7261 6d65 203d 2064 6174 6166 7261 6d65  rame = dataframe
-0001e9c0: 5b3a 2c4e 6f6e 655d 0a20 2020 206d 6564  [:,None].    med
-0001e9d0: 6961 6e20 3d20 6e70 2e6d 6564 6961 6e28  ian = np.median(
-0001e9e0: 6461 7461 6672 616d 652c 2061 7869 733d  dataframe, axis=
-0001e9f0: 3029 0a20 2020 2064 6966 6620 3d20 6e70  0).    diff = np
-0001ea00: 2e73 756d 2828 6461 7461 6672 616d 6520  .sum((dataframe 
-0001ea10: 2d20 6d65 6469 616e 292a 2a32 2c20 6178  - median)**2, ax
-0001ea20: 6973 3d2d 3129 0a20 2020 2064 6966 6620  is=-1).    diff 
-0001ea30: 3d20 6e70 2e73 7172 7428 6469 6666 290a  = np.sqrt(diff).
-0001ea40: 2020 2020 6d65 645f 6162 735f 6465 7669      med_abs_devi
-0001ea50: 6174 696f 6e20 3d20 6e70 2e6d 6564 6961  ation = np.media
-0001ea60: 6e28 6469 6666 290a 0a20 2020 206d 6f64  n(diff)..    mod
-0001ea70: 6966 6965 645f 7a5f 7363 6f72 6520 3d20  ified_z_score = 
-0001ea80: 302e 3637 3435 202a 2064 6966 6620 2f20  0.6745 * diff / 
-0001ea90: 6d65 645f 6162 735f 6465 7669 6174 696f  med_abs_deviatio
-0001eaa0: 6e0a 2020 2020 7265 7475 726e 206d 6f64  n.    return mod
-0001eab0: 6966 6965 645f 7a5f 7363 6f72 6520 3e20  ified_z_score > 
-0001eac0: 7468 7265 7368 0a0a 6465 6620 4544 415f  thresh..def EDA_
-0001ead0: 6669 6e64 5f6f 7574 6c69 6572 7328 6466  find_outliers(df
-0001eae0: 2c20 636f 6c2c 2074 6872 6573 683d 3529  , col, thresh=5)
-0001eaf0: 3a0a 2020 2020 2222 220a 2020 2020 2222  :.    """.    ""
-0001eb00: 220a 2020 2020 2323 2323 2323 2320 4669  ".    ####### Fi
-0001eb10: 6e64 7320 4f75 746c 6965 7273 2061 6e64  nds Outliers and
-0001eb20: 206d 6172 6b73 2074 6865 6d20 6173 2027   marks them as '
-0001eb30: 5472 7565 2720 6966 2074 6865 7920 6172  True' if they ar
-0001eb40: 6520 6f75 746c 6965 7273 0a20 2020 2023  e outliers.    #
-0001eb50: 2323 2323 2323 2044 6174 6166 7261 6d65  ###### Dataframe
-0001eb60: 2072 6566 6572 7320 746f 2074 6865 2069   refers to the i
-0001eb70: 6e70 7574 2064 6174 6166 7261 6d65 2061  nput dataframe a
-0001eb80: 6e64 2074 6872 6573 686f 6c64 2072 6566  nd threshold ref
-0001eb90: 6572 7320 746f 2068 6f77 2066 6172 2066  ers to how far f
-0001eba0: 726f 6d20 7468 6520 6d65 6469 616e 2061  rom the median a
-0001ebb0: 2076 616c 7565 2069 730a 2020 2020 2323   value is.    ##
-0001ebc0: 2323 2323 2320 4920 616d 2075 7369 6e67  ##### I am using
-0001ebd0: 2074 6865 204d 6564 6961 6e20 4162 736f   the Median Abso
-0001ebe0: 6c75 7465 2044 6576 6961 7469 6f6e 204d  lute Deviation M
-0001ebf0: 6574 686f 6420 284d 4144 4429 2074 6f20  ethod (MADD) to 
-0001ec00: 6669 6e64 204f 7574 6c69 6572 7320 6865  find Outliers he
-0001ec10: 7265 0a20 2020 206d 6173 6b5f 6f75 746c  re.    mask_outl
-0001ec20: 6965 7273 203d 2069 735f 6f75 746c 6965  iers = is_outlie
-0001ec30: 7228 6466 5b63 6f6c 5d2c 7468 7265 7368  r(df[col],thresh
-0001ec40: 3d74 6872 6573 6829 2e61 7374 7970 6528  =thresh).astype(
-0001ec50: 696e 7429 0a20 2020 2072 6574 7572 6e20  int).    return 
-0001ec60: 6466 2e69 6c6f 635b 6e70 2e77 6865 7265  df.iloc[np.where
-0001ec70: 286d 6173 6b5f 6f75 746c 6965 7273 3e30  (mask_outliers>0
-0001ec80: 295d 0a23 2323 2323 2323 2323 2323 2323  )].#############
+0001e940: 2323 2323 2323 2323 2323 2323 2323 0a64  ##############.d
+0001e950: 6566 2069 735f 6f75 746c 6965 7228 6461  ef is_outlier(da
+0001e960: 7461 6672 616d 652c 2074 6872 6573 683d  taframe, thresh=
+0001e970: 332e 3529 3a0a 2020 2020 6966 206c 656e  3.5):.    if len
+0001e980: 2864 6174 6166 7261 6d65 2e73 6861 7065  (dataframe.shape
+0001e990: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+0001e9a0: 6461 7461 6672 616d 6520 3d20 6461 7461  dataframe = data
+0001e9b0: 6672 616d 655b 3a2c 4e6f 6e65 5d0a 2020  frame[:,None].  
+0001e9c0: 2020 6d65 6469 616e 203d 206e 702e 6d65    median = np.me
+0001e9d0: 6469 616e 2864 6174 6166 7261 6d65 2c20  dian(dataframe, 
+0001e9e0: 6178 6973 3d30 290a 2020 2020 6469 6666  axis=0).    diff
+0001e9f0: 203d 206e 702e 7375 6d28 2864 6174 6166   = np.sum((dataf
+0001ea00: 7261 6d65 202d 206d 6564 6961 6e29 2a2a  rame - median)**
+0001ea10: 322c 2061 7869 733d 2d31 290a 2020 2020  2, axis=-1).    
+0001ea20: 6469 6666 203d 206e 702e 7371 7274 2864  diff = np.sqrt(d
+0001ea30: 6966 6629 0a20 2020 206d 6564 5f61 6273  iff).    med_abs
+0001ea40: 5f64 6576 6961 7469 6f6e 203d 206e 702e  _deviation = np.
+0001ea50: 6d65 6469 616e 2864 6966 6629 0a0a 2020  median(diff)..  
+0001ea60: 2020 6d6f 6469 6669 6564 5f7a 5f73 636f    modified_z_sco
+0001ea70: 7265 203d 2030 2e36 3734 3520 2a20 6469  re = 0.6745 * di
+0001ea80: 6666 202f 206d 6564 5f61 6273 5f64 6576  ff / med_abs_dev
+0001ea90: 6961 7469 6f6e 0a20 2020 2072 6574 7572  iation.    retur
+0001eaa0: 6e20 6d6f 6469 6669 6564 5f7a 5f73 636f  n modified_z_sco
+0001eab0: 7265 203e 2074 6872 6573 680a 0a64 6566  re > thresh..def
+0001eac0: 2045 4441 5f66 696e 645f 6f75 746c 6965   EDA_find_outlie
+0001ead0: 7273 2864 662c 2063 6f6c 2c20 7468 7265  rs(df, col, thre
+0001eae0: 7368 3d35 293a 0a20 2020 2022 2222 0a20  sh=5):.    """. 
+0001eaf0: 2020 2022 2222 0a20 2020 2023 2323 2323     """.    #####
+0001eb00: 2323 2046 696e 6473 204f 7574 6c69 6572  ## Finds Outlier
+0001eb10: 7320 616e 6420 6d61 726b 7320 7468 656d  s and marks them
+0001eb20: 2061 7320 2754 7275 6527 2069 6620 7468   as 'True' if th
+0001eb30: 6579 2061 7265 206f 7574 6c69 6572 730a  ey are outliers.
+0001eb40: 2020 2020 2323 2323 2323 2320 4461 7461      ####### Data
+0001eb50: 6672 616d 6520 7265 6665 7273 2074 6f20  frame refers to 
+0001eb60: 7468 6520 696e 7075 7420 6461 7461 6672  the input datafr
+0001eb70: 616d 6520 616e 6420 7468 7265 7368 6f6c  ame and threshol
+0001eb80: 6420 7265 6665 7273 2074 6f20 686f 7720  d refers to how 
+0001eb90: 6661 7220 6672 6f6d 2074 6865 206d 6564  far from the med
+0001eba0: 6961 6e20 6120 7661 6c75 6520 6973 0a20  ian a value is. 
+0001ebb0: 2020 2023 2323 2323 2323 2049 2061 6d20     ####### I am 
+0001ebc0: 7573 696e 6720 7468 6520 4d65 6469 616e  using the Median
+0001ebd0: 2041 6273 6f6c 7574 6520 4465 7669 6174   Absolute Deviat
+0001ebe0: 696f 6e20 4d65 7468 6f64 2028 4d41 4444  ion Method (MADD
+0001ebf0: 2920 746f 2066 696e 6420 4f75 746c 6965  ) to find Outlie
+0001ec00: 7273 2068 6572 650a 2020 2020 6d61 736b  rs here.    mask
+0001ec10: 5f6f 7574 6c69 6572 7320 3d20 6973 5f6f  _outliers = is_o
+0001ec20: 7574 6c69 6572 2864 665b 636f 6c5d 2c74  utlier(df[col],t
+0001ec30: 6872 6573 683d 7468 7265 7368 292e 6173  hresh=thresh).as
+0001ec40: 7479 7065 2869 6e74 290a 2020 2020 7265  type(int).    re
+0001ec50: 7475 726e 2064 662e 696c 6f63 5b6e 702e  turn df.iloc[np.
+0001ec60: 7768 6572 6528 6d61 736b 5f6f 7574 6c69  where(mask_outli
+0001ec70: 6572 733e 3029 5d0a 2323 2323 2323 2323  ers>0)].########
+0001ec80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ec90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001eca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001ecb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ecc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ecd0: 2323 2323 2323 0a64 6566 206f 7574 6c69  ######.def outli
-0001ece0: 6572 5f64 6574 6572 6d69 6e65 5f74 6872  er_determine_thr
-0001ecf0: 6573 686f 6c64 2864 662c 2063 6f6c 293a  eshold(df, col):
-0001ed00: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
-0001ed10: 7320 6675 6e63 7469 6f6e 2061 7574 6f6d  s function autom
-0001ed20: 6174 6963 616c 6c79 2064 6574 6572 6d69  atically determi
-0001ed30: 6e65 7320 7468 6520 7269 6768 7420 7468  nes the right th
-0001ed40: 7265 7368 6f6c 6420 666f 7220 7468 6520  reshold for the 
-0001ed50: 6461 7461 6672 616d 6520 616e 6420 636f  dataframe and co
-0001ed60: 6c75 6d6e 2e0a 2020 2020 5468 7265 7368  lumn..    Thresh
-0001ed70: 6f6c 6420 6973 2075 7365 6420 746f 2064  old is used to d
-0001ed80: 6574 6572 6d69 6e65 2068 6f77 206d 616e  etermine how man
-0001ed90: 7920 6f75 746c 6965 7273 2077 6520 7368  y outliers we sh
-0001eda0: 6f75 6c64 2064 6574 6563 7420 696e 2074  ould detect in t
-0001edb0: 6865 2073 6572 6965 732e 0a20 2020 2041  he series..    A
-0001edc0: 206c 6f77 2074 6872 6573 686f 6c64 2077   low threshold w
-0001edd0: 696c 6c20 7265 7375 6c74 2069 6e20 746f  ill result in to
-0001ede0: 6f20 6d61 6e79 206f 7574 6c69 6572 7320  o many outliers 
-0001edf0: 616e 6420 6120 7665 7279 2068 6967 6820  and a very high 
-0001ee00: 7468 7265 7368 6f6c 6420 7769 6c6c 206e  threshold will n
-0001ee10: 6f74 2066 696e 6420 616e 792e 0a20 2020  ot find any..   
-0001ee20: 2054 6869 7320 6c6f 6f70 7320 756e 7469   This loops unti
-0001ee30: 6c20 6974 2066 696e 6473 206c 6573 7320  l it finds less 
-0001ee40: 7468 616e 2031 3020 7469 6d65 7320 6f72  than 10 times or
-0001ee50: 206d 6178 696d 756d 2031 2520 6f66 2064   maximum 1% of d
-0001ee60: 6174 6120 6265 696e 6720 6f75 746c 6965  ata being outlie
-0001ee70: 7273 2e0a 2020 2020 2222 220a 2020 2020  rs..    """.    
-0001ee80: 6466 203d 2064 662e 636f 7079 2864 6565  df = df.copy(dee
-0001ee90: 703d 5472 7565 290a 2020 2020 6b65 6570  p=True).    keep
-0001eea0: 5f6c 6f6f 7069 6e67 203d 2054 7275 650a  _looping = True.
-0001eeb0: 2020 2020 6e75 6d62 6572 5f6f 665f 6c6f      number_of_lo
-0001eec0: 6f70 7320 3d20 310a 2020 2020 7468 7265  ops = 1.    thre
-0001eed0: 7368 203d 2035 0a20 2020 2077 6869 6c65  sh = 5.    while
-0001eee0: 206b 6565 705f 6c6f 6f70 696e 673a 0a20   keep_looping:. 
-0001eef0: 2020 2020 2020 2069 6620 6e75 6d62 6572         if number
-0001ef00: 5f6f 665f 6c6f 6f70 7320 3e3d 2031 303a  _of_loops >= 10:
-0001ef10: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
-0001ef20: 616b 0a20 2020 2020 2020 206d 6173 6b5f  ak.        mask_
-0001ef30: 6f75 746c 6965 7273 203d 2069 735f 6f75  outliers = is_ou
-0001ef40: 746c 6965 7228 6466 5b63 6f6c 5d2c 2074  tlier(df[col], t
-0001ef50: 6872 6573 683d 7468 7265 7368 292e 6173  hresh=thresh).as
-0001ef60: 7479 7065 2869 6e74 290a 2020 2020 2020  type(int).      
-0001ef70: 2020 6466 6f75 745f 696e 6465 7820 3d20    dfout_index = 
-0001ef80: 6466 2e69 6c6f 635b 6e70 2e77 6865 7265  df.iloc[np.where
-0001ef90: 286d 6173 6b5f 6f75 746c 6965 7273 3e30  (mask_outliers>0
-0001efa0: 295d 2e69 6e64 6578 0a20 2020 2020 2020  )].index.       
-0001efb0: 2070 6374 5f6f 7574 6c69 6572 7320 3d20   pct_outliers = 
-0001efc0: 6c65 6e28 6466 6f75 745f 696e 6465 7829  len(dfout_index)
-0001efd0: 2f6c 656e 2864 6629 0a20 2020 2020 2020  /len(df).       
-0001efe0: 2069 6620 7063 745f 6f75 746c 6965 7273   if pct_outliers
-0001eff0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0001f000: 2020 2069 6620 7468 7265 7368 203e 2035     if thresh > 5
-0001f010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f020: 2020 7468 7265 7368 203d 2074 6872 6573    thresh = thres
-0001f030: 6820 2d20 350a 2020 2020 2020 2020 2020  h - 5.          
-0001f040: 2020 656c 6966 2074 6872 6573 6820 3d3d    elif thresh ==
-0001f050: 2035 3a0a 2020 2020 2020 2020 2020 2020   5:.            
-0001f060: 2020 2020 7265 7475 726e 2074 6872 6573      return thres
-0001f070: 680a 2020 2020 2020 2020 2020 2020 656c  h.            el
-0001f080: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001f090: 2020 2020 7468 7265 7368 203d 2074 6872      thresh = thr
-0001f0a0: 6573 6820 2d20 310a 2020 2020 2020 2020  esh - 1.        
-0001f0b0: 656c 6966 2020 7063 745f 6f75 746c 6965  elif  pct_outlie
-0001f0c0: 7273 203c 3d20 302e 3031 3a0a 2020 2020  rs <= 0.01:.    
-0001f0d0: 2020 2020 2020 2020 6b65 6570 5f6c 6f6f          keep_loo
-0001f0e0: 7069 6e67 203d 2046 616c 7365 0a20 2020  ping = False.   
-0001f0f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001f100: 2020 2020 2020 2074 6872 6573 685f 6d75         thresh_mu
-0001f110: 6c74 6970 6c69 6572 203d 2069 6e74 2828  ltiplier = int((
-0001f120: 7063 745f 6f75 746c 6965 7273 2f30 2e30  pct_outliers/0.0
-0001f130: 3129 2a30 2e35 290a 2020 2020 2020 2020  1)*0.5).        
-0001f140: 2020 2020 7468 7265 7368 203d 2074 6872      thresh = thr
-0001f150: 6573 682a 7468 7265 7368 5f6d 756c 7469  esh*thresh_multi
-0001f160: 706c 6965 720a 2020 2020 2020 2020 6e75  plier.        nu
-0001f170: 6d62 6572 5f6f 665f 6c6f 6f70 7320 2b3d  mber_of_loops +=
-0001f180: 2031 0a20 2020 2070 7269 6e74 2827 2020   1.    print('  
-0001f190: 2020 2573 204f 7574 6c69 6572 2074 6872    %s Outlier thr
-0001f1a0: 6573 686f 6c64 203d 2025 6427 2025 2863  eshold = %d' %(c
-0001f1b0: 6f6c 2c20 7468 7265 7368 2929 0a20 2020  ol, thresh)).   
-0001f1c0: 2072 6574 7572 6e20 7468 7265 7368 0a0a   return thresh..
-0001f1d0: 6672 6f6d 2063 6f6c 6c65 6374 696f 6e73  from collections
-0001f1e0: 2069 6d70 6f72 7420 436f 756e 7465 720a   import Counter.
-0001f1f0: 6465 6620 4645 5f66 696e 645f 616e 645f  def FE_find_and_
-0001f200: 6361 705f 6f75 746c 6965 7273 2864 662c  cap_outliers(df,
-0001f210: 2066 6561 7475 7265 732c 2064 726f 703d   features, drop=
-0001f220: 4661 6c73 652c 2076 6572 626f 7365 3d46  False, verbose=F
-0001f230: 616c 7365 293a 0a20 2020 2022 2222 0a20  alse):.    """. 
-0001f240: 2020 2046 4520 6174 2074 6865 2062 6567     FE at the beg
-0001f250: 696e 6e69 6e67 206f 6620 6675 6e63 7469  inning of functi
-0001f260: 6f6e 206e 616d 6520 7374 616e 6473 2066  on name stands f
-0001f270: 6f72 2046 6561 7475 7265 2045 6e67 696e  or Feature Engin
-0001f280: 6565 7269 6e67 2e20 4645 2066 756e 6374  eering. FE funct
-0001f290: 696f 6e73 2061 6464 206f 7220 6472 6f70  ions add or drop
-0001f2a0: 2066 6561 7475 7265 732e 0a20 2020 2023   features..    #
+0001ecc0: 2323 2323 2323 2323 2323 230a 6465 6620  ###########.def 
+0001ecd0: 6f75 746c 6965 725f 6465 7465 726d 696e  outlier_determin
+0001ece0: 655f 7468 7265 7368 6f6c 6428 6466 2c20  e_threshold(df, 
+0001ecf0: 636f 6c29 3a0a 2020 2020 2222 220a 2020  col):.    """.  
+0001ed00: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+0001ed10: 6175 746f 6d61 7469 6361 6c6c 7920 6465  automatically de
+0001ed20: 7465 726d 696e 6573 2074 6865 2072 6967  termines the rig
+0001ed30: 6874 2074 6872 6573 686f 6c64 2066 6f72  ht threshold for
+0001ed40: 2074 6865 2064 6174 6166 7261 6d65 2061   the dataframe a
+0001ed50: 6e64 2063 6f6c 756d 6e2e 0a20 2020 2054  nd column..    T
+0001ed60: 6872 6573 686f 6c64 2069 7320 7573 6564  hreshold is used
+0001ed70: 2074 6f20 6465 7465 726d 696e 6520 686f   to determine ho
+0001ed80: 7720 6d61 6e79 206f 7574 6c69 6572 7320  w many outliers 
+0001ed90: 7765 2073 686f 756c 6420 6465 7465 6374  we should detect
+0001eda0: 2069 6e20 7468 6520 7365 7269 6573 2e0a   in the series..
+0001edb0: 2020 2020 4120 6c6f 7720 7468 7265 7368      A low thresh
+0001edc0: 6f6c 6420 7769 6c6c 2072 6573 756c 7420  old will result 
+0001edd0: 696e 2074 6f6f 206d 616e 7920 6f75 746c  in too many outl
+0001ede0: 6965 7273 2061 6e64 2061 2076 6572 7920  iers and a very 
+0001edf0: 6869 6768 2074 6872 6573 686f 6c64 2077  high threshold w
+0001ee00: 696c 6c20 6e6f 7420 6669 6e64 2061 6e79  ill not find any
+0001ee10: 2e0a 2020 2020 5468 6973 206c 6f6f 7073  ..    This loops
+0001ee20: 2075 6e74 696c 2069 7420 6669 6e64 7320   until it finds 
+0001ee30: 6c65 7373 2074 6861 6e20 3130 2074 696d  less than 10 tim
+0001ee40: 6573 206f 7220 6d61 7869 6d75 6d20 3125  es or maximum 1%
+0001ee50: 206f 6620 6461 7461 2062 6569 6e67 206f   of data being o
+0001ee60: 7574 6c69 6572 732e 0a20 2020 2022 2222  utliers..    """
+0001ee70: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
+0001ee80: 7928 6465 6570 3d54 7275 6529 0a20 2020  y(deep=True).   
+0001ee90: 206b 6565 705f 6c6f 6f70 696e 6720 3d20   keep_looping = 
+0001eea0: 5472 7565 0a20 2020 206e 756d 6265 725f  True.    number_
+0001eeb0: 6f66 5f6c 6f6f 7073 203d 2031 0a20 2020  of_loops = 1.   
+0001eec0: 2074 6872 6573 6820 3d20 350a 2020 2020   thresh = 5.    
+0001eed0: 7768 696c 6520 6b65 6570 5f6c 6f6f 7069  while keep_loopi
+0001eee0: 6e67 3a0a 2020 2020 2020 2020 6966 206e  ng:.        if n
+0001eef0: 756d 6265 725f 6f66 5f6c 6f6f 7073 203e  umber_of_loops >
+0001ef00: 3d20 3130 3a0a 2020 2020 2020 2020 2020  = 10:.          
+0001ef10: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0001ef20: 6d61 736b 5f6f 7574 6c69 6572 7320 3d20  mask_outliers = 
+0001ef30: 6973 5f6f 7574 6c69 6572 2864 665b 636f  is_outlier(df[co
+0001ef40: 6c5d 2c20 7468 7265 7368 3d74 6872 6573  l], thresh=thres
+0001ef50: 6829 2e61 7374 7970 6528 696e 7429 0a20  h).astype(int). 
+0001ef60: 2020 2020 2020 2064 666f 7574 5f69 6e64         dfout_ind
+0001ef70: 6578 203d 2064 662e 696c 6f63 5b6e 702e  ex = df.iloc[np.
+0001ef80: 7768 6572 6528 6d61 736b 5f6f 7574 6c69  where(mask_outli
+0001ef90: 6572 733e 3029 5d2e 696e 6465 780a 2020  ers>0)].index.  
+0001efa0: 2020 2020 2020 7063 745f 6f75 746c 6965        pct_outlie
+0001efb0: 7273 203d 206c 656e 2864 666f 7574 5f69  rs = len(dfout_i
+0001efc0: 6e64 6578 292f 6c65 6e28 6466 290a 2020  ndex)/len(df).  
+0001efd0: 2020 2020 2020 6966 2070 6374 5f6f 7574        if pct_out
+0001efe0: 6c69 6572 7320 3d3d 2030 3a0a 2020 2020  liers == 0:.    
+0001eff0: 2020 2020 2020 2020 6966 2074 6872 6573          if thres
+0001f000: 6820 3e20 353a 0a20 2020 2020 2020 2020  h > 5:.         
+0001f010: 2020 2020 2020 2074 6872 6573 6820 3d20         thresh = 
+0001f020: 7468 7265 7368 202d 2035 0a20 2020 2020  thresh - 5.     
+0001f030: 2020 2020 2020 2065 6c69 6620 7468 7265         elif thre
+0001f040: 7368 203d 3d20 353a 0a20 2020 2020 2020  sh == 5:.       
+0001f050: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f060: 7468 7265 7368 0a20 2020 2020 2020 2020  thresh.         
+0001f070: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001f080: 2020 2020 2020 2020 2074 6872 6573 6820           thresh 
+0001f090: 3d20 7468 7265 7368 202d 2031 0a20 2020  = thresh - 1.   
+0001f0a0: 2020 2020 2065 6c69 6620 2070 6374 5f6f       elif  pct_o
+0001f0b0: 7574 6c69 6572 7320 3c3d 2030 2e30 313a  utliers <= 0.01:
+0001f0c0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+0001f0d0: 705f 6c6f 6f70 696e 6720 3d20 4661 6c73  p_looping = Fals
+0001f0e0: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+0001f0f0: 2020 2020 2020 2020 2020 2020 7468 7265              thre
+0001f100: 7368 5f6d 756c 7469 706c 6965 7220 3d20  sh_multiplier = 
+0001f110: 696e 7428 2870 6374 5f6f 7574 6c69 6572  int((pct_outlier
+0001f120: 732f 302e 3031 292a 302e 3529 0a20 2020  s/0.01)*0.5).   
+0001f130: 2020 2020 2020 2020 2074 6872 6573 6820           thresh 
+0001f140: 3d20 7468 7265 7368 2a74 6872 6573 685f  = thresh*thresh_
+0001f150: 6d75 6c74 6970 6c69 6572 0a20 2020 2020  multiplier.     
+0001f160: 2020 206e 756d 6265 725f 6f66 5f6c 6f6f     number_of_loo
+0001f170: 7073 202b 3d20 310a 2020 2020 7072 696e  ps += 1.    prin
+0001f180: 7428 2720 2020 2025 7320 4f75 746c 6965  t('    %s Outlie
+0001f190: 7220 7468 7265 7368 6f6c 6420 3d20 2564  r threshold = %d
+0001f1a0: 2720 2528 636f 6c2c 2074 6872 6573 6829  ' %(col, thresh)
+0001f1b0: 290a 2020 2020 7265 7475 726e 2074 6872  ).    return thr
+0001f1c0: 6573 680a 0a66 726f 6d20 636f 6c6c 6563  esh..from collec
+0001f1d0: 7469 6f6e 7320 696d 706f 7274 2043 6f75  tions import Cou
+0001f1e0: 6e74 6572 0a64 6566 2046 455f 6669 6e64  nter.def FE_find
+0001f1f0: 5f61 6e64 5f63 6170 5f6f 7574 6c69 6572  _and_cap_outlier
+0001f200: 7328 6466 2c20 6665 6174 7572 6573 2c20  s(df, features, 
+0001f210: 6472 6f70 3d46 616c 7365 2c20 7665 7262  drop=False, verb
+0001f220: 6f73 653d 4661 6c73 6529 3a0a 2020 2020  ose=False):.    
+0001f230: 2222 220a 2020 2020 4645 2061 7420 7468  """.    FE at th
+0001f240: 6520 6265 6769 6e6e 696e 6720 6f66 2066  e beginning of f
+0001f250: 756e 6374 696f 6e20 6e61 6d65 2073 7461  unction name sta
+0001f260: 6e64 7320 666f 7220 4665 6174 7572 6520  nds for Feature 
+0001f270: 456e 6769 6e65 6572 696e 672e 2046 4520  Engineering. FE 
+0001f280: 6675 6e63 7469 6f6e 7320 6164 6420 6f72  functions add or
+0001f290: 2064 726f 7020 6665 6174 7572 6573 2e0a   drop features..
+0001f2a0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
 0001f2b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f2c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f2d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f2e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f2f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f300: 2323 2323 2323 2323 0a20 2020 2054 7970  ########.    Typ
-0001f310: 6963 616c 6c79 2077 6520 7468 696e 6b20  ically we think 
-0001f320: 6f66 206f 7574 6c69 6572 7320 6173 2062  of outliers as b
-0001f330: 6569 6e67 206f 6273 6572 7661 7469 6f6e  eing observation
-0001f340: 7320 6265 796f 6e64 2074 6865 2031 2e35  s beyond the 1.5
-0001f350: 2049 6e74 6572 2051 7561 7274 696c 6520   Inter Quartile 
-0001f360: 5261 6e67 6520 2849 5152 290a 2020 2020  Range (IQR).    
-0001f370: 4275 7420 7468 6973 2066 756e 6374 696f  But this functio
-0001f380: 6e20 7769 6c6c 2061 6c6c 6f77 2079 6f75  n will allow you
-0001f390: 2074 6f20 6361 7020 616e 7920 6f62 7365   to cap any obse
-0001f3a0: 7276 6174 696f 6e20 7573 696e 6720 4d41  rvation using MA
-0001f3b0: 4444 206d 6574 686f 643a 0a20 2020 2020  DD method:.     
-0001f3c0: 2020 204d 4144 443a 204d 6564 6961 6e20     MADD: Median 
-0001f3d0: 4162 736f 6c75 7465 2044 6576 6961 7469  Absolute Deviati
-0001f3e0: 6f6e 204d 6574 686f 6420 2d20 6974 2773  on Method - it's
-0001f3f0: 2061 2066 6173 7420 616e 6420 6561 7379   a fast and easy
-0001f400: 206d 6574 686f 6420 746f 2066 696e 6420   method to find 
-0001f410: 6f75 746c 6965 7273 2e0a 2020 2020 496e  outliers..    In
-0001f420: 2061 6464 6974 696f 6e2c 2074 6869 7320   addition, this 
-0001f430: 7574 696c 6974 7920 6175 746f 6d61 7469  utility automati
-0001f440: 6361 6c6c 7920 7365 6c65 6374 7320 7468  cally selects th
-0001f450: 6520 7661 6c75 6520 746f 2063 6170 2069  e value to cap i
-0001f460: 7420 6174 2e0a 2020 2020 2020 2020 202d  t at..         -
-0001f470: 2d20 5468 6520 7661 6c75 6520 746f 2062  - The value to b
-0001f480: 6520 6361 7070 6564 2069 7320 6261 7365  e capped is base
-0001f490: 6420 6f6e 206d 6178 696d 756d 2031 2520  d on maximum 1% 
-0001f4a0: 6f66 2064 6174 6120 6265 696e 6720 6f75  of data being ou
-0001f4b0: 746c 6965 7273 2e0a 2020 2020 4974 2061  tliers..    It a
-0001f4c0: 7574 6f6d 6174 6963 616c 6c79 2064 6574  utomatically det
-0001f4d0: 6572 6d69 6e65 7320 686f 7720 6661 7220  ermines how far 
-0001f4e0: 6177 6179 2066 726f 6d20 6d65 6469 616e  away from median
-0001f4f0: 2074 6865 2064 6174 6120 706f 696e 7420   the data point 
-0001f500: 6e65 6564 7320 746f 2062 6520 666f 7220  needs to be for 
-0001f510: 6974 2074 6f20 6361 6c6c 6564 2061 6e20  it to called an 
-0001f520: 6f75 746c 6965 722e 0a20 2020 2020 2020  outlier..       
-0001f530: 2020 2d2d 2069 7420 7573 6573 2061 2074    -- it uses a t
-0001f540: 6872 6573 6820 6e75 6d62 6572 3a20 7468  hresh number: th
-0001f550: 6520 6c6f 7765 7220 6974 2069 732c 206d  e lower it is, m
-0001f560: 6f72 6520 6f75 746c 6965 7273 2e20 4974  ore outliers. It
-0001f570: 2073 7461 7274 7320 6174 2035 206f 7220   starts at 5 or 
-0001f580: 6869 6768 6572 2061 7320 7468 7265 7368  higher as thresh
-0001f590: 6f6c 6420 7661 6c75 652e 0a20 2020 204e  old value..    N
-0001f5a0: 6f74 6963 6520 7468 6174 2069 7420 646f  otice that it do
-0001f5b0: 6573 206e 6f74 2075 7365 2061 206c 6f77  es not use a low
-0001f5c0: 6572 2062 6f75 6e64 2074 6f20 6669 6e64  er bound to find
-0001f5d0: 2074 6f6f 206c 6f77 206f 7574 6c69 6572   too low outlier
-0001f5e0: 732e 2054 6861 7420 796f 7520 6861 7665  s. That you have
-0001f5f0: 2074 6f20 646f 2074 6861 7420 796f 7572   to do that your
-0001f600: 7365 6c66 2e0a 2020 2020 2323 2323 2323  self..    ######
+0001f2f0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
+0001f300: 2020 5479 7069 6361 6c6c 7920 7765 2074    Typically we t
+0001f310: 6869 6e6b 206f 6620 6f75 746c 6965 7273  hink of outliers
+0001f320: 2061 7320 6265 696e 6720 6f62 7365 7276   as being observ
+0001f330: 6174 696f 6e73 2062 6579 6f6e 6420 7468  ations beyond th
+0001f340: 6520 312e 3520 496e 7465 7220 5175 6172  e 1.5 Inter Quar
+0001f350: 7469 6c65 2052 616e 6765 2028 4951 5229  tile Range (IQR)
+0001f360: 0a20 2020 2042 7574 2074 6869 7320 6675  .    But this fu
+0001f370: 6e63 7469 6f6e 2077 696c 6c20 616c 6c6f  nction will allo
+0001f380: 7720 796f 7520 746f 2063 6170 2061 6e79  w you to cap any
+0001f390: 206f 6273 6572 7661 7469 6f6e 2075 7369   observation usi
+0001f3a0: 6e67 204d 4144 4420 6d65 7468 6f64 3a0a  ng MADD method:.
+0001f3b0: 2020 2020 2020 2020 4d41 4444 3a20 4d65          MADD: Me
+0001f3c0: 6469 616e 2041 6273 6f6c 7574 6520 4465  dian Absolute De
+0001f3d0: 7669 6174 696f 6e20 4d65 7468 6f64 202d  viation Method -
+0001f3e0: 2069 7427 7320 6120 6661 7374 2061 6e64   it's a fast and
+0001f3f0: 2065 6173 7920 6d65 7468 6f64 2074 6f20   easy method to 
+0001f400: 6669 6e64 206f 7574 6c69 6572 732e 0a20  find outliers.. 
+0001f410: 2020 2049 6e20 6164 6469 7469 6f6e 2c20     In addition, 
+0001f420: 7468 6973 2075 7469 6c69 7479 2061 7574  this utility aut
+0001f430: 6f6d 6174 6963 616c 6c79 2073 656c 6563  omatically selec
+0001f440: 7473 2074 6865 2076 616c 7565 2074 6f20  ts the value to 
+0001f450: 6361 7020 6974 2061 742e 0a20 2020 2020  cap it at..     
+0001f460: 2020 2020 2d2d 2054 6865 2076 616c 7565      -- The value
+0001f470: 2074 6f20 6265 2063 6170 7065 6420 6973   to be capped is
+0001f480: 2062 6173 6564 206f 6e20 6d61 7869 6d75   based on maximu
+0001f490: 6d20 3125 206f 6620 6461 7461 2062 6569  m 1% of data bei
+0001f4a0: 6e67 206f 7574 6c69 6572 732e 0a20 2020  ng outliers..   
+0001f4b0: 2049 7420 6175 746f 6d61 7469 6361 6c6c   It automaticall
+0001f4c0: 7920 6465 7465 726d 696e 6573 2068 6f77  y determines how
+0001f4d0: 2066 6172 2061 7761 7920 6672 6f6d 206d   far away from m
+0001f4e0: 6564 6961 6e20 7468 6520 6461 7461 2070  edian the data p
+0001f4f0: 6f69 6e74 206e 6565 6473 2074 6f20 6265  oint needs to be
+0001f500: 2066 6f72 2069 7420 746f 2063 616c 6c65   for it to calle
+0001f510: 6420 616e 206f 7574 6c69 6572 2e0a 2020  d an outlier..  
+0001f520: 2020 2020 2020 202d 2d20 6974 2075 7365         -- it use
+0001f530: 7320 6120 7468 7265 7368 206e 756d 6265  s a thresh numbe
+0001f540: 723a 2074 6865 206c 6f77 6572 2069 7420  r: the lower it 
+0001f550: 6973 2c20 6d6f 7265 206f 7574 6c69 6572  is, more outlier
+0001f560: 732e 2049 7420 7374 6172 7473 2061 7420  s. It starts at 
+0001f570: 3520 6f72 2068 6967 6865 7220 6173 2074  5 or higher as t
+0001f580: 6872 6573 686f 6c64 2076 616c 7565 2e0a  hreshold value..
+0001f590: 2020 2020 4e6f 7469 6365 2074 6861 7420      Notice that 
+0001f5a0: 6974 2064 6f65 7320 6e6f 7420 7573 6520  it does not use 
+0001f5b0: 6120 6c6f 7765 7220 626f 756e 6420 746f  a lower bound to
+0001f5c0: 2066 696e 6420 746f 6f20 6c6f 7720 6f75   find too low ou
+0001f5d0: 746c 6965 7273 2e20 5468 6174 2079 6f75  tliers. That you
+0001f5e0: 2068 6176 6520 746f 2064 6f20 7468 6174   have to do that
+0001f5f0: 2079 6f75 7273 656c 662e 0a20 2020 2023   yourself..    #
+0001f600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f610: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f620: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f630: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f660: 2323 230a 2020 2020 496e 7075 7473 3a0a  ###.    Inputs:.
-0001f670: 2020 2020 6466 203a 2070 616e 6461 7320      df : pandas 
-0001f680: 4461 7461 4672 616d 650a 2020 2020 6665  DataFrame.    fe
-0001f690: 6174 7572 6573 3a20 6120 7369 6e67 6c65  atures: a single
-0001f6a0: 2063 6f6c 756d 6e20 6f72 2061 206c 6973   column or a lis
-0001f6b0: 7420 6f66 2063 6f6c 756d 6e73 2069 6e20  t of columns in 
-0001f6c0: 796f 7572 2044 6174 6146 7261 6d65 0a20  your DataFrame. 
-0001f6d0: 2020 2063 6170 5f61 745f 6e74 685f 6c61     cap_at_nth_la
-0001f6e0: 7267 6573 743a 2064 6566 6175 6c74 2069  rgest: default i
-0001f6f0: 7320 3520 3d20 796f 7520 6361 6e20 7365  s 5 = you can se
-0001f700: 7420 6974 2074 6f20 616e 7920 696e 7465  t it to any inte
-0001f710: 6765 7220 7375 6368 2061 7320 312c 2032  ger such as 1, 2
-0001f720: 2c20 332c 2034 2c20 352c 2065 7463 2e0a  , 3, 4, 5, etc..
-0001f730: 0a20 2020 204f 7574 7075 7473 3a0a 2020  .    Outputs:.  
-0001f740: 2020 6466 3a20 7061 6e64 6173 2044 6174    df: pandas Dat
-0001f750: 6146 7261 6d65 0a20 2020 2049 7420 7265  aFrame.    It re
-0001f760: 7475 726e 7320 7468 6520 7361 6d65 2064  turns the same d
-0001f770: 6174 6166 7261 6d65 2061 7320 796f 7520  ataframe as you 
-0001f780: 696e 7075 7420 756e 6c65 7373 2079 6f75  input unless you
-0001f790: 2063 6861 6e67 6520 6472 6f70 2074 6f20   change drop to 
-0001f7a0: 5472 7565 2069 6e20 7468 6520 696e 7075  True in the inpu
-0001f7b0: 7420 6172 6775 6d65 6e74 2e0a 0a20 2020  t argument...   
-0001f7c0: 204f 7074 696f 6e61 6c6c 792c 2069 7420   Optionally, it 
-0001f7d0: 6361 6e20 6472 6f70 2063 6572 7461 696e  can drop certain
-0001f7e0: 2072 6f77 7320 7468 6174 2068 6176 6520   rows that have 
-0001f7f0: 746f 6f20 6d61 6e79 206f 7574 6c69 6572  too many outlier
-0001f800: 7320 696e 2061 7420 6c65 6173 7420 3320  s in at least 3 
-0001f810: 636f 6c75 6d6e 7320 7369 6d75 6c74 616e  columns simultan
-0001f820: 656f 7573 6c79 2e0a 2020 2020 4966 2064  eously..    If d
-0001f830: 726f 703d 5472 7565 2c20 6974 2077 696c  rop=True, it wil
-0001f840: 6c20 7265 7475 726e 2061 2073 6d61 6c6c  l return a small
-0001f850: 6572 206e 756d 6265 7220 6f66 2072 6f77  er number of row
-0001f860: 7320 696e 2079 6f75 7220 6461 7461 6672  s in your datafr
-0001f870: 616d 6520 7468 616e 2077 6861 7420 796f  ame than what yo
-0001f880: 7520 7365 6e74 2069 6e2e 2042 6520 6361  u sent in. Be ca
-0001f890: 7265 6675 6c21 0a20 2020 2023 2323 2323  reful!.    #####
+0001f650: 2323 2323 2323 2323 0a20 2020 2049 6e70  ########.    Inp
+0001f660: 7574 733a 0a20 2020 2064 6620 3a20 7061  uts:.    df : pa
+0001f670: 6e64 6173 2044 6174 6146 7261 6d65 0a20  ndas DataFrame. 
+0001f680: 2020 2066 6561 7475 7265 733a 2061 2073     features: a s
+0001f690: 696e 676c 6520 636f 6c75 6d6e 206f 7220  ingle column or 
+0001f6a0: 6120 6c69 7374 206f 6620 636f 6c75 6d6e  a list of column
+0001f6b0: 7320 696e 2079 6f75 7220 4461 7461 4672  s in your DataFr
+0001f6c0: 616d 650a 2020 2020 6361 705f 6174 5f6e  ame.    cap_at_n
+0001f6d0: 7468 5f6c 6172 6765 7374 3a20 6465 6661  th_largest: defa
+0001f6e0: 756c 7420 6973 2035 203d 2079 6f75 2063  ult is 5 = you c
+0001f6f0: 616e 2073 6574 2069 7420 746f 2061 6e79  an set it to any
+0001f700: 2069 6e74 6567 6572 2073 7563 6820 6173   integer such as
+0001f710: 2031 2c20 322c 2033 2c20 342c 2035 2c20   1, 2, 3, 4, 5, 
+0001f720: 6574 632e 0a0a 2020 2020 4f75 7470 7574  etc...    Output
+0001f730: 733a 0a20 2020 2064 663a 2070 616e 6461  s:.    df: panda
+0001f740: 7320 4461 7461 4672 616d 650a 2020 2020  s DataFrame.    
+0001f750: 4974 2072 6574 7572 6e73 2074 6865 2073  It returns the s
+0001f760: 616d 6520 6461 7461 6672 616d 6520 6173  ame dataframe as
+0001f770: 2079 6f75 2069 6e70 7574 2075 6e6c 6573   you input unles
+0001f780: 7320 796f 7520 6368 616e 6765 2064 726f  s you change dro
+0001f790: 7020 746f 2054 7275 6520 696e 2074 6865  p to True in the
+0001f7a0: 2069 6e70 7574 2061 7267 756d 656e 742e   input argument.
+0001f7b0: 0a0a 2020 2020 4f70 7469 6f6e 616c 6c79  ..    Optionally
+0001f7c0: 2c20 6974 2063 616e 2064 726f 7020 6365  , it can drop ce
+0001f7d0: 7274 6169 6e20 726f 7773 2074 6861 7420  rtain rows that 
+0001f7e0: 6861 7665 2074 6f6f 206d 616e 7920 6f75  have too many ou
+0001f7f0: 746c 6965 7273 2069 6e20 6174 206c 6561  tliers in at lea
+0001f800: 7374 2033 2063 6f6c 756d 6e73 2073 696d  st 3 columns sim
+0001f810: 756c 7461 6e65 6f75 736c 792e 0a20 2020  ultaneously..   
+0001f820: 2049 6620 6472 6f70 3d54 7275 652c 2069   If drop=True, i
+0001f830: 7420 7769 6c6c 2072 6574 7572 6e20 6120  t will return a 
+0001f840: 736d 616c 6c65 7220 6e75 6d62 6572 206f  smaller number o
+0001f850: 6620 726f 7773 2069 6e20 796f 7572 2064  f rows in your d
+0001f860: 6174 6166 7261 6d65 2074 6861 6e20 7768  ataframe than wh
+0001f870: 6174 2079 6f75 2073 656e 7420 696e 2e20  at you sent in. 
+0001f880: 4265 2063 6172 6566 756c 210a 2020 2020  Be careful!.    
+0001f890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f8b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0001f8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f8e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001f8f0: 2323 2323 0a20 2020 2022 2222 0a20 2020  ####.    """.   
-0001f900: 2064 6620 3d20 6466 2e63 6f70 7928 6465   df = df.copy(de
-0001f910: 6570 3d54 7275 6529 0a20 2020 206f 7574  ep=True).    out
-0001f920: 6c69 6572 5f69 6e64 6963 6573 203d 205b  lier_indices = [
-0001f930: 5d0a 2020 2020 6964 636f 6c20 3d20 2769  ].    idcol = 'i
-0001f940: 6463 6f6c 270a 2020 2020 6466 5b69 6463  dcol'.    df[idc
-0001f950: 6f6c 5d20 3d20 7261 6e67 6528 6c65 6e28  ol] = range(len(
-0001f960: 6466 2929 0a20 2020 2069 6620 6973 696e  df)).    if isin
-0001f970: 7374 616e 6365 2866 6561 7475 7265 732c  stance(features,
-0001f980: 2073 7472 293a 0a20 2020 2020 2020 2066   str):.        f
-0001f990: 6561 7475 7265 7320 3d20 5b66 6561 7475  eatures = [featu
-0001f9a0: 7265 735d 0a20 2020 2023 2069 7465 7261  res].    # itera
-0001f9b0: 7465 206f 7665 7220 6665 6174 7572 6573  te over features
-0001f9c0: 2863 6f6c 756d 6e73 290a 2020 2020 666f  (columns).    fo
-0001f9d0: 7220 636f 6c20 696e 2066 6561 7475 7265  r col in feature
-0001f9e0: 733a 0a20 2020 2020 2020 2023 2044 6574  s:.        # Det
-0001f9f0: 6572 6d69 6e65 2061 206c 6973 7420 6f66  ermine a list of
-0001fa00: 2069 6e64 6963 6573 206f 6620 6f75 746c   indices of outl
-0001fa10: 6965 7273 2066 6f72 2066 6561 7475 7265  iers for feature
-0001fa20: 2063 6f6c 0a20 2020 2020 2020 2074 6872   col.        thr
-0001fa30: 6573 6820 3d20 6f75 746c 6965 725f 6465  esh = outlier_de
-0001fa40: 7465 726d 696e 655f 7468 7265 7368 6f6c  termine_threshol
-0001fa50: 6428 6466 2c20 636f 6c29 0a20 2020 2020  d(df, col).     
-0001fa60: 2020 206d 6173 6b5f 6f75 746c 6965 7273     mask_outliers
-0001fa70: 203d 2069 735f 6f75 746c 6965 7228 6466   = is_outlier(df
-0001fa80: 5b63 6f6c 5d2c 2074 6872 6573 683d 7468  [col], thresh=th
-0001fa90: 7265 7368 292e 6173 7479 7065 2869 6e74  resh).astype(int
-0001faa0: 290a 2020 2020 2020 2020 6466 6f75 745f  ).        dfout_
-0001fab0: 696e 6465 7820 3d20 6466 2e69 6c6f 635b  index = df.iloc[
-0001fac0: 6e70 2e77 6865 7265 286d 6173 6b5f 6f75  np.where(mask_ou
-0001fad0: 746c 6965 7273 3e30 295d 2e69 6e64 6578  tliers>0)].index
-0001fae0: 0a0a 2020 2020 2020 2020 6466 5b27 616e  ..        df['an
-0001faf0: 6f6d 616c 7931 275d 203d 2030 0a20 2020  omaly1'] = 0.   
-0001fb00: 2020 2020 2064 662e 6c6f 635b 6466 6f75       df.loc[dfou
-0001fb10: 745f 696e 6465 7820 2c27 616e 6f6d 616c  t_index ,'anomal
-0001fb20: 7931 275d 203d 2031 0a0a 2020 2020 2020  y1'] = 1..      
-0001fb30: 2020 2323 2320 7468 6973 2069 7320 686f    ### this is ho
-0001fb40: 7720 7468 6520 636f 6c75 6d6e 206c 6f6f  w the column loo
-0001fb50: 6b73 206e 6f77 2062 6566 6f72 6520 6361  ks now before ca
-0001fb60: 7070 696e 6720 6f75 746c 6965 7273 0a20  pping outliers. 
-0001fb70: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-0001fb80: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-0001fb90: 6967 2c20 2861 7831 2c61 7832 2920 3d20  ig, (ax1,ax2) = 
-0001fba0: 706c 742e 7375 6270 6c6f 7473 2831 2c32  plt.subplots(1,2
-0001fbb0: 2c66 6967 7369 7a65 3d28 3132 2c35 2929  ,figsize=(12,5))
-0001fbc0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-0001fbd0: 6f72 7320 3d20 7b30 3a27 626c 7565 272c  ors = {0:'blue',
-0001fbe0: 2031 3a27 7265 6427 7d0a 2020 2020 2020   1:'red'}.      
-0001fbf0: 2020 2020 2020 6178 312e 7363 6174 7465        ax1.scatte
-0001fc00: 7228 6466 5b69 6463 6f6c 5d2c 2064 665b  r(df[idcol], df[
-0001fc10: 636f 6c5d 2c20 633d 6466 5b22 616e 6f6d  col], c=df["anom
-0001fc20: 616c 7931 225d 2e61 7070 6c79 286c 616d  aly1"].apply(lam
-0001fc30: 6264 6120 783a 2063 6f6c 6f72 735b 785d  bda x: colors[x]
-0001fc40: 2929 0a20 2020 2020 2020 2020 2020 2061  )).            a
-0001fc50: 7831 2e73 6574 5f78 6c61 6265 6c28 2752  x1.set_xlabel('R
-0001fc60: 6f77 2049 4427 290a 2020 2020 2020 2020  ow ID').        
-0001fc70: 2020 2020 6178 312e 7365 745f 796c 6162      ax1.set_ylab
-0001fc80: 656c 2827 5461 7267 6574 2076 616c 7565  el('Target value
-0001fc90: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-0001fca0: 6178 312e 7365 745f 7469 746c 6528 2725  ax1.set_title('%
-0001fcb0: 7320 6265 666f 7265 2063 6170 7069 6e67  s before capping
-0001fcc0: 206f 7574 6c69 6572 7327 2025 636f 6c29   outliers' %col)
-0001fcd0: 0a0a 2020 2020 2020 2020 6361 7070 6564  ..        capped
-0001fce0: 5f76 616c 7565 203d 2064 662e 6c6f 635b  _value = df.loc[
-0001fcf0: 6466 6f75 745f 696e 6465 782c 2063 6f6c  dfout_index, col
-0001fd00: 5d2e 6d69 6e28 2920 2323 2074 6869 7320  ].min() ## this 
-0001fd10: 6973 2074 6865 2076 616c 7565 2077 6520  is the value we 
-0001fd20: 6361 7020 6974 2061 6761 696e 7374 0a20  cap it against. 
-0001fd30: 2020 2020 2020 2064 662e 6c6f 635b 6466         df.loc[df
-0001fd40: 6f75 745f 696e 6465 782c 2063 6f6c 5d20  out_index, col] 
-0001fd50: 3d20 2063 6170 7065 645f 7661 6c75 6520  =  capped_value 
-0001fd60: 2323 206d 6178 696d 756d 2076 616c 7565  ## maximum value
-0001fd70: 7320 6172 6520 6e6f 7720 6361 7070 6564  s are now capped
-0001fd80: 0a20 2020 2020 2020 2023 2323 2079 6f75  .        ### you
-0001fd90: 2061 7265 206e 6f77 2067 6f6f 6420 746f   are now good to
-0001fda0: 2067 6f20 2d20 796f 7520 6361 6e20 7368   go - you can sh
-0001fdb0: 6f77 2068 6f77 2074 6865 7920 6172 6520  ow how they are 
-0001fdc0: 6361 7070 6564 2075 7369 6e67 2062 6566  capped using bef
-0001fdd0: 6f72 6520 616e 6420 6166 7465 7220 7069  ore and after pi
-0001fde0: 6373 0a20 2020 2020 2020 2069 6620 7665  cs.        if ve
-0001fdf0: 7262 6f73 653a 0a20 2020 2020 2020 2020  rbose:.         
-0001fe00: 2020 2063 6f6c 6f72 7320 3d20 7b30 3a27     colors = {0:'
-0001fe10: 626c 7565 272c 2031 3a27 7265 6427 7d0a  blue', 1:'red'}.
-0001fe20: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-0001fe30: 7363 6174 7465 7228 6466 5b69 6463 6f6c  scatter(df[idcol
-0001fe40: 5d2c 2064 665b 636f 6c5d 2c20 633d 6466  ], df[col], c=df
-0001fe50: 5b22 616e 6f6d 616c 7931 225d 2e61 7070  ["anomaly1"].app
-0001fe60: 6c79 286c 616d 6264 6120 783a 2063 6f6c  ly(lambda x: col
-0001fe70: 6f72 735b 785d 2929 0a20 2020 2020 2020  ors[x])).       
-0001fe80: 2020 2020 2061 7832 2e73 6574 5f78 6c61       ax2.set_xla
-0001fe90: 6265 6c28 2752 6f77 2049 4427 290a 2020  bel('Row ID').  
-0001fea0: 2020 2020 2020 2020 2020 6178 322e 7365            ax2.se
-0001feb0: 745f 796c 6162 656c 2827 5461 7267 6574  t_ylabel('Target
-0001fec0: 2076 616c 7565 7327 290a 2020 2020 2020   values').      
-0001fed0: 2020 2020 2020 6178 322e 7365 745f 7469        ax2.set_ti
-0001fee0: 746c 6528 2725 7320 6166 7465 7220 6361  tle('%s after ca
-0001fef0: 7070 696e 6720 6f75 746c 6965 7273 2720  pping outliers' 
-0001ff00: 2563 6f6c 290a 0a20 2020 2020 2020 2023  %col)..        #
-0001ff10: 204c 6574 2773 2073 6176 6520 7468 6520   Let's save the 
-0001ff20: 6c69 7374 206f 6620 6f75 746c 6965 7273  list of outliers
-0001ff30: 2061 6e64 2073 6565 2069 6620 7468 6572   and see if ther
-0001ff40: 6520 6172 6520 736f 6d65 2077 6974 6820  e are some with 
-0001ff50: 6f75 746c 6965 7273 2069 6e20 6d75 6c74  outliers in mult
-0001ff60: 6970 6c65 2063 6f6c 756d 6e73 0a20 2020  iple columns.   
-0001ff70: 2020 2020 206f 7574 6c69 6572 5f69 6e64       outlier_ind
-0001ff80: 6963 6573 2e65 7874 656e 6428 6466 6f75  ices.extend(dfou
-0001ff90: 745f 696e 6465 7829 0a0a 2020 2020 2320  t_index)..    # 
-0001ffa0: 7365 6c65 6374 2063 6572 7461 696e 206f  select certain o
-0001ffb0: 6273 6572 7661 7469 6f6e 7320 636f 6e74  bservations cont
-0001ffc0: 6169 6e69 6e67 206d 6f72 6520 7468 616e  aining more than
-0001ffd0: 206f 6e65 206f 7574 6c69 6572 2069 6e20   one outlier in 
-0001ffe0: 3220 636f 6c75 6d6e 7320 6f72 206d 6f72  2 columns or mor
-0001fff0: 652e 2057 6520 6361 6e20 6472 6f70 2074  e. We can drop t
-00020000: 6865 6d21 0a20 2020 206f 7574 6c69 6572  hem!.    outlier
-00020010: 5f69 6e64 6963 6573 203d 2043 6f75 6e74  _indices = Count
-00020020: 6572 286f 7574 6c69 6572 5f69 6e64 6963  er(outlier_indic
-00020030: 6573 290a 2020 2020 6d75 6c74 6970 6c65  es).    multiple
-00020040: 5f6f 7574 6c69 6572 7320 3d20 6c69 7374  _outliers = list
-00020050: 2820 6b20 666f 7220 6b2c 2076 2069 6e20  ( k for k, v in 
-00020060: 6f75 746c 6965 725f 696e 6469 6365 732e  outlier_indices.
-00020070: 6974 656d 7328 2920 6966 2076 203e 2033  items() if v > 3
-00020080: 2029 0a20 2020 2023 2323 206e 6f77 2064   ).    ### now d
-00020090: 726f 7020 7468 6573 6520 726f 7773 2061  rop these rows a
-000200a0: 6c74 6f67 6574 6865 7220 2323 2323 0a20  ltogether ####. 
-000200b0: 2020 2064 6620 3d20 6466 2e64 726f 7028     df = df.drop(
-000200c0: 5b69 6463 6f6c 2c27 616e 6f6d 616c 7931  [idcol,'anomaly1
-000200d0: 275d 2c20 6178 6973 3d31 290a 2020 2020  '], axis=1).    
-000200e0: 6966 2064 726f 703a 0a20 2020 2020 2020  if drop:.       
-000200f0: 2070 7269 6e74 2827 5368 6170 6520 6f66   print('Shape of
-00020100: 2064 6174 6166 7261 6d65 2062 6566 6f72   dataframe befor
-00020110: 6520 6f75 746c 6965 7273 2062 6569 6e67  e outliers being
-00020120: 2064 726f 7070 6564 3a20 2573 2720 2528   dropped: %s' %(
-00020130: 6466 2e73 6861 7065 2c29 290a 2020 2020  df.shape,)).    
-00020140: 2020 2020 6e75 6d62 6572 5f6f 665f 726f      number_of_ro
-00020150: 7773 203d 2064 662e 7368 6170 655b 305d  ws = df.shape[0]
-00020160: 0a20 2020 2020 2020 2064 6620 3d20 6466  .        df = df
-00020170: 2e64 726f 7028 6d75 6c74 6970 6c65 5f6f  .drop(multiple_o
-00020180: 7574 6c69 6572 732c 2061 7869 733d 3029  utliers, axis=0)
-00020190: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-000201a0: 5368 6170 6520 6f66 2064 6174 6166 7261  Shape of datafra
-000201b0: 6d65 2061 6674 6572 206f 7574 6c69 6572  me after outlier
-000201c0: 7320 6265 696e 6720 6472 6f70 7065 643a  s being dropped:
-000201d0: 2025 7327 2025 2864 662e 7368 6170 652c   %s' %(df.shape,
-000201e0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-000201f0: 2827 5c6e 4e75 6d62 6572 5f6f 665f 726f  ('\nNumber_of_ro
-00020200: 7773 2077 6974 6820 6d75 6c74 6970 6c65  ws with multiple
-00020210: 206f 7574 6c69 6572 7320 696e 206d 6f72   outliers in mor
-00020220: 6520 7468 616e 2033 2063 6f6c 756d 6e73  e than 3 columns
-00020230: 2077 6869 6368 2077 6572 6520 6472 6f70   which were drop
-00020240: 7065 6420 3d20 2564 2720 2528 6e75 6d62  ped = %d' %(numb
-00020250: 6572 5f6f 665f 726f 7773 2d64 662e 7368  er_of_rows-df.sh
-00020260: 6170 655b 305d 2929 0a20 2020 2072 6574  ape[0])).    ret
-00020270: 7572 6e20 6466 0a23 2323 2323 2323 2323  urn df.#########
+0001f8e0: 2323 2323 2323 2323 230a 2020 2020 2222  #########.    ""
+0001f8f0: 220a 2020 2020 6466 203d 2064 662e 636f  ".    df = df.co
+0001f900: 7079 2864 6565 703d 5472 7565 290a 2020  py(deep=True).  
+0001f910: 2020 6f75 746c 6965 725f 696e 6469 6365    outlier_indice
+0001f920: 7320 3d20 5b5d 0a20 2020 2069 6463 6f6c  s = [].    idcol
+0001f930: 203d 2027 6964 636f 6c27 0a20 2020 2064   = 'idcol'.    d
+0001f940: 665b 6964 636f 6c5d 203d 2072 616e 6765  f[idcol] = range
+0001f950: 286c 656e 2864 6629 290a 2020 2020 6966  (len(df)).    if
+0001f960: 2069 7369 6e73 7461 6e63 6528 6665 6174   isinstance(feat
+0001f970: 7572 6573 2c20 7374 7229 3a0a 2020 2020  ures, str):.    
+0001f980: 2020 2020 6665 6174 7572 6573 203d 205b      features = [
+0001f990: 6665 6174 7572 6573 5d0a 2020 2020 2320  features].    # 
+0001f9a0: 6974 6572 6174 6520 6f76 6572 2066 6561  iterate over fea
+0001f9b0: 7475 7265 7328 636f 6c75 6d6e 7329 0a20  tures(columns). 
+0001f9c0: 2020 2066 6f72 2063 6f6c 2069 6e20 6665     for col in fe
+0001f9d0: 6174 7572 6573 3a0a 2020 2020 2020 2020  atures:.        
+0001f9e0: 2320 4465 7465 726d 696e 6520 6120 6c69  # Determine a li
+0001f9f0: 7374 206f 6620 696e 6469 6365 7320 6f66  st of indices of
+0001fa00: 206f 7574 6c69 6572 7320 666f 7220 6665   outliers for fe
+0001fa10: 6174 7572 6520 636f 6c0a 2020 2020 2020  ature col.      
+0001fa20: 2020 7468 7265 7368 203d 206f 7574 6c69    thresh = outli
+0001fa30: 6572 5f64 6574 6572 6d69 6e65 5f74 6872  er_determine_thr
+0001fa40: 6573 686f 6c64 2864 662c 2063 6f6c 290a  eshold(df, col).
+0001fa50: 2020 2020 2020 2020 6d61 736b 5f6f 7574          mask_out
+0001fa60: 6c69 6572 7320 3d20 6973 5f6f 7574 6c69  liers = is_outli
+0001fa70: 6572 2864 665b 636f 6c5d 2c20 7468 7265  er(df[col], thre
+0001fa80: 7368 3d74 6872 6573 6829 2e61 7374 7970  sh=thresh).astyp
+0001fa90: 6528 696e 7429 0a20 2020 2020 2020 2064  e(int).        d
+0001faa0: 666f 7574 5f69 6e64 6578 203d 2064 662e  fout_index = df.
+0001fab0: 696c 6f63 5b6e 702e 7768 6572 6528 6d61  iloc[np.where(ma
+0001fac0: 736b 5f6f 7574 6c69 6572 733e 3029 5d2e  sk_outliers>0)].
+0001fad0: 696e 6465 780a 0a20 2020 2020 2020 2064  index..        d
+0001fae0: 665b 2761 6e6f 6d61 6c79 3127 5d20 3d20  f['anomaly1'] = 
+0001faf0: 300a 2020 2020 2020 2020 6466 2e6c 6f63  0.        df.loc
+0001fb00: 5b64 666f 7574 5f69 6e64 6578 202c 2761  [dfout_index ,'a
+0001fb10: 6e6f 6d61 6c79 3127 5d20 3d20 310a 0a20  nomaly1'] = 1.. 
+0001fb20: 2020 2020 2020 2023 2323 2074 6869 7320         ### this 
+0001fb30: 6973 2068 6f77 2074 6865 2063 6f6c 756d  is how the colum
+0001fb40: 6e20 6c6f 6f6b 7320 6e6f 7720 6265 666f  n looks now befo
+0001fb50: 7265 2063 6170 7069 6e67 206f 7574 6c69  re capping outli
+0001fb60: 6572 730a 2020 2020 2020 2020 6966 2076  ers.        if v
+0001fb70: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0001fb80: 2020 2020 6669 672c 2028 6178 312c 6178      fig, (ax1,ax
+0001fb90: 3229 203d 2070 6c74 2e73 7562 706c 6f74  2) = plt.subplot
+0001fba0: 7328 312c 322c 6669 6773 697a 653d 2831  s(1,2,figsize=(1
+0001fbb0: 322c 3529 290a 2020 2020 2020 2020 2020  2,5)).          
+0001fbc0: 2020 636f 6c6f 7273 203d 207b 303a 2762    colors = {0:'b
+0001fbd0: 6c75 6527 2c20 313a 2772 6564 277d 0a20  lue', 1:'red'}. 
+0001fbe0: 2020 2020 2020 2020 2020 2061 7831 2e73             ax1.s
+0001fbf0: 6361 7474 6572 2864 665b 6964 636f 6c5d  catter(df[idcol]
+0001fc00: 2c20 6466 5b63 6f6c 5d2c 2063 3d64 665b  , df[col], c=df[
+0001fc10: 2261 6e6f 6d61 6c79 3122 5d2e 6170 706c  "anomaly1"].appl
+0001fc20: 7928 6c61 6d62 6461 2078 3a20 636f 6c6f  y(lambda x: colo
+0001fc30: 7273 5b78 5d29 290a 2020 2020 2020 2020  rs[x])).        
+0001fc40: 2020 2020 6178 312e 7365 745f 786c 6162      ax1.set_xlab
+0001fc50: 656c 2827 526f 7720 4944 2729 0a20 2020  el('Row ID').   
+0001fc60: 2020 2020 2020 2020 2061 7831 2e73 6574           ax1.set
+0001fc70: 5f79 6c61 6265 6c28 2754 6172 6765 7420  _ylabel('Target 
+0001fc80: 7661 6c75 6573 2729 0a20 2020 2020 2020  values').       
+0001fc90: 2020 2020 2061 7831 2e73 6574 5f74 6974       ax1.set_tit
+0001fca0: 6c65 2827 2573 2062 6566 6f72 6520 6361  le('%s before ca
+0001fcb0: 7070 696e 6720 6f75 746c 6965 7273 2720  pping outliers' 
+0001fcc0: 2563 6f6c 290a 0a20 2020 2020 2020 2063  %col)..        c
+0001fcd0: 6170 7065 645f 7661 6c75 6520 3d20 6466  apped_value = df
+0001fce0: 2e6c 6f63 5b64 666f 7574 5f69 6e64 6578  .loc[dfout_index
+0001fcf0: 2c20 636f 6c5d 2e6d 696e 2829 2023 2320  , col].min() ## 
+0001fd00: 7468 6973 2069 7320 7468 6520 7661 6c75  this is the valu
+0001fd10: 6520 7765 2063 6170 2069 7420 6167 6169  e we cap it agai
+0001fd20: 6e73 740a 2020 2020 2020 2020 6466 2e6c  nst.        df.l
+0001fd30: 6f63 5b64 666f 7574 5f69 6e64 6578 2c20  oc[dfout_index, 
+0001fd40: 636f 6c5d 203d 2020 6361 7070 6564 5f76  col] =  capped_v
+0001fd50: 616c 7565 2023 2320 6d61 7869 6d75 6d20  alue ## maximum 
+0001fd60: 7661 6c75 6573 2061 7265 206e 6f77 2063  values are now c
+0001fd70: 6170 7065 640a 2020 2020 2020 2020 2323  apped.        ##
+0001fd80: 2320 796f 7520 6172 6520 6e6f 7720 676f  # you are now go
+0001fd90: 6f64 2074 6f20 676f 202d 2079 6f75 2063  od to go - you c
+0001fda0: 616e 2073 686f 7720 686f 7720 7468 6579  an show how they
+0001fdb0: 2061 7265 2063 6170 7065 6420 7573 696e   are capped usin
+0001fdc0: 6720 6265 666f 7265 2061 6e64 2061 6674  g before and aft
+0001fdd0: 6572 2070 6963 730a 2020 2020 2020 2020  er pics.        
+0001fde0: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
+0001fdf0: 2020 2020 2020 2020 636f 6c6f 7273 203d          colors =
+0001fe00: 207b 303a 2762 6c75 6527 2c20 313a 2772   {0:'blue', 1:'r
+0001fe10: 6564 277d 0a20 2020 2020 2020 2020 2020  ed'}.           
+0001fe20: 2061 7832 2e73 6361 7474 6572 2864 665b   ax2.scatter(df[
+0001fe30: 6964 636f 6c5d 2c20 6466 5b63 6f6c 5d2c  idcol], df[col],
+0001fe40: 2063 3d64 665b 2261 6e6f 6d61 6c79 3122   c=df["anomaly1"
+0001fe50: 5d2e 6170 706c 7928 6c61 6d62 6461 2078  ].apply(lambda x
+0001fe60: 3a20 636f 6c6f 7273 5b78 5d29 290a 2020  : colors[x])).  
+0001fe70: 2020 2020 2020 2020 2020 6178 322e 7365            ax2.se
+0001fe80: 745f 786c 6162 656c 2827 526f 7720 4944  t_xlabel('Row ID
+0001fe90: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
+0001fea0: 7832 2e73 6574 5f79 6c61 6265 6c28 2754  x2.set_ylabel('T
+0001feb0: 6172 6765 7420 7661 6c75 6573 2729 0a20  arget values'). 
+0001fec0: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
+0001fed0: 6574 5f74 6974 6c65 2827 2573 2061 6674  et_title('%s aft
+0001fee0: 6572 2063 6170 7069 6e67 206f 7574 6c69  er capping outli
+0001fef0: 6572 7327 2025 636f 6c29 0a0a 2020 2020  ers' %col)..    
+0001ff00: 2020 2020 2320 4c65 7427 7320 7361 7665      # Let's save
+0001ff10: 2074 6865 206c 6973 7420 6f66 206f 7574   the list of out
+0001ff20: 6c69 6572 7320 616e 6420 7365 6520 6966  liers and see if
+0001ff30: 2074 6865 7265 2061 7265 2073 6f6d 6520   there are some 
+0001ff40: 7769 7468 206f 7574 6c69 6572 7320 696e  with outliers in
+0001ff50: 206d 756c 7469 706c 6520 636f 6c75 6d6e   multiple column
+0001ff60: 730a 2020 2020 2020 2020 6f75 746c 6965  s.        outlie
+0001ff70: 725f 696e 6469 6365 732e 6578 7465 6e64  r_indices.extend
+0001ff80: 2864 666f 7574 5f69 6e64 6578 290a 0a20  (dfout_index).. 
+0001ff90: 2020 2023 2073 656c 6563 7420 6365 7274     # select cert
+0001ffa0: 6169 6e20 6f62 7365 7276 6174 696f 6e73  ain observations
+0001ffb0: 2063 6f6e 7461 696e 696e 6720 6d6f 7265   containing more
+0001ffc0: 2074 6861 6e20 6f6e 6520 6f75 746c 6965   than one outlie
+0001ffd0: 7220 696e 2032 2063 6f6c 756d 6e73 206f  r in 2 columns o
+0001ffe0: 7220 6d6f 7265 2e20 5765 2063 616e 2064  r more. We can d
+0001fff0: 726f 7020 7468 656d 210a 2020 2020 6f75  rop them!.    ou
+00020000: 746c 6965 725f 696e 6469 6365 7320 3d20  tlier_indices = 
+00020010: 436f 756e 7465 7228 6f75 746c 6965 725f  Counter(outlier_
+00020020: 696e 6469 6365 7329 0a20 2020 206d 756c  indices).    mul
+00020030: 7469 706c 655f 6f75 746c 6965 7273 203d  tiple_outliers =
+00020040: 206c 6973 7428 206b 2066 6f72 206b 2c20   list( k for k, 
+00020050: 7620 696e 206f 7574 6c69 6572 5f69 6e64  v in outlier_ind
+00020060: 6963 6573 2e69 7465 6d73 2829 2069 6620  ices.items() if 
+00020070: 7620 3e20 3320 290a 2020 2020 2323 2320  v > 3 ).    ### 
+00020080: 6e6f 7720 6472 6f70 2074 6865 7365 2072  now drop these r
+00020090: 6f77 7320 616c 746f 6765 7468 6572 2023  ows altogether #
+000200a0: 2323 230a 2020 2020 6466 203d 2064 662e  ###.    df = df.
+000200b0: 6472 6f70 285b 6964 636f 6c2c 2761 6e6f  drop([idcol,'ano
+000200c0: 6d61 6c79 3127 5d2c 2061 7869 733d 3129  maly1'], axis=1)
+000200d0: 0a20 2020 2069 6620 6472 6f70 3a0a 2020  .    if drop:.  
+000200e0: 2020 2020 2020 7072 696e 7428 2753 6861        print('Sha
+000200f0: 7065 206f 6620 6461 7461 6672 616d 6520  pe of dataframe 
+00020100: 6265 666f 7265 206f 7574 6c69 6572 7320  before outliers 
+00020110: 6265 696e 6720 6472 6f70 7065 643a 2025  being dropped: %
+00020120: 7327 2025 2864 662e 7368 6170 652c 2929  s' %(df.shape,))
+00020130: 0a20 2020 2020 2020 206e 756d 6265 725f  .        number_
+00020140: 6f66 5f72 6f77 7320 3d20 6466 2e73 6861  of_rows = df.sha
+00020150: 7065 5b30 5d0a 2020 2020 2020 2020 6466  pe[0].        df
+00020160: 203d 2064 662e 6472 6f70 286d 756c 7469   = df.drop(multi
+00020170: 706c 655f 6f75 746c 6965 7273 2c20 6178  ple_outliers, ax
+00020180: 6973 3d30 290a 2020 2020 2020 2020 7072  is=0).        pr
+00020190: 696e 7428 2753 6861 7065 206f 6620 6461  int('Shape of da
+000201a0: 7461 6672 616d 6520 6166 7465 7220 6f75  taframe after ou
+000201b0: 746c 6965 7273 2062 6569 6e67 2064 726f  tliers being dro
+000201c0: 7070 6564 3a20 2573 2720 2528 6466 2e73  pped: %s' %(df.s
+000201d0: 6861 7065 2c29 290a 2020 2020 2020 2020  hape,)).        
+000201e0: 7072 696e 7428 275c 6e4e 756d 6265 725f  print('\nNumber_
+000201f0: 6f66 5f72 6f77 7320 7769 7468 206d 756c  of_rows with mul
+00020200: 7469 706c 6520 6f75 746c 6965 7273 2069  tiple outliers i
+00020210: 6e20 6d6f 7265 2074 6861 6e20 3320 636f  n more than 3 co
+00020220: 6c75 6d6e 7320 7768 6963 6820 7765 7265  lumns which were
+00020230: 2064 726f 7070 6564 203d 2025 6427 2025   dropped = %d' %
+00020240: 286e 756d 6265 725f 6f66 5f72 6f77 732d  (number_of_rows-
+00020250: 6466 2e73 6861 7065 5b30 5d29 290a 2020  df.shape[0])).  
+00020260: 2020 7265 7475 726e 2064 660a 2323 2323    return df.####
+00020270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020280: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000202a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000202b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000202c0: 2323 2323 2323 2323 0a69 6d70 6f72 7420  ########.import 
-000202d0: 7061 6e64 6173 2061 7320 7064 0a69 6d70  pandas as pd.imp
-000202e0: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-000202f0: 696d 706f 7274 2070 6462 0a66 726f 6d20  import pdb.from 
-00020300: 736b 6c65 6172 6e2e 7574 696c 732e 7661  sklearn.utils.va
-00020310: 6c69 6461 7469 6f6e 2069 6d70 6f72 7420  lidation import 
-00020320: 6368 6563 6b5f 585f 792c 2063 6865 636b  check_X_y, check
-00020330: 5f69 735f 6669 7474 6564 0a66 726f 6d20  _is_fitted.from 
-00020340: 736b 6c65 6172 6e2e 7072 6570 726f 6365  sklearn.preproce
-00020350: 7373 696e 6720 696d 706f 7274 204c 6162  ssing import Lab
-00020360: 656c 456e 636f 6465 720a 6672 6f6d 2063  elEncoder.from c
-00020370: 6f6c 6c65 6374 696f 6e73 2069 6d70 6f72  ollections impor
-00020380: 7420 436f 756e 7465 722c 2064 6566 6175  t Counter, defau
-00020390: 6c74 6469 6374 0a66 726f 6d20 736b 6c65  ltdict.from skle
-000203a0: 6172 6e2e 6261 7365 2069 6d70 6f72 7420  arn.base import 
-000203b0: 4261 7365 4573 7469 6d61 746f 722c 2043  BaseEstimator, C
-000203c0: 6c61 7373 6966 6965 724d 6978 696e 2c20  lassifierMixin, 
-000203d0: 5472 616e 7366 6f72 6d65 724d 6978 696e  TransformerMixin
-000203e0: 0a0a 6672 6f6d 2069 6d62 6c65 6172 6e2e  ..from imblearn.
-000203f0: 6f76 6572 5f73 616d 706c 696e 6720 696d  over_sampling im
-00020400: 706f 7274 2053 4d4f 5445 2c20 5356 4d53  port SMOTE, SVMS
-00020410: 4d4f 5445 0a66 726f 6d20 696d 626c 6561  MOTE.from imblea
-00020420: 726e 2e6f 7665 725f 7361 6d70 6c69 6e67  rn.over_sampling
-00020430: 2069 6d70 6f72 7420 4144 4153 594e 2c20   import ADASYN, 
-00020440: 534d 4f54 454e 430a 0a69 6d70 6f72 7420  SMOTENC..import 
-00020450: 7061 6e64 6173 2061 7320 7064 0a69 6d70  pandas as pd.imp
-00020460: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-00020470: 6672 6f6d 2063 6f6c 6c65 6374 696f 6e73  from collections
-00020480: 2069 6d70 6f72 7420 436f 756e 7465 720a   import Counter.
-00020490: 696d 706f 7274 2077 6172 6e69 6e67 730a  import warnings.
-000204a0: 7761 726e 696e 6773 2e66 696c 7465 7277  warnings.filterw
-000204b0: 6172 6e69 6e67 7328 2269 676e 6f72 6522  arnings("ignore"
-000204c0: 290a 2323 2323 2323 2323 2323 2323 2323  ).##############
+000202b0: 2323 2323 2323 2323 2323 2323 230a 696d  #############.im
+000202c0: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+000202d0: 640a 696d 706f 7274 206e 756d 7079 2061  d.import numpy a
+000202e0: 7320 6e70 0a69 6d70 6f72 7420 7064 620a  s np.import pdb.
+000202f0: 6672 6f6d 2073 6b6c 6561 726e 2e75 7469  from sklearn.uti
+00020300: 6c73 2e76 616c 6964 6174 696f 6e20 696d  ls.validation im
+00020310: 706f 7274 2063 6865 636b 5f58 5f79 2c20  port check_X_y, 
+00020320: 6368 6563 6b5f 6973 5f66 6974 7465 640a  check_is_fitted.
+00020330: 6672 6f6d 2073 6b6c 6561 726e 2e70 7265  from sklearn.pre
+00020340: 7072 6f63 6573 7369 6e67 2069 6d70 6f72  processing impor
+00020350: 7420 4c61 6265 6c45 6e63 6f64 6572 0a66  t LabelEncoder.f
+00020360: 726f 6d20 636f 6c6c 6563 7469 6f6e 7320  rom collections 
+00020370: 696d 706f 7274 2043 6f75 6e74 6572 2c20  import Counter, 
+00020380: 6465 6661 756c 7464 6963 740a 6672 6f6d  defaultdict.from
+00020390: 2073 6b6c 6561 726e 2e62 6173 6520 696d   sklearn.base im
+000203a0: 706f 7274 2042 6173 6545 7374 696d 6174  port BaseEstimat
+000203b0: 6f72 2c20 436c 6173 7369 6669 6572 4d69  or, ClassifierMi
+000203c0: 7869 6e2c 2054 7261 6e73 666f 726d 6572  xin, Transformer
+000203d0: 4d69 7869 6e0a 0a66 726f 6d20 696d 626c  Mixin..from imbl
+000203e0: 6561 726e 2e6f 7665 725f 7361 6d70 6c69  earn.over_sampli
+000203f0: 6e67 2069 6d70 6f72 7420 534d 4f54 452c  ng import SMOTE,
+00020400: 2053 564d 534d 4f54 450a 6672 6f6d 2069   SVMSMOTE.from i
+00020410: 6d62 6c65 6172 6e2e 6f76 6572 5f73 616d  mblearn.over_sam
+00020420: 706c 696e 6720 696d 706f 7274 2041 4441  pling import ADA
+00020430: 5359 4e2c 2053 4d4f 5445 4e43 0a0a 696d  SYN, SMOTENC..im
+00020440: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+00020450: 640a 696d 706f 7274 206e 756d 7079 2061  d.import numpy a
+00020460: 7320 6e70 0a66 726f 6d20 636f 6c6c 6563  s np.from collec
+00020470: 7469 6f6e 7320 696d 706f 7274 2043 6f75  tions import Cou
+00020480: 6e74 6572 0a69 6d70 6f72 7420 7761 726e  nter.import warn
+00020490: 696e 6773 0a77 6172 6e69 6e67 732e 6669  ings.warnings.fi
+000204a0: 6c74 6572 7761 726e 696e 6773 2822 6967  lterwarnings("ig
+000204b0: 6e6f 7265 2229 0a23 2323 2323 2323 2323  nore").#########
+000204c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000204d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000204e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000204f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020510: 2323 230a 696d 706f 7274 2063 6f70 790a  ###.import copy.
-00020520: 6672 6f6d 2073 6b6c 6561 726e 2e63 6c75  from sklearn.clu
-00020530: 7374 6572 2069 6d70 6f72 7420 4b4d 6561  ster import KMea
-00020540: 6e73 0a64 6566 2046 455f 6b6d 6561 6e73  ns.def FE_kmeans
-00020550: 5f72 6573 616d 706c 6572 2878 5f74 7261  _resampler(x_tra
-00020560: 696e 2c20 795f 7472 6169 6e2c 2074 6172  in, y_train, tar
-00020570: 6765 742c 2073 6d6f 7465 3d22 222c 2076  get, smote="", v
-00020580: 6572 626f 7365 3d30 293a 0a20 2020 2022  erbose=0):.    "
-00020590: 2222 0a20 2020 2054 6869 7320 6675 6e63  "".    This func
-000205a0: 7469 6f6e 2063 6f6e 7665 7274 7320 6120  tion converts a 
-000205b0: 5265 6772 6573 7369 6f6e 2070 726f 626c  Regression probl
-000205c0: 656d 2069 6e74 6f20 6120 436c 6173 7369  em into a Classi
-000205d0: 6669 6361 7469 6f6e 2070 726f 626c 656d  fication problem
-000205e0: 2074 6f20 656e 6162 6c65 2053 4d4f 5445   to enable SMOTE
-000205f0: 210a 2020 2020 4974 2069 7320 6120 7665  !.    It is a ve
-00020600: 7279 2073 696d 706c 6520 7761 7920 746f  ry simple way to
-00020610: 2073 656e 6420 796f 7572 2078 5f74 7261   send your x_tra
-00020620: 696e 2c20 795f 7472 6169 6e20 696e 2061  in, y_train in a
-00020630: 6e64 2067 6574 2062 6163 6b20 616e 206f  nd get back an o
-00020640: 7665 7273 616d 706c 6564 2078 5f74 7261  versampled x_tra
-00020650: 696e 2c20 795f 7472 6169 6e2e 0a20 2020  in, y_train..   
-00020660: 2057 6879 2069 7320 7468 6973 206e 6565   Why is this nee
-00020670: 6465 6420 696e 204d 6163 6869 6e65 204c  ded in Machine L
-00020680: 6561 726e 696e 6720 7072 6f62 6c65 6d73  earning problems
-00020690: 3f0a 2020 2020 2020 2020 2049 6e20 496d  ?.         In Im
-000206a0: 6261 6c61 6e63 6564 2064 6174 6173 6574  balanced dataset
-000206b0: 732c 2065 7370 2e20 736b 6577 6564 2072  s, esp. skewed r
-000206c0: 6567 7265 7373 696f 6e20 7072 6f62 6c65  egression proble
-000206d0: 6d73 2077 6865 7265 2074 6865 2074 6172  ms where the tar
-000206e0: 6765 7420 7661 7269 6162 6c65 2069 7320  get variable is 
-000206f0: 736b 6577 6564 2c20 7468 6973 2069 7320  skewed, this is 
-00020700: 6e65 6564 6564 2e0a 2020 2020 5472 7920  needed..    Try 
-00020710: 7468 6973 206f 6e20 796f 7572 2073 6b65  this on your ske
-00020720: 7765 6420 5265 6772 6573 7369 6f6e 2070  wed Regression p
-00020730: 726f 626c 656d 7320 616e 6420 7365 6520  roblems and see 
-00020740: 7768 6174 2072 6573 756c 7473 2079 6f75  what results you
-00020750: 2067 6574 2e20 4974 2073 686f 756c 6420   get. It should 
-00020760: 6265 2062 6574 7465 722e 0a20 2020 202d  be better..    -
-00020770: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 496e  ---------.    In
-00020780: 7075 7473 0a20 2020 202d 2d2d 2d2d 2d2d  puts.    -------
-00020790: 2d2d 2d0a 2020 2020 785f 7472 6169 6e20  ---.    x_train 
-000207a0: 3a20 7061 6e64 6173 2064 6174 6166 7261  : pandas datafra
-000207b0: 6d65 3a20 796f 7520 6d75 7374 2073 656e  me: you must sen
-000207c0: 6420 696e 2074 6865 2064 6174 6120 7769  d in the data wi
-000207d0: 7468 2070 7265 6469 6374 6f72 7320 6f6e  th predictors on
-000207e0: 6c79 2e0a 2020 2020 6d69 6e5f 6e5f 7361  ly..    min_n_sa
-000207f0: 6d70 6c65 7320 3a20 696e 742c 2064 6566  mples : int, def
-00020800: 6175 6c74 3d35 3a20 6d69 6e20 6e75 6d62  ault=5: min numb
-00020810: 6572 206f 6620 7361 6d70 6c65 7320 6265  er of samples be
-00020820: 6c6f 7720 7768 6963 6820 796f 7520 636f  low which you co
-00020830: 6d62 696e 6520 6269 6e73 0a20 2020 2062  mbine bins.    b
-00020840: 696e 7320 3a20 696e 742c 2064 6566 6175  ins : int, defau
-00020850: 6c74 3d33 3a20 686f 7720 6d61 6e79 2062  lt=3: how many b
-00020860: 696e 7320 796f 7520 7761 6e74 2074 6f20  ins you want to 
-00020870: 7370 6c69 7420 7461 7267 6574 2069 6e74  split target int
-00020880: 6f0a 0a20 2020 204f 7574 7075 7473 0a20  o..    Outputs. 
-00020890: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000208a0: 2020 6e5f 6665 6174 7572 6573 5f20 3a20    n_features_ : 
-000208b0: 696e 740a 2020 2020 2020 2020 5468 6520  int.        The 
-000208c0: 6e75 6d62 6572 206f 6620 6665 6174 7572  number of featur
-000208d0: 6573 206f 6620 7468 6520 6461 7461 2070  es of the data p
-000208e0: 6173 7365 6420 746f 203a 6d65 7468 3a60  assed to :meth:`
-000208f0: 6669 7460 2e0a 2020 2020 2222 220a 2020  fit`..    """.  
-00020900: 2020 785f 7472 6169 6e5f 6320 3d20 636f    x_train_c = co
-00020910: 7079 2e64 6565 7063 6f70 7928 785f 7472  py.deepcopy(x_tr
-00020920: 6169 6e29 0a20 2020 2078 5f74 7261 696e  ain).    x_train
-00020930: 5f63 5b74 6172 6765 745d 203d 2079 5f74  _c[target] = y_t
-00020940: 7261 696e 2e76 616c 7565 730a 0a20 2020  rain.values..   
-00020950: 2023 2052 6567 7265 7373 696f 6e20 7072   # Regression pr
-00020960: 6f62 6c65 6d20 7475 726e 6564 2069 6e74  oblem turned int
-00020970: 6f20 436c 6173 7369 6669 6361 7469 6f6e  o Classification
-00020980: 2070 726f 626c 656d 0a20 2020 206e 5f63   problem.    n_c
-00020990: 6c75 7374 6572 7320 3d20 6d61 7828 332c  lusters = max(3,
-000209a0: 2069 6e74 286e 702e 6c6f 6731 3028 6c65   int(np.log10(le
-000209b0: 6e28 795f 7472 6169 6e29 2929 202b 2031  n(y_train))) + 1
-000209c0: 290a 2020 2020 2320 5573 6520 4b4d 6561  ).    # Use KMea
-000209d0: 6e73 2074 6f20 6669 6e64 206e 6174 7572  ns to find natur
-000209e0: 616c 2063 6c75 7374 6572 7320 696e 2079  al clusters in y
-000209f0: 6f75 7220 6461 7461 0a20 2020 206b 6d5f  our data.    km_
-00020a00: 6d6f 6465 6c20 3d20 4b4d 6561 6e73 286e  model = KMeans(n
-00020a10: 5f63 6c75 7374 6572 733d 6e5f 636c 7573  _clusters=n_clus
-00020a20: 7465 7273 2c0a 2020 2020 2020 2020 2020  ters,.          
-00020a30: 2020 2020 2020 2020 2020 2020 6e5f 696e              n_in
-00020a40: 6974 3d35 2c0a 2020 2020 2020 2020 2020  it=5,.          
-00020a50: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
-00020a60: 6f6d 5f73 7461 7465 3d39 3929 0a20 2020  om_state=99).   
-00020a70: 2023 2323 2320 7265 6d65 6d62 6572 2079   #### remember y
-00020a80: 6f75 206d 7573 7420 7072 6564 6963 7420  ou must predict 
-00020a90: 7573 696e 6720 6f6e 6c79 2070 7265 6469  using only predi
-00020aa0: 6374 6f72 2076 6172 6961 626c 6573 210a  ctor variables!.
-00020ab0: 2020 2020 795f 7472 6169 6e5f 6320 3d20      y_train_c = 
-00020ac0: 6b6d 5f6d 6f64 656c 2e66 6974 5f70 7265  km_model.fit_pre
-00020ad0: 6469 6374 2878 5f74 7261 696e 290a 0a20  dict(x_train).. 
-00020ae0: 2020 2069 6620 7665 7262 6f73 6520 3e3d     if verbose >=
-00020af0: 2031 3a0a 2020 2020 2020 2020 7072 696e   1:.        prin
-00020b00: 7428 274e 756d 6265 7220 6f66 2063 6c75  t('Number of clu
-00020b10: 7374 6572 7320 6372 6561 7465 6420 3d20  sters created = 
-00020b20: 2564 2720 256e 5f63 6c75 7374 6572 7329  %d' %n_clusters)
-00020b30: 0a0a 2020 2020 2323 2323 2047 656e 6572  ..    #### Gener
-00020b40: 6174 6520 7468 6520 6f76 6572 2d73 616d  ate the over-sam
-00020b50: 706c 6564 2064 6174 610a 2020 2020 2323  pled data.    ##
-00020b60: 2323 2041 4441 5359 4e20 2f20 534d 4f54  ## ADASYN / SMOT
-00020b70: 4520 6f76 6572 7361 6d70 6c69 6e67 2023  E oversampling #
-00020b80: 2323 2323 0a20 2020 2069 6620 6973 696e  ####.    if isin
-00020b90: 7374 616e 6365 2873 6d6f 7465 2c20 7374  stance(smote, st
-00020ba0: 7229 3a0a 2020 2020 2020 2020 785f 7472  r):.        x_tr
-00020bb0: 6169 6e5f 6578 742c 205f 203d 206f 7665  ain_ext, _ = ove
-00020bc0: 7273 616d 706c 655f 534d 4f54 4528 785f  rsample_SMOTE(x_
-00020bd0: 7472 6169 6e5f 632c 2079 5f74 7261 696e  train_c, y_train
-00020be0: 5f63 290a 2020 2020 656c 7365 3a0a 2020  _c).    else:.  
-00020bf0: 2020 2020 2020 785f 7472 6169 6e5f 6578        x_train_ex
-00020c00: 742c 205f 203d 2073 6d6f 7465 2e66 6974  t, _ = smote.fit
-00020c10: 5f72 6573 616d 706c 6528 785f 7472 6169  _resample(x_trai
-00020c20: 6e5f 632c 2079 5f74 7261 696e 5f63 290a  n_c, y_train_c).
-00020c30: 2020 2020 795f 7472 6169 6e5f 6578 7420      y_train_ext 
-00020c40: 3d20 785f 7472 6169 6e5f 6578 745b 7461  = x_train_ext[ta
-00020c50: 7267 6574 5d2e 7661 6c75 6573 0a20 2020  rget].values.   
-00020c60: 2078 5f74 7261 696e 5f65 7874 203d 2078   x_train_ext = x
-00020c70: 5f74 7261 696e 5f65 7874 2e64 726f 7028  _train_ext.drop(
-00020c80: 7461 7267 6574 2c20 6178 6973 3d31 290a  target, axis=1).
-00020c90: 2020 2020 7265 7475 726e 2028 785f 7472      return (x_tr
-00020ca0: 6169 6e5f 6578 742c 2079 5f74 7261 696e  ain_ext, y_train
-00020cb0: 5f65 7874 290a 0a23 2323 2323 2323 2323  _ext)..#########
+00020500: 2323 2323 2323 2323 0a69 6d70 6f72 7420  ########.import 
+00020510: 636f 7079 0a66 726f 6d20 736b 6c65 6172  copy.from sklear
+00020520: 6e2e 636c 7573 7465 7220 696d 706f 7274  n.cluster import
+00020530: 204b 4d65 616e 730a 6465 6620 4645 5f6b   KMeans.def FE_k
+00020540: 6d65 616e 735f 7265 7361 6d70 6c65 7228  means_resampler(
+00020550: 785f 7472 6169 6e2c 2079 5f74 7261 696e  x_train, y_train
+00020560: 2c20 7461 7267 6574 2c20 736d 6f74 653d  , target, smote=
+00020570: 2222 2c20 7665 7262 6f73 653d 3029 3a0a  "", verbose=0):.
+00020580: 2020 2020 2222 220a 2020 2020 5468 6973      """.    This
+00020590: 2066 756e 6374 696f 6e20 636f 6e76 6572   function conver
+000205a0: 7473 2061 2052 6567 7265 7373 696f 6e20  ts a Regression 
+000205b0: 7072 6f62 6c65 6d20 696e 746f 2061 2043  problem into a C
+000205c0: 6c61 7373 6966 6963 6174 696f 6e20 7072  lassification pr
+000205d0: 6f62 6c65 6d20 746f 2065 6e61 626c 6520  oblem to enable 
+000205e0: 534d 4f54 4521 0a20 2020 2049 7420 6973  SMOTE!.    It is
+000205f0: 2061 2076 6572 7920 7369 6d70 6c65 2077   a very simple w
+00020600: 6179 2074 6f20 7365 6e64 2079 6f75 7220  ay to send your 
+00020610: 785f 7472 6169 6e2c 2079 5f74 7261 696e  x_train, y_train
+00020620: 2069 6e20 616e 6420 6765 7420 6261 636b   in and get back
+00020630: 2061 6e20 6f76 6572 7361 6d70 6c65 6420   an oversampled 
+00020640: 785f 7472 6169 6e2c 2079 5f74 7261 696e  x_train, y_train
+00020650: 2e0a 2020 2020 5768 7920 6973 2074 6869  ..    Why is thi
+00020660: 7320 6e65 6564 6564 2069 6e20 4d61 6368  s needed in Mach
+00020670: 696e 6520 4c65 6172 6e69 6e67 2070 726f  ine Learning pro
+00020680: 626c 656d 733f 0a20 2020 2020 2020 2020  blems?.         
+00020690: 496e 2049 6d62 616c 616e 6365 6420 6461  In Imbalanced da
+000206a0: 7461 7365 7473 2c20 6573 702e 2073 6b65  tasets, esp. ske
+000206b0: 7765 6420 7265 6772 6573 7369 6f6e 2070  wed regression p
+000206c0: 726f 626c 656d 7320 7768 6572 6520 7468  roblems where th
+000206d0: 6520 7461 7267 6574 2076 6172 6961 626c  e target variabl
+000206e0: 6520 6973 2073 6b65 7765 642c 2074 6869  e is skewed, thi
+000206f0: 7320 6973 206e 6565 6465 642e 0a20 2020  s is needed..   
+00020700: 2054 7279 2074 6869 7320 6f6e 2079 6f75   Try this on you
+00020710: 7220 736b 6577 6564 2052 6567 7265 7373  r skewed Regress
+00020720: 696f 6e20 7072 6f62 6c65 6d73 2061 6e64  ion problems and
+00020730: 2073 6565 2077 6861 7420 7265 7375 6c74   see what result
+00020740: 7320 796f 7520 6765 742e 2049 7420 7368  s you get. It sh
+00020750: 6f75 6c64 2062 6520 6265 7474 6572 2e0a  ould be better..
+00020760: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00020770: 2020 2049 6e70 7574 730a 2020 2020 2d2d     Inputs.    --
+00020780: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2078 5f74  --------.    x_t
+00020790: 7261 696e 203a 2070 616e 6461 7320 6461  rain : pandas da
+000207a0: 7461 6672 616d 653a 2079 6f75 206d 7573  taframe: you mus
+000207b0: 7420 7365 6e64 2069 6e20 7468 6520 6461  t send in the da
+000207c0: 7461 2077 6974 6820 7072 6564 6963 746f  ta with predicto
+000207d0: 7273 206f 6e6c 792e 0a20 2020 206d 696e  rs only..    min
+000207e0: 5f6e 5f73 616d 706c 6573 203a 2069 6e74  _n_samples : int
+000207f0: 2c20 6465 6661 756c 743d 353a 206d 696e  , default=5: min
+00020800: 206e 756d 6265 7220 6f66 2073 616d 706c   number of sampl
+00020810: 6573 2062 656c 6f77 2077 6869 6368 2079  es below which y
+00020820: 6f75 2063 6f6d 6269 6e65 2062 696e 730a  ou combine bins.
+00020830: 2020 2020 6269 6e73 203a 2069 6e74 2c20      bins : int, 
+00020840: 6465 6661 756c 743d 333a 2068 6f77 206d  default=3: how m
+00020850: 616e 7920 6269 6e73 2079 6f75 2077 616e  any bins you wan
+00020860: 7420 746f 2073 706c 6974 2074 6172 6765  t to split targe
+00020870: 7420 696e 746f 0a0a 2020 2020 4f75 7470  t into..    Outp
+00020880: 7574 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  uts.    --------
+00020890: 2d2d 0a20 2020 206e 5f66 6561 7475 7265  --.    n_feature
+000208a0: 735f 203a 2069 6e74 0a20 2020 2020 2020  s_ : int.       
+000208b0: 2054 6865 206e 756d 6265 7220 6f66 2066   The number of f
+000208c0: 6561 7475 7265 7320 6f66 2074 6865 2064  eatures of the d
+000208d0: 6174 6120 7061 7373 6564 2074 6f20 3a6d  ata passed to :m
+000208e0: 6574 683a 6066 6974 602e 0a20 2020 2022  eth:`fit`..    "
+000208f0: 2222 0a20 2020 2078 5f74 7261 696e 5f63  "".    x_train_c
+00020900: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00020910: 2878 5f74 7261 696e 290a 2020 2020 785f  (x_train).    x_
+00020920: 7472 6169 6e5f 635b 7461 7267 6574 5d20  train_c[target] 
+00020930: 3d20 795f 7472 6169 6e2e 7661 6c75 6573  = y_train.values
+00020940: 0a0a 2020 2020 2320 5265 6772 6573 7369  ..    # Regressi
+00020950: 6f6e 2070 726f 626c 656d 2074 7572 6e65  on problem turne
+00020960: 6420 696e 746f 2043 6c61 7373 6966 6963  d into Classific
+00020970: 6174 696f 6e20 7072 6f62 6c65 6d0a 2020  ation problem.  
+00020980: 2020 6e5f 636c 7573 7465 7273 203d 206d    n_clusters = m
+00020990: 6178 2833 2c20 696e 7428 6e70 2e6c 6f67  ax(3, int(np.log
+000209a0: 3130 286c 656e 2879 5f74 7261 696e 2929  10(len(y_train))
+000209b0: 2920 2b20 3129 0a20 2020 2023 2055 7365  ) + 1).    # Use
+000209c0: 204b 4d65 616e 7320 746f 2066 696e 6420   KMeans to find 
+000209d0: 6e61 7475 7261 6c20 636c 7573 7465 7273  natural clusters
+000209e0: 2069 6e20 796f 7572 2064 6174 610a 2020   in your data.  
+000209f0: 2020 6b6d 5f6d 6f64 656c 203d 204b 4d65    km_model = KMe
+00020a00: 616e 7328 6e5f 636c 7573 7465 7273 3d6e  ans(n_clusters=n
+00020a10: 5f63 6c75 7374 6572 732c 0a20 2020 2020  _clusters,.     
+00020a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a30: 206e 5f69 6e69 743d 352c 0a20 2020 2020   n_init=5,.     
+00020a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a50: 2072 616e 646f 6d5f 7374 6174 653d 3939   random_state=99
+00020a60: 290a 2020 2020 2323 2323 2072 656d 656d  ).    #### remem
+00020a70: 6265 7220 796f 7520 6d75 7374 2070 7265  ber you must pre
+00020a80: 6469 6374 2075 7369 6e67 206f 6e6c 7920  dict using only 
+00020a90: 7072 6564 6963 746f 7220 7661 7269 6162  predictor variab
+00020aa0: 6c65 7321 0a20 2020 2079 5f74 7261 696e  les!.    y_train
+00020ab0: 5f63 203d 206b 6d5f 6d6f 6465 6c2e 6669  _c = km_model.fi
+00020ac0: 745f 7072 6564 6963 7428 785f 7472 6169  t_predict(x_trai
+00020ad0: 6e29 0a0a 2020 2020 6966 2076 6572 626f  n)..    if verbo
+00020ae0: 7365 203e 3d20 313a 0a20 2020 2020 2020  se >= 1:.       
+00020af0: 2070 7269 6e74 2827 4e75 6d62 6572 206f   print('Number o
+00020b00: 6620 636c 7573 7465 7273 2063 7265 6174  f clusters creat
+00020b10: 6564 203d 2025 6427 2025 6e5f 636c 7573  ed = %d' %n_clus
+00020b20: 7465 7273 290a 0a20 2020 2023 2323 2320  ters)..    #### 
+00020b30: 4765 6e65 7261 7465 2074 6865 206f 7665  Generate the ove
+00020b40: 722d 7361 6d70 6c65 6420 6461 7461 0a20  r-sampled data. 
+00020b50: 2020 2023 2323 2320 4144 4153 594e 202f     #### ADASYN /
+00020b60: 2053 4d4f 5445 206f 7665 7273 616d 706c   SMOTE oversampl
+00020b70: 696e 6720 2323 2323 230a 2020 2020 6966  ing #####.    if
+00020b80: 2069 7369 6e73 7461 6e63 6528 736d 6f74   isinstance(smot
+00020b90: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
+00020ba0: 2078 5f74 7261 696e 5f65 7874 2c20 5f20   x_train_ext, _ 
+00020bb0: 3d20 6f76 6572 7361 6d70 6c65 5f53 4d4f  = oversample_SMO
+00020bc0: 5445 2878 5f74 7261 696e 5f63 2c20 795f  TE(x_train_c, y_
+00020bd0: 7472 6169 6e5f 6329 0a20 2020 2065 6c73  train_c).    els
+00020be0: 653a 0a20 2020 2020 2020 2078 5f74 7261  e:.        x_tra
+00020bf0: 696e 5f65 7874 2c20 5f20 3d20 736d 6f74  in_ext, _ = smot
+00020c00: 652e 6669 745f 7265 7361 6d70 6c65 2878  e.fit_resample(x
+00020c10: 5f74 7261 696e 5f63 2c20 795f 7472 6169  _train_c, y_trai
+00020c20: 6e5f 6329 0a20 2020 2079 5f74 7261 696e  n_c).    y_train
+00020c30: 5f65 7874 203d 2078 5f74 7261 696e 5f65  _ext = x_train_e
+00020c40: 7874 5b74 6172 6765 745d 2e76 616c 7565  xt[target].value
+00020c50: 730a 2020 2020 785f 7472 6169 6e5f 6578  s.    x_train_ex
+00020c60: 7420 3d20 785f 7472 6169 6e5f 6578 742e  t = x_train_ext.
+00020c70: 6472 6f70 2874 6172 6765 742c 2061 7869  drop(target, axi
+00020c80: 733d 3129 0a20 2020 2072 6574 7572 6e20  s=1).    return 
+00020c90: 2878 5f74 7261 696e 5f65 7874 2c20 795f  (x_train_ext, y_
+00020ca0: 7472 6169 6e5f 6578 7429 0a0a 2323 2323  train_ext)..####
+00020cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00020cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020d10: 2323 2323 2323 2323 2323 0a23 2043 616c  ##########.# Cal
-00020d20: 6375 6c61 7465 2063 6c61 7373 2077 6569  culate class wei
-00020d30: 6768 740a 696d 706f 7274 2063 6f70 790a  ght.import copy.
-00020d40: 6672 6f6d 2063 6f6c 6c65 6374 696f 6e73  from collections
-00020d50: 2069 6d70 6f72 7420 436f 756e 7465 720a   import Counter.
-00020d60: 6672 6f6d 2073 6b6c 6561 726e 2e75 7469  from sklearn.uti
-00020d70: 6c73 2e63 6c61 7373 5f77 6569 6768 7420  ls.class_weight 
-00020d80: 696d 706f 7274 2063 6f6d 7075 7465 5f63  import compute_c
-00020d90: 6c61 7373 5f77 6569 6768 740a 6465 6620  lass_weight.def 
-00020da0: 6765 745f 636c 6173 735f 6469 7374 7269  get_class_distri
-00020db0: 6275 7469 6f6e 2879 5f69 6e70 7574 2c20  bution(y_input, 
-00020dc0: 7665 7262 6f73 653d 3029 3a0a 2020 2020  verbose=0):.    
-00020dd0: 795f 696e 7075 7420 3d20 636f 7079 2e64  y_input = copy.d
-00020de0: 6565 7063 6f70 7928 795f 696e 7075 7429  eepcopy(y_input)
-00020df0: 0a20 2020 2063 6c61 7373 6573 203d 206e  .    classes = n
-00020e00: 702e 756e 6971 7565 2879 5f69 6e70 7574  p.unique(y_input
-00020e10: 290a 2020 2020 7870 203d 2043 6f75 6e74  ).    xp = Count
-00020e20: 6572 2879 5f69 6e70 7574 290a 2020 2020  er(y_input).    
-00020e30: 636c 6173 735f 7765 6967 6874 7320 3d20  class_weights = 
-00020e40: 636f 6d70 7574 655f 636c 6173 735f 7765  compute_class_we
-00020e50: 6967 6874 2827 6261 6c61 6e63 6564 272c  ight('balanced',
-00020e60: 2063 6c61 7373 6573 3d6e 702e 756e 6971   classes=np.uniq
-00020e70: 7565 2879 5f69 6e70 7574 292c 2079 3d79  ue(y_input), y=y
-00020e80: 5f69 6e70 7574 290a 2020 2020 6966 206c  _input).    if l
-00020e90: 656e 2863 6c61 7373 5f77 6569 6768 7473  en(class_weights
-00020ea0: 5b28 636c 6173 735f 7765 6967 6874 733e  [(class_weights>
-00020eb0: 2031 3029 5d29 203e 2030 3a0a 2020 2020   10)]) > 0:.    
-00020ec0: 2020 2020 636c 6173 735f 7765 6967 6874      class_weight
-00020ed0: 7320 3d20 2863 6c61 7373 5f77 6569 6768  s = (class_weigh
-00020ee0: 7473 2f31 3029 0a20 2020 2065 6c73 653a  ts/10).    else:
-00020ef0: 0a20 2020 2020 2020 2063 6c61 7373 5f77  .        class_w
-00020f00: 6569 6768 7473 203d 2028 636c 6173 735f  eights = (class_
-00020f10: 7765 6967 6874 7329 0a20 2020 2023 7072  weights).    #pr
-00020f20: 696e 7428 2720 2020 2063 6c61 7373 5f77  int('    class_w
-00020f30: 6569 6768 7473 203d 2025 7327 2025 636c  eights = %s' %cl
-00020f40: 6173 735f 7765 6967 6874 7329 0a20 2020  ass_weights).   
-00020f50: 2063 6c61 7373 5f77 6569 6768 7473 5b28   class_weights[(
-00020f60: 636c 6173 735f 7765 6967 6874 733c 3129  class_weights<1)
-00020f70: 5d3d 310a 2020 2020 636c 6173 735f 726f  ]=1.    class_ro
-00020f80: 7773 203d 2063 6c61 7373 5f77 6569 6768  ws = class_weigh
-00020f90: 7473 2a5b 7870 5b78 5d20 666f 7220 7820  ts*[xp[x] for x 
-00020fa0: 696e 2063 6c61 7373 6573 5d0a 2020 2020  in classes].    
-00020fb0: 636c 6173 735f 726f 7773 203d 2063 6c61  class_rows = cla
-00020fc0: 7373 5f72 6f77 732e 6173 7479 7065 2869  ss_rows.astype(i
-00020fd0: 6e74 290a 2020 2020 636c 6173 735f 7765  nt).    class_we
-00020fe0: 6967 6874 6564 5f72 6f77 7320 3d20 6469  ighted_rows = di
-00020ff0: 6374 287a 6970 2863 6c61 7373 6573 2c63  ct(zip(classes,c
-00021000: 6c61 7373 5f72 6f77 7329 290a 2020 2020  lass_rows)).    
-00021010: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-00021020: 2020 2020 7072 696e 7428 2720 2020 2063      print('    c
-00021030: 6c61 7373 5f77 6569 6768 7465 645f 726f  lass_weighted_ro
-00021040: 7773 203d 2025 7327 2025 636c 6173 735f  ws = %s' %class_
-00021050: 7765 6967 6874 6564 5f72 6f77 7329 0a20  weighted_rows). 
-00021060: 2020 2072 6574 7572 6e20 636c 6173 735f     return class_
-00021070: 7765 6967 6874 6564 5f72 6f77 730a 0a0a  weighted_rows...
-00021080: 6465 6620 6f76 6572 7361 6d70 6c65 5f53  def oversample_S
-00021090: 4d4f 5445 2858 2c79 293a 0a20 2020 2023  MOTE(X,y):.    #
-000210a0: 696e 7075 7420 4461 7461 4672 616d 650a  input DataFrame.
-000210b0: 2020 2020 2358 20e2 8692 496e 6465 7065      #X ...Indepe
-000210c0: 6e64 656e 7420 5661 7269 6162 6c65 2069  ndent Variable i
-000210d0: 6e20 4461 7461 4672 616d 655c 0a20 2020  n DataFrame\.   
-000210e0: 2023 7920 e286 9264 6570 656e 6465 6e74   #y ...dependent
-000210f0: 2056 6172 6961 626c 6520 696e 2050 616e   Variable in Pan
-00021100: 6461 7320 4461 7461 4672 616d 6520 666f  das DataFrame fo
-00021110: 726d 6174 0a20 2020 2023 2047 6574 2074  rmat.    # Get t
-00021120: 6865 2063 6c61 7373 2064 6973 7472 6975  he class distriu
-00021130: 6274 696f 6e20 666f 7220 7065 7266 6f6d  btion for perfom
-00021140: 696e 6720 7265 6c61 7469 7665 2073 616d  ing relative sam
-00021150: 706c 696e 6720 696e 2074 6865 206e 6578  pling in the nex
-00021160: 7420 6c69 6e65 0a20 2020 2063 6c61 7373  t line.    class
-00021170: 5f77 6569 6768 7465 645f 726f 7773 203d  _weighted_rows =
-00021180: 2067 6574 5f63 6c61 7373 5f64 6973 7472   get_class_distr
-00021190: 6962 7574 696f 6e28 7929 0a20 2020 2073  ibution(y).    s
-000211a0: 6d6f 7465 203d 2053 564d 534d 4f54 4528  mote = SVMSMOTE(
-000211b0: 2072 616e 646f 6d5f 7374 6174 653d 3237   random_state=27
-000211c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000211d0: 2020 2020 7361 6d70 6c69 6e67 5f73 7472      sampling_str
-000211e0: 6174 6567 793d 636c 6173 735f 7765 6967  ategy=class_weig
-000211f0: 6874 6564 5f72 6f77 7329 0a20 2020 2058  hted_rows).    X
-00021200: 2c20 7920 3d20 736d 6f74 652e 6669 745f  , y = smote.fit_
-00021210: 7265 7361 6d70 6c65 2858 2c20 7929 0a20  resample(X, y). 
-00021220: 2020 2072 6574 7572 6e28 582c 7929 0a0a     return(X,y)..
-00021230: 6465 6620 6f76 6572 7361 6d70 6c65 5f41  def oversample_A
-00021240: 4441 5359 4e28 582c 7929 3a0a 2020 2020  DASYN(X,y):.    
-00021250: 2369 6e70 7574 2044 6174 6146 7261 6d65  #input DataFrame
-00021260: 0a20 2020 2023 5820 e286 9249 6e64 6570  .    #X ...Indep
-00021270: 656e 6465 6e74 2056 6172 6961 626c 6520  endent Variable 
-00021280: 696e 2044 6174 6146 7261 6d65 5c0a 2020  in DataFrame\.  
-00021290: 2020 2379 20e2 8692 6465 7065 6e64 656e    #y ...dependen
-000212a0: 7420 5661 7269 6162 6c65 2069 6e20 5061  t Variable in Pa
-000212b0: 6e64 6173 2044 6174 6146 7261 6d65 2066  ndas DataFrame f
-000212c0: 6f72 6d61 740a 2020 2020 2320 4765 7420  ormat.    # Get 
-000212d0: 7468 6520 636c 6173 7320 6469 7374 7269  the class distri
-000212e0: 7562 7469 6f6e 2066 6f72 2070 6572 666f  ubtion for perfo
-000212f0: 6d69 6e67 2072 656c 6174 6976 6520 7361  ming relative sa
-00021300: 6d70 6c69 6e67 2069 6e20 7468 6520 6e65  mpling in the ne
-00021310: 7874 206c 696e 650a 2020 2020 636c 6173  xt line.    clas
-00021320: 735f 7765 6967 6874 6564 5f72 6f77 7320  s_weighted_rows 
-00021330: 3d20 6765 745f 636c 6173 735f 6469 7374  = get_class_dist
-00021340: 7269 6275 7469 6f6e 2879 290a 2020 2020  ribution(y).    
-00021350: 2320 596f 7572 2066 6176 6f75 7269 7465  # Your favourite
-00021360: 206f 7665 7273 616d 706c 6572 0a20 2020   oversampler.   
-00021370: 2073 6d6f 7465 203d 2041 4441 5359 4e28   smote = ADASYN(
-00021380: 7261 6e64 6f6d 5f73 7461 7465 3d32 372c  random_state=27,
-00021390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000213a0: 2020 2020 7361 6d70 6c69 6e67 5f73 7472      sampling_str
-000213b0: 6174 6567 793d 636c 6173 735f 7765 6967  ategy=class_weig
-000213c0: 6874 6564 5f72 6f77 7329 0a20 2020 2058  hted_rows).    X
-000213d0: 2c20 7920 3d20 736d 6f74 652e 6669 745f  , y = smote.fit_
-000213e0: 7265 7361 6d70 6c65 2858 2c20 7929 0a20  resample(X, y). 
-000213f0: 2020 2072 6574 7572 6e28 582c 7929 0a23     return(X,y).#
+00020d00: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00020d10: 2320 4361 6c63 756c 6174 6520 636c 6173  # Calculate clas
+00020d20: 7320 7765 6967 6874 0a69 6d70 6f72 7420  s weight.import 
+00020d30: 636f 7079 0a66 726f 6d20 636f 6c6c 6563  copy.from collec
+00020d40: 7469 6f6e 7320 696d 706f 7274 2043 6f75  tions import Cou
+00020d50: 6e74 6572 0a66 726f 6d20 736b 6c65 6172  nter.from sklear
+00020d60: 6e2e 7574 696c 732e 636c 6173 735f 7765  n.utils.class_we
+00020d70: 6967 6874 2069 6d70 6f72 7420 636f 6d70  ight import comp
+00020d80: 7574 655f 636c 6173 735f 7765 6967 6874  ute_class_weight
+00020d90: 0a64 6566 2067 6574 5f63 6c61 7373 5f64  .def get_class_d
+00020da0: 6973 7472 6962 7574 696f 6e28 795f 696e  istribution(y_in
+00020db0: 7075 742c 2076 6572 626f 7365 3d30 293a  put, verbose=0):
+00020dc0: 0a20 2020 2079 5f69 6e70 7574 203d 2063  .    y_input = c
+00020dd0: 6f70 792e 6465 6570 636f 7079 2879 5f69  opy.deepcopy(y_i
+00020de0: 6e70 7574 290a 2020 2020 636c 6173 7365  nput).    classe
+00020df0: 7320 3d20 6e70 2e75 6e69 7175 6528 795f  s = np.unique(y_
+00020e00: 696e 7075 7429 0a20 2020 2078 7020 3d20  input).    xp = 
+00020e10: 436f 756e 7465 7228 795f 696e 7075 7429  Counter(y_input)
+00020e20: 0a20 2020 2063 6c61 7373 5f77 6569 6768  .    class_weigh
+00020e30: 7473 203d 2063 6f6d 7075 7465 5f63 6c61  ts = compute_cla
+00020e40: 7373 5f77 6569 6768 7428 2762 616c 616e  ss_weight('balan
+00020e50: 6365 6427 2c20 636c 6173 7365 733d 6e70  ced', classes=np
+00020e60: 2e75 6e69 7175 6528 795f 696e 7075 7429  .unique(y_input)
+00020e70: 2c20 793d 795f 696e 7075 7429 0a20 2020  , y=y_input).   
+00020e80: 2069 6620 6c65 6e28 636c 6173 735f 7765   if len(class_we
+00020e90: 6967 6874 735b 2863 6c61 7373 5f77 6569  ights[(class_wei
+00020ea0: 6768 7473 3e20 3130 295d 2920 3e20 303a  ghts> 10)]) > 0:
+00020eb0: 0a20 2020 2020 2020 2063 6c61 7373 5f77  .        class_w
+00020ec0: 6569 6768 7473 203d 2028 636c 6173 735f  eights = (class_
+00020ed0: 7765 6967 6874 732f 3130 290a 2020 2020  weights/10).    
+00020ee0: 656c 7365 3a0a 2020 2020 2020 2020 636c  else:.        cl
+00020ef0: 6173 735f 7765 6967 6874 7320 3d20 2863  ass_weights = (c
+00020f00: 6c61 7373 5f77 6569 6768 7473 290a 2020  lass_weights).  
+00020f10: 2020 2370 7269 6e74 2827 2020 2020 636c    #print('    cl
+00020f20: 6173 735f 7765 6967 6874 7320 3d20 2573  ass_weights = %s
+00020f30: 2720 2563 6c61 7373 5f77 6569 6768 7473  ' %class_weights
+00020f40: 290a 2020 2020 636c 6173 735f 7765 6967  ).    class_weig
+00020f50: 6874 735b 2863 6c61 7373 5f77 6569 6768  hts[(class_weigh
+00020f60: 7473 3c31 295d 3d31 0a20 2020 2063 6c61  ts<1)]=1.    cla
+00020f70: 7373 5f72 6f77 7320 3d20 636c 6173 735f  ss_rows = class_
+00020f80: 7765 6967 6874 732a 5b78 705b 785d 2066  weights*[xp[x] f
+00020f90: 6f72 2078 2069 6e20 636c 6173 7365 735d  or x in classes]
+00020fa0: 0a20 2020 2063 6c61 7373 5f72 6f77 7320  .    class_rows 
+00020fb0: 3d20 636c 6173 735f 726f 7773 2e61 7374  = class_rows.ast
+00020fc0: 7970 6528 696e 7429 0a20 2020 2063 6c61  ype(int).    cla
+00020fd0: 7373 5f77 6569 6768 7465 645f 726f 7773  ss_weighted_rows
+00020fe0: 203d 2064 6963 7428 7a69 7028 636c 6173   = dict(zip(clas
+00020ff0: 7365 732c 636c 6173 735f 726f 7773 2929  ses,class_rows))
+00021000: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
+00021010: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00021020: 2020 2020 636c 6173 735f 7765 6967 6874      class_weight
+00021030: 6564 5f72 6f77 7320 3d20 2573 2720 2563  ed_rows = %s' %c
+00021040: 6c61 7373 5f77 6569 6768 7465 645f 726f  lass_weighted_ro
+00021050: 7773 290a 2020 2020 7265 7475 726e 2063  ws).    return c
+00021060: 6c61 7373 5f77 6569 6768 7465 645f 726f  lass_weighted_ro
+00021070: 7773 0a0a 0a64 6566 206f 7665 7273 616d  ws...def oversam
+00021080: 706c 655f 534d 4f54 4528 582c 7929 3a0a  ple_SMOTE(X,y):.
+00021090: 2020 2020 2369 6e70 7574 2044 6174 6146      #input DataF
+000210a0: 7261 6d65 0a20 2020 2023 5820 e286 9249  rame.    #X ...I
+000210b0: 6e64 6570 656e 6465 6e74 2056 6172 6961  ndependent Varia
+000210c0: 626c 6520 696e 2044 6174 6146 7261 6d65  ble in DataFrame
+000210d0: 5c0a 2020 2020 2379 20e2 8692 6465 7065  \.    #y ...depe
+000210e0: 6e64 656e 7420 5661 7269 6162 6c65 2069  ndent Variable i
+000210f0: 6e20 5061 6e64 6173 2044 6174 6146 7261  n Pandas DataFra
+00021100: 6d65 2066 6f72 6d61 740a 2020 2020 2320  me format.    # 
+00021110: 4765 7420 7468 6520 636c 6173 7320 6469  Get the class di
+00021120: 7374 7269 7562 7469 6f6e 2066 6f72 2070  striubtion for p
+00021130: 6572 666f 6d69 6e67 2072 656c 6174 6976  erfoming relativ
+00021140: 6520 7361 6d70 6c69 6e67 2069 6e20 7468  e sampling in th
+00021150: 6520 6e65 7874 206c 696e 650a 2020 2020  e next line.    
+00021160: 636c 6173 735f 7765 6967 6874 6564 5f72  class_weighted_r
+00021170: 6f77 7320 3d20 6765 745f 636c 6173 735f  ows = get_class_
+00021180: 6469 7374 7269 6275 7469 6f6e 2879 290a  distribution(y).
+00021190: 2020 2020 736d 6f74 6520 3d20 5356 4d53      smote = SVMS
+000211a0: 4d4f 5445 2820 7261 6e64 6f6d 5f73 7461  MOTE( random_sta
+000211b0: 7465 3d32 372c 0a20 2020 2020 2020 2020  te=27,.         
+000211c0: 2020 2020 2020 2020 2073 616d 706c 696e           samplin
+000211d0: 675f 7374 7261 7465 6779 3d63 6c61 7373  g_strategy=class
+000211e0: 5f77 6569 6768 7465 645f 726f 7773 290a  _weighted_rows).
+000211f0: 2020 2020 582c 2079 203d 2073 6d6f 7465      X, y = smote
+00021200: 2e66 6974 5f72 6573 616d 706c 6528 582c  .fit_resample(X,
+00021210: 2079 290a 2020 2020 7265 7475 726e 2858   y).    return(X
+00021220: 2c79 290a 0a64 6566 206f 7665 7273 616d  ,y)..def oversam
+00021230: 706c 655f 4144 4153 594e 2858 2c79 293a  ple_ADASYN(X,y):
+00021240: 0a20 2020 2023 696e 7075 7420 4461 7461  .    #input Data
+00021250: 4672 616d 650a 2020 2020 2358 20e2 8692  Frame.    #X ...
+00021260: 496e 6465 7065 6e64 656e 7420 5661 7269  Independent Vari
+00021270: 6162 6c65 2069 6e20 4461 7461 4672 616d  able in DataFram
+00021280: 655c 0a20 2020 2023 7920 e286 9264 6570  e\.    #y ...dep
+00021290: 656e 6465 6e74 2056 6172 6961 626c 6520  endent Variable 
+000212a0: 696e 2050 616e 6461 7320 4461 7461 4672  in Pandas DataFr
+000212b0: 616d 6520 666f 726d 6174 0a20 2020 2023  ame format.    #
+000212c0: 2047 6574 2074 6865 2063 6c61 7373 2064   Get the class d
+000212d0: 6973 7472 6975 6274 696f 6e20 666f 7220  istriubtion for 
+000212e0: 7065 7266 6f6d 696e 6720 7265 6c61 7469  perfoming relati
+000212f0: 7665 2073 616d 706c 696e 6720 696e 2074  ve sampling in t
+00021300: 6865 206e 6578 7420 6c69 6e65 0a20 2020  he next line.   
+00021310: 2063 6c61 7373 5f77 6569 6768 7465 645f   class_weighted_
+00021320: 726f 7773 203d 2067 6574 5f63 6c61 7373  rows = get_class
+00021330: 5f64 6973 7472 6962 7574 696f 6e28 7929  _distribution(y)
+00021340: 0a20 2020 2023 2059 6f75 7220 6661 766f  .    # Your favo
+00021350: 7572 6974 6520 6f76 6572 7361 6d70 6c65  urite oversample
+00021360: 720a 2020 2020 736d 6f74 6520 3d20 4144  r.    smote = AD
+00021370: 4153 594e 2872 616e 646f 6d5f 7374 6174  ASYN(random_stat
+00021380: 653d 3237 2c0a 2020 2020 2020 2020 2020  e=27,.          
+00021390: 2020 2020 2020 2020 2073 616d 706c 696e           samplin
+000213a0: 675f 7374 7261 7465 6779 3d63 6c61 7373  g_strategy=class
+000213b0: 5f77 6569 6768 7465 645f 726f 7773 290a  _weighted_rows).
+000213c0: 2020 2020 582c 2079 203d 2073 6d6f 7465      X, y = smote
+000213d0: 2e66 6974 5f72 6573 616d 706c 6528 582c  .fit_resample(X,
+000213e0: 2079 290a 2020 2020 7265 7475 726e 2858   y).    return(X
+000213f0: 2c79 290a 2323 2323 2323 2323 2323 2323  ,y).############
 00021400: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00021410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00021420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00021430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00021440: 2323 2323 2323 2323 2323 2323 0a69 6d70  ############.imp
-00021450: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-00021460: 696d 706f 7274 2070 616e 6461 7320 6173  import pandas as
-00021470: 2070 640a 6672 6f6d 2073 6b6c 6561 726e   pd.from sklearn
-00021480: 2e6d 6f64 656c 5f73 656c 6563 7469 6f6e  .model_selection
-00021490: 2069 6d70 6f72 7420 7472 6169 6e5f 7465   import train_te
-000214a0: 7374 5f73 706c 6974 0a64 6566 2073 706c  st_split.def spl
-000214b0: 6974 5f64 6174 615f 6e5f 7761 7973 2864  it_data_n_ways(d
-000214c0: 662c 2074 6172 6765 742c 206e 5f73 706c  f, target, n_spl
-000214d0: 6974 732c 2074 6573 745f 7369 7a65 3d30  its, test_size=0
-000214e0: 2e32 2c20 6d6f 6465 6c74 7970 653d 4e6f  .2, modeltype=No
-000214f0: 6e65 2c2a 2a6b 7761 7267 7329 3a0a 2020  ne,**kwargs):.  
-00021500: 2020 2222 220a 2020 2020 496e 7075 7473    """.    Inputs
-00021510: 3a0a 2020 2020 6466 3a20 6461 7461 6672  :.    df: datafr
-00021520: 616d 6520 7468 6174 2079 6f75 2077 616e  ame that you wan
-00021530: 7420 746f 2073 706c 6974 0a20 2020 2074  t to split.    t
-00021540: 6172 6765 743a 2074 6865 2074 6172 6765  arget: the targe
-00021550: 7420 7661 7269 6162 6c65 2069 6e20 6461  t variable in da
-00021560: 7461 2066 7261 6d65 2028 6466 290a 2020  ta frame (df).  
-00021570: 2020 6e5f 7370 6c69 7473 3a20 6e75 6d62    n_splits: numb
-00021580: 6572 206f 6620 7761 7973 2069 6e20 7768  er of ways in wh
-00021590: 6963 6820 796f 7520 7761 6e74 2074 6f20  ich you want to 
-000215a0: 7370 6c69 7420 7468 6520 6461 7461 2066  split the data f
-000215b0: 7261 6d65 2028 6465 6661 756c 743d 3329  rame (default=3)
-000215c0: 0a20 2020 2074 6573 745f 7369 7a65 3a20  .    test_size: 
-000215d0: 7369 7a65 206f 6620 7468 6520 7465 7374  size of the test
-000215e0: 2064 6174 6173 6574 3a20 6465 6661 756c   dataset: defaul
-000215f0: 7420 6973 2030 2e32 2042 7574 2069 7420  t is 0.2 But it 
-00021600: 7370 6c69 7473 2074 6869 7320 7465 7374  splits this test
-00021610: 2069 6e74 6f20 7661 6c69 6420 616e 6420   into valid and 
-00021620: 7465 7374 2068 616c 662e 0a20 2020 2048  test half..    H
-00021630: 656e 6365 2079 6f75 2077 696c 6c20 6765  ence you will ge
-00021640: 7420 3130 2520 6f66 2064 6620 6173 2074  t 10% of df as t
-00021650: 6573 7420 616e 6420 3130 2520 6f66 2064  est and 10% of d
-00021660: 6620 6173 2076 616c 6964 2061 6e64 2072  f as valid and r
-00021670: 656d 6169 6e69 6e67 2038 3025 2061 7320  emaining 80% as 
-00021680: 7472 6169 6e0a 2020 2020 2323 2323 2323  train.    ######
-00021690: 2323 2323 2323 2323 2323 2020 2068 6f77  ##########   how
-000216a0: 2069 7420 776f 726b 7320 2323 2323 2323   it works ######
+00021440: 230a 696d 706f 7274 206e 756d 7079 2061  #.import numpy a
+00021450: 7320 6e70 0a69 6d70 6f72 7420 7061 6e64  s np.import pand
+00021460: 6173 2061 7320 7064 0a66 726f 6d20 736b  as as pd.from sk
+00021470: 6c65 6172 6e2e 6d6f 6465 6c5f 7365 6c65  learn.model_sele
+00021480: 6374 696f 6e20 696d 706f 7274 2074 7261  ction import tra
+00021490: 696e 5f74 6573 745f 7370 6c69 740a 6465  in_test_split.de
+000214a0: 6620 7370 6c69 745f 6461 7461 5f6e 5f77  f split_data_n_w
+000214b0: 6179 7328 6466 2c20 7461 7267 6574 2c20  ays(df, target, 
+000214c0: 6e5f 7370 6c69 7473 2c20 7465 7374 5f73  n_splits, test_s
+000214d0: 697a 653d 302e 322c 206d 6f64 656c 7479  ize=0.2, modelty
+000214e0: 7065 3d4e 6f6e 652c 2a2a 6b77 6172 6773  pe=None,**kwargs
+000214f0: 293a 0a20 2020 2022 2222 0a20 2020 2049  ):.    """.    I
+00021500: 6e70 7574 733a 0a20 2020 2064 663a 2064  nputs:.    df: d
+00021510: 6174 6166 7261 6d65 2074 6861 7420 796f  ataframe that yo
+00021520: 7520 7761 6e74 2074 6f20 7370 6c69 740a  u want to split.
+00021530: 2020 2020 7461 7267 6574 3a20 7468 6520      target: the 
+00021540: 7461 7267 6574 2076 6172 6961 626c 6520  target variable 
+00021550: 696e 2064 6174 6120 6672 616d 6520 2864  in data frame (d
+00021560: 6629 0a20 2020 206e 5f73 706c 6974 733a  f).    n_splits:
+00021570: 206e 756d 6265 7220 6f66 2077 6179 7320   number of ways 
+00021580: 696e 2077 6869 6368 2079 6f75 2077 616e  in which you wan
+00021590: 7420 746f 2073 706c 6974 2074 6865 2064  t to split the d
+000215a0: 6174 6120 6672 616d 6520 2864 6566 6175  ata frame (defau
+000215b0: 6c74 3d33 290a 2020 2020 7465 7374 5f73  lt=3).    test_s
+000215c0: 697a 653a 2073 697a 6520 6f66 2074 6865  ize: size of the
+000215d0: 2074 6573 7420 6461 7461 7365 743a 2064   test dataset: d
+000215e0: 6566 6175 6c74 2069 7320 302e 3220 4275  efault is 0.2 Bu
+000215f0: 7420 6974 2073 706c 6974 7320 7468 6973  t it splits this
+00021600: 2074 6573 7420 696e 746f 2076 616c 6964   test into valid
+00021610: 2061 6e64 2074 6573 7420 6861 6c66 2e0a   and test half..
+00021620: 2020 2020 4865 6e63 6520 796f 7520 7769      Hence you wi
+00021630: 6c6c 2067 6574 2031 3025 206f 6620 6466  ll get 10% of df
+00021640: 2061 7320 7465 7374 2061 6e64 2031 3025   as test and 10%
+00021650: 206f 6620 6466 2061 7320 7661 6c69 6420   of df as valid 
+00021660: 616e 6420 7265 6d61 696e 696e 6720 3830  and remaining 80
+00021670: 2520 6173 2074 7261 696e 0a20 2020 2023  % as train.    #
+00021680: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+00021690: 2020 686f 7720 6974 2077 6f72 6b73 2023    how it works #
+000216a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000216b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000216c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000216d0: 2323 2323 2323 2323 2323 0a20 2020 2059  ##########.    Y
-000216e0: 6f75 2063 616e 2073 706c 6974 2061 2064  ou can split a d
-000216f0: 6174 6166 7261 6d65 2074 6872 6565 2077  ataframe three w
-00021700: 6179 7320 6f72 2073 6978 2077 6179 7320  ays or six ways 
-00021710: 6465 7065 6e64 696e 6720 6f6e 2079 6f75  depending on you
-00021720: 7220 6e65 6564 2e20 5468 7265 6520 7761  r need. Three wa
-00021730: 7973 2069 733a 0a20 2020 2074 7261 696e  ys is:.    train
-00021740: 2c20 7661 6c69 642c 2074 6573 740a 2020  , valid, test.  
-00021750: 2020 5369 7820 7761 7973 2063 616e 2062    Six ways can b
-00021760: 653a 0a20 2020 2058 5f74 7261 696e 2c79  e:.    X_train,y
-00021770: 5f74 7261 696e 2c20 585f 7661 6c69 642c  _train, X_valid,
-00021780: 2079 5f76 616c 6964 2c20 585f 7465 7374   y_valid, X_test
-00021790: 2c20 795f 7465 7374 0a20 2020 2059 6f75  , y_test.    You
-000217a0: 2077 696c 6c20 6765 7420 6120 6c69 7374   will get a list
-000217b0: 2063 6f6e 7461 696e 696e 6720 7468 6573   containing thes
-000217c0: 6520 6461 7461 6672 616d 6573 2e2e 2e64  e dataframes...d
-000217d0: 6570 656e 6469 6e67 206f 6e20 7768 6174  epending on what
-000217e0: 2079 6f75 2065 6e74 6572 6564 2061 7320   you entered as 
-000217f0: 6e75 6d62 6572 206f 6620 7370 6c69 7473  number of splits
-00021800: 0a20 2020 204f 7574 7075 743a 204c 6973  .    Output: Lis
-00021810: 7420 6f66 2064 6174 6166 7261 6d65 730a  t of dataframes.
-00021820: 2020 2020 2222 220a 2020 2020 6966 206b      """.    if k
-00021830: 7761 7267 733a 0a20 2020 2020 2020 2066  wargs:.        f
-00021840: 6f72 206b 6579 2c20 7661 6c20 696e 206b  or key, val in k
-00021850: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
-00021860: 2020 2069 6620 6b65 7920 3d3d 2027 6d6f     if key == 'mo
-00021870: 6465 6c74 7970 6527 3a0a 2020 2020 2020  deltype':.      
-00021880: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-00021890: 7661 6c0a 2020 2020 2020 2020 2020 2020  val.            
-000218a0: 6966 206b 6579 203d 3d20 2774 6573 745f  if key == 'test_
-000218b0: 7369 7a65 273a 0a20 2020 2020 2020 2020  size':.         
-000218c0: 2020 2020 2020 2074 6573 745f 7369 7a65         test_size
-000218d0: 203d 2076 616c 0a20 2020 2069 6620 6d6f   = val.    if mo
-000218e0: 6465 6c74 7970 6520 6973 204e 6f6e 653a  deltype is None:
-000218f0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00021900: 7374 616e 6365 2874 6172 6765 742c 2073  stance(target, s
-00021910: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00021920: 2069 6620 6466 5b74 6172 6765 745d 2e64   if df[target].d
-00021930: 7479 7065 203d 3d20 666c 6f61 743a 0a20  type == float:. 
-00021940: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00021950: 6f64 656c 7479 7065 203d 2027 5265 6772  odeltype = 'Regr
-00021960: 6573 7369 6f6e 270a 2020 2020 2020 2020  ession'.        
-00021970: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00021980: 2020 2020 2020 2020 2020 6d6f 6465 6c74            modelt
-00021990: 7970 6520 3d20 2743 6c61 7373 6966 6963  ype = 'Classific
-000219a0: 6174 696f 6e27 0a20 2020 2020 2020 2020  ation'.         
-000219b0: 2020 2074 6172 6765 7420 3d20 5b74 6172     target = [tar
-000219c0: 6765 745d 0a20 2020 2020 2020 2065 6c73  get].        els
-000219d0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-000219e0: 6620 6466 5b74 6172 6765 745b 305d 5d2e  f df[target[0]].
-000219f0: 6474 7970 6520 3d3d 2066 6c6f 6174 3a0a  dtype == float:.
-00021a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a10: 6d6f 6465 6c74 7970 6520 3d20 2752 6567  modeltype = 'Reg
-00021a20: 7265 7373 696f 6e27 0a20 2020 2020 2020  ression'.       
-00021a30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00021a40: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00021a50: 6c74 7970 6520 3d20 2743 6c61 7373 6966  ltype = 'Classif
-00021a60: 6963 6174 696f 6e27 0a20 2020 2070 7265  ication'.    pre
-00021a70: 6473 203d 205b 7820 666f 7220 7820 696e  ds = [x for x in
-00021a80: 206c 6973 7428 6466 2920 6966 2078 206e   list(df) if x n
-00021a90: 6f74 2069 6e20 7461 7267 6574 5d0a 2020  ot in target].  
-00021aa0: 2020 7072 696e 7428 274e 756d 6265 7220    print('Number 
-00021ab0: 6f66 2070 7265 6469 6374 6f72 7320 696e  of predictors in
-00021ac0: 2064 6174 6173 6574 3a20 2564 2720 256c   dataset: %d' %l
-00021ad0: 656e 2870 7265 6473 2929 0a20 2020 206c  en(preds)).    l
-00021ae0: 6973 745f 6f66 5f64 6673 203d 205b 5d0a  ist_of_dfs = [].
-00021af0: 2020 2020 6966 206d 6f64 656c 7479 7065      if modeltype
-00021b00: 203d 3d20 2752 6567 7265 7373 696f 6e27   == 'Regression'
-00021b10: 3a0a 2020 2020 2020 2020 6e75 6d73 203d  :.        nums =
-00021b20: 2069 6e74 2828 312d 7465 7374 5f73 697a   int((1-test_siz
-00021b30: 6529 2a64 662e 7368 6170 655b 305d 290a  e)*df.shape[0]).
-00021b40: 2020 2020 2020 2020 7472 6169 6e2c 2074          train, t
-00021b50: 6573 746c 6172 6765 203d 2064 665b 3a6e  estlarge = df[:n
-00021b60: 756d 735d 2c20 6466 5b6e 756d 733a 5d0a  ums], df[nums:].
-00021b70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00021b80: 2020 7472 6169 6e2c 2074 6573 746c 6172    train, testlar
-00021b90: 6765 203d 2074 7261 696e 5f74 6573 745f  ge = train_test_
-00021ba0: 7370 6c69 7428 6466 2c20 7465 7374 5f73  split(df, test_s
-00021bb0: 697a 653d 7465 7374 5f73 697a 652c 2072  ize=test_size, r
-00021bc0: 616e 646f 6d5f 7374 6174 653d 3432 290a  andom_state=42).
-00021bd0: 2020 2020 6c69 7374 5f6f 665f 6466 732e      list_of_dfs.
-00021be0: 6170 7065 6e64 2874 7261 696e 290a 2020  append(train).  
-00021bf0: 2020 6966 206e 5f73 706c 6974 7320 3d3d    if n_splits ==
-00021c00: 2032 3a0a 2020 2020 2020 2020 7072 696e   2:.        prin
-00021c10: 7428 2752 6574 7572 6e69 6e67 2061 2054  t('Returning a T
-00021c20: 7570 6c65 2077 6974 6820 7477 6f20 6461  uple with two da
-00021c30: 7461 6672 616d 6573 2061 6e64 2073 6861  taframes and sha
-00021c40: 7065 733a 2028 2573 2c25 7329 2720 2528  pes: (%s,%s)' %(
-00021c50: 7472 6169 6e2e 7368 6170 652c 2074 6573  train.shape, tes
-00021c60: 746c 6172 6765 2e73 6861 7065 2929 0a20  tlarge.shape)). 
-00021c70: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
-00021c80: 6169 6e2c 2074 6573 746c 6172 6765 0a20  ain, testlarge. 
-00021c90: 2020 2065 6c69 6620 6d6f 6465 6c74 7970     elif modeltyp
-00021ca0: 6520 3d3d 2027 5265 6772 6573 7369 6f6e  e == 'Regression
-00021cb0: 2720 616e 6420 6e5f 7370 6c69 7473 203d  ' and n_splits =
-00021cc0: 3d20 333a 0a20 2020 2020 2020 206e 756d  = 3:.        num
-00021cd0: 7332 203d 2069 6e74 2830 2e35 2a28 7465  s2 = int(0.5*(te
-00021ce0: 7374 6c61 7267 652e 7368 6170 655b 305d  stlarge.shape[0]
-00021cf0: 2929 0a20 2020 2020 2020 2076 616c 6964  )).        valid
-00021d00: 2c20 7465 7374 203d 2074 6573 746c 6172  , test = testlar
-00021d10: 6765 5b3a 6e75 6d73 325d 2c20 7465 7374  ge[:nums2], test
-00021d20: 6c61 7267 655b 6e75 6d73 323a 5d0a 2020  large[nums2:].  
-00021d30: 2020 2020 2020 7072 696e 7428 2752 6574        print('Ret
-00021d40: 7572 6e69 6e67 2061 2054 7570 6c65 2077  urning a Tuple w
-00021d50: 6974 6820 7468 7265 6520 6461 7461 6672  ith three datafr
-00021d60: 616d 6573 2061 6e64 2073 6861 7065 733a  ames and shapes:
-00021d70: 2028 2573 2c25 732c 2573 2927 2025 2874   (%s,%s,%s)' %(t
-00021d80: 7261 696e 2e73 6861 7065 2c20 7661 6c69  rain.shape, vali
-00021d90: 642e 7368 6170 652c 2074 6573 742e 7368  d.shape, test.sh
-00021da0: 6170 6529 290a 2020 2020 2020 2020 7265  ape)).        re
-00021db0: 7475 726e 2074 7261 696e 2c20 7661 6c69  turn train, vali
-00021dc0: 642c 2074 6573 740a 2020 2020 656c 6966  d, test.    elif
-00021dd0: 206d 6f64 656c 7479 7065 203d 3d20 2743   modeltype == 'C
-00021de0: 6c61 7373 6966 6963 6174 696f 6e27 2061  lassification' a
-00021df0: 6e64 206e 5f73 706c 6974 7320 3d3d 2033  nd n_splits == 3
-00021e00: 3a0a 2020 2020 2020 2020 7661 6c69 642c  :.        valid,
-00021e10: 2074 6573 7420 3d20 7472 6169 6e5f 7465   test = train_te
-00021e20: 7374 5f73 706c 6974 2874 6573 746c 6172  st_split(testlar
-00021e30: 6765 2c20 7465 7374 5f73 697a 653d 302e  ge, test_size=0.
-00021e40: 352c 2072 616e 646f 6d5f 7374 6174 653d  5, random_state=
-00021e50: 3939 290a 2020 2020 2020 2020 7072 696e  99).        prin
-00021e60: 7428 2752 6574 7572 6e69 6e67 2061 2054  t('Returning a T
-00021e70: 7570 6c65 2077 6974 6820 7468 7265 6520  uple with three 
-00021e80: 6461 7461 6672 616d 6573 2061 6e64 2073  dataframes and s
-00021e90: 6861 7065 733a 2028 2573 2c25 732c 2573  hapes: (%s,%s,%s
-00021ea0: 2927 2025 2874 7261 696e 2e73 6861 7065  )' %(train.shape
-00021eb0: 2c20 7661 6c69 642e 7368 6170 652c 2074  , valid.shape, t
-00021ec0: 6573 742e 7368 6170 6529 290a 2020 2020  est.shape)).    
-00021ed0: 2020 2020 7265 7475 726e 2074 7261 696e      return train
-00021ee0: 2c20 7661 6c69 642c 2074 6573 740a 2020  , valid, test.  
-00021ef0: 2020 2323 2323 2043 6f6e 7469 6e75 6520    #### Continue 
-00021f00: 6f6e 6c79 2069 6620 796f 7520 6e65 6564  only if you need
-00021f10: 206d 6f72 6520 7468 616e 2033 2073 706c   more than 3 spl
-00021f20: 6974 7320 2323 2323 2323 0a20 2020 2069  its ######.    i
-00021f30: 6620 6d6f 6465 6c74 7970 6520 3d3d 2027  f modeltype == '
-00021f40: 5265 6772 6573 7369 6f6e 273a 0a20 2020  Regression':.   
-00021f50: 2020 2020 206e 756d 7332 203d 2069 6e74       nums2 = int
-00021f60: 2830 2e35 2a28 6466 2e73 6861 7065 5b30  (0.5*(df.shape[0
-00021f70: 5d20 2d20 6e75 6d73 2929 0a20 2020 2020  ] - nums)).     
-00021f80: 2020 2076 616c 6964 2c20 7465 7374 203d     valid, test =
-00021f90: 2074 6573 746c 6172 6765 5b3a 6e75 6d73   testlarge[:nums
-00021fa0: 325d 2c20 7465 7374 6c61 7267 655b 6e75  2], testlarge[nu
-00021fb0: 6d73 323a 5d0a 2020 2020 2020 2020 6966  ms2:].        if
-00021fc0: 206e 5f73 706c 6974 7320 3d3d 2034 3a0a   n_splits == 4:.
-00021fd0: 2020 2020 2020 2020 2020 2020 585f 7472              X_tr
-00021fe0: 6169 6e2c 2079 5f74 7261 696e 2c20 585f  ain, y_train, X_
-00021ff0: 7465 7374 2c20 795f 7465 7374 203d 2074  test, y_test = t
-00022000: 7261 696e 5b70 7265 6473 5d2c 2074 7261  rain[preds], tra
-00022010: 696e 5b74 6172 6765 745d 2c20 7465 7374  in[target], test
-00022020: 6c61 7267 655b 7072 6564 735d 2c20 7465  large[preds], te
-00022030: 7374 6c61 7267 655b 7461 7267 6574 5d0a  stlarge[target].
-00022040: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-00022050: 5f6f 665f 6466 7320 3d20 5b58 5f74 7261  _of_dfs = [X_tra
-00022060: 696e 2c79 5f74 7261 696e 2c20 585f 7465  in,y_train, X_te
-00022070: 7374 2c20 795f 7465 7374 5d0a 2020 2020  st, y_test].    
-00022080: 2020 2020 2020 2020 7072 696e 7428 2752          print('R
-00022090: 6574 7572 6e69 6e67 2061 2054 7570 6c65  eturning a Tuple
-000220a0: 2077 6974 6820 3420 6461 7461 6672 616d   with 4 datafram
-000220b0: 6573 3a20 2825 7320 2573 2025 7320 2573  es: (%s %s %s %s
-000220c0: 2927 2025 2858 5f74 7261 696e 2e73 6861  )' %(X_train.sha
-000220d0: 7065 2c79 5f74 7261 696e 2e73 6861 7065  pe,y_train.shape
-000220e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000220f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022100: 2020 585f 7465 7374 2e73 6861 7065 2c79    X_test.shape,y
-00022110: 5f74 6573 742e 7368 6170 6529 290a 2020  _test.shape)).  
-00022120: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022130: 206c 6973 745f 6f66 5f64 6673 0a20 2020   list_of_dfs.   
-00022140: 2020 2020 2065 6c69 6620 6e5f 7370 6c69       elif n_spli
-00022150: 7473 203d 3d20 363a 0a20 2020 2020 2020  ts == 6:.       
-00022160: 2020 2020 2058 5f74 7261 696e 2c20 795f       X_train, y_
-00022170: 7472 6169 6e2c 2058 5f76 616c 6964 2c20  train, X_valid, 
-00022180: 795f 7661 6c69 642c 2058 5f74 6573 742c  y_valid, X_test,
-00022190: 2079 5f74 6573 7420 3d20 7472 6169 6e5b   y_test = train[
-000221a0: 7072 6564 735d 2c20 7472 6169 6e5b 7461  preds], train[ta
-000221b0: 7267 6574 5d2c 2076 616c 6964 5b0a 2020  rget], valid[.  
+000216c0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+000216d0: 2020 2020 596f 7520 6361 6e20 7370 6c69      You can spli
+000216e0: 7420 6120 6461 7461 6672 616d 6520 7468  t a dataframe th
+000216f0: 7265 6520 7761 7973 206f 7220 7369 7820  ree ways or six 
+00021700: 7761 7973 2064 6570 656e 6469 6e67 206f  ways depending o
+00021710: 6e20 796f 7572 206e 6565 642e 2054 6872  n your need. Thr
+00021720: 6565 2077 6179 7320 6973 3a0a 2020 2020  ee ways is:.    
+00021730: 7472 6169 6e2c 2076 616c 6964 2c20 7465  train, valid, te
+00021740: 7374 0a20 2020 2053 6978 2077 6179 7320  st.    Six ways 
+00021750: 6361 6e20 6265 3a0a 2020 2020 585f 7472  can be:.    X_tr
+00021760: 6169 6e2c 795f 7472 6169 6e2c 2058 5f76  ain,y_train, X_v
+00021770: 616c 6964 2c20 795f 7661 6c69 642c 2058  alid, y_valid, X
+00021780: 5f74 6573 742c 2079 5f74 6573 740a 2020  _test, y_test.  
+00021790: 2020 596f 7520 7769 6c6c 2067 6574 2061    You will get a
+000217a0: 206c 6973 7420 636f 6e74 6169 6e69 6e67   list containing
+000217b0: 2074 6865 7365 2064 6174 6166 7261 6d65   these dataframe
+000217c0: 732e 2e2e 6465 7065 6e64 696e 6720 6f6e  s...depending on
+000217d0: 2077 6861 7420 796f 7520 656e 7465 7265   what you entere
+000217e0: 6420 6173 206e 756d 6265 7220 6f66 2073  d as number of s
+000217f0: 706c 6974 730a 2020 2020 4f75 7470 7574  plits.    Output
+00021800: 3a20 4c69 7374 206f 6620 6461 7461 6672  : List of datafr
+00021810: 616d 6573 0a20 2020 2022 2222 0a20 2020  ames.    """.   
+00021820: 2069 6620 6b77 6172 6773 3a0a 2020 2020   if kwargs:.    
+00021830: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
+00021840: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
+00021850: 2020 2020 2020 2020 6966 206b 6579 203d          if key =
+00021860: 3d20 276d 6f64 656c 7479 7065 273a 0a20  = 'modeltype':. 
+00021870: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00021880: 6579 203d 2076 616c 0a20 2020 2020 2020  ey = val.       
+00021890: 2020 2020 2069 6620 6b65 7920 3d3d 2027       if key == '
+000218a0: 7465 7374 5f73 697a 6527 3a0a 2020 2020  test_size':.    
+000218b0: 2020 2020 2020 2020 2020 2020 7465 7374              test
+000218c0: 5f73 697a 6520 3d20 7661 6c0a 2020 2020  _size = val.    
+000218d0: 6966 206d 6f64 656c 7479 7065 2069 7320  if modeltype is 
+000218e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+000218f0: 2069 7369 6e73 7461 6e63 6528 7461 7267   isinstance(targ
+00021900: 6574 2c20 7374 7229 3a0a 2020 2020 2020  et, str):.      
+00021910: 2020 2020 2020 6966 2064 665b 7461 7267        if df[targ
+00021920: 6574 5d2e 6474 7970 6520 3d3d 2066 6c6f  et].dtype == flo
+00021930: 6174 3a0a 2020 2020 2020 2020 2020 2020  at:.            
+00021940: 2020 2020 6d6f 6465 6c74 7970 6520 3d20      modeltype = 
+00021950: 2752 6567 7265 7373 696f 6e27 0a20 2020  'Regression'.   
+00021960: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00021970: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00021980: 6f64 656c 7479 7065 203d 2027 436c 6173  odeltype = 'Clas
+00021990: 7369 6669 6361 7469 6f6e 270a 2020 2020  sification'.    
+000219a0: 2020 2020 2020 2020 7461 7267 6574 203d          target =
+000219b0: 205b 7461 7267 6574 5d0a 2020 2020 2020   [target].      
+000219c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000219d0: 2020 2020 6966 2064 665b 7461 7267 6574      if df[target
+000219e0: 5b30 5d5d 2e64 7479 7065 203d 3d20 666c  [0]].dtype == fl
+000219f0: 6f61 743a 0a20 2020 2020 2020 2020 2020  oat:.           
+00021a00: 2020 2020 206d 6f64 656c 7479 7065 203d       modeltype =
+00021a10: 2027 5265 6772 6573 7369 6f6e 270a 2020   'Regression'.  
+00021a20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a40: 206d 6f64 656c 7479 7065 203d 2027 436c   modeltype = 'Cl
+00021a50: 6173 7369 6669 6361 7469 6f6e 270a 2020  assification'.  
+00021a60: 2020 7072 6564 7320 3d20 5b78 2066 6f72    preds = [x for
+00021a70: 2078 2069 6e20 6c69 7374 2864 6629 2069   x in list(df) i
+00021a80: 6620 7820 6e6f 7420 696e 2074 6172 6765  f x not in targe
+00021a90: 745d 0a20 2020 2070 7269 6e74 2827 4e75  t].    print('Nu
+00021aa0: 6d62 6572 206f 6620 7072 6564 6963 746f  mber of predicto
+00021ab0: 7273 2069 6e20 6461 7461 7365 743a 2025  rs in dataset: %
+00021ac0: 6427 2025 6c65 6e28 7072 6564 7329 290a  d' %len(preds)).
+00021ad0: 2020 2020 6c69 7374 5f6f 665f 6466 7320      list_of_dfs 
+00021ae0: 3d20 5b5d 0a20 2020 2069 6620 6d6f 6465  = [].    if mode
+00021af0: 6c74 7970 6520 3d3d 2027 5265 6772 6573  ltype == 'Regres
+00021b00: 7369 6f6e 273a 0a20 2020 2020 2020 206e  sion':.        n
+00021b10: 756d 7320 3d20 696e 7428 2831 2d74 6573  ums = int((1-tes
+00021b20: 745f 7369 7a65 292a 6466 2e73 6861 7065  t_size)*df.shape
+00021b30: 5b30 5d29 0a20 2020 2020 2020 2074 7261  [0]).        tra
+00021b40: 696e 2c20 7465 7374 6c61 7267 6520 3d20  in, testlarge = 
+00021b50: 6466 5b3a 6e75 6d73 5d2c 2064 665b 6e75  df[:nums], df[nu
+00021b60: 6d73 3a5d 0a20 2020 2065 6c73 653a 0a20  ms:].    else:. 
+00021b70: 2020 2020 2020 2074 7261 696e 2c20 7465         train, te
+00021b80: 7374 6c61 7267 6520 3d20 7472 6169 6e5f  stlarge = train_
+00021b90: 7465 7374 5f73 706c 6974 2864 662c 2074  test_split(df, t
+00021ba0: 6573 745f 7369 7a65 3d74 6573 745f 7369  est_size=test_si
+00021bb0: 7a65 2c20 7261 6e64 6f6d 5f73 7461 7465  ze, random_state
+00021bc0: 3d34 3229 0a20 2020 206c 6973 745f 6f66  =42).    list_of
+00021bd0: 5f64 6673 2e61 7070 656e 6428 7472 6169  _dfs.append(trai
+00021be0: 6e29 0a20 2020 2069 6620 6e5f 7370 6c69  n).    if n_spli
+00021bf0: 7473 203d 3d20 323a 0a20 2020 2020 2020  ts == 2:.       
+00021c00: 2070 7269 6e74 2827 5265 7475 726e 696e   print('Returnin
+00021c10: 6720 6120 5475 706c 6520 7769 7468 2074  g a Tuple with t
+00021c20: 776f 2064 6174 6166 7261 6d65 7320 616e  wo dataframes an
+00021c30: 6420 7368 6170 6573 3a20 2825 732c 2573  d shapes: (%s,%s
+00021c40: 2927 2025 2874 7261 696e 2e73 6861 7065  )' %(train.shape
+00021c50: 2c20 7465 7374 6c61 7267 652e 7368 6170  , testlarge.shap
+00021c60: 6529 290a 2020 2020 2020 2020 7265 7475  e)).        retu
+00021c70: 726e 2074 7261 696e 2c20 7465 7374 6c61  rn train, testla
+00021c80: 7267 650a 2020 2020 656c 6966 206d 6f64  rge.    elif mod
+00021c90: 656c 7479 7065 203d 3d20 2752 6567 7265  eltype == 'Regre
+00021ca0: 7373 696f 6e27 2061 6e64 206e 5f73 706c  ssion' and n_spl
+00021cb0: 6974 7320 3d3d 2033 3a0a 2020 2020 2020  its == 3:.      
+00021cc0: 2020 6e75 6d73 3220 3d20 696e 7428 302e    nums2 = int(0.
+00021cd0: 352a 2874 6573 746c 6172 6765 2e73 6861  5*(testlarge.sha
+00021ce0: 7065 5b30 5d29 290a 2020 2020 2020 2020  pe[0])).        
+00021cf0: 7661 6c69 642c 2074 6573 7420 3d20 7465  valid, test = te
+00021d00: 7374 6c61 7267 655b 3a6e 756d 7332 5d2c  stlarge[:nums2],
+00021d10: 2074 6573 746c 6172 6765 5b6e 756d 7332   testlarge[nums2
+00021d20: 3a5d 0a20 2020 2020 2020 2070 7269 6e74  :].        print
+00021d30: 2827 5265 7475 726e 696e 6720 6120 5475  ('Returning a Tu
+00021d40: 706c 6520 7769 7468 2074 6872 6565 2064  ple with three d
+00021d50: 6174 6166 7261 6d65 7320 616e 6420 7368  ataframes and sh
+00021d60: 6170 6573 3a20 2825 732c 2573 2c25 7329  apes: (%s,%s,%s)
+00021d70: 2720 2528 7472 6169 6e2e 7368 6170 652c  ' %(train.shape,
+00021d80: 2076 616c 6964 2e73 6861 7065 2c20 7465   valid.shape, te
+00021d90: 7374 2e73 6861 7065 2929 0a20 2020 2020  st.shape)).     
+00021da0: 2020 2072 6574 7572 6e20 7472 6169 6e2c     return train,
+00021db0: 2076 616c 6964 2c20 7465 7374 0a20 2020   valid, test.   
+00021dc0: 2065 6c69 6620 6d6f 6465 6c74 7970 6520   elif modeltype 
+00021dd0: 3d3d 2027 436c 6173 7369 6669 6361 7469  == 'Classificati
+00021de0: 6f6e 2720 616e 6420 6e5f 7370 6c69 7473  on' and n_splits
+00021df0: 203d 3d20 333a 0a20 2020 2020 2020 2076   == 3:.        v
+00021e00: 616c 6964 2c20 7465 7374 203d 2074 7261  alid, test = tra
+00021e10: 696e 5f74 6573 745f 7370 6c69 7428 7465  in_test_split(te
+00021e20: 7374 6c61 7267 652c 2074 6573 745f 7369  stlarge, test_si
+00021e30: 7a65 3d30 2e35 2c20 7261 6e64 6f6d 5f73  ze=0.5, random_s
+00021e40: 7461 7465 3d39 3929 0a20 2020 2020 2020  tate=99).       
+00021e50: 2070 7269 6e74 2827 5265 7475 726e 696e   print('Returnin
+00021e60: 6720 6120 5475 706c 6520 7769 7468 2074  g a Tuple with t
+00021e70: 6872 6565 2064 6174 6166 7261 6d65 7320  hree dataframes 
+00021e80: 616e 6420 7368 6170 6573 3a20 2825 732c  and shapes: (%s,
+00021e90: 2573 2c25 7329 2720 2528 7472 6169 6e2e  %s,%s)' %(train.
+00021ea0: 7368 6170 652c 2076 616c 6964 2e73 6861  shape, valid.sha
+00021eb0: 7065 2c20 7465 7374 2e73 6861 7065 2929  pe, test.shape))
+00021ec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00021ed0: 7472 6169 6e2c 2076 616c 6964 2c20 7465  train, valid, te
+00021ee0: 7374 0a20 2020 2023 2323 2320 436f 6e74  st.    #### Cont
+00021ef0: 696e 7565 206f 6e6c 7920 6966 2079 6f75  inue only if you
+00021f00: 206e 6565 6420 6d6f 7265 2074 6861 6e20   need more than 
+00021f10: 3320 7370 6c69 7473 2023 2323 2323 230a  3 splits ######.
+00021f20: 2020 2020 6966 206d 6f64 656c 7479 7065      if modeltype
+00021f30: 203d 3d20 2752 6567 7265 7373 696f 6e27   == 'Regression'
+00021f40: 3a0a 2020 2020 2020 2020 6e75 6d73 3220  :.        nums2 
+00021f50: 3d20 696e 7428 302e 352a 2864 662e 7368  = int(0.5*(df.sh
+00021f60: 6170 655b 305d 202d 206e 756d 7329 290a  ape[0] - nums)).
+00021f70: 2020 2020 2020 2020 7661 6c69 642c 2074          valid, t
+00021f80: 6573 7420 3d20 7465 7374 6c61 7267 655b  est = testlarge[
+00021f90: 3a6e 756d 7332 5d2c 2074 6573 746c 6172  :nums2], testlar
+00021fa0: 6765 5b6e 756d 7332 3a5d 0a20 2020 2020  ge[nums2:].     
+00021fb0: 2020 2069 6620 6e5f 7370 6c69 7473 203d     if n_splits =
+00021fc0: 3d20 343a 0a20 2020 2020 2020 2020 2020  = 4:.           
+00021fd0: 2058 5f74 7261 696e 2c20 795f 7472 6169   X_train, y_trai
+00021fe0: 6e2c 2058 5f74 6573 742c 2079 5f74 6573  n, X_test, y_tes
+00021ff0: 7420 3d20 7472 6169 6e5b 7072 6564 735d  t = train[preds]
+00022000: 2c20 7472 6169 6e5b 7461 7267 6574 5d2c  , train[target],
+00022010: 2074 6573 746c 6172 6765 5b70 7265 6473   testlarge[preds
+00022020: 5d2c 2074 6573 746c 6172 6765 5b74 6172  ], testlarge[tar
+00022030: 6765 745d 0a20 2020 2020 2020 2020 2020  get].           
+00022040: 206c 6973 745f 6f66 5f64 6673 203d 205b   list_of_dfs = [
+00022050: 585f 7472 6169 6e2c 795f 7472 6169 6e2c  X_train,y_train,
+00022060: 2058 5f74 6573 742c 2079 5f74 6573 745d   X_test, y_test]
+00022070: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00022080: 6e74 2827 5265 7475 726e 696e 6720 6120  nt('Returning a 
+00022090: 5475 706c 6520 7769 7468 2034 2064 6174  Tuple with 4 dat
+000220a0: 6166 7261 6d65 733a 2028 2573 2025 7320  aframes: (%s %s 
+000220b0: 2573 2025 7329 2720 2528 585f 7472 6169  %s %s)' %(X_trai
+000220c0: 6e2e 7368 6170 652c 795f 7472 6169 6e2e  n.shape,y_train.
+000220d0: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
+000220e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220f0: 2020 2020 2020 2058 5f74 6573 742e 7368         X_test.sh
+00022100: 6170 652c 795f 7465 7374 2e73 6861 7065  ape,y_test.shape
+00022110: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+00022120: 6574 7572 6e20 6c69 7374 5f6f 665f 6466  eturn list_of_df
+00022130: 730a 2020 2020 2020 2020 656c 6966 206e  s.        elif n
+00022140: 5f73 706c 6974 7320 3d3d 2036 3a0a 2020  _splits == 6:.  
+00022150: 2020 2020 2020 2020 2020 585f 7472 6169            X_trai
+00022160: 6e2c 2079 5f74 7261 696e 2c20 585f 7661  n, y_train, X_va
+00022170: 6c69 642c 2079 5f76 616c 6964 2c20 585f  lid, y_valid, X_
+00022180: 7465 7374 2c20 795f 7465 7374 203d 2074  test, y_test = t
+00022190: 7261 696e 5b70 7265 6473 5d2c 2074 7261  rain[preds], tra
+000221a0: 696e 5b74 6172 6765 745d 2c20 7661 6c69  in[target], vali
+000221b0: 645b 0a20 2020 2020 2020 2020 2020 2020  d[.             
 000221c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221e0: 2020 7072 6564 735d 2c20 7661 6c69 645b    preds], valid[
-000221f0: 7461 7267 6574 5d2c 2074 6573 745b 7072  target], test[pr
-00022200: 6564 735d 2c20 7465 7374 5b74 6172 6765  eds], test[targe
-00022210: 745d 0a20 2020 2020 2020 2020 2020 206c  t].            l
-00022220: 6973 745f 6f66 5f64 6673 203d 205b 585f  ist_of_dfs = [X_
-00022230: 7472 6169 6e2c 795f 7472 6169 6e2c 2058  train,y_train, X
-00022240: 5f76 616c 6964 2c20 795f 7661 6c69 642c  _valid, y_valid,
-00022250: 2058 5f74 6573 742c 2079 5f74 6573 745d   X_test, y_test]
-00022260: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00022270: 6e74 2827 5265 7475 726e 696e 6720 6120  nt('Returning a 
-00022280: 5475 706c 6520 7769 7468 2073 6978 2064  Tuple with six d
-00022290: 6174 6166 7261 6d65 7320 616e 6420 7368  ataframes and sh
-000222a0: 6170 6573 3a20 2825 7320 2573 2025 7320  apes: (%s %s %s 
-000222b0: 2573 2c25 732c 2573 2927 2025 280a 2020  %s,%s,%s)' %(.  
-000222c0: 2020 2020 2020 2020 2020 2020 2020 585f                X_
-000222d0: 7472 6169 6e2e 7368 6170 652c 795f 7472  train.shape,y_tr
-000222e0: 6169 6e2e 7368 6170 652c 2058 5f76 616c  ain.shape, X_val
-000222f0: 6964 2e73 6861 7065 2c79 5f76 616c 6964  id.shape,y_valid
-00022300: 2e73 6861 7065 2c58 5f74 6573 742e 7368  .shape,X_test.sh
-00022310: 6170 652c 795f 7465 7374 2e73 6861 7065  ape,y_test.shape
-00022320: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
-00022330: 6574 7572 6e20 6c69 7374 5f6f 665f 6466  eturn list_of_df
-00022340: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
-00022350: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00022360: 7428 274e 756d 6265 7220 6f66 2073 706c  t('Number of spl
-00022370: 6974 7320 6d75 7374 2062 6520 322c 2033  its must be 2, 3
-00022380: 2c20 3420 6f72 2036 2729 0a20 2020 2020  , 4 or 6').     
-00022390: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000223a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000223b0: 6966 206e 5f73 706c 6974 7320 3d3d 2034  if n_splits == 4
-000223c0: 3a0a 2020 2020 2020 2020 2020 2020 585f  :.            X_
-000223d0: 7472 6169 6e2c 2079 5f74 7261 696e 2c20  train, y_train, 
-000223e0: 585f 7465 7374 2c20 795f 7465 7374 203d  X_test, y_test =
-000223f0: 2074 7261 696e 5b70 7265 6473 5d2c 2074   train[preds], t
-00022400: 7261 696e 5b74 6172 6765 745d 2c20 7465  rain[target], te
-00022410: 7374 6c61 7267 655b 7072 6564 735d 2c20  stlarge[preds], 
-00022420: 7465 7374 6c61 7267 655b 7461 7267 6574  testlarge[target
-00022430: 5d0a 2020 2020 2020 2020 2020 2020 6c69  ].            li
-00022440: 7374 5f6f 665f 6466 7320 3d20 5b58 5f74  st_of_dfs = [X_t
-00022450: 7261 696e 2c79 5f74 7261 696e 2c20 585f  rain,y_train, X_
-00022460: 7465 7374 2c20 795f 7465 7374 5d0a 2020  test, y_test].  
-00022470: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00022480: 2752 6574 7572 6e69 6e67 2061 2054 7570  'Returning a Tup
-00022490: 6c65 2077 6974 6820 3420 6461 7461 6672  le with 4 datafr
-000224a0: 616d 6573 3a20 2825 7320 2573 2025 7320  ames: (%s %s %s 
-000224b0: 2573 2927 2025 2858 5f74 7261 696e 2e73  %s)' %(X_train.s
-000224c0: 6861 7065 2c79 5f74 7261 696e 2e73 6861  hape,y_train.sha
-000224d0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-000224e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224f0: 2020 2020 585f 7465 7374 2e73 6861 7065      X_test.shape
-00022500: 2c79 5f74 6573 742e 7368 6170 6529 290a  ,y_test.shape)).
-00022510: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00022520: 726e 206c 6973 745f 6f66 5f64 6673 0a20  rn list_of_dfs. 
-00022530: 2020 2020 2020 2065 6c69 6620 6e5f 7370         elif n_sp
-00022540: 6c69 7473 203d 3d20 363a 0a20 2020 2020  lits == 6:.     
-00022550: 2020 2020 2020 2058 5f74 7261 696e 2c20         X_train, 
-00022560: 795f 7472 6169 6e2c 2058 5f76 616c 6964  y_train, X_valid
-00022570: 2c20 795f 7661 6c69 642c 2058 5f74 6573  , y_valid, X_tes
-00022580: 742c 2079 5f74 6573 7420 3d20 7472 6169  t, y_test = trai
-00022590: 6e5b 7072 6564 735d 2c20 7472 6169 6e5b  n[preds], train[
-000225a0: 7461 7267 6574 5d2c 2076 616c 6964 5b0a  target], valid[.
+000221d0: 2020 2020 2020 2070 7265 6473 5d2c 2076         preds], v
+000221e0: 616c 6964 5b74 6172 6765 745d 2c20 7465  alid[target], te
+000221f0: 7374 5b70 7265 6473 5d2c 2074 6573 745b  st[preds], test[
+00022200: 7461 7267 6574 5d0a 2020 2020 2020 2020  target].        
+00022210: 2020 2020 6c69 7374 5f6f 665f 6466 7320      list_of_dfs 
+00022220: 3d20 5b58 5f74 7261 696e 2c79 5f74 7261  = [X_train,y_tra
+00022230: 696e 2c20 585f 7661 6c69 642c 2079 5f76  in, X_valid, y_v
+00022240: 616c 6964 2c20 585f 7465 7374 2c20 795f  alid, X_test, y_
+00022250: 7465 7374 5d0a 2020 2020 2020 2020 2020  test].          
+00022260: 2020 7072 696e 7428 2752 6574 7572 6e69    print('Returni
+00022270: 6e67 2061 2054 7570 6c65 2077 6974 6820  ng a Tuple with 
+00022280: 7369 7820 6461 7461 6672 616d 6573 2061  six dataframes a
+00022290: 6e64 2073 6861 7065 733a 2028 2573 2025  nd shapes: (%s %
+000222a0: 7320 2573 2025 732c 2573 2c25 7329 2720  s %s %s,%s,%s)' 
+000222b0: 2528 0a20 2020 2020 2020 2020 2020 2020  %(.             
+000222c0: 2020 2058 5f74 7261 696e 2e73 6861 7065     X_train.shape
+000222d0: 2c79 5f74 7261 696e 2e73 6861 7065 2c20  ,y_train.shape, 
+000222e0: 585f 7661 6c69 642e 7368 6170 652c 795f  X_valid.shape,y_
+000222f0: 7661 6c69 642e 7368 6170 652c 585f 7465  valid.shape,X_te
+00022300: 7374 2e73 6861 7065 2c79 5f74 6573 742e  st.shape,y_test.
+00022310: 7368 6170 6529 290a 2020 2020 2020 2020  shape)).        
+00022320: 2020 2020 7265 7475 726e 206c 6973 745f      return list_
+00022330: 6f66 5f64 6673 0a20 2020 2020 2020 2065  of_dfs.        e
+00022340: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022350: 2070 7269 6e74 2827 4e75 6d62 6572 206f   print('Number o
+00022360: 6620 7370 6c69 7473 206d 7573 7420 6265  f splits must be
+00022370: 2032 2c20 332c 2034 206f 7220 3627 290a   2, 3, 4 or 6').
+00022380: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022390: 726e 0a20 2020 2065 6c73 653a 0a20 2020  rn.    else:.   
+000223a0: 2020 2020 2069 6620 6e5f 7370 6c69 7473       if n_splits
+000223b0: 203d 3d20 343a 0a20 2020 2020 2020 2020   == 4:.         
+000223c0: 2020 2058 5f74 7261 696e 2c20 795f 7472     X_train, y_tr
+000223d0: 6169 6e2c 2058 5f74 6573 742c 2079 5f74  ain, X_test, y_t
+000223e0: 6573 7420 3d20 7472 6169 6e5b 7072 6564  est = train[pred
+000223f0: 735d 2c20 7472 6169 6e5b 7461 7267 6574  s], train[target
+00022400: 5d2c 2074 6573 746c 6172 6765 5b70 7265  ], testlarge[pre
+00022410: 6473 5d2c 2074 6573 746c 6172 6765 5b74  ds], testlarge[t
+00022420: 6172 6765 745d 0a20 2020 2020 2020 2020  arget].         
+00022430: 2020 206c 6973 745f 6f66 5f64 6673 203d     list_of_dfs =
+00022440: 205b 585f 7472 6169 6e2c 795f 7472 6169   [X_train,y_trai
+00022450: 6e2c 2058 5f74 6573 742c 2079 5f74 6573  n, X_test, y_tes
+00022460: 745d 0a20 2020 2020 2020 2020 2020 2070  t].            p
+00022470: 7269 6e74 2827 5265 7475 726e 696e 6720  rint('Returning 
+00022480: 6120 5475 706c 6520 7769 7468 2034 2064  a Tuple with 4 d
+00022490: 6174 6166 7261 6d65 733a 2028 2573 2025  ataframes: (%s %
+000224a0: 7320 2573 2025 7329 2720 2528 585f 7472  s %s %s)' %(X_tr
+000224b0: 6169 6e2e 7368 6170 652c 795f 7472 6169  ain.shape,y_trai
+000224c0: 6e2e 7368 6170 652c 0a20 2020 2020 2020  n.shape,.       
+000224d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000224e0: 2020 2020 2020 2020 2058 5f74 6573 742e           X_test.
+000224f0: 7368 6170 652c 795f 7465 7374 2e73 6861  shape,y_test.sha
+00022500: 7065 2929 0a20 2020 2020 2020 2020 2020  pe)).           
+00022510: 2072 6574 7572 6e20 6c69 7374 5f6f 665f   return list_of_
+00022520: 6466 730a 2020 2020 2020 2020 656c 6966  dfs.        elif
+00022530: 206e 5f73 706c 6974 7320 3d3d 2036 3a0a   n_splits == 6:.
+00022540: 2020 2020 2020 2020 2020 2020 585f 7472              X_tr
+00022550: 6169 6e2c 2079 5f74 7261 696e 2c20 585f  ain, y_train, X_
+00022560: 7661 6c69 642c 2079 5f76 616c 6964 2c20  valid, y_valid, 
+00022570: 585f 7465 7374 2c20 795f 7465 7374 203d  X_test, y_test =
+00022580: 2074 7261 696e 5b70 7265 6473 5d2c 2074   train[preds], t
+00022590: 7261 696e 5b74 6172 6765 745d 2c20 7661  rain[target], va
+000225a0: 6c69 645b 0a20 2020 2020 2020 2020 2020  lid[.           
 000225b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225d0: 2020 2020 7072 6564 735d 2c20 7661 6c69      preds], vali
-000225e0: 645b 7461 7267 6574 5d2c 2074 6573 745b  d[target], test[
-000225f0: 7072 6564 735d 2c20 7465 7374 5b74 6172  preds], test[tar
-00022600: 6765 745d 0a20 2020 2020 2020 2020 2020  get].           
-00022610: 2070 7269 6e74 2827 5265 7475 726e 696e   print('Returnin
-00022620: 6720 3420 6461 7461 6672 616d 6573 3a27  g 4 dataframes:'
-00022630: 2c20 585f 7472 6169 6e2e 7368 6170 652c  , X_train.shape,
-00022640: 2079 5f74 7261 696e 2e73 6861 7065 2c20   y_train.shape, 
-00022650: 585f 7465 7374 2e73 6861 7065 2c20 795f  X_test.shape, y_
-00022660: 7465 7374 2e73 6861 7065 290a 2020 2020  test.shape).    
-00022670: 2020 2020 2020 2020 6c69 7374 5f6f 665f          list_of_
-00022680: 6466 7320 3d20 5b58 5f74 7261 696e 2c79  dfs = [X_train,y
-00022690: 5f74 7261 696e 2c20 585f 7661 6c69 642c  _train, X_valid,
-000226a0: 2079 5f76 616c 6964 2c20 585f 7465 7374   y_valid, X_test
-000226b0: 2c20 795f 7465 7374 5d0a 2020 2020 2020  , y_test].      
-000226c0: 2020 2020 2020 7072 696e 7428 2752 6574        print('Ret
-000226d0: 7572 6e69 6e67 2061 2054 7570 6c65 2077  urning a Tuple w
-000226e0: 6974 6820 7369 7820 6461 7461 6672 616d  ith six datafram
-000226f0: 6573 2061 6e64 2073 6861 7065 733a 2028  es and shapes: (
-00022700: 2573 2025 7320 2573 2025 732c 2573 2c25  %s %s %s %s,%s,%
-00022710: 7329 2720 2528 0a20 2020 2020 2020 2020  s)' %(.         
-00022720: 2020 2020 2020 2058 5f74 7261 696e 2e73         X_train.s
-00022730: 6861 7065 2c79 5f74 7261 696e 2e73 6861  hape,y_train.sha
-00022740: 7065 2c20 585f 7661 6c69 642e 7368 6170  pe, X_valid.shap
-00022750: 652c 795f 7661 6c69 642e 7368 6170 652c  e,y_valid.shape,
-00022760: 585f 7465 7374 2e73 6861 7065 2c79 5f74  X_test.shape,y_t
-00022770: 6573 742e 7368 6170 6529 290a 2020 2020  est.shape)).    
-00022780: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00022790: 6973 745f 6f66 5f64 6673 0a20 2020 2020  ist_of_dfs.     
-000227a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000227b0: 2020 2020 2070 7269 6e74 2827 4e75 6d62       print('Numb
-000227c0: 6572 206f 6620 7370 6c69 7473 206d 7573  er of splits mus
-000227d0: 7420 6265 2032 2c20 332c 2034 206f 7220  t be 2, 3, 4 or 
-000227e0: 3627 290a 2020 2020 2020 2020 2020 2020  6').            
-000227f0: 7265 7475 726e 0a23 2323 2323 2323 2323  return.#########
+000225c0: 2020 2020 2020 2020 2070 7265 6473 5d2c           preds],
+000225d0: 2076 616c 6964 5b74 6172 6765 745d 2c20   valid[target], 
+000225e0: 7465 7374 5b70 7265 6473 5d2c 2074 6573  test[preds], tes
+000225f0: 745b 7461 7267 6574 5d0a 2020 2020 2020  t[target].      
+00022600: 2020 2020 2020 7072 696e 7428 2752 6574        print('Ret
+00022610: 7572 6e69 6e67 2034 2064 6174 6166 7261  urning 4 datafra
+00022620: 6d65 733a 272c 2058 5f74 7261 696e 2e73  mes:', X_train.s
+00022630: 6861 7065 2c20 795f 7472 6169 6e2e 7368  hape, y_train.sh
+00022640: 6170 652c 2058 5f74 6573 742e 7368 6170  ape, X_test.shap
+00022650: 652c 2079 5f74 6573 742e 7368 6170 6529  e, y_test.shape)
+00022660: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+00022670: 745f 6f66 5f64 6673 203d 205b 585f 7472  t_of_dfs = [X_tr
+00022680: 6169 6e2c 795f 7472 6169 6e2c 2058 5f76  ain,y_train, X_v
+00022690: 616c 6964 2c20 795f 7661 6c69 642c 2058  alid, y_valid, X
+000226a0: 5f74 6573 742c 2079 5f74 6573 745d 0a20  _test, y_test]. 
+000226b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000226c0: 2827 5265 7475 726e 696e 6720 6120 5475  ('Returning a Tu
+000226d0: 706c 6520 7769 7468 2073 6978 2064 6174  ple with six dat
+000226e0: 6166 7261 6d65 7320 616e 6420 7368 6170  aframes and shap
+000226f0: 6573 3a20 2825 7320 2573 2025 7320 2573  es: (%s %s %s %s
+00022700: 2c25 732c 2573 2927 2025 280a 2020 2020  ,%s,%s)' %(.    
+00022710: 2020 2020 2020 2020 2020 2020 585f 7472              X_tr
+00022720: 6169 6e2e 7368 6170 652c 795f 7472 6169  ain.shape,y_trai
+00022730: 6e2e 7368 6170 652c 2058 5f76 616c 6964  n.shape, X_valid
+00022740: 2e73 6861 7065 2c79 5f76 616c 6964 2e73  .shape,y_valid.s
+00022750: 6861 7065 2c58 5f74 6573 742e 7368 6170  hape,X_test.shap
+00022760: 652c 795f 7465 7374 2e73 6861 7065 2929  e,y_test.shape))
+00022770: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00022780: 7572 6e20 6c69 7374 5f6f 665f 6466 730a  urn list_of_dfs.
+00022790: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000227a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000227b0: 274e 756d 6265 7220 6f66 2073 706c 6974  'Number of split
+000227c0: 7320 6d75 7374 2062 6520 322c 2033 2c20  s must be 2, 3, 
+000227d0: 3420 6f72 2036 2729 0a20 2020 2020 2020  4 or 6').       
+000227e0: 2020 2020 2072 6574 7572 6e0a 2323 2323       return.####
+000227f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022840: 2323 2323 2323 2323 230a 6465 6620 4645  #########.def FE
-00022850: 5f63 6f6e 6361 7465 6e61 7465 5f6d 756c  _concatenate_mul
-00022860: 7469 706c 655f 636f 6c75 6d6e 7328 6466  tiple_columns(df
-00022870: 2c20 636f 6c73 2c20 6669 6c6c 6572 3d22  , cols, filler="
-00022880: 2022 2c20 6472 6f70 3d54 7275 6529 3a0a   ", drop=True):.
-00022890: 2020 2020 2222 220a 2020 2020 5468 6973      """.    This
-000228a0: 2068 616e 6479 2066 756e 6374 696f 6e20   handy function 
-000228b0: 636f 6d62 696e 6573 206d 756c 7469 706c  combines multipl
-000228c0: 6520 7374 7269 6e67 2063 6f6c 756d 6e73  e string columns
-000228d0: 2069 6e74 6f20 6120 7369 6e67 6c65 204e   into a single N
-000228e0: 4c50 2074 6578 7420 636f 6c75 6d6e 2e0a  LP text column..
-000228f0: 2020 2020 596f 7520 6361 6e20 646f 2066      You can do f
-00022900: 7572 7468 6572 2070 7265 2d70 726f 6365  urther pre-proce
-00022910: 7373 696e 6720 6f6e 2073 7563 6820 6120  ssing on such a 
-00022920: 636f 6d62 696e 6564 2063 6f6c 756d 6e20  combined column 
-00022930: 7769 7468 2054 4649 4446 206f 7220 4245  with TFIDF or BE
-00022940: 5254 2073 7479 6c65 2065 6d62 6564 6469  RT style embeddi
-00022950: 6e67 2e0a 0a20 2020 2049 6e70 7574 730a  ng...    Inputs.
-00022960: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
-00022970: 2020 2020 2020 6466 3a20 7061 6e64 6173        df: pandas
-00022980: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
-00022990: 2020 2063 6f6c 733a 2073 7472 696e 6720     cols: string 
-000229a0: 636f 6c75 6d6e 7320 7468 6174 2079 6f75  columns that you
-000229b0: 2077 616e 7420 746f 2063 6f6e 6361 7465   want to concate
-000229c0: 6e61 7465 2069 6e74 6f20 6120 7369 6e67  nate into a sing
-000229d0: 6c65 2063 6f6d 6269 6e65 6420 636f 6c75  le combined colu
-000229e0: 6d6e 0a20 2020 2020 2020 2066 696c 6c65  mn.        fille
-000229f0: 723a 2073 7472 696e 6720 2864 6566 6175  r: string (defau
-00022a00: 6c74 3a20 2220 2229 3a20 796f 7520 6361  lt: " "): you ca
-00022a10: 6e20 696e 7075 7420 616e 7920 7374 7269  n input any stri
-00022a20: 6e67 2074 6861 7420 796f 7520 7761 6e74  ng that you want
-00022a30: 2074 6f20 636f 6d62 696e 6520 7468 656d   to combine them
-00022a40: 2077 6974 682e 0a20 2020 2020 2020 2064   with..        d
-00022a50: 726f 703a 2064 6566 6175 6c74 2054 7275  rop: default Tru
-00022a60: 652e 2049 6620 5472 7565 2c20 6472 6f70  e. If True, drop
-00022a70: 2074 6865 2063 6f6c 756d 6e73 2069 6e70   the columns inp
-00022a80: 7574 2e20 4966 2046 616c 7365 2c20 6b65  ut. If False, ke
-00022a90: 6570 2074 6865 2063 6f6c 756d 6e73 2e0a  ep the columns..
-00022aa0: 0a20 2020 204f 7574 7075 7473 3a0a 2020  .    Outputs:.  
-00022ab0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00022ac0: 2020 2020 2064 663a 2074 6865 7265 2077       df: there w
-00022ad0: 696c 6c20 6265 2061 206e 6577 2063 6f6c  ill be a new col
-00022ae0: 756d 6e20 6361 6c6c 6564 205b 2763 6f6d  umn called ['com
-00022af0: 6269 6e65 6427 5d20 7468 6174 2077 696c  bined'] that wil
-00022b00: 6c20 6265 2061 6464 6564 2074 6f20 796f  l be added to yo
-00022b10: 7572 2064 6174 6166 7261 6d65 2e0a 2020  ur dataframe..  
-00022b20: 2020 2222 220a 2020 2020 6466 203d 2064    """.    df = d
-00022b30: 662e 636f 7079 2864 6565 703d 5472 7565  f.copy(deep=True
-00022b40: 290a 2020 2020 6466 5b27 636f 6d62 696e  ).    df['combin
-00022b50: 6564 275d 203d 2064 665b 636f 6c73 5d2e  ed'] = df[cols].
-00022b60: 6170 706c 7928 6c61 6d62 6461 2072 6f77  apply(lambda row
-00022b70: 3a20 6669 6c6c 6572 2e6a 6f69 6e28 726f  : filler.join(ro
-00022b80: 772e 7661 6c75 6573 2e61 7374 7970 6528  w.values.astype(
-00022b90: 7374 7229 292c 2061 7869 733d 3129 0a20  str)), axis=1). 
-00022ba0: 2020 2069 6620 6472 6f70 3a0a 2020 2020     if drop:.    
-00022bb0: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
-00022bc0: 2863 6f6c 732c 2061 7869 733d 3129 0a20  (cols, axis=1). 
-00022bd0: 2020 2072 6574 7572 6e20 6466 0a23 2323     return df.###
+00022830: 2323 2323 2323 2323 2323 2323 2323 0a64  ##############.d
+00022840: 6566 2046 455f 636f 6e63 6174 656e 6174  ef FE_concatenat
+00022850: 655f 6d75 6c74 6970 6c65 5f63 6f6c 756d  e_multiple_colum
+00022860: 6e73 2864 662c 2063 6f6c 732c 2066 696c  ns(df, cols, fil
+00022870: 6c65 723d 2220 222c 2064 726f 703d 5472  ler=" ", drop=Tr
+00022880: 7565 293a 0a20 2020 2022 2222 0a20 2020  ue):.    """.   
+00022890: 2054 6869 7320 6861 6e64 7920 6675 6e63   This handy func
+000228a0: 7469 6f6e 2063 6f6d 6269 6e65 7320 6d75  tion combines mu
+000228b0: 6c74 6970 6c65 2073 7472 696e 6720 636f  ltiple string co
+000228c0: 6c75 6d6e 7320 696e 746f 2061 2073 696e  lumns into a sin
+000228d0: 676c 6520 4e4c 5020 7465 7874 2063 6f6c  gle NLP text col
+000228e0: 756d 6e2e 0a20 2020 2059 6f75 2063 616e  umn..    You can
+000228f0: 2064 6f20 6675 7274 6865 7220 7072 652d   do further pre-
+00022900: 7072 6f63 6573 7369 6e67 206f 6e20 7375  processing on su
+00022910: 6368 2061 2063 6f6d 6269 6e65 6420 636f  ch a combined co
+00022920: 6c75 6d6e 2077 6974 6820 5446 4944 4620  lumn with TFIDF 
+00022930: 6f72 2042 4552 5420 7374 796c 6520 656d  or BERT style em
+00022940: 6265 6464 696e 672e 0a0a 2020 2020 496e  bedding...    In
+00022950: 7075 7473 0a20 2020 202d 2d2d 2d2d 2d2d  puts.    -------
+00022960: 2d2d 0a20 2020 2020 2020 2064 663a 2070  --.        df: p
+00022970: 616e 6461 7320 6461 7461 6672 616d 650a  andas dataframe.
+00022980: 2020 2020 2020 2020 636f 6c73 3a20 7374          cols: st
+00022990: 7269 6e67 2063 6f6c 756d 6e73 2074 6861  ring columns tha
+000229a0: 7420 796f 7520 7761 6e74 2074 6f20 636f  t you want to co
+000229b0: 6e63 6174 656e 6174 6520 696e 746f 2061  ncatenate into a
+000229c0: 2073 696e 676c 6520 636f 6d62 696e 6564   single combined
+000229d0: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
+000229e0: 6669 6c6c 6572 3a20 7374 7269 6e67 2028  filler: string (
+000229f0: 6465 6661 756c 743a 2022 2022 293a 2079  default: " "): y
+00022a00: 6f75 2063 616e 2069 6e70 7574 2061 6e79  ou can input any
+00022a10: 2073 7472 696e 6720 7468 6174 2079 6f75   string that you
+00022a20: 2077 616e 7420 746f 2063 6f6d 6269 6e65   want to combine
+00022a30: 2074 6865 6d20 7769 7468 2e0a 2020 2020   them with..    
+00022a40: 2020 2020 6472 6f70 3a20 6465 6661 756c      drop: defaul
+00022a50: 7420 5472 7565 2e20 4966 2054 7275 652c  t True. If True,
+00022a60: 2064 726f 7020 7468 6520 636f 6c75 6d6e   drop the column
+00022a70: 7320 696e 7075 742e 2049 6620 4661 6c73  s input. If Fals
+00022a80: 652c 206b 6565 7020 7468 6520 636f 6c75  e, keep the colu
+00022a90: 6d6e 732e 0a0a 2020 2020 4f75 7470 7574  mns...    Output
+00022aa0: 733a 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s:.    ---------
+00022ab0: 2d0a 2020 2020 2020 2020 6466 3a20 7468  -.        df: th
+00022ac0: 6572 6520 7769 6c6c 2062 6520 6120 6e65  ere will be a ne
+00022ad0: 7720 636f 6c75 6d6e 2063 616c 6c65 6420  w column called 
+00022ae0: 5b27 636f 6d62 696e 6564 275d 2074 6861  ['combined'] tha
+00022af0: 7420 7769 6c6c 2062 6520 6164 6465 6420  t will be added 
+00022b00: 746f 2079 6f75 7220 6461 7461 6672 616d  to your datafram
+00022b10: 652e 0a20 2020 2022 2222 0a20 2020 2064  e..    """.    d
+00022b20: 6620 3d20 6466 2e63 6f70 7928 6465 6570  f = df.copy(deep
+00022b30: 3d54 7275 6529 0a20 2020 2064 665b 2763  =True).    df['c
+00022b40: 6f6d 6269 6e65 6427 5d20 3d20 6466 5b63  ombined'] = df[c
+00022b50: 6f6c 735d 2e61 7070 6c79 286c 616d 6264  ols].apply(lambd
+00022b60: 6120 726f 773a 2066 696c 6c65 722e 6a6f  a row: filler.jo
+00022b70: 696e 2872 6f77 2e76 616c 7565 732e 6173  in(row.values.as
+00022b80: 7479 7065 2873 7472 2929 2c20 6178 6973  type(str)), axis
+00022b90: 3d31 290a 2020 2020 6966 2064 726f 703a  =1).    if drop:
+00022ba0: 0a20 2020 2020 2020 2064 6620 3d20 6466  .        df = df
+00022bb0: 2e64 726f 7028 636f 6c73 2c20 6178 6973  .drop(cols, axis
+00022bc0: 3d31 290a 2020 2020 7265 7475 726e 2064  =1).    return d
+00022bd0: 660a 2323 2323 2323 2323 2323 2323 2323  f.##############
 00022be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022bf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00022c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022c20: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00022c30: 6672 6f6d 2073 6b6c 6561 726e 2e70 7265  from sklearn.pre
-00022c40: 7072 6f63 6573 7369 6e67 2069 6d70 6f72  processing impor
-00022c50: 7420 4b42 696e 7344 6973 6372 6574 697a  t KBinsDiscretiz
-00022c60: 6572 0a66 726f 6d20 736b 6c65 6172 6e2e  er.from sklearn.
-00022c70: 6d69 7874 7572 6520 696d 706f 7274 2047  mixture import G
-00022c80: 6175 7373 6961 6e4d 6978 7475 7265 0a0a  aussianMixture..
-00022c90: 6465 6620 4645 5f64 6973 6372 6574 697a  def FE_discretiz
-00022ca0: 655f 6e75 6d65 7269 635f 7661 7269 6162  e_numeric_variab
-00022cb0: 6c65 7328 7472 6169 6e2c 2062 696e 5f64  les(train, bin_d
-00022cc0: 6963 742c 2074 6573 743d 2727 2c20 7374  ict, test='', st
-00022cd0: 7261 7465 6779 3d27 6b6d 6561 6e73 272c  rategy='kmeans',
-00022ce0: 7665 7262 6f73 653d 3029 3a0a 2020 2020  verbose=0):.    
-00022cf0: 2222 220a 2020 2020 5468 6973 2068 616e  """.    This han
-00022d00: 6479 2066 756e 6374 696f 6e20 6469 7363  dy function disc
-00022d10: 7265 7469 7a65 7320 6e75 6d65 7269 6320  retizes numeric 
-00022d20: 7661 7269 6162 6c65 7320 696e 746f 2062  variables into b
-00022d30: 696e 6e65 6420 7661 7269 6162 6c65 7320  inned variables 
-00022d40: 7573 696e 6720 6b6d 6561 6e73 2061 6c67  using kmeans alg
-00022d50: 6f72 6974 686d 2e0a 2020 2020 596f 7520  orithm..    You 
-00022d60: 6e65 6564 2074 6f20 7072 6f76 6964 6520  need to provide 
-00022d70: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
-00022d80: 2076 6172 6961 626c 6573 2061 6e64 2074   variables and t
-00022d90: 6865 206e 756d 6265 7273 206f 6620 6269  he numbers of bi
-00022da0: 6e73 2066 6f72 2065 6163 6820 7661 7269  ns for each vari
-00022db0: 6162 6c65 2069 6e20 6120 6469 6374 696f  able in a dictio
-00022dc0: 6e61 7279 2e0a 2020 2020 4974 2077 696c  nary..    It wil
-00022dd0: 6c20 7265 7475 726e 2074 6865 2073 616d  l return the sam
-00022de0: 6520 6461 7461 6672 616d 6520 7769 7468  e dataframe with
-00022df0: 206e 6577 2062 696e 6e65 6420 7661 7269   new binned vari
-00022e00: 6162 6c65 7320 7468 6174 2069 7420 6861  ables that it ha
-00022e10: 7320 6372 6561 7465 642e 0a0a 2020 2020  s created...    
-00022e20: 496e 7075 7473 3a0a 2020 2020 2d2d 2d2d  Inputs:.    ----
-00022e30: 2d2d 2d2d 2d2d 0a20 2020 2064 6620 3a20  ------.    df : 
-00022e40: 7061 6e64 6173 2064 6174 6166 7261 6d65  pandas dataframe
-00022e50: 202d 2070 6c65 6173 6520 656e 7375 7265   - please ensure
-00022e60: 2069 7420 6973 2061 2064 6174 6166 7261   it is a datafra
-00022e70: 6d65 2e20 4e6f 2061 7272 6179 7320 706c  me. No arrays pl
-00022e80: 6561 7365 2e0a 2020 2020 6269 6e5f 6469  ease..    bin_di
-00022e90: 6374 3a20 6469 6374 696f 6e61 7279 206f  ct: dictionary o
-00022ea0: 6620 6e61 6d65 7320 6f66 2076 6172 6961  f names of varia
-00022eb0: 626c 6573 2061 6e64 2074 6865 2062 696e  bles and the bin
-00022ec0: 7320 7468 6174 2079 6f75 2077 616e 7420  s that you want 
-00022ed0: 666f 7220 6561 6368 2076 6172 6961 626c  for each variabl
-00022ee0: 652e 0a20 2020 2073 7472 6174 6567 793a  e..    strategy:
-00022ef0: 2064 6566 6175 6c74 2069 7320 276b 6d65   default is 'kme
-00022f00: 616e 7327 3a20 6275 7420 796f 7520 6361  ans': but you ca
-00022f10: 6e20 6368 6f6f 7365 3a20 7b27 6761 7575  n choose: {'gauu
-00022f20: 7369 616e 272c 2775 6e69 666f 726d 272c  sian','uniform',
-00022f30: 2027 7175 616e 7469 6c65 272c 2027 6b6d   'quantile', 'km
-00022f40: 6561 6e73 277d 0a0a 2020 2020 4f75 7470  eans'}..    Outp
-00022f50: 7574 733a 0a20 2020 202d 2d2d 2d2d 2d2d  uts:.    -------
-00022f60: 2d2d 2d0a 2020 2020 6466 3a20 7061 6e64  ---.    df: pand
-00022f70: 6173 2064 6174 6166 7261 6d65 2077 6974  as dataframe wit
-00022f80: 6820 6e65 7720 7661 7269 6162 6c65 7320  h new variables 
-00022f90: 7769 7468 206e 616d 6573 2073 7563 6820  with names such 
-00022fa0: 6173 3a20 2076 6172 6961 626c 652b 275f  as:  variable+'_
-00022fb0: 6469 7363 7265 7465 270a 2020 2020 2222  discrete'.    ""
-00022fc0: 220a 2020 2020 6466 203d 2063 6f70 792e  ".    df = copy.
-00022fd0: 6465 6570 636f 7079 2874 7261 696e 290a  deepcopy(train).
-00022fe0: 2020 2020 7465 7374 203d 2063 6f70 792e      test = copy.
-00022ff0: 6465 6570 636f 7079 2874 6573 7429 0a20  deepcopy(test). 
-00023000: 2020 206e 756d 5f63 6f6c 7320 3d20 6c65     num_cols = le
-00023010: 6e28 6269 6e5f 6469 6374 290a 2020 2020  n(bin_dict).    
-00023020: 6e72 6f77 7320 3d20 696e 7428 286e 756d  nrows = int((num
-00023030: 5f63 6f6c 732f 3229 2b30 2e35 290a 2020  _cols/2)+0.5).  
-00023040: 2020 2370 7269 6e74 2827 6e72 6f77 7327    #print('nrows'
-00023050: 2c6e 726f 7773 290a 2020 2020 6966 2076  ,nrows).    if v
-00023060: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
-00023070: 6669 6720 3d20 706c 742e 6669 6775 7265  fig = plt.figure
-00023080: 2866 6967 7369 7a65 3d28 3130 2c33 2a6e  (figsize=(10,3*n
-00023090: 756d 5f63 6f6c 7329 290a 2020 2020 666f  um_cols)).    fo
-000230a0: 7220 692c 2028 636f 6c2c 2062 696e 7661  r i, (col, binva
-000230b0: 6c75 6529 2069 6e20 656e 756d 6572 6174  lue) in enumerat
-000230c0: 6528 6269 6e5f 6469 6374 2e69 7465 6d73  e(bin_dict.items
-000230d0: 2829 293a 0a20 2020 2020 2020 206e 6577  ()):.        new
-000230e0: 5f63 6f6c 203d 2063 6f6c 2b27 5f64 6973  _col = col+'_dis
-000230f0: 6372 6574 6527 0a20 2020 2020 2020 2069  crete'.        i
-00023100: 6620 7374 7261 7465 6779 203d 3d20 2767  f strategy == 'g
-00023110: 6175 7373 6961 6e27 3a0a 2020 2020 2020  aussian':.      
-00023120: 2020 2020 2020 6b62 6420 3d20 4761 7573        kbd = Gaus
-00023130: 7369 616e 4d69 7874 7572 6528 6e5f 636f  sianMixture(n_co
-00023140: 6d70 6f6e 656e 7473 3d62 696e 7661 6c75  mponents=binvalu
-00023150: 652c 2072 616e 646f 6d5f 7374 6174 653d  e, random_state=
-00023160: 3939 290a 2020 2020 2020 2020 2020 2020  99).            
-00023170: 6466 5b6e 6577 5f63 6f6c 5d20 3d20 6b62  df[new_col] = kb
-00023180: 642e 6669 745f 7072 6564 6963 7428 6466  d.fit_predict(df
-00023190: 5b5b 636f 6c5d 5d29 2e61 7374 7970 6528  [[col]]).astype(
-000231a0: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
-000231b0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-000231c0: 6365 2874 6573 742c 2073 7472 293a 0a20  ce(test, str):. 
-000231d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000231e0: 6573 745b 6e65 775f 636f 6c5d 203d 206b  est[new_col] = k
-000231f0: 6264 2e70 7265 6469 6374 2874 6573 745b  bd.predict(test[
-00023200: 5b63 6f6c 5d5d 292e 6173 7479 7065 2869  [col]]).astype(i
-00023210: 6e74 290a 2020 2020 2020 2020 656c 7365  nt).        else
-00023220: 3a0a 2020 2020 2020 2020 2020 2020 6b62  :.            kb
-00023230: 6420 3d20 4b42 696e 7344 6973 6372 6574  d = KBinsDiscret
-00023240: 697a 6572 286e 5f62 696e 733d 6269 6e76  izer(n_bins=binv
-00023250: 616c 7565 2c20 656e 636f 6465 3d27 6f72  alue, encode='or
-00023260: 6469 6e61 6c27 2c20 7374 7261 7465 6779  dinal', strategy
-00023270: 3d73 7472 6174 6567 7929 0a20 2020 2020  =strategy).     
-00023280: 2020 2020 2020 2064 665b 6e65 775f 636f         df[new_co
-00023290: 6c5d 203d 206b 6264 2e66 6974 5f74 7261  l] = kbd.fit_tra
-000232a0: 6e73 666f 726d 2864 665b 5b63 6f6c 5d5d  nsform(df[[col]]
-000232b0: 292e 6173 7479 7065 2869 6e74 290a 2020  ).astype(int).  
-000232c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000232d0: 2069 7369 6e73 7461 6e63 6528 7465 7374   isinstance(test
-000232e0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-000232f0: 2020 2020 2020 2020 7465 7374 5b6e 6577          test[new
-00023300: 5f63 6f6c 5d20 3d20 6b62 642e 7472 616e  _col] = kbd.tran
-00023310: 7366 6f72 6d28 7465 7374 5b5b 636f 6c5d  sform(test[[col]
-00023320: 5d29 2e61 7374 7970 6528 696e 7429 0a20  ]).astype(int). 
-00023330: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-00023340: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-00023350: 7831 203d 2070 6c74 2e73 7562 706c 6f74  x1 = plt.subplot
-00023360: 286e 726f 7773 2c32 2c69 2b31 290a 2020  (nrows,2,i+1).  
-00023370: 2020 2020 2020 2020 2020 6178 312e 7363            ax1.sc
-00023380: 6174 7465 7228 6466 5b63 6f6c 5d2c 6466  atter(df[col],df
-00023390: 5b6e 6577 5f63 6f6c 5d29 0a20 2020 2020  [new_col]).     
-000233a0: 2020 2020 2020 2061 7831 2e73 6574 5f74         ax1.set_t
-000233b0: 6974 6c65 286e 6577 5f63 6f6c 290a 2020  itle(new_col).  
-000233c0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-000233d0: 6e63 6528 7465 7374 2c20 7374 7229 3a0a  nce(test, str):.
-000233e0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-000233f0: 662c 2074 6573 740a 2020 2020 656c 7365  f, test.    else
-00023400: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00023410: 2064 660a 2323 2323 2323 2323 2323 2323   df.############
+00022c20: 2323 2323 0a66 726f 6d20 736b 6c65 6172  ####.from sklear
+00022c30: 6e2e 7072 6570 726f 6365 7373 696e 6720  n.preprocessing 
+00022c40: 696d 706f 7274 204b 4269 6e73 4469 7363  import KBinsDisc
+00022c50: 7265 7469 7a65 720a 6672 6f6d 2073 6b6c  retizer.from skl
+00022c60: 6561 726e 2e6d 6978 7475 7265 2069 6d70  earn.mixture imp
+00022c70: 6f72 7420 4761 7573 7369 616e 4d69 7874  ort GaussianMixt
+00022c80: 7572 650a 0a64 6566 2046 455f 6469 7363  ure..def FE_disc
+00022c90: 7265 7469 7a65 5f6e 756d 6572 6963 5f76  retize_numeric_v
+00022ca0: 6172 6961 626c 6573 2874 7261 696e 2c20  ariables(train, 
+00022cb0: 6269 6e5f 6469 6374 2c20 7465 7374 3d27  bin_dict, test='
+00022cc0: 272c 2073 7472 6174 6567 793d 276b 6d65  ', strategy='kme
+00022cd0: 616e 7327 2c76 6572 626f 7365 3d30 293a  ans',verbose=0):
+00022ce0: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
+00022cf0: 7320 6861 6e64 7920 6675 6e63 7469 6f6e  s handy function
+00022d00: 2064 6973 6372 6574 697a 6573 206e 756d   discretizes num
+00022d10: 6572 6963 2076 6172 6961 626c 6573 2069  eric variables i
+00022d20: 6e74 6f20 6269 6e6e 6564 2076 6172 6961  nto binned varia
+00022d30: 626c 6573 2075 7369 6e67 206b 6d65 616e  bles using kmean
+00022d40: 7320 616c 676f 7269 7468 6d2e 0a20 2020  s algorithm..   
+00022d50: 2059 6f75 206e 6565 6420 746f 2070 726f   You need to pro
+00022d60: 7669 6465 2074 6865 206e 616d 6573 206f  vide the names o
+00022d70: 6620 7468 6520 7661 7269 6162 6c65 7320  f the variables 
+00022d80: 616e 6420 7468 6520 6e75 6d62 6572 7320  and the numbers 
+00022d90: 6f66 2062 696e 7320 666f 7220 6561 6368  of bins for each
+00022da0: 2076 6172 6961 626c 6520 696e 2061 2064   variable in a d
+00022db0: 6963 7469 6f6e 6172 792e 0a20 2020 2049  ictionary..    I
+00022dc0: 7420 7769 6c6c 2072 6574 7572 6e20 7468  t will return th
+00022dd0: 6520 7361 6d65 2064 6174 6166 7261 6d65  e same dataframe
+00022de0: 2077 6974 6820 6e65 7720 6269 6e6e 6564   with new binned
+00022df0: 2076 6172 6961 626c 6573 2074 6861 7420   variables that 
+00022e00: 6974 2068 6173 2063 7265 6174 6564 2e0a  it has created..
+00022e10: 0a20 2020 2049 6e70 7574 733a 0a20 2020  .    Inputs:.   
+00022e20: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00022e30: 6466 203a 2070 616e 6461 7320 6461 7461  df : pandas data
+00022e40: 6672 616d 6520 2d20 706c 6561 7365 2065  frame - please e
+00022e50: 6e73 7572 6520 6974 2069 7320 6120 6461  nsure it is a da
+00022e60: 7461 6672 616d 652e 204e 6f20 6172 7261  taframe. No arra
+00022e70: 7973 2070 6c65 6173 652e 0a20 2020 2062  ys please..    b
+00022e80: 696e 5f64 6963 743a 2064 6963 7469 6f6e  in_dict: diction
+00022e90: 6172 7920 6f66 206e 616d 6573 206f 6620  ary of names of 
+00022ea0: 7661 7269 6162 6c65 7320 616e 6420 7468  variables and th
+00022eb0: 6520 6269 6e73 2074 6861 7420 796f 7520  e bins that you 
+00022ec0: 7761 6e74 2066 6f72 2065 6163 6820 7661  want for each va
+00022ed0: 7269 6162 6c65 2e0a 2020 2020 7374 7261  riable..    stra
+00022ee0: 7465 6779 3a20 6465 6661 756c 7420 6973  tegy: default is
+00022ef0: 2027 6b6d 6561 6e73 273a 2062 7574 2079   'kmeans': but y
+00022f00: 6f75 2063 616e 2063 686f 6f73 653a 207b  ou can choose: {
+00022f10: 2767 6175 7573 6961 6e27 2c27 756e 6966  'gauusian','unif
+00022f20: 6f72 6d27 2c20 2771 7561 6e74 696c 6527  orm', 'quantile'
+00022f30: 2c20 276b 6d65 616e 7327 7d0a 0a20 2020  , 'kmeans'}..   
+00022f40: 204f 7574 7075 7473 3a0a 2020 2020 2d2d   Outputs:.    --
+00022f50: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 663a  --------.    df:
+00022f60: 2070 616e 6461 7320 6461 7461 6672 616d   pandas datafram
+00022f70: 6520 7769 7468 206e 6577 2076 6172 6961  e with new varia
+00022f80: 626c 6573 2077 6974 6820 6e61 6d65 7320  bles with names 
+00022f90: 7375 6368 2061 733a 2020 7661 7269 6162  such as:  variab
+00022fa0: 6c65 2b27 5f64 6973 6372 6574 6527 0a20  le+'_discrete'. 
+00022fb0: 2020 2022 2222 0a20 2020 2064 6620 3d20     """.    df = 
+00022fc0: 636f 7079 2e64 6565 7063 6f70 7928 7472  copy.deepcopy(tr
+00022fd0: 6169 6e29 0a20 2020 2074 6573 7420 3d20  ain).    test = 
+00022fe0: 636f 7079 2e64 6565 7063 6f70 7928 7465  copy.deepcopy(te
+00022ff0: 7374 290a 2020 2020 6e75 6d5f 636f 6c73  st).    num_cols
+00023000: 203d 206c 656e 2862 696e 5f64 6963 7429   = len(bin_dict)
+00023010: 0a20 2020 206e 726f 7773 203d 2069 6e74  .    nrows = int
+00023020: 2828 6e75 6d5f 636f 6c73 2f32 292b 302e  ((num_cols/2)+0.
+00023030: 3529 0a20 2020 2023 7072 696e 7428 276e  5).    #print('n
+00023040: 726f 7773 272c 6e72 6f77 7329 0a20 2020  rows',nrows).   
+00023050: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+00023060: 2020 2020 2066 6967 203d 2070 6c74 2e66       fig = plt.f
+00023070: 6967 7572 6528 6669 6773 697a 653d 2831  igure(figsize=(1
+00023080: 302c 332a 6e75 6d5f 636f 6c73 2929 0a20  0,3*num_cols)). 
+00023090: 2020 2066 6f72 2069 2c20 2863 6f6c 2c20     for i, (col, 
+000230a0: 6269 6e76 616c 7565 2920 696e 2065 6e75  binvalue) in enu
+000230b0: 6d65 7261 7465 2862 696e 5f64 6963 742e  merate(bin_dict.
+000230c0: 6974 656d 7328 2929 3a0a 2020 2020 2020  items()):.      
+000230d0: 2020 6e65 775f 636f 6c20 3d20 636f 6c2b    new_col = col+
+000230e0: 275f 6469 7363 7265 7465 270a 2020 2020  '_discrete'.    
+000230f0: 2020 2020 6966 2073 7472 6174 6567 7920      if strategy 
+00023100: 3d3d 2027 6761 7573 7369 616e 273a 0a20  == 'gaussian':. 
+00023110: 2020 2020 2020 2020 2020 206b 6264 203d             kbd =
+00023120: 2047 6175 7373 6961 6e4d 6978 7475 7265   GaussianMixture
+00023130: 286e 5f63 6f6d 706f 6e65 6e74 733d 6269  (n_components=bi
+00023140: 6e76 616c 7565 2c20 7261 6e64 6f6d 5f73  nvalue, random_s
+00023150: 7461 7465 3d39 3929 0a20 2020 2020 2020  tate=99).       
+00023160: 2020 2020 2064 665b 6e65 775f 636f 6c5d       df[new_col]
+00023170: 203d 206b 6264 2e66 6974 5f70 7265 6469   = kbd.fit_predi
+00023180: 6374 2864 665b 5b63 6f6c 5d5d 292e 6173  ct(df[[col]]).as
+00023190: 7479 7065 2869 6e74 290a 2020 2020 2020  type(int).      
+000231a0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+000231b0: 6e73 7461 6e63 6528 7465 7374 2c20 7374  nstance(test, st
+000231c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000231d0: 2020 2020 7465 7374 5b6e 6577 5f63 6f6c      test[new_col
+000231e0: 5d20 3d20 6b62 642e 7072 6564 6963 7428  ] = kbd.predict(
+000231f0: 7465 7374 5b5b 636f 6c5d 5d29 2e61 7374  test[[col]]).ast
+00023200: 7970 6528 696e 7429 0a20 2020 2020 2020  ype(int).       
+00023210: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00023220: 2020 206b 6264 203d 204b 4269 6e73 4469     kbd = KBinsDi
+00023230: 7363 7265 7469 7a65 7228 6e5f 6269 6e73  scretizer(n_bins
+00023240: 3d62 696e 7661 6c75 652c 2065 6e63 6f64  =binvalue, encod
+00023250: 653d 276f 7264 696e 616c 272c 2073 7472  e='ordinal', str
+00023260: 6174 6567 793d 7374 7261 7465 6779 290a  ategy=strategy).
+00023270: 2020 2020 2020 2020 2020 2020 6466 5b6e              df[n
+00023280: 6577 5f63 6f6c 5d20 3d20 6b62 642e 6669  ew_col] = kbd.fi
+00023290: 745f 7472 616e 7366 6f72 6d28 6466 5b5b  t_transform(df[[
+000232a0: 636f 6c5d 5d29 2e61 7374 7970 6528 696e  col]]).astype(in
+000232b0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
+000232c0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+000232d0: 2874 6573 742c 2073 7472 293a 0a20 2020  (test, str):.   
+000232e0: 2020 2020 2020 2020 2020 2020 2074 6573               tes
+000232f0: 745b 6e65 775f 636f 6c5d 203d 206b 6264  t[new_col] = kbd
+00023300: 2e74 7261 6e73 666f 726d 2874 6573 745b  .transform(test[
+00023310: 5b63 6f6c 5d5d 292e 6173 7479 7065 2869  [col]]).astype(i
+00023320: 6e74 290a 2020 2020 2020 2020 6966 2076  nt).        if v
+00023330: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+00023340: 2020 2020 6178 3120 3d20 706c 742e 7375      ax1 = plt.su
+00023350: 6270 6c6f 7428 6e72 6f77 732c 322c 692b  bplot(nrows,2,i+
+00023360: 3129 0a20 2020 2020 2020 2020 2020 2061  1).            a
+00023370: 7831 2e73 6361 7474 6572 2864 665b 636f  x1.scatter(df[co
+00023380: 6c5d 2c64 665b 6e65 775f 636f 6c5d 290a  l],df[new_col]).
+00023390: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
+000233a0: 7365 745f 7469 746c 6528 6e65 775f 636f  set_title(new_co
+000233b0: 6c29 0a20 2020 2069 6620 6e6f 7420 6973  l).    if not is
+000233c0: 696e 7374 616e 6365 2874 6573 742c 2073  instance(test, s
+000233d0: 7472 293a 0a20 2020 2020 2020 2072 6574  tr):.        ret
+000233e0: 7572 6e20 6466 2c20 7465 7374 0a20 2020  urn df, test.   
+000233f0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+00023400: 6574 7572 6e20 6466 0a23 2323 2323 2323  eturn df.#######
+00023410: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023430: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023460: 2323 2323 2323 0a64 6566 2046 455f 7472  ######.def FE_tr
-00023470: 616e 7366 6f72 6d5f 6e75 6d65 7269 635f  ansform_numeric_
-00023480: 636f 6c75 6d6e 735f 746f 5f62 696e 7328  columns_to_bins(
-00023490: 6466 2c20 6269 6e5f 6469 6374 2c20 7665  df, bin_dict, ve
-000234a0: 7262 6f73 653d 3029 3a0a 2020 2020 2222  rbose=0):.    ""
-000234b0: 220a 2020 2020 5468 6973 2068 616e 6479  ".    This handy
-000234c0: 2066 756e 6374 696f 6e20 6469 7363 7265   function discre
-000234d0: 7469 7a65 7320 6e75 6d65 7269 6320 7661  tizes numeric va
-000234e0: 7269 6162 6c65 7320 696e 746f 2062 696e  riables into bin
-000234f0: 6e65 6420 7661 7269 6162 6c65 7320 7573  ned variables us
-00023500: 696e 6720 6b6d 6561 6e73 2061 6c67 6f72  ing kmeans algor
-00023510: 6974 686d 2e0a 2020 2020 596f 7520 6e65  ithm..    You ne
-00023520: 6564 2074 6f20 7072 6f76 6964 6520 7468  ed to provide th
-00023530: 6520 6e61 6d65 7320 6f66 2074 6865 2076  e names of the v
-00023540: 6172 6961 626c 6573 2061 6e64 2074 6865  ariables and the
-00023550: 206e 756d 6265 7273 206f 6620 6269 6e73   numbers of bins
-00023560: 2066 6f72 2065 6163 6820 7661 7269 6162   for each variab
-00023570: 6c65 2069 6e20 6120 6469 6374 696f 6e61  le in a dictiona
-00023580: 7279 2e0a 2020 2020 4974 2077 696c 6c20  ry..    It will 
-00023590: 7265 7475 726e 2074 6865 2073 616d 6520  return the same 
-000235a0: 6461 7461 6672 616d 6520 7769 7468 206e  dataframe with n
-000235b0: 6577 2062 696e 6e65 6420 7661 7269 6162  ew binned variab
-000235c0: 6c65 7320 7468 6174 2069 7420 6861 7320  les that it has 
-000235d0: 6372 6561 7465 642e 0a0a 2020 2020 496e  created...    In
-000235e0: 7075 7473 3a0a 2020 2020 2d2d 2d2d 2d2d  puts:.    ------
-000235f0: 2d2d 2d2d 0a20 2020 2064 6620 3a20 7061  ----.    df : pa
-00023600: 6e64 6173 2064 6174 6166 7261 6d65 202d  ndas dataframe -
-00023610: 2070 6c65 6173 6520 656e 7375 7265 2069   please ensure i
-00023620: 7420 6973 2061 2064 6174 6166 7261 6d65  t is a dataframe
-00023630: 2e20 4e6f 2061 7272 6179 7320 706c 6561  . No arrays plea
-00023640: 7365 2e0a 2020 2020 6269 6e5f 6469 6374  se..    bin_dict
-00023650: 3a20 6469 6374 696f 6e61 7279 206f 6620  : dictionary of 
-00023660: 6e61 6d65 7320 6f66 2076 6172 6961 626c  names of variabl
-00023670: 6573 2061 6e64 2074 6865 206b 696e 6420  es and the kind 
-00023680: 6f66 2074 7261 6e73 666f 726d 6174 696f  of transformatio
-00023690: 6e20 796f 7520 7761 6e74 0a20 2020 2020  n you want.     
-000236a0: 2020 2064 6566 6175 6c74 2069 7320 276c     default is 'l
-000236b0: 6f67 273a 2062 7574 2079 6f75 2063 616e  og': but you can
-000236c0: 2063 686f 6f73 653a 207b 276c 6f67 272c   choose: {'log',
-000236d0: 276c 6f67 3130 272c 2027 7371 7274 272c  'log10', 'sqrt',
-000236e0: 2027 6d61 782d 6162 7327 7d0a 0a20 2020   'max-abs'}..   
-000236f0: 204f 7574 7075 7473 3a0a 2020 2020 2d2d   Outputs:.    --
-00023700: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 663a  --------.    df:
-00023710: 2070 616e 6461 7320 6461 7461 6672 616d   pandas datafram
-00023720: 6520 7769 7468 206e 6577 2076 6172 6961  e with new varia
-00023730: 626c 6573 2077 6974 6820 6e61 6d65 7320  bles with names 
-00023740: 7375 6368 2061 733a 2020 7661 7269 6162  such as:  variab
-00023750: 6c65 2b27 5f64 6973 6372 6574 6527 0a20  le+'_discrete'. 
-00023760: 2020 2022 2222 0a20 2020 2064 6620 3d20     """.    df = 
-00023770: 636f 7079 2e64 6565 7063 6f70 7928 6466  copy.deepcopy(df
-00023780: 290a 2020 2020 6e75 6d5f 636f 6c73 203d  ).    num_cols =
-00023790: 206c 656e 2862 696e 5f64 6963 7429 0a20   len(bin_dict). 
-000237a0: 2020 206e 726f 7773 203d 2069 6e74 2828     nrows = int((
-000237b0: 6e75 6d5f 636f 6c73 2f32 292b 302e 3529  num_cols/2)+0.5)
-000237c0: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
-000237d0: 0a20 2020 2020 2020 2066 6967 203d 2070  .        fig = p
-000237e0: 6c74 2e66 6967 7572 6528 6669 6773 697a  lt.figure(figsiz
-000237f0: 653d 2831 302c 332a 6e75 6d5f 636f 6c73  e=(10,3*num_cols
-00023800: 2929 0a20 2020 2066 6f72 2069 2c20 2863  )).    for i, (c
-00023810: 6f6c 2c20 6269 6e76 616c 7565 2920 696e  ol, binvalue) in
-00023820: 2065 6e75 6d65 7261 7465 2862 696e 5f64   enumerate(bin_d
-00023830: 6963 742e 6974 656d 7328 2929 3a0a 2020  ict.items()):.  
-00023840: 2020 2020 2020 6e65 775f 636f 6c20 3d20        new_col = 
-00023850: 636f 6c2b 275f 272b 6269 6e76 616c 7565  col+'_'+binvalue
-00023860: 0a20 2020 2020 2020 2069 6620 6269 6e76  .        if binv
-00023870: 616c 7565 203d 3d20 276c 6f67 273a 0a20  alue == 'log':. 
-00023880: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00023890: 2827 5761 726e 696e 673a 204e 6567 6174  ('Warning: Negat
-000238a0: 6976 6520 7661 6c75 6573 2069 6e20 2573  ive values in %s
-000238b0: 2068 6176 6520 6265 656e 206d 6164 6520   have been made 
-000238c0: 706f 7369 7469 7665 2062 6566 6f72 6520  positive before 
-000238d0: 6c6f 6720 7472 616e 7366 6f72 6d21 2720  log transform!' 
-000238e0: 2563 6f6c 290a 2020 2020 2020 2020 2020  %col).          
-000238f0: 2020 6466 2e6c 6f63 5b64 665b 636f 6c5d    df.loc[df[col]
-00023900: 3d3d 302c 636f 6c5d 203d 2031 652d 3135  ==0,col] = 1e-15
-00023910: 2020 2323 2320 6d61 6b65 2069 7420 6120    ### make it a 
-00023920: 736d 616c 6c20 6e75 6d62 6572 0a20 2020  small number.   
-00023930: 2020 2020 2020 2020 2064 665b 6e65 775f           df[new_
-00023940: 636f 6c5d 203d 206e 702e 6162 7328 6466  col] = np.abs(df
-00023950: 5b63 6f6c 5d2e 7661 6c75 6573 290a 2020  [col].values).  
-00023960: 2020 2020 2020 2020 2020 6466 5b6e 6577            df[new
-00023970: 5f63 6f6c 5d20 3d20 6e70 2e6c 6f67 2864  _col] = np.log(d
-00023980: 665b 6e65 775f 636f 6c5d 292e 7661 6c75  f[new_col]).valu
-00023990: 6573 0a20 2020 2020 2020 2065 6c69 6620  es.        elif 
-000239a0: 6269 6e76 616c 7565 203d 3d20 276c 6f67  binvalue == 'log
-000239b0: 3130 273a 0a20 2020 2020 2020 2020 2020  10':.           
-000239c0: 2070 7269 6e74 2827 5761 726e 696e 673a   print('Warning:
-000239d0: 204e 6567 6174 6976 6520 7661 6c75 6573   Negative values
-000239e0: 2069 6e20 2573 2068 6176 6520 6265 656e   in %s have been
-000239f0: 206d 6164 6520 706f 7369 7469 7665 2062   made positive b
-00023a00: 6566 6f72 6520 6c6f 6731 3020 7472 616e  efore log10 tran
-00023a10: 7366 6f72 6d21 2720 2563 6f6c 290a 2020  sform!' %col).  
-00023a20: 2020 2020 2020 2020 2020 6466 2e6c 6f63            df.loc
-00023a30: 5b64 665b 636f 6c5d 3d3d 302c 636f 6c5d  [df[col]==0,col]
-00023a40: 203d 2031 652d 3135 2020 2323 2320 6d61   = 1e-15  ### ma
-00023a50: 6b65 2069 7420 6120 736d 616c 6c20 6e75  ke it a small nu
-00023a60: 6d62 6572 0a20 2020 2020 2020 2020 2020  mber.           
-00023a70: 2064 665b 6e65 775f 636f 6c5d 203d 206e   df[new_col] = n
-00023a80: 702e 6162 7328 6466 5b63 6f6c 5d2e 7661  p.abs(df[col].va
-00023a90: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
-00023aa0: 2020 6466 5b6e 6577 5f63 6f6c 5d20 3d20    df[new_col] = 
-00023ab0: 6e70 2e6c 6f67 3130 2864 665b 6e65 775f  np.log10(df[new_
-00023ac0: 636f 6c5d 292e 7661 6c75 6573 0a20 2020  col]).values.   
-00023ad0: 2020 2020 2065 6c69 6620 6269 6e76 616c       elif binval
-00023ae0: 7565 203d 3d20 2773 7172 7427 3a0a 2020  ue == 'sqrt':.  
-00023af0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00023b00: 2757 6172 6e69 6e67 3a20 4e65 6761 7469  'Warning: Negati
-00023b10: 7665 2076 616c 7565 7320 696e 2025 7320  ve values in %s 
-00023b20: 6861 7665 2062 6565 6e20 6d61 6465 2070  have been made p
-00023b30: 6f73 6974 6976 6520 6265 666f 7265 2073  ositive before s
-00023b40: 7172 7420 7472 616e 7366 6f72 6d21 2720  qrt transform!' 
-00023b50: 2563 6f6c 290a 2020 2020 2020 2020 2020  %col).          
-00023b60: 2020 6466 5b6e 6577 5f63 6f6c 5d20 3d20    df[new_col] = 
-00023b70: 6e70 2e61 6273 2864 665b 636f 6c5d 2e76  np.abs(df[col].v
-00023b80: 616c 7565 7329 2020 2323 2320 6d61 6b65  alues)  ### make
-00023b90: 2069 7420 6120 736d 616c 6c20 6e75 6d62   it a small numb
-00023ba0: 6572 0a20 2020 2020 2020 2020 2020 2064  er.            d
-00023bb0: 665b 6e65 775f 636f 6c5d 203d 206e 702e  f[new_col] = np.
-00023bc0: 7371 7274 2864 665b 6e65 775f 636f 6c5d  sqrt(df[new_col]
-00023bd0: 292e 7661 6c75 6573 0a20 2020 2020 2020  ).values.       
-00023be0: 2065 6c69 6620 6269 6e76 616c 7565 203d   elif binvalue =
-00023bf0: 3d20 276d 6178 2d61 6273 273a 0a20 2020  = 'max-abs':.   
-00023c00: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00023c10: 5761 726e 696e 673a 204e 6567 6174 6976  Warning: Negativ
-00023c20: 6520 7661 6c75 6573 2069 6e20 2573 2068  e values in %s h
-00023c30: 6176 6520 6265 656e 206d 6164 6520 706f  ave been made po
-00023c40: 7369 7469 7665 2062 6566 6f72 6520 6d61  sitive before ma
-00023c50: 782d 6162 7320 7472 616e 7366 6f72 6d21  x-abs transform!
-00023c60: 2720 2563 6f6c 290a 2020 2020 2020 2020  ' %col).        
-00023c70: 2020 2020 636f 6c5f 6d61 7820 3d20 6d61      col_max = ma
-00023c80: 7828 6e70 2e61 6273 2864 665b 636f 6c5d  x(np.abs(df[col]
-00023c90: 2e76 616c 7565 7329 290a 2020 2020 2020  .values)).      
-00023ca0: 2020 2020 2020 6966 2063 6f6c 5f6d 6178        if col_max
-00023cb0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00023cc0: 2020 2020 2020 2063 6f6c 5f6d 6178 203d         col_max =
-00023cd0: 2031 0a20 2020 2020 2020 2020 2020 2064   1.            d
-00023ce0: 665b 6e65 775f 636f 6c5d 203d 206e 702e  f[new_col] = np.
-00023cf0: 6162 7328 6466 5b63 6f6c 5d2e 7661 6c75  abs(df[col].valu
-00023d00: 6573 292f 636f 6c5f 6d61 780a 2020 2020  es)/col_max.    
-00023d10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00023d20: 2020 2020 2020 7072 696e 7428 2757 6172        print('War
-00023d30: 6e69 6e67 3a20 4e65 6761 7469 7665 2076  ning: Negative v
-00023d40: 616c 7565 7320 696e 2025 7320 6861 7665  alues in %s have
-00023d50: 2062 6565 6e20 6d61 6465 2070 6f73 6974   been made posit
-00023d60: 6976 6520 6265 666f 7265 206c 6f67 2074  ive before log t
-00023d70: 7261 6e73 666f 726d 2127 2025 636f 6c29  ransform!' %col)
-00023d80: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
-00023d90: 6c6f 635b 6466 5b63 6f6c 5d3d 3d30 2c63  loc[df[col]==0,c
-00023da0: 6f6c 5d20 3d20 3165 2d31 3520 2023 2323  ol] = 1e-15  ###
-00023db0: 206d 616b 6520 6974 2061 2073 6d61 6c6c   make it a small
-00023dc0: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
-00023dd0: 2020 2020 6466 5b6e 6577 5f63 6f6c 5d20      df[new_col] 
-00023de0: 3d20 6e70 2e61 6273 2864 665b 636f 6c5d  = np.abs(df[col]
-00023df0: 2e76 616c 7565 7329 0a20 2020 2020 2020  .values).       
-00023e00: 2020 2020 2064 665b 6e65 775f 636f 6c5d       df[new_col]
-00023e10: 203d 206e 702e 6c6f 6728 6466 5b6e 6577   = np.log(df[new
-00023e20: 5f63 6f6c 5d29 2e76 616c 7565 730a 2020  _col]).values.  
-00023e30: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-00023e40: 3a0a 2020 2020 2020 2020 2020 2020 6178  :.            ax
-00023e50: 3120 3d20 706c 742e 7375 6270 6c6f 7428  1 = plt.subplot(
-00023e60: 6e72 6f77 732c 322c 692b 3129 0a20 2020  nrows,2,i+1).   
-00023e70: 2020 2020 2020 2020 2064 665b 636f 6c5d           df[col]
-00023e80: 2e70 6c6f 742e 6b64 6528 6178 3d61 7831  .plot.kde(ax=ax1
-00023e90: 2c20 6c61 6265 6c3d 636f 6c2c 616c 7068  , label=col,alph
-00023ea0: 613d 302e 352c 636f 6c6f 723d 2772 2729  a=0.5,color='r')
-00023eb0: 0a20 2020 2020 2020 2020 2020 2061 7832  .            ax2
-00023ec0: 203d 2061 7831 2e74 7769 6e79 2829 0a20   = ax1.twiny(). 
-00023ed0: 2020 2020 2020 2020 2020 2064 665b 6e65             df[ne
-00023ee0: 775f 636f 6c5d 2e70 6c6f 742e 6b64 6528  w_col].plot.kde(
-00023ef0: 6178 3d61 7832 2c6c 6162 656c 3d6e 6577  ax=ax2,label=new
-00023f00: 5f63 6f6c 2c61 6c70 6861 3d30 2e35 2c63  _col,alpha=0.5,c
-00023f10: 6f6c 6f72 3d27 6227 290a 2020 2020 2020  olor='b').      
-00023f20: 2020 2020 2020 706c 742e 6c65 6765 6e64        plt.legend
-00023f30: 2829 3b0a 2020 2020 7265 7475 726e 2064  ();.    return d
-00023f40: 660a 2323 2323 2323 2323 2323 2323 2323  f.##############
+00023450: 2323 2323 2323 2323 2323 230a 6465 6620  ###########.def 
+00023460: 4645 5f74 7261 6e73 666f 726d 5f6e 756d  FE_transform_num
+00023470: 6572 6963 5f63 6f6c 756d 6e73 5f74 6f5f  eric_columns_to_
+00023480: 6269 6e73 2864 662c 2062 696e 5f64 6963  bins(df, bin_dic
+00023490: 742c 2076 6572 626f 7365 3d30 293a 0a20  t, verbose=0):. 
+000234a0: 2020 2022 2222 0a20 2020 2054 6869 7320     """.    This 
+000234b0: 6861 6e64 7920 6675 6e63 7469 6f6e 2064  handy function d
+000234c0: 6973 6372 6574 697a 6573 206e 756d 6572  iscretizes numer
+000234d0: 6963 2076 6172 6961 626c 6573 2069 6e74  ic variables int
+000234e0: 6f20 6269 6e6e 6564 2076 6172 6961 626c  o binned variabl
+000234f0: 6573 2075 7369 6e67 206b 6d65 616e 7320  es using kmeans 
+00023500: 616c 676f 7269 7468 6d2e 0a20 2020 2059  algorithm..    Y
+00023510: 6f75 206e 6565 6420 746f 2070 726f 7669  ou need to provi
+00023520: 6465 2074 6865 206e 616d 6573 206f 6620  de the names of 
+00023530: 7468 6520 7661 7269 6162 6c65 7320 616e  the variables an
+00023540: 6420 7468 6520 6e75 6d62 6572 7320 6f66  d the numbers of
+00023550: 2062 696e 7320 666f 7220 6561 6368 2076   bins for each v
+00023560: 6172 6961 626c 6520 696e 2061 2064 6963  ariable in a dic
+00023570: 7469 6f6e 6172 792e 0a20 2020 2049 7420  tionary..    It 
+00023580: 7769 6c6c 2072 6574 7572 6e20 7468 6520  will return the 
+00023590: 7361 6d65 2064 6174 6166 7261 6d65 2077  same dataframe w
+000235a0: 6974 6820 6e65 7720 6269 6e6e 6564 2076  ith new binned v
+000235b0: 6172 6961 626c 6573 2074 6861 7420 6974  ariables that it
+000235c0: 2068 6173 2063 7265 6174 6564 2e0a 0a20   has created... 
+000235d0: 2020 2049 6e70 7574 733a 0a20 2020 202d     Inputs:.    -
+000235e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
+000235f0: 203a 2070 616e 6461 7320 6461 7461 6672   : pandas datafr
+00023600: 616d 6520 2d20 706c 6561 7365 2065 6e73  ame - please ens
+00023610: 7572 6520 6974 2069 7320 6120 6461 7461  ure it is a data
+00023620: 6672 616d 652e 204e 6f20 6172 7261 7973  frame. No arrays
+00023630: 2070 6c65 6173 652e 0a20 2020 2062 696e   please..    bin
+00023640: 5f64 6963 743a 2064 6963 7469 6f6e 6172  _dict: dictionar
+00023650: 7920 6f66 206e 616d 6573 206f 6620 7661  y of names of va
+00023660: 7269 6162 6c65 7320 616e 6420 7468 6520  riables and the 
+00023670: 6b69 6e64 206f 6620 7472 616e 7366 6f72  kind of transfor
+00023680: 6d61 7469 6f6e 2079 6f75 2077 616e 740a  mation you want.
+00023690: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+000236a0: 6973 2027 6c6f 6727 3a20 6275 7420 796f  is 'log': but yo
+000236b0: 7520 6361 6e20 6368 6f6f 7365 3a20 7b27  u can choose: {'
+000236c0: 6c6f 6727 2c27 6c6f 6731 3027 2c20 2773  log','log10', 's
+000236d0: 7172 7427 2c20 276d 6178 2d61 6273 277d  qrt', 'max-abs'}
+000236e0: 0a0a 2020 2020 4f75 7470 7574 733a 0a20  ..    Outputs:. 
+000236f0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00023700: 2020 6466 3a20 7061 6e64 6173 2064 6174    df: pandas dat
+00023710: 6166 7261 6d65 2077 6974 6820 6e65 7720  aframe with new 
+00023720: 7661 7269 6162 6c65 7320 7769 7468 206e  variables with n
+00023730: 616d 6573 2073 7563 6820 6173 3a20 2076  ames such as:  v
+00023740: 6172 6961 626c 652b 275f 6469 7363 7265  ariable+'_discre
+00023750: 7465 270a 2020 2020 2222 220a 2020 2020  te'.    """.    
+00023760: 6466 203d 2063 6f70 792e 6465 6570 636f  df = copy.deepco
+00023770: 7079 2864 6629 0a20 2020 206e 756d 5f63  py(df).    num_c
+00023780: 6f6c 7320 3d20 6c65 6e28 6269 6e5f 6469  ols = len(bin_di
+00023790: 6374 290a 2020 2020 6e72 6f77 7320 3d20  ct).    nrows = 
+000237a0: 696e 7428 286e 756d 5f63 6f6c 732f 3229  int((num_cols/2)
+000237b0: 2b30 2e35 290a 2020 2020 6966 2076 6572  +0.5).    if ver
+000237c0: 626f 7365 3a0a 2020 2020 2020 2020 6669  bose:.        fi
+000237d0: 6720 3d20 706c 742e 6669 6775 7265 2866  g = plt.figure(f
+000237e0: 6967 7369 7a65 3d28 3130 2c33 2a6e 756d  igsize=(10,3*num
+000237f0: 5f63 6f6c 7329 290a 2020 2020 666f 7220  _cols)).    for 
+00023800: 692c 2028 636f 6c2c 2062 696e 7661 6c75  i, (col, binvalu
+00023810: 6529 2069 6e20 656e 756d 6572 6174 6528  e) in enumerate(
+00023820: 6269 6e5f 6469 6374 2e69 7465 6d73 2829  bin_dict.items()
+00023830: 293a 0a20 2020 2020 2020 206e 6577 5f63  ):.        new_c
+00023840: 6f6c 203d 2063 6f6c 2b27 5f27 2b62 696e  ol = col+'_'+bin
+00023850: 7661 6c75 650a 2020 2020 2020 2020 6966  value.        if
+00023860: 2062 696e 7661 6c75 6520 3d3d 2027 6c6f   binvalue == 'lo
+00023870: 6727 3a0a 2020 2020 2020 2020 2020 2020  g':.            
+00023880: 7072 696e 7428 2757 6172 6e69 6e67 3a20  print('Warning: 
+00023890: 4e65 6761 7469 7665 2076 616c 7565 7320  Negative values 
+000238a0: 696e 2025 7320 6861 7665 2062 6565 6e20  in %s have been 
+000238b0: 6d61 6465 2070 6f73 6974 6976 6520 6265  made positive be
+000238c0: 666f 7265 206c 6f67 2074 7261 6e73 666f  fore log transfo
+000238d0: 726d 2127 2025 636f 6c29 0a20 2020 2020  rm!' %col).     
+000238e0: 2020 2020 2020 2064 662e 6c6f 635b 6466         df.loc[df
+000238f0: 5b63 6f6c 5d3d 3d30 2c63 6f6c 5d20 3d20  [col]==0,col] = 
+00023900: 3165 2d31 3520 2023 2323 206d 616b 6520  1e-15  ### make 
+00023910: 6974 2061 2073 6d61 6c6c 206e 756d 6265  it a small numbe
+00023920: 720a 2020 2020 2020 2020 2020 2020 6466  r.            df
+00023930: 5b6e 6577 5f63 6f6c 5d20 3d20 6e70 2e61  [new_col] = np.a
+00023940: 6273 2864 665b 636f 6c5d 2e76 616c 7565  bs(df[col].value
+00023950: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
+00023960: 665b 6e65 775f 636f 6c5d 203d 206e 702e  f[new_col] = np.
+00023970: 6c6f 6728 6466 5b6e 6577 5f63 6f6c 5d29  log(df[new_col])
+00023980: 2e76 616c 7565 730a 2020 2020 2020 2020  .values.        
+00023990: 656c 6966 2062 696e 7661 6c75 6520 3d3d  elif binvalue ==
+000239a0: 2027 6c6f 6731 3027 3a0a 2020 2020 2020   'log10':.      
+000239b0: 2020 2020 2020 7072 696e 7428 2757 6172        print('War
+000239c0: 6e69 6e67 3a20 4e65 6761 7469 7665 2076  ning: Negative v
+000239d0: 616c 7565 7320 696e 2025 7320 6861 7665  alues in %s have
+000239e0: 2062 6565 6e20 6d61 6465 2070 6f73 6974   been made posit
+000239f0: 6976 6520 6265 666f 7265 206c 6f67 3130  ive before log10
+00023a00: 2074 7261 6e73 666f 726d 2127 2025 636f   transform!' %co
+00023a10: 6c29 0a20 2020 2020 2020 2020 2020 2064  l).            d
+00023a20: 662e 6c6f 635b 6466 5b63 6f6c 5d3d 3d30  f.loc[df[col]==0
+00023a30: 2c63 6f6c 5d20 3d20 3165 2d31 3520 2023  ,col] = 1e-15  #
+00023a40: 2323 206d 616b 6520 6974 2061 2073 6d61  ## make it a sma
+00023a50: 6c6c 206e 756d 6265 720a 2020 2020 2020  ll number.      
+00023a60: 2020 2020 2020 6466 5b6e 6577 5f63 6f6c        df[new_col
+00023a70: 5d20 3d20 6e70 2e61 6273 2864 665b 636f  ] = np.abs(df[co
+00023a80: 6c5d 2e76 616c 7565 7329 0a20 2020 2020  l].values).     
+00023a90: 2020 2020 2020 2064 665b 6e65 775f 636f         df[new_co
+00023aa0: 6c5d 203d 206e 702e 6c6f 6731 3028 6466  l] = np.log10(df
+00023ab0: 5b6e 6577 5f63 6f6c 5d29 2e76 616c 7565  [new_col]).value
+00023ac0: 730a 2020 2020 2020 2020 656c 6966 2062  s.        elif b
+00023ad0: 696e 7661 6c75 6520 3d3d 2027 7371 7274  invalue == 'sqrt
+00023ae0: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
+00023af0: 7269 6e74 2827 5761 726e 696e 673a 204e  rint('Warning: N
+00023b00: 6567 6174 6976 6520 7661 6c75 6573 2069  egative values i
+00023b10: 6e20 2573 2068 6176 6520 6265 656e 206d  n %s have been m
+00023b20: 6164 6520 706f 7369 7469 7665 2062 6566  ade positive bef
+00023b30: 6f72 6520 7371 7274 2074 7261 6e73 666f  ore sqrt transfo
+00023b40: 726d 2127 2025 636f 6c29 0a20 2020 2020  rm!' %col).     
+00023b50: 2020 2020 2020 2064 665b 6e65 775f 636f         df[new_co
+00023b60: 6c5d 203d 206e 702e 6162 7328 6466 5b63  l] = np.abs(df[c
+00023b70: 6f6c 5d2e 7661 6c75 6573 2920 2023 2323  ol].values)  ###
+00023b80: 206d 616b 6520 6974 2061 2073 6d61 6c6c   make it a small
+00023b90: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
+00023ba0: 2020 2020 6466 5b6e 6577 5f63 6f6c 5d20      df[new_col] 
+00023bb0: 3d20 6e70 2e73 7172 7428 6466 5b6e 6577  = np.sqrt(df[new
+00023bc0: 5f63 6f6c 5d29 2e76 616c 7565 730a 2020  _col]).values.  
+00023bd0: 2020 2020 2020 656c 6966 2062 696e 7661        elif binva
+00023be0: 6c75 6520 3d3d 2027 6d61 782d 6162 7327  lue == 'max-abs'
+00023bf0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00023c00: 696e 7428 2757 6172 6e69 6e67 3a20 4e65  int('Warning: Ne
+00023c10: 6761 7469 7665 2076 616c 7565 7320 696e  gative values in
+00023c20: 2025 7320 6861 7665 2062 6565 6e20 6d61   %s have been ma
+00023c30: 6465 2070 6f73 6974 6976 6520 6265 666f  de positive befo
+00023c40: 7265 206d 6178 2d61 6273 2074 7261 6e73  re max-abs trans
+00023c50: 666f 726d 2127 2025 636f 6c29 0a20 2020  form!' %col).   
+00023c60: 2020 2020 2020 2020 2063 6f6c 5f6d 6178           col_max
+00023c70: 203d 206d 6178 286e 702e 6162 7328 6466   = max(np.abs(df
+00023c80: 5b63 6f6c 5d2e 7661 6c75 6573 2929 0a20  [col].values)). 
+00023c90: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00023ca0: 6c5f 6d61 7820 3d3d 2030 3a0a 2020 2020  l_max == 0:.    
+00023cb0: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
+00023cc0: 6d61 7820 3d20 310a 2020 2020 2020 2020  max = 1.        
+00023cd0: 2020 2020 6466 5b6e 6577 5f63 6f6c 5d20      df[new_col] 
+00023ce0: 3d20 6e70 2e61 6273 2864 665b 636f 6c5d  = np.abs(df[col]
+00023cf0: 2e76 616c 7565 7329 2f63 6f6c 5f6d 6178  .values)/col_max
+00023d00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00023d10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00023d20: 2827 5761 726e 696e 673a 204e 6567 6174  ('Warning: Negat
+00023d30: 6976 6520 7661 6c75 6573 2069 6e20 2573  ive values in %s
+00023d40: 2068 6176 6520 6265 656e 206d 6164 6520   have been made 
+00023d50: 706f 7369 7469 7665 2062 6566 6f72 6520  positive before 
+00023d60: 6c6f 6720 7472 616e 7366 6f72 6d21 2720  log transform!' 
+00023d70: 2563 6f6c 290a 2020 2020 2020 2020 2020  %col).          
+00023d80: 2020 6466 2e6c 6f63 5b64 665b 636f 6c5d    df.loc[df[col]
+00023d90: 3d3d 302c 636f 6c5d 203d 2031 652d 3135  ==0,col] = 1e-15
+00023da0: 2020 2323 2320 6d61 6b65 2069 7420 6120    ### make it a 
+00023db0: 736d 616c 6c20 6e75 6d62 6572 0a20 2020  small number.   
+00023dc0: 2020 2020 2020 2020 2064 665b 6e65 775f           df[new_
+00023dd0: 636f 6c5d 203d 206e 702e 6162 7328 6466  col] = np.abs(df
+00023de0: 5b63 6f6c 5d2e 7661 6c75 6573 290a 2020  [col].values).  
+00023df0: 2020 2020 2020 2020 2020 6466 5b6e 6577            df[new
+00023e00: 5f63 6f6c 5d20 3d20 6e70 2e6c 6f67 2864  _col] = np.log(d
+00023e10: 665b 6e65 775f 636f 6c5d 292e 7661 6c75  f[new_col]).valu
+00023e20: 6573 0a20 2020 2020 2020 2069 6620 7665  es.        if ve
+00023e30: 7262 6f73 653a 0a20 2020 2020 2020 2020  rbose:.         
+00023e40: 2020 2061 7831 203d 2070 6c74 2e73 7562     ax1 = plt.sub
+00023e50: 706c 6f74 286e 726f 7773 2c32 2c69 2b31  plot(nrows,2,i+1
+00023e60: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+00023e70: 5b63 6f6c 5d2e 706c 6f74 2e6b 6465 2861  [col].plot.kde(a
+00023e80: 783d 6178 312c 206c 6162 656c 3d63 6f6c  x=ax1, label=col
+00023e90: 2c61 6c70 6861 3d30 2e35 2c63 6f6c 6f72  ,alpha=0.5,color
+00023ea0: 3d27 7227 290a 2020 2020 2020 2020 2020  ='r').          
+00023eb0: 2020 6178 3220 3d20 6178 312e 7477 696e    ax2 = ax1.twin
+00023ec0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00023ed0: 6466 5b6e 6577 5f63 6f6c 5d2e 706c 6f74  df[new_col].plot
+00023ee0: 2e6b 6465 2861 783d 6178 322c 6c61 6265  .kde(ax=ax2,labe
+00023ef0: 6c3d 6e65 775f 636f 6c2c 616c 7068 613d  l=new_col,alpha=
+00023f00: 302e 352c 636f 6c6f 723d 2762 2729 0a20  0.5,color='b'). 
+00023f10: 2020 2020 2020 2020 2020 2070 6c74 2e6c             plt.l
+00023f20: 6567 656e 6428 293b 0a20 2020 2072 6574  egend();.    ret
+00023f30: 7572 6e20 6466 0a23 2323 2323 2323 2323  urn df.#########
+00023f40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023f50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023f60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00023f70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023f80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00023f90: 2323 230a 6672 6f6d 2069 7465 7274 6f6f  ###.from itertoo
-00023fa0: 6c73 2069 6d70 6f72 7420 6379 636c 652c  ls import cycle,
-00023fb0: 2063 6f6d 6269 6e61 7469 6f6e 730a 6465   combinations.de
-00023fc0: 6620 4645 5f63 7265 6174 655f 696e 7465  f FE_create_inte
-00023fd0: 7261 6374 696f 6e5f 7661 7273 2864 662c  raction_vars(df,
-00023fe0: 2069 6e74 786e 5f76 6172 7329 3a0a 2020   intxn_vars):.  
-00023ff0: 2020 2222 220a 2020 2020 5468 6973 2068    """.    This h
-00024000: 616e 6479 2066 756e 6374 696f 6e20 6372  andy function cr
-00024010: 6561 7465 7320 696e 7465 7261 6374 696f  eates interactio
-00024020: 6e20 7661 7269 6162 6c65 7320 616d 6f6e  n variables amon
-00024030: 6720 7061 6972 7320 6f66 206e 756d 6572  g pairs of numer
-00024040: 6963 2076 6172 7320 796f 7520 7365 6e64  ic vars you send
-00024050: 2069 6e2e 0a20 2020 2059 6f75 7220 696e   in..    Your in
-00024060: 7075 7420 6d75 7374 2062 6520 6120 6461  put must be a da
-00024070: 7461 6672 616d 6520 616e 6420 6120 6c69  taframe and a li
-00024080: 7374 206f 6620 7475 706c 6573 2e20 4561  st of tuples. Ea
-00024090: 6368 2074 7570 6c65 206d 7573 7420 636f  ch tuple must co
-000240a0: 6e74 6169 6e20 6120 7061 6972 206f 6620  ntain a pair of 
-000240b0: 7661 7269 6162 6c65 732e 0a20 2020 2041  variables..    A
-000240c0: 6c6c 2076 6172 6961 626c 6573 206d 7573  ll variables mus
-000240d0: 7420 6265 206e 756d 6572 6963 2e20 446f  t be numeric. Do
-000240e0: 7562 6c65 2063 6865 636b 2079 6f75 7220  uble check your 
-000240f0: 696e 7075 7420 6265 666f 7265 2073 656e  input before sen
-00024100: 6469 6e67 2074 6865 6d20 696e 2e0a 2020  ding them in..  
-00024110: 2020 2222 220a 2020 2020 6966 2074 7970    """.    if typ
-00024120: 6528 6466 2920 3d3d 2064 6173 6b2e 6461  e(df) == dask.da
-00024130: 7461 6672 616d 652e 636f 7265 2e44 6174  taframe.core.Dat
-00024140: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
-00024150: 2323 2073 6b69 7020 6966 2069 7420 6973  ## skip if it is
-00024160: 2061 2064 6173 6b20 6461 7461 6672 616d   a dask datafram
-00024170: 6520 2323 2323 0a20 2020 2020 2020 2070  e ####.        p
-00024180: 6173 730a 2020 2020 656c 7365 3a0a 2020  ass.    else:.  
-00024190: 2020 2020 2020 6466 203d 2064 662e 636f        df = df.co
-000241a0: 7079 2864 6565 703d 5472 7565 290a 2020  py(deep=True).  
-000241b0: 2020 636f 6d62 6f73 203d 2063 6f6d 6269    combos = combi
-000241c0: 6e61 7469 6f6e 7328 696e 7478 6e5f 7661  nations(intxn_va
-000241d0: 7273 2c20 3229 0a20 2020 2023 2323 2049  rs, 2).    ### I
-000241e0: 2068 6176 6520 7465 7374 6564 2074 6869   have tested thi
-000241f0: 7320 666f 7220 626f 7468 2063 6174 6567  s for both categ
-00024200: 6f72 7920 616e 6420 6f62 6a65 6374 2064  ory and object d
-00024210: 7479 7065 7320 736f 2064 6f6e 2774 2077  types so don't w
-00024220: 6f72 7279 2023 2323 0a20 2020 2066 6f72  orry ###.    for
-00024230: 2028 6561 6368 5f69 6e74 786e 312c 6561   (each_intxn1,ea
-00024240: 6368 5f69 6e74 786e 3229 2020 696e 2063  ch_intxn2)  in c
-00024250: 6f6d 626f 733a 0a20 2020 2020 2020 206e  ombos:.        n
-00024260: 6577 5f63 6f6c 203d 2065 6163 685f 696e  ew_col = each_in
-00024270: 7478 6e31 202b 2027 5f78 5f27 202b 2065  txn1 + '_x_' + e
-00024280: 6163 685f 696e 7478 6e32 0a20 2020 2020  ach_intxn2.     
-00024290: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000242a0: 2020 2020 6466 5b6e 6577 5f63 6f6c 5d20      df[new_col] 
-000242b0: 3d20 6466 5b65 6163 685f 696e 7478 6e31  = df[each_intxn1
-000242c0: 5d2e 6173 7479 7065 2873 7472 2920 2b20  ].astype(str) + 
-000242d0: 2720 2720 2b20 6466 5b65 6163 685f 696e  ' ' + df[each_in
-000242e0: 7478 6e32 5d2e 6173 7479 7065 2873 7472  txn2].astype(str
-000242f0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00024300: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00024310: 6e74 696e 7565 0a20 2020 2023 2323 2074  ntinue.    ### t
-00024320: 6869 7320 7769 6c6c 2072 6574 7572 6e20  his will return 
-00024330: 6578 7472 6120 6665 6174 7572 6573 2067  extra features g
-00024340: 656e 6572 6174 6564 2062 7920 696e 7465  enerated by inte
-00024350: 7261 6374 696f 6e73 2023 2323 2320 2020  ractions ####   
-00024360: 200a 2020 2020 7265 7475 726e 2064 660a   .    return df.
+00023f80: 2323 2323 2323 2323 0a66 726f 6d20 6974  ########.from it
+00023f90: 6572 746f 6f6c 7320 696d 706f 7274 2063  ertools import c
+00023fa0: 7963 6c65 2c20 636f 6d62 696e 6174 696f  ycle, combinatio
+00023fb0: 6e73 0a64 6566 2046 455f 6372 6561 7465  ns.def FE_create
+00023fc0: 5f69 6e74 6572 6163 7469 6f6e 5f76 6172  _interaction_var
+00023fd0: 7328 6466 2c20 696e 7478 6e5f 7661 7273  s(df, intxn_vars
+00023fe0: 293a 0a20 2020 2022 2222 0a20 2020 2054  ):.    """.    T
+00023ff0: 6869 7320 6861 6e64 7920 6675 6e63 7469  his handy functi
+00024000: 6f6e 2063 7265 6174 6573 2069 6e74 6572  on creates inter
+00024010: 6163 7469 6f6e 2076 6172 6961 626c 6573  action variables
+00024020: 2061 6d6f 6e67 2070 6169 7273 206f 6620   among pairs of 
+00024030: 6e75 6d65 7269 6320 7661 7273 2079 6f75  numeric vars you
+00024040: 2073 656e 6420 696e 2e0a 2020 2020 596f   send in..    Yo
+00024050: 7572 2069 6e70 7574 206d 7573 7420 6265  ur input must be
+00024060: 2061 2064 6174 6166 7261 6d65 2061 6e64   a dataframe and
+00024070: 2061 206c 6973 7420 6f66 2074 7570 6c65   a list of tuple
+00024080: 732e 2045 6163 6820 7475 706c 6520 6d75  s. Each tuple mu
+00024090: 7374 2063 6f6e 7461 696e 2061 2070 6169  st contain a pai
+000240a0: 7220 6f66 2076 6172 6961 626c 6573 2e0a  r of variables..
+000240b0: 2020 2020 416c 6c20 7661 7269 6162 6c65      All variable
+000240c0: 7320 6d75 7374 2062 6520 6e75 6d65 7269  s must be numeri
+000240d0: 632e 2044 6f75 626c 6520 6368 6563 6b20  c. Double check 
+000240e0: 796f 7572 2069 6e70 7574 2062 6566 6f72  your input befor
+000240f0: 6520 7365 6e64 696e 6720 7468 656d 2069  e sending them i
+00024100: 6e2e 0a20 2020 2022 2222 0a20 2020 2069  n..    """.    i
+00024110: 6620 7479 7065 2864 6629 203d 3d20 6461  f type(df) == da
+00024120: 736b 2e64 6174 6166 7261 6d65 2e63 6f72  sk.dataframe.cor
+00024130: 652e 4461 7461 4672 616d 653a 0a20 2020  e.DataFrame:.   
+00024140: 2020 2020 2023 2320 736b 6970 2069 6620       ## skip if 
+00024150: 6974 2069 7320 6120 6461 736b 2064 6174  it is a dask dat
+00024160: 6166 7261 6d65 2023 2323 230a 2020 2020  aframe ####.    
+00024170: 2020 2020 7061 7373 0a20 2020 2065 6c73      pass.    els
+00024180: 653a 0a20 2020 2020 2020 2064 6620 3d20  e:.        df = 
+00024190: 6466 2e63 6f70 7928 6465 6570 3d54 7275  df.copy(deep=Tru
+000241a0: 6529 0a20 2020 2063 6f6d 626f 7320 3d20  e).    combos = 
+000241b0: 636f 6d62 696e 6174 696f 6e73 2869 6e74  combinations(int
+000241c0: 786e 5f76 6172 732c 2032 290a 2020 2020  xn_vars, 2).    
+000241d0: 2323 2320 4920 6861 7665 2074 6573 7465  ### I have teste
+000241e0: 6420 7468 6973 2066 6f72 2062 6f74 6820  d this for both 
+000241f0: 6361 7465 676f 7279 2061 6e64 206f 626a  category and obj
+00024200: 6563 7420 6474 7970 6573 2073 6f20 646f  ect dtypes so do
+00024210: 6e27 7420 776f 7272 7920 2323 230a 2020  n't worry ###.  
+00024220: 2020 666f 7220 2865 6163 685f 696e 7478    for (each_intx
+00024230: 6e31 2c65 6163 685f 696e 7478 6e32 2920  n1,each_intxn2) 
+00024240: 2069 6e20 636f 6d62 6f73 3a0a 2020 2020   in combos:.    
+00024250: 2020 2020 6e65 775f 636f 6c20 3d20 6561      new_col = ea
+00024260: 6368 5f69 6e74 786e 3120 2b20 275f 785f  ch_intxn1 + '_x_
+00024270: 2720 2b20 6561 6368 5f69 6e74 786e 320a  ' + each_intxn2.
+00024280: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00024290: 2020 2020 2020 2020 2064 665b 6e65 775f           df[new_
+000242a0: 636f 6c5d 203d 2064 665b 6561 6368 5f69  col] = df[each_i
+000242b0: 6e74 786e 315d 2e61 7374 7970 6528 7374  ntxn1].astype(st
+000242c0: 7229 202b 2027 2027 202b 2064 665b 6561  r) + ' ' + df[ea
+000242d0: 6368 5f69 6e74 786e 325d 2e61 7374 7970  ch_intxn2].astyp
+000242e0: 6528 7374 7229 0a20 2020 2020 2020 2065  e(str).        e
+000242f0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+00024300: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00024310: 2323 2320 7468 6973 2077 696c 6c20 7265  ### this will re
+00024320: 7475 726e 2065 7874 7261 2066 6561 7475  turn extra featu
+00024330: 7265 7320 6765 6e65 7261 7465 6420 6279  res generated by
+00024340: 2069 6e74 6572 6163 7469 6f6e 7320 2323   interactions ##
+00024350: 2323 2020 2020 0a20 2020 2072 6574 7572  ##    .    retur
+00024360: 6e20 6466 0a23 2323 2323 2323 2323 2323  n df.###########
 00024370: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024380: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000243a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000243b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000243c0: 2323 0a69 6d70 6f72 7420 6d61 7470 6c6f  ##.import matplo
-000243d0: 746c 6962 2e70 7970 6c6f 7420 6173 2070  tlib.pyplot as p
-000243e0: 6c74 0a64 6566 2045 4441 5f62 696e 6e69  lt.def EDA_binni
-000243f0: 6e67 5f6e 756d 6572 6963 5f63 6f6c 756d  ng_numeric_colum
-00024400: 6e5f 6469 7370 6c61 7969 6e67 5f62 696e  n_displaying_bin
-00024410: 7328 6466 742c 2074 6172 6765 742c 2062  s(dft, target, b
-00024420: 696e 733d 342c 2074 6573 743d 2222 293a  ins=4, test=""):
-00024430: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
-00024440: 7320 7370 6c69 7473 2074 6865 2064 6174  s splits the dat
-00024450: 6120 636f 6c75 6d6e 2069 6e74 6f20 7468  a column into th
-00024460: 6520 6e75 6d62 6572 206f 6620 6269 6e73  e number of bins
-00024470: 2073 7065 6369 6669 6564 2061 6e64 2072   specified and r
-00024480: 6574 7572 6e73 206c 6162 656c 732c 2062  eturns labels, b
-00024490: 696e 732c 2061 6e64 2064 6174 6166 7261  ins, and datafra
-000244a0: 6d65 2e0a 2020 2020 4f75 7470 7574 733a  me..    Outputs:
-000244b0: 0a20 2020 2020 2020 6c61 6265 6c73 203d  .       labels =
-000244c0: 2074 6865 206e 616d 6573 206f 6620 7468   the names of th
-000244d0: 6520 6269 6e73 0a20 2020 2020 2020 6564  e bins.       ed
-000244e0: 6765 7320 3d20 7468 6520 6564 6765 7320  ges = the edges 
-000244f0: 6f66 2074 6865 2062 696e 730a 2020 2020  of the bins.    
-00024500: 2020 2064 6674 203d 2074 6865 2064 6174     dft = the dat
-00024510: 6166 7261 6d65 2077 6974 6820 616e 2061  aframe with an a
-00024520: 6464 6564 2063 6f6c 756d 6e20 6361 6c6c  dded column call
-00024530: 6564 2022 6269 6e6e 6564 5f22 2b6e 616d  ed "binned_"+nam
-00024540: 6520 6f66 2074 6865 2063 6f6c 756d 6e20  e of the column 
-00024550: 796f 7520 7365 6e74 2069 6e0a 2020 2020  you sent in.    
-00024560: 2222 220a 2020 2020 6466 7420 3d20 636f  """.    dft = co
-00024570: 7079 2e64 6565 7063 6f70 7928 6466 7429  py.deepcopy(dft)
-00024580: 0a20 2020 205f 2c20 6564 6765 7320 3d20  .    _, edges = 
-00024590: 7064 2e71 6375 7428 6466 745b 7461 7267  pd.qcut(dft[targ
-000245a0: 6574 5d2e 6472 6f70 6e61 2861 7869 733d  et].dropna(axis=
-000245b0: 3029 2c71 3d62 696e 732c 2072 6574 6269  0),q=bins, retbi
-000245c0: 6e73 3d54 7275 652c 2064 7570 6c69 6361  ns=True, duplica
-000245d0: 7465 733d 2764 726f 7027 290a 2020 2020  tes='drop').    
-000245e0: 2323 2320 6e6f 7720 7765 2063 7265 6174  ### now we creat
-000245f0: 6520 6172 7469 6669 6369 616c 206c 6162  e artificial lab
-00024600: 656c 7320 746f 206d 6174 6368 2074 6865  els to match the
-00024610: 2062 696e 7320 6564 6765 7320 2323 2323   bins edges ####
-00024620: 0a20 2020 206c 7320 3d20 5b5d 0a20 2020  .    ls = [].   
-00024630: 2066 6f72 2069 2c20 7820 696e 2065 6e75   for i, x in enu
-00024640: 6d65 7261 7465 2865 6467 6573 293a 0a20  merate(edges):. 
-00024650: 2020 2020 2020 2023 7072 696e 7428 2769         #print('i
-00024660: 203d 2025 732c 206e 6578 7420 6920 3d20   = %s, next i = 
-00024670: 2573 2720 2528 692c 692b 3129 290a 2020  %s' %(i,i+1)).  
-00024680: 2020 2020 2020 6966 2069 203c 206c 656e        if i < len
-00024690: 2865 6467 6573 292d 313a 0a20 2020 2020  (edges)-1:.     
-000246a0: 2020 2020 2020 206c 732e 6170 7065 6e64         ls.append
-000246b0: 2827 6672 6f6d 5f27 2b73 7472 2872 6f75  ('from_'+str(rou
-000246c0: 6e64 2865 6467 6573 5b69 5d2c 3329 292b  nd(edges[i],3))+
-000246d0: 275f 746f 5f27 2b73 7472 2872 6f75 6e64  '_to_'+str(round
-000246e0: 2865 6467 6573 5b69 2b31 5d2c 3329 2929  (edges[i+1],3)))
-000246f0: 0a20 2020 2023 2323 2323 204e 6578 7420  .    ##### Next 
-00024700: 7765 2061 6464 2061 2063 6f6c 756d 6e20  we add a column 
-00024710: 746f 2068 6f6c 6420 7468 6520 6269 6e73  to hold the bins
-00024720: 2063 7265 6174 6564 2062 7920 6162 6f76   created by abov
-00024730: 6520 2323 2323 2323 2323 2323 2323 2323  e ##############
-00024740: 230a 2020 2020 6466 745b 2762 696e 6e65  #.    dft['binne
-00024750: 645f 272b 7461 7267 6574 5d20 3d20 7064  d_'+target] = pd
-00024760: 2e63 7574 2864 6674 5b74 6172 6765 745d  .cut(dft[target]
-00024770: 2c20 6269 6e73 3d65 6467 6573 2c20 7265  , bins=edges, re
-00024780: 7462 696e 733d 4661 6c73 652c 206c 6162  tbins=False, lab
-00024790: 656c 733d 6c73 2c20 696e 636c 7564 655f  els=ls, include_
-000247a0: 6c6f 7765 7374 3d54 7275 6529 2e76 616c  lowest=True).val
-000247b0: 7565 732e 746f 6c69 7374 2829 0a20 2020  ues.tolist().   
-000247c0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-000247d0: 6365 2874 6573 742c 2073 7472 293a 0a20  ce(test, str):. 
-000247e0: 2020 2020 2020 2074 6573 745b 2762 696e         test['bin
-000247f0: 6e65 645f 272b 7461 7267 6574 5d20 3d20  ned_'+target] = 
-00024800: 7064 2e63 7574 2874 6573 745b 7461 7267  pd.cut(test[targ
-00024810: 6574 5d2c 2062 696e 733d 6564 6765 732c  et], bins=edges,
-00024820: 2072 6574 6269 6e73 3d46 616c 7365 2c20   retbins=False, 
-00024830: 6c61 6265 6c73 3d6c 732c 2069 6e63 6c75  labels=ls, inclu
-00024840: 6465 5f6c 6f77 6573 743d 5472 7565 292e  de_lowest=True).
-00024850: 7661 6c75 6573 2e74 6f6c 6973 7428 290a  values.tolist().
-00024860: 2020 2020 6e72 6f77 7320 3d20 696e 7428      nrows = int(
-00024870: 6c65 6e28 6564 6765 7329 2f32 202b 2031  len(edges)/2 + 1
-00024880: 290a 2020 2020 706c 742e 6669 6775 7265  ).    plt.figure
-00024890: 2866 6967 7369 7a65 3d28 3135 2c6e 726f  (figsize=(15,nro
-000248a0: 7773 2a33 2929 0a20 2020 2070 6c74 2e73  ws*3)).    plt.s
-000248b0: 7562 706c 6f74 735f 6164 6a75 7374 2868  ubplots_adjust(h
-000248c0: 7370 6163 653d 2e35 290a 2020 2020 636f  space=.5).    co
-000248d0: 6c6c 6563 745f 6269 6e73 203d 205b 5d0a  llect_bins = [].
-000248e0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000248f0: 6765 286c 656e 2865 6467 6573 2929 3a0a  ge(len(edges)):.
-00024900: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-00024910: 303a 0a20 2020 2020 2020 2020 2020 2063  0:.            c
-00024920: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00024930: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00024940: 2020 6466 7463 203d 2064 6674 5b28 6466    dftc = dft[(df
-00024950: 745b 7461 7267 6574 5d3e 6564 6765 735b  t[target]>edges[
-00024960: 692d 315d 2920 2620 2864 6674 5b74 6172  i-1]) & (dft[tar
-00024970: 6765 745d 3c3d 6564 6765 735b 695d 295d  get]<=edges[i])]
-00024980: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00024990: 6c65 6374 5f62 696e 732e 6170 7065 6e64  lect_bins.append
-000249a0: 2864 6674 6329 0a20 2020 2020 2020 2020  (dftc).         
-000249b0: 2020 2061 7831 203d 2070 6c74 2e73 7562     ax1 = plt.sub
-000249c0: 706c 6f74 286e 726f 7773 2c20 322c 2069  plot(nrows, 2, i
-000249d0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-000249e0: 7463 5b74 6172 6765 745d 2e68 6973 7428  tc[target].hist(
-000249f0: 6269 6e73 3d33 302c 2061 783d 6178 3129  bins=30, ax=ax1)
-00024a00: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00024a10: 2e73 6574 5f74 6974 6c65 2827 6269 6e20  .set_title('bin 
-00024a20: 2564 3a20 7369 7a65 3a20 2564 2c20 2573  %d: size: %d, %s
-00024a30: 2025 302e 3266 2074 6f20 2530 2e32 6627   %0.2f to %0.2f'
-00024a40: 2025 2869 2c20 6466 7463 2e73 6861 7065   %(i, dftc.shape
-00024a50: 5b30 5d2c 2074 6172 6765 742c 0a20 2020  [0], target,.   
+000243b0: 2323 2323 2323 230a 696d 706f 7274 206d  #######.import m
+000243c0: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+000243d0: 2061 7320 706c 740a 6465 6620 4544 415f   as plt.def EDA_
+000243e0: 6269 6e6e 696e 675f 6e75 6d65 7269 635f  binning_numeric_
+000243f0: 636f 6c75 6d6e 5f64 6973 706c 6179 696e  column_displayin
+00024400: 675f 6269 6e73 2864 6674 2c20 7461 7267  g_bins(dft, targ
+00024410: 6574 2c20 6269 6e73 3d34 2c20 7465 7374  et, bins=4, test
+00024420: 3d22 2229 3a0a 2020 2020 2222 220a 2020  =""):.    """.  
+00024430: 2020 5468 6973 2073 706c 6974 7320 7468    This splits th
+00024440: 6520 6461 7461 2063 6f6c 756d 6e20 696e  e data column in
+00024450: 746f 2074 6865 206e 756d 6265 7220 6f66  to the number of
+00024460: 2062 696e 7320 7370 6563 6966 6965 6420   bins specified 
+00024470: 616e 6420 7265 7475 726e 7320 6c61 6265  and returns labe
+00024480: 6c73 2c20 6269 6e73 2c20 616e 6420 6461  ls, bins, and da
+00024490: 7461 6672 616d 652e 0a20 2020 204f 7574  taframe..    Out
+000244a0: 7075 7473 3a0a 2020 2020 2020 206c 6162  puts:.       lab
+000244b0: 656c 7320 3d20 7468 6520 6e61 6d65 7320  els = the names 
+000244c0: 6f66 2074 6865 2062 696e 730a 2020 2020  of the bins.    
+000244d0: 2020 2065 6467 6573 203d 2074 6865 2065     edges = the e
+000244e0: 6467 6573 206f 6620 7468 6520 6269 6e73  dges of the bins
+000244f0: 0a20 2020 2020 2020 6466 7420 3d20 7468  .       dft = th
+00024500: 6520 6461 7461 6672 616d 6520 7769 7468  e dataframe with
+00024510: 2061 6e20 6164 6465 6420 636f 6c75 6d6e   an added column
+00024520: 2063 616c 6c65 6420 2262 696e 6e65 645f   called "binned_
+00024530: 222b 6e61 6d65 206f 6620 7468 6520 636f  "+name of the co
+00024540: 6c75 6d6e 2079 6f75 2073 656e 7420 696e  lumn you sent in
+00024550: 0a20 2020 2022 2222 0a20 2020 2064 6674  .    """.    dft
+00024560: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00024570: 2864 6674 290a 2020 2020 5f2c 2065 6467  (dft).    _, edg
+00024580: 6573 203d 2070 642e 7163 7574 2864 6674  es = pd.qcut(dft
+00024590: 5b74 6172 6765 745d 2e64 726f 706e 6128  [target].dropna(
+000245a0: 6178 6973 3d30 292c 713d 6269 6e73 2c20  axis=0),q=bins, 
+000245b0: 7265 7462 696e 733d 5472 7565 2c20 6475  retbins=True, du
+000245c0: 706c 6963 6174 6573 3d27 6472 6f70 2729  plicates='drop')
+000245d0: 0a20 2020 2023 2323 206e 6f77 2077 6520  .    ### now we 
+000245e0: 6372 6561 7465 2061 7274 6966 6963 6961  create artificia
+000245f0: 6c20 6c61 6265 6c73 2074 6f20 6d61 7463  l labels to matc
+00024600: 6820 7468 6520 6269 6e73 2065 6467 6573  h the bins edges
+00024610: 2023 2323 230a 2020 2020 6c73 203d 205b   ####.    ls = [
+00024620: 5d0a 2020 2020 666f 7220 692c 2078 2069  ].    for i, x i
+00024630: 6e20 656e 756d 6572 6174 6528 6564 6765  n enumerate(edge
+00024640: 7329 3a0a 2020 2020 2020 2020 2370 7269  s):.        #pri
+00024650: 6e74 2827 6920 3d20 2573 2c20 6e65 7874  nt('i = %s, next
+00024660: 2069 203d 2025 7327 2025 2869 2c69 2b31   i = %s' %(i,i+1
+00024670: 2929 0a20 2020 2020 2020 2069 6620 6920  )).        if i 
+00024680: 3c20 6c65 6e28 6564 6765 7329 2d31 3a0a  < len(edges)-1:.
+00024690: 2020 2020 2020 2020 2020 2020 6c73 2e61              ls.a
+000246a0: 7070 656e 6428 2766 726f 6d5f 272b 7374  ppend('from_'+st
+000246b0: 7228 726f 756e 6428 6564 6765 735b 695d  r(round(edges[i]
+000246c0: 2c33 2929 2b27 5f74 6f5f 272b 7374 7228  ,3))+'_to_'+str(
+000246d0: 726f 756e 6428 6564 6765 735b 692b 315d  round(edges[i+1]
+000246e0: 2c33 2929 290a 2020 2020 2323 2323 2320  ,3))).    ##### 
+000246f0: 4e65 7874 2077 6520 6164 6420 6120 636f  Next we add a co
+00024700: 6c75 6d6e 2074 6f20 686f 6c64 2074 6865  lumn to hold the
+00024710: 2062 696e 7320 6372 6561 7465 6420 6279   bins created by
+00024720: 2061 626f 7665 2023 2323 2323 2323 2323   above #########
+00024730: 2323 2323 2323 0a20 2020 2064 6674 5b27  ######.    dft['
+00024740: 6269 6e6e 6564 5f27 2b74 6172 6765 745d  binned_'+target]
+00024750: 203d 2070 642e 6375 7428 6466 745b 7461   = pd.cut(dft[ta
+00024760: 7267 6574 5d2c 2062 696e 733d 6564 6765  rget], bins=edge
+00024770: 732c 2072 6574 6269 6e73 3d46 616c 7365  s, retbins=False
+00024780: 2c20 6c61 6265 6c73 3d6c 732c 2069 6e63  , labels=ls, inc
+00024790: 6c75 6465 5f6c 6f77 6573 743d 5472 7565  lude_lowest=True
+000247a0: 292e 7661 6c75 6573 2e74 6f6c 6973 7428  ).values.tolist(
+000247b0: 290a 2020 2020 6966 206e 6f74 2069 7369  ).    if not isi
+000247c0: 6e73 7461 6e63 6528 7465 7374 2c20 7374  nstance(test, st
+000247d0: 7229 3a0a 2020 2020 2020 2020 7465 7374  r):.        test
+000247e0: 5b27 6269 6e6e 6564 5f27 2b74 6172 6765  ['binned_'+targe
+000247f0: 745d 203d 2070 642e 6375 7428 7465 7374  t] = pd.cut(test
+00024800: 5b74 6172 6765 745d 2c20 6269 6e73 3d65  [target], bins=e
+00024810: 6467 6573 2c20 7265 7462 696e 733d 4661  dges, retbins=Fa
+00024820: 6c73 652c 206c 6162 656c 733d 6c73 2c20  lse, labels=ls, 
+00024830: 696e 636c 7564 655f 6c6f 7765 7374 3d54  include_lowest=T
+00024840: 7275 6529 2e76 616c 7565 732e 746f 6c69  rue).values.toli
+00024850: 7374 2829 0a20 2020 206e 726f 7773 203d  st().    nrows =
+00024860: 2069 6e74 286c 656e 2865 6467 6573 292f   int(len(edges)/
+00024870: 3220 2b20 3129 0a20 2020 2070 6c74 2e66  2 + 1).    plt.f
+00024880: 6967 7572 6528 6669 6773 697a 653d 2831  igure(figsize=(1
+00024890: 352c 6e72 6f77 732a 3329 290a 2020 2020  5,nrows*3)).    
+000248a0: 706c 742e 7375 6270 6c6f 7473 5f61 646a  plt.subplots_adj
+000248b0: 7573 7428 6873 7061 6365 3d2e 3529 0a20  ust(hspace=.5). 
+000248c0: 2020 2063 6f6c 6c65 6374 5f62 696e 7320     collect_bins 
+000248d0: 3d20 5b5d 0a20 2020 2066 6f72 2069 2069  = [].    for i i
+000248e0: 6e20 7261 6e67 6528 6c65 6e28 6564 6765  n range(len(edge
+000248f0: 7329 293a 0a20 2020 2020 2020 2069 6620  s)):.        if 
+00024900: 6920 3d3d 2030 3a0a 2020 2020 2020 2020  i == 0:.        
+00024910: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00024920: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00024930: 2020 2020 2020 2064 6674 6320 3d20 6466         dftc = df
+00024940: 745b 2864 6674 5b74 6172 6765 745d 3e65  t[(dft[target]>e
+00024950: 6467 6573 5b69 2d31 5d29 2026 2028 6466  dges[i-1]) & (df
+00024960: 745b 7461 7267 6574 5d3c 3d65 6467 6573  t[target]<=edges
+00024970: 5b69 5d29 5d0a 2020 2020 2020 2020 2020  [i])].          
+00024980: 2020 636f 6c6c 6563 745f 6269 6e73 2e61    collect_bins.a
+00024990: 7070 656e 6428 6466 7463 290a 2020 2020  ppend(dftc).    
+000249a0: 2020 2020 2020 2020 6178 3120 3d20 706c          ax1 = pl
+000249b0: 742e 7375 6270 6c6f 7428 6e72 6f77 732c  t.subplot(nrows,
+000249c0: 2032 2c20 6929 0a20 2020 2020 2020 2020   2, i).         
+000249d0: 2020 2064 6674 635b 7461 7267 6574 5d2e     dftc[target].
+000249e0: 6869 7374 2862 696e 733d 3330 2c20 6178  hist(bins=30, ax
+000249f0: 3d61 7831 290a 2020 2020 2020 2020 2020  =ax1).          
+00024a00: 2020 6178 312e 7365 745f 7469 746c 6528    ax1.set_title(
+00024a10: 2762 696e 2025 643a 2073 697a 653a 2025  'bin %d: size: %
+00024a20: 642c 2025 7320 2530 2e32 6620 746f 2025  d, %s %0.2f to %
+00024a30: 302e 3266 2720 2528 692c 2064 6674 632e  0.2f' %(i, dftc.
+00024a40: 7368 6170 655b 305d 2c20 7461 7267 6574  shape[0], target
+00024a50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00024a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00024a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00024a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00024aa0: 6467 6573 5b69 2d31 5d2c 2065 6467 6573  dges[i-1], edges
-00024ab0: 5b69 5d29 290a 2020 2020 7265 7475 726e  [i])).    return
-00024ac0: 206c 732c 2065 6467 6573 2c20 6466 742c   ls, edges, dft,
-00024ad0: 2074 6573 740a 2323 2323 2323 2323 2323   test.##########
+00024a90: 2020 2020 6564 6765 735b 692d 315d 2c20      edges[i-1], 
+00024aa0: 6564 6765 735b 695d 2929 0a20 2020 2072  edges[i])).    r
+00024ab0: 6574 7572 6e20 6c73 2c20 6564 6765 732c  eturn ls, edges,
+00024ac0: 2064 6674 2c20 7465 7374 0a23 2323 2323   dft, test.#####
+00024ad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024ae0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024b20: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00024b30: 6672 6f6d 2070 6174 686c 6962 2069 6d70  from pathlib imp
-00024b40: 6f72 7420 5061 7468 0a69 6d70 6f72 7420  ort Path.import 
-00024b50: 6d61 7470 6c6f 746c 6962 2e70 7970 6c6f  matplotlib.pyplo
-00024b60: 7420 6173 2070 6c74 0a69 6d70 6f72 7420  t as plt.import 
-00024b70: 7365 6162 6f72 6e20 6173 2073 6e73 0a66  seaborn as sns.f
-00024b80: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
-00024b90: 6f72 7420 6461 7465 7469 6d65 2c20 6461  ort datetime, da
-00024ba0: 7465 0a66 726f 6d20 736b 6c65 6172 6e2e  te.from sklearn.
-00024bb0: 6d65 7472 6963 7320 696d 706f 7274 206d  metrics import m
-00024bc0: 6561 6e5f 7371 7561 7265 645f 6572 726f  ean_squared_erro
-00024bd0: 722c 2072 6f63 5f61 7563 5f73 636f 7265  r, roc_auc_score
-00024be0: 0a66 726f 6d20 736b 6c65 6172 6e2e 7072  .from sklearn.pr
-00024bf0: 6570 726f 6365 7373 696e 6720 696d 706f  eprocessing impo
-00024c00: 7274 206d 696e 6d61 785f 7363 616c 650a  rt minmax_scale.
-00024c10: 2323 2323 2054 6869 7320 6973 2077 6865  #### This is whe
-00024c20: 7265 2077 6520 6164 6420 6f74 6865 7220  re we add other 
-00024c30: 6c69 6272 6172 6965 7320 746f 2066 6f72  libraries to for
-00024c40: 6d20 6120 7069 7065 6c69 6e65 2023 2323  m a pipeline ###
-00024c50: 0a69 6d70 6f72 7420 636f 7079 0a69 6d70  .import copy.imp
-00024c60: 6f72 7420 7469 6d65 0a69 6d70 6f72 7420  ort time.import 
-00024c70: 7265 0a66 726f 6d20 7363 6970 792e 6e64  re.from scipy.nd
-00024c80: 696d 6167 6520 696d 706f 7274 2063 6f6e  image import con
-00024c90: 766f 6c76 650a 6672 6f6d 2073 6b6c 6561  volve.from sklea
-00024ca0: 726e 2069 6d70 6f72 7420 2064 6174 6173  rn import  datas
-00024cb0: 6574 732c 206d 6574 7269 6373 0a66 726f  ets, metrics.fro
-00024cc0: 6d20 736b 6c65 6172 6e2e 6d6f 6465 6c5f  m sklearn.model_
-00024cd0: 7365 6c65 6374 696f 6e20 696d 706f 7274  selection import
-00024ce0: 2074 7261 696e 5f74 6573 745f 7370 6c69   train_test_spli
-00024cf0: 740a 6672 6f6d 2073 6b6c 6561 726e 2e70  t.from sklearn.p
-00024d00: 6970 656c 696e 6520 696d 706f 7274 2050  ipeline import P
-00024d10: 6970 656c 696e 650a 6672 6f6d 2073 6b6c  ipeline.from skl
-00024d20: 6561 726e 2e6d 6f64 656c 5f73 656c 6563  earn.model_selec
-00024d30: 7469 6f6e 2069 6d70 6f72 7420 4b46 6f6c  tion import KFol
-00024d40: 642c 2053 7472 6174 6966 6965 6453 6875  d, StratifiedShu
-00024d50: 6666 6c65 5370 6c69 740a 0a64 6566 2061  ffleSplit..def a
-00024d60: 6464 5f74 6578 745f 7061 6464 696e 6773  dd_text_paddings
-00024d70: 2874 7261 696e 5f64 6174 612c 6e6c 705f  (train_data,nlp_
-00024d80: 636f 6c75 6d6e 2c67 6c6f 7665 5f66 696c  column,glove_fil
-00024d90: 656e 616d 655f 7769 7468 5f70 6174 682c  ename_with_path,
-00024da0: 746f 6b65 6e69 7a65 642c 0a20 2020 2020  tokenized,.     
-00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dc0: 2020 2020 2020 2066 6974 5f66 6c61 673d         fit_flag=
-00024dd0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00024de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024df0: 2020 6d61 785f 6c65 6e67 7468 3d31 3030    max_length=100
-00024e00: 293a 0a20 2020 2022 2222 0a20 2020 2023  ):.    """.    #
+00024b20: 2323 2323 0a66 726f 6d20 7061 7468 6c69  ####.from pathli
+00024b30: 6220 696d 706f 7274 2050 6174 680a 696d  b import Path.im
+00024b40: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+00024b50: 7079 706c 6f74 2061 7320 706c 740a 696d  pyplot as plt.im
+00024b60: 706f 7274 2073 6561 626f 726e 2061 7320  port seaborn as 
+00024b70: 736e 730a 6672 6f6d 2064 6174 6574 696d  sns.from datetim
+00024b80: 6520 696d 706f 7274 2064 6174 6574 696d  e import datetim
+00024b90: 652c 2064 6174 650a 6672 6f6d 2073 6b6c  e, date.from skl
+00024ba0: 6561 726e 2e6d 6574 7269 6373 2069 6d70  earn.metrics imp
+00024bb0: 6f72 7420 6d65 616e 5f73 7175 6172 6564  ort mean_squared
+00024bc0: 5f65 7272 6f72 2c20 726f 635f 6175 635f  _error, roc_auc_
+00024bd0: 7363 6f72 650a 6672 6f6d 2073 6b6c 6561  score.from sklea
+00024be0: 726e 2e70 7265 7072 6f63 6573 7369 6e67  rn.preprocessing
+00024bf0: 2069 6d70 6f72 7420 6d69 6e6d 6178 5f73   import minmax_s
+00024c00: 6361 6c65 0a23 2323 2320 5468 6973 2069  cale.#### This i
+00024c10: 7320 7768 6572 6520 7765 2061 6464 206f  s where we add o
+00024c20: 7468 6572 206c 6962 7261 7269 6573 2074  ther libraries t
+00024c30: 6f20 666f 726d 2061 2070 6970 656c 696e  o form a pipelin
+00024c40: 6520 2323 230a 696d 706f 7274 2063 6f70  e ###.import cop
+00024c50: 790a 696d 706f 7274 2074 696d 650a 696d  y.import time.im
+00024c60: 706f 7274 2072 650a 6672 6f6d 2073 6369  port re.from sci
+00024c70: 7079 2e6e 6469 6d61 6765 2069 6d70 6f72  py.ndimage impor
+00024c80: 7420 636f 6e76 6f6c 7665 0a66 726f 6d20  t convolve.from 
+00024c90: 736b 6c65 6172 6e20 696d 706f 7274 2020  sklearn import  
+00024ca0: 6461 7461 7365 7473 2c20 6d65 7472 6963  datasets, metric
+00024cb0: 730a 6672 6f6d 2073 6b6c 6561 726e 2e6d  s.from sklearn.m
+00024cc0: 6f64 656c 5f73 656c 6563 7469 6f6e 2069  odel_selection i
+00024cd0: 6d70 6f72 7420 7472 6169 6e5f 7465 7374  mport train_test
+00024ce0: 5f73 706c 6974 0a66 726f 6d20 736b 6c65  _split.from skle
+00024cf0: 6172 6e2e 7069 7065 6c69 6e65 2069 6d70  arn.pipeline imp
+00024d00: 6f72 7420 5069 7065 6c69 6e65 0a66 726f  ort Pipeline.fro
+00024d10: 6d20 736b 6c65 6172 6e2e 6d6f 6465 6c5f  m sklearn.model_
+00024d20: 7365 6c65 6374 696f 6e20 696d 706f 7274  selection import
+00024d30: 204b 466f 6c64 2c20 5374 7261 7469 6669   KFold, Stratifi
+00024d40: 6564 5368 7566 666c 6553 706c 6974 0a0a  edShuffleSplit..
+00024d50: 6465 6620 6164 645f 7465 7874 5f70 6164  def add_text_pad
+00024d60: 6469 6e67 7328 7472 6169 6e5f 6461 7461  dings(train_data
+00024d70: 2c6e 6c70 5f63 6f6c 756d 6e2c 676c 6f76  ,nlp_column,glov
+00024d80: 655f 6669 6c65 6e61 6d65 5f77 6974 685f  e_filename_with_
+00024d90: 7061 7468 2c74 6f6b 656e 697a 6564 2c0a  path,tokenized,.
+00024da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024db0: 2020 2020 2020 2020 2020 2020 6669 745f              fit_
+00024dc0: 666c 6167 3d54 7275 652c 0a20 2020 2020  flag=True,.     
+00024dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024de0: 2020 2020 2020 206d 6178 5f6c 656e 6774         max_lengt
+00024df0: 683d 3130 3029 3a0a 2020 2020 2222 220a  h=100):.    """.
+00024e00: 2020 2020 2323 2323 2323 2323 2323 2323      ############
 00024e10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00024e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024e70: 230a 2020 2020 5468 6973 2066 756e 6374  #.    This funct
-00024e80: 696f 6e20 7573 6573 2061 2047 6c6f 5665  ion uses a GloVe
-00024e90: 2070 7265 2d74 7261 696e 6564 206d 6f64   pre-trained mod
-00024ea0: 656c 2074 6f20 6164 6420 656d 6265 6464  el to add embedd
-00024eb0: 696e 6773 2074 6f20 796f 7572 2064 6174  ings to your dat
-00024ec0: 6120 7365 742e 0a20 2020 2023 2323 2323  a set..    #####
-00024ed0: 2323 2320 2049 204e 2050 2055 2054 2023  ###  I N P U T #
+00024e60: 2323 2323 2323 0a20 2020 2054 6869 7320  ######.    This 
+00024e70: 6675 6e63 7469 6f6e 2075 7365 7320 6120  function uses a 
+00024e80: 476c 6f56 6520 7072 652d 7472 6169 6e65  GloVe pre-traine
+00024e90: 6420 6d6f 6465 6c20 746f 2061 6464 2065  d model to add e
+00024ea0: 6d62 6564 6469 6e67 7320 746f 2079 6f75  mbeddings to you
+00024eb0: 7220 6461 7461 2073 6574 2e0a 2020 2020  r data set..    
+00024ec0: 2323 2323 2323 2323 2020 4920 4e20 5020  ########  I N P 
+00024ed0: 5520 5420 2323 2323 2323 2323 2323 2323  U T ############
 00024ee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024ef0: 2323 2323 2323 2323 2323 2323 233a 0a20  #############:. 
-00024f00: 2020 2064 6174 613a 2044 6174 6146 7261     data: DataFra
-00024f10: 6d65 0a20 2020 206e 6c70 5f63 6f6c 756d  me.    nlp_colum
-00024f20: 6e3a 206e 616d 6520 6f66 2074 6865 204e  n: name of the N
-00024f30: 4c50 2063 6f6c 756d 6e20 696e 2074 6865  LP column in the
-00024f40: 2044 6174 6146 7261 6d65 0a20 2020 2074   DataFrame.    t
-00024f50: 6172 6765 743a 206e 616d 6520 6f66 2074  arget: name of t
-00024f60: 6865 2074 6172 6765 7420 7661 7269 6162  he target variab
-00024f70: 6c65 2069 6e20 7468 6520 4461 7461 4672  le in the DataFr
-00024f80: 616d 650a 2020 2020 676c 6f76 6566 696c  ame.    glovefil
-00024f90: 653a 206c 6f63 6174 696f 6e20 6f66 2077  e: location of w
-00024fa0: 6865 7265 2074 6865 2067 6c6f 7665 2e74  here the glove.t
-00024fb0: 7874 2066 696c 6520 6973 2e20 596f 7520  xt file is. You 
-00024fc0: 6d75 7374 2067 6976 6520 7468 6520 6675  must give the fu
-00024fd0: 6c6c 2070 6174 6820 746f 2074 6861 7420  ll path to that 
-00024fe0: 6669 6c65 2e0a 2020 2020 6d61 785f 6c65  file..    max_le
-00024ff0: 6e67 7468 3a20 7370 6563 6966 7920 7468  ngth: specify th
-00025000: 6520 6469 6d65 6e73 696f 6e20 6f66 2074  e dimension of t
-00025010: 6865 2067 6c6f 7665 2076 6563 746f 7220  he glove vector 
-00025020: 2079 6f75 2063 616e 2068 6176 6520 7570   you can have up
-00025030: 746f 2074 6865 2064 696d 656e 7369 6f6e  to the dimension
-00025040: 206f 6620 7468 6520 676c 6f76 6520 7478   of the glove tx
-00025050: 7420 6669 6c65 2e0a 2020 2020 2020 2020  t file..        
-00025060: 2020 204d 616b 6520 7375 7265 2079 6f75     Make sure you
-00025070: 2064 6f6e 2774 2065 7863 6565 6420 7468   don't exceed th
-00025080: 6520 6469 6d65 6e73 696f 6e20 7370 6563  e dimension spec
-00025090: 6966 6965 6420 696e 2074 6865 2067 6c6f  ified in the glo
-000250a0: 7665 2e74 7874 2066 696c 652e 204f 7468  ve.txt file. Oth
-000250b0: 6572 7769 7365 2c20 6572 726f 7220 7265  erwise, error re
-000250c0: 7375 6c74 2e0a 2020 2020 2323 2323 2323  sult..    ######
-000250d0: 2320 4f20 5520 5420 5020 5520 5420 2323  # O U T P U T ##
+00024ef0: 2323 3a0a 2020 2020 6461 7461 3a20 4461  ##:.    data: Da
+00024f00: 7461 4672 616d 650a 2020 2020 6e6c 705f  taFrame.    nlp_
+00024f10: 636f 6c75 6d6e 3a20 6e61 6d65 206f 6620  column: name of 
+00024f20: 7468 6520 4e4c 5020 636f 6c75 6d6e 2069  the NLP column i
+00024f30: 6e20 7468 6520 4461 7461 4672 616d 650a  n the DataFrame.
+00024f40: 2020 2020 7461 7267 6574 3a20 6e61 6d65      target: name
+00024f50: 206f 6620 7468 6520 7461 7267 6574 2076   of the target v
+00024f60: 6172 6961 626c 6520 696e 2074 6865 2044  ariable in the D
+00024f70: 6174 6146 7261 6d65 0a20 2020 2067 6c6f  ataFrame.    glo
+00024f80: 7665 6669 6c65 3a20 6c6f 6361 7469 6f6e  vefile: location
+00024f90: 206f 6620 7768 6572 6520 7468 6520 676c   of where the gl
+00024fa0: 6f76 652e 7478 7420 6669 6c65 2069 732e  ove.txt file is.
+00024fb0: 2059 6f75 206d 7573 7420 6769 7665 2074   You must give t
+00024fc0: 6865 2066 756c 6c20 7061 7468 2074 6f20  he full path to 
+00024fd0: 7468 6174 2066 696c 652e 0a20 2020 206d  that file..    m
+00024fe0: 6178 5f6c 656e 6774 683a 2073 7065 6369  ax_length: speci
+00024ff0: 6679 2074 6865 2064 696d 656e 7369 6f6e  fy the dimension
+00025000: 206f 6620 7468 6520 676c 6f76 6520 7665   of the glove ve
+00025010: 6374 6f72 2020 796f 7520 6361 6e20 6861  ctor  you can ha
+00025020: 7665 2075 7074 6f20 7468 6520 6469 6d65  ve upto the dime
+00025030: 6e73 696f 6e20 6f66 2074 6865 2067 6c6f  nsion of the glo
+00025040: 7665 2074 7874 2066 696c 652e 0a20 2020  ve txt file..   
+00025050: 2020 2020 2020 2020 4d61 6b65 2073 7572          Make sur
+00025060: 6520 796f 7520 646f 6e27 7420 6578 6365  e you don't exce
+00025070: 6564 2074 6865 2064 696d 656e 7369 6f6e  ed the dimension
+00025080: 2073 7065 6369 6669 6564 2069 6e20 7468   specified in th
+00025090: 6520 676c 6f76 652e 7478 7420 6669 6c65  e glove.txt file
+000250a0: 2e20 4f74 6865 7277 6973 652c 2065 7272  . Otherwise, err
+000250b0: 6f72 2072 6573 756c 742e 0a20 2020 2023  or result..    #
+000250c0: 2323 2323 2323 204f 2055 2054 2050 2055  ###### O U T P U
+000250d0: 2054 2023 2323 2323 2323 2323 2323 2323   T #############
 000250e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000250f0: 2323 2323 2323 2323 2323 230a 2020 2020  ###########.    
-00025100: 5468 6520 6461 7461 6672 616d 6520 6973  The dataframe is
-00025110: 2073 706c 6974 2069 6e74 6f20 7472 6169   split into trai
-00025120: 6e20 616e 6420 7465 7374 2061 6e64 2061  n and test and a
-00025130: 7265 206d 6f64 6966 6965 6420 696e 746f  re modified into
-00025140: 2074 6865 2073 7065 6369 6669 6564 2076   the specified v
-00025150: 6563 746f 7220 6469 6d65 6e73 696f 6e20  ector dimension 
-00025160: 6f66 206d 6178 5f6c 656e 6774 680a 2020  of max_length.  
-00025170: 2020 585f 7472 6169 6e5f 7061 6464 6564    X_train_padded
-00025180: 3a20 7468 6520 7472 6169 6e20 6461 7461  : the train data
-00025190: 6672 616d 6520 7769 7468 2064 696d 656e  frame with dimen
-000251a0: 7369 6f6e 2073 7065 6369 6669 6564 2069  sion specified i
-000251b0: 6e20 6d61 785f 6c65 6e67 7468 0a20 2020  n max_length.   
-000251c0: 2079 5f74 7261 696e 3a20 7468 6520 7461   y_train: the ta
-000251d0: 7267 6574 2076 6563 746f 7220 7573 696e  rget vector usin
-000251e0: 6720 6461 7461 2061 6e64 2074 6172 6765  g data and targe
-000251f0: 7420 636f 6c75 6d6e 0a20 2020 2058 5f74  t column.    X_t
-00025200: 6573 745f 7061 6464 6564 3a20 2074 6865  est_padded:  the
-00025210: 2074 6573 7420 6461 7461 6672 616d 6520   test dataframe 
-00025220: 7769 7468 2064 696d 656e 7369 6f6e 2073  with dimension s
-00025230: 7065 6369 6669 6564 2069 6e20 6d61 785f  pecified in max_
-00025240: 6c65 6e67 7468 0a20 2020 2074 6f6b 656e  length.    token
-00025250: 697a 6564 3a20 5468 6973 2069 7320 7468  ized: This is th
-00025260: 6520 746f 6b65 6e69 7a65 7220 7468 6174  e tokenizer that
-00025270: 2077 6173 2075 7365 6420 746f 2073 706c   was used to spl
-00025280: 6974 2074 6865 2077 6f72 6473 2069 6e20  it the words in 
-00025290: 6461 7461 2073 6574 2e20 5468 6973 206d  data set. This m
-000252a0: 7573 7420 6265 2075 7365 6420 6c61 7465  ust be used late
-000252b0: 722e 0a20 2020 2023 2323 2323 2323 2323  r..    #########
+000250f0: 0a20 2020 2054 6865 2064 6174 6166 7261  .    The datafra
+00025100: 6d65 2069 7320 7370 6c69 7420 696e 746f  me is split into
+00025110: 2074 7261 696e 2061 6e64 2074 6573 7420   train and test 
+00025120: 616e 6420 6172 6520 6d6f 6469 6669 6564  and are modified
+00025130: 2069 6e74 6f20 7468 6520 7370 6563 6966   into the specif
+00025140: 6965 6420 7665 6374 6f72 2064 696d 656e  ied vector dimen
+00025150: 7369 6f6e 206f 6620 6d61 785f 6c65 6e67  sion of max_leng
+00025160: 7468 0a20 2020 2058 5f74 7261 696e 5f70  th.    X_train_p
+00025170: 6164 6465 643a 2074 6865 2074 7261 696e  added: the train
+00025180: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
+00025190: 6469 6d65 6e73 696f 6e20 7370 6563 6966  dimension specif
+000251a0: 6965 6420 696e 206d 6178 5f6c 656e 6774  ied in max_lengt
+000251b0: 680a 2020 2020 795f 7472 6169 6e3a 2074  h.    y_train: t
+000251c0: 6865 2074 6172 6765 7420 7665 6374 6f72  he target vector
+000251d0: 2075 7369 6e67 2064 6174 6120 616e 6420   using data and 
+000251e0: 7461 7267 6574 2063 6f6c 756d 6e0a 2020  target column.  
+000251f0: 2020 585f 7465 7374 5f70 6164 6465 643a    X_test_padded:
+00025200: 2020 7468 6520 7465 7374 2064 6174 6166    the test dataf
+00025210: 7261 6d65 2077 6974 6820 6469 6d65 6e73  rame with dimens
+00025220: 696f 6e20 7370 6563 6966 6965 6420 696e  ion specified in
+00025230: 206d 6178 5f6c 656e 6774 680a 2020 2020   max_length.    
+00025240: 746f 6b65 6e69 7a65 643a 2054 6869 7320  tokenized: This 
+00025250: 6973 2074 6865 2074 6f6b 656e 697a 6572  is the tokenizer
+00025260: 2074 6861 7420 7761 7320 7573 6564 2074   that was used t
+00025270: 6f20 7370 6c69 7420 7468 6520 776f 7264  o split the word
+00025280: 7320 696e 2064 6174 6120 7365 742e 2054  s in data set. T
+00025290: 6869 7320 6d75 7374 2062 6520 7573 6564  his must be used
+000252a0: 206c 6174 6572 2e0a 2020 2020 2323 2323   later..    ####
+000252b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000252c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000252d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000252e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000252f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025310: 2323 2323 2323 2323 230a 2020 2020 2222  #########.    ""
-00025320: 220a 2020 2020 7472 6169 6e5f 696e 6465  ".    train_inde
-00025330: 7820 3d20 7472 6169 6e5f 6461 7461 2e69  x = train_data.i
-00025340: 6e64 6578 0a20 2020 2023 2323 2045 6e63  ndex.    ### Enc
-00025350: 6f64 6520 5472 6169 6e20 6461 7461 2074  ode Train data t
-00025360: 6578 7420 696e 746f 2073 6571 7565 6e63  ext into sequenc
-00025370: 6573 0a20 2020 2074 7261 696e 5f64 6174  es.    train_dat
-00025380: 615f 656e 636f 6465 6420 3d20 746f 6b65  a_encoded = toke
-00025390: 6e69 7a65 642e 7465 7874 735f 746f 5f73  nized.texts_to_s
-000253a0: 6571 7565 6e63 6573 2874 7261 696e 5f64  equences(train_d
-000253b0: 6174 615b 6e6c 705f 636f 6c75 6d6e 5d29  ata[nlp_column])
-000253c0: 0a20 2020 2023 2323 2050 6164 5f53 6571  .    ### Pad_Seq
-000253d0: 7565 6e63 6573 2066 756e 6374 696f 6e20  uences function 
-000253e0: 6973 2075 7365 6420 746f 206d 616b 6520  is used to make 
-000253f0: 6c69 7374 7320 6f66 2075 6e65 7175 616c  lists of unequal
-00025400: 206c 656e 6774 6820 746f 2073 7461 636b   length to stack
-00025410: 6564 2073 6574 7320 6f66 2070 6164 6465  ed sets of padde
-00025420: 6420 616e 6420 7472 756e 6361 7465 6420  d and truncated 
-00025430: 6172 7261 7973 0a20 2020 2023 2323 2050  arrays.    ### P
-00025440: 6164 2053 6571 7565 6e63 6573 2066 6f72  ad Sequences for
-00025450: 2054 7261 696e 0a20 2020 2058 5f74 7261   Train.    X_tra
-00025460: 696e 5f70 6164 6465 6420 3d20 7061 645f  in_padded = pad_
-00025470: 7365 7175 656e 6365 7328 7472 6169 6e5f  sequences(train_
-00025480: 6461 7461 5f65 6e63 6f64 6564 2c0a 2020  data_encoded,.  
+00025300: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+00025310: 2020 2022 2222 0a20 2020 2074 7261 696e     """.    train
+00025320: 5f69 6e64 6578 203d 2074 7261 696e 5f64  _index = train_d
+00025330: 6174 612e 696e 6465 780a 2020 2020 2323  ata.index.    ##
+00025340: 2320 456e 636f 6465 2054 7261 696e 2064  # Encode Train d
+00025350: 6174 6120 7465 7874 2069 6e74 6f20 7365  ata text into se
+00025360: 7175 656e 6365 730a 2020 2020 7472 6169  quences.    trai
+00025370: 6e5f 6461 7461 5f65 6e63 6f64 6564 203d  n_data_encoded =
+00025380: 2074 6f6b 656e 697a 6564 2e74 6578 7473   tokenized.texts
+00025390: 5f74 6f5f 7365 7175 656e 6365 7328 7472  _to_sequences(tr
+000253a0: 6169 6e5f 6461 7461 5b6e 6c70 5f63 6f6c  ain_data[nlp_col
+000253b0: 756d 6e5d 290a 2020 2020 2323 2320 5061  umn]).    ### Pa
+000253c0: 645f 5365 7175 656e 6365 7320 6675 6e63  d_Sequences func
+000253d0: 7469 6f6e 2069 7320 7573 6564 2074 6f20  tion is used to 
+000253e0: 6d61 6b65 206c 6973 7473 206f 6620 756e  make lists of un
+000253f0: 6571 7561 6c20 6c65 6e67 7468 2074 6f20  equal length to 
+00025400: 7374 6163 6b65 6420 7365 7473 206f 6620  stacked sets of 
+00025410: 7061 6464 6564 2061 6e64 2074 7275 6e63  padded and trunc
+00025420: 6174 6564 2061 7272 6179 730a 2020 2020  ated arrays.    
+00025430: 2323 2320 5061 6420 5365 7175 656e 6365  ### Pad Sequence
+00025440: 7320 666f 7220 5472 6169 6e0a 2020 2020  s for Train.    
+00025450: 585f 7472 6169 6e5f 7061 6464 6564 203d  X_train_padded =
+00025460: 2070 6164 5f73 6571 7565 6e63 6573 2874   pad_sequences(t
+00025470: 7261 696e 5f64 6174 615f 656e 636f 6465  rain_data_encode
+00025480: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
 00025490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254a0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-000254b0: 786c 656e 3d6d 6178 5f6c 656e 6774 682c  xlen=max_length,
-000254c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000254d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254e0: 2070 6164 6469 6e67 3d27 706f 7374 272c   padding='post',
-000254f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025510: 7472 756e 6361 7469 6e67 3d27 706f 7374  truncating='post
-00025520: 2729 0a20 2020 2070 7269 6e74 2827 2020  ').    print('  
-00025530: 2020 4461 7461 2073 6861 7065 2061 6674    Data shape aft
-00025540: 6572 2070 6164 6469 6e67 203d 2025 7327  er padding = %s'
-00025550: 2025 2858 5f74 7261 696e 5f70 6164 6465   %(X_train_padde
-00025560: 642e 7368 6170 652c 2929 0a20 2020 206e  d.shape,)).    n
-00025570: 6577 5f63 6f6c 7320 3d20 5b27 676c 6f76  ew_cols = ['glov
-00025580: 655f 6469 6d5f 2720 2b20 7374 7228 782b  e_dim_' + str(x+
-00025590: 3129 2066 6f72 2078 2069 6e20 7261 6e67  1) for x in rang
-000255a0: 6528 585f 7472 6169 6e5f 7061 6464 6564  e(X_train_padded
-000255b0: 2e73 6861 7065 5b31 5d29 5d0a 2020 2020  .shape[1])].    
-000255c0: 585f 7472 6169 6e5f 7061 6464 6564 203d  X_train_padded =
-000255d0: 2070 642e 4461 7461 4672 616d 6528 585f   pd.DataFrame(X_
-000255e0: 7472 6169 6e5f 7061 6464 6564 2c20 636f  train_padded, co
-000255f0: 6c75 6d6e 733d 6e65 775f 636f 6c73 2c20  lumns=new_cols, 
-00025600: 696e 6465 783d 7472 6169 6e5f 696e 6465  index=train_inde
-00025610: 7829 0a20 2020 2069 6620 6669 745f 666c  x).    if fit_fl
-00025620: 6167 3a0a 2020 2020 2020 2020 7265 7475  ag:.        retu
-00025630: 726e 2058 5f74 7261 696e 5f70 6164 6465  rn X_train_padde
-00025640: 642c 2074 6f6b 656e 697a 6564 2c20 766f  d, tokenized, vo
-00025650: 6361 625f 7369 7a65 0a20 2020 2065 6c73  cab_size.    els
-00025660: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-00025670: 6e20 585f 7472 6169 6e5f 7061 6464 6564  n X_train_padded
-00025680: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+000254a0: 2020 206d 6178 6c65 6e3d 6d61 785f 6c65     maxlen=max_le
+000254b0: 6e67 7468 2c0a 2020 2020 2020 2020 2020  ngth,.          
+000254c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254d0: 2020 2020 2020 7061 6464 696e 673d 2770        padding='p
+000254e0: 6f73 7427 2c0a 2020 2020 2020 2020 2020  ost',.          
+000254f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025500: 2020 2020 2074 7275 6e63 6174 696e 673d       truncating=
+00025510: 2770 6f73 7427 290a 2020 2020 7072 696e  'post').    prin
+00025520: 7428 2720 2020 2044 6174 6120 7368 6170  t('    Data shap
+00025530: 6520 6166 7465 7220 7061 6464 696e 6720  e after padding 
+00025540: 3d20 2573 2720 2528 585f 7472 6169 6e5f  = %s' %(X_train_
+00025550: 7061 6464 6564 2e73 6861 7065 2c29 290a  padded.shape,)).
+00025560: 2020 2020 6e65 775f 636f 6c73 203d 205b      new_cols = [
+00025570: 2767 6c6f 7665 5f64 696d 5f27 202b 2073  'glove_dim_' + s
+00025580: 7472 2878 2b31 2920 666f 7220 7820 696e  tr(x+1) for x in
+00025590: 2072 616e 6765 2858 5f74 7261 696e 5f70   range(X_train_p
+000255a0: 6164 6465 642e 7368 6170 655b 315d 295d  added.shape[1])]
+000255b0: 0a20 2020 2058 5f74 7261 696e 5f70 6164  .    X_train_pad
+000255c0: 6465 6420 3d20 7064 2e44 6174 6146 7261  ded = pd.DataFra
+000255d0: 6d65 2858 5f74 7261 696e 5f70 6164 6465  me(X_train_padde
+000255e0: 642c 2063 6f6c 756d 6e73 3d6e 6577 5f63  d, columns=new_c
+000255f0: 6f6c 732c 2069 6e64 6578 3d74 7261 696e  ols, index=train
+00025600: 5f69 6e64 6578 290a 2020 2020 6966 2066  _index).    if f
+00025610: 6974 5f66 6c61 673a 0a20 2020 2020 2020  it_flag:.       
+00025620: 2072 6574 7572 6e20 585f 7472 6169 6e5f   return X_train_
+00025630: 7061 6464 6564 2c20 746f 6b65 6e69 7a65  padded, tokenize
+00025640: 642c 2076 6f63 6162 5f73 697a 650a 2020  d, vocab_size.  
+00025650: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00025660: 7265 7475 726e 2058 5f74 7261 696e 5f70  return X_train_p
+00025670: 6164 6465 640a 2323 2323 2323 2323 2323  added.##########
+00025680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000256a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000256b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000256c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000256d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000256e0: 2323 2323 2323 0a64 6566 206c 6f61 645f  ######.def load_
-000256f0: 656d 6265 6464 696e 6773 2874 6f6b 656e  embeddings(token
-00025700: 697a 6564 2c67 6c6f 7665 5f66 696c 656e  ized,glove_filen
-00025710: 616d 655f 7769 7468 5f70 6174 682c 766f  ame_with_path,vo
-00025720: 6361 625f 7369 7a65 2c67 6c6f 7665 5f64  cab_size,glove_d
-00025730: 696d 656e 7369 6f6e 293a 0a20 2020 2022  imension):.    "
-00025740: 2222 0a20 2020 2023 2323 2323 2323 2323  "".    #########
+000256d0: 2323 2323 2323 2323 2323 230a 6465 6620  ###########.def 
+000256e0: 6c6f 6164 5f65 6d62 6564 6469 6e67 7328  load_embeddings(
+000256f0: 746f 6b65 6e69 7a65 642c 676c 6f76 655f  tokenized,glove_
+00025700: 6669 6c65 6e61 6d65 5f77 6974 685f 7061  filename_with_pa
+00025710: 7468 2c76 6f63 6162 5f73 697a 652c 676c  th,vocab_size,gl
+00025720: 6f76 655f 6469 6d65 6e73 696f 6e29 3a0a  ove_dimension):.
+00025730: 2020 2020 2222 220a 2020 2020 2323 2323      """.    ####
+00025740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025760: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000257a0: 2323 2323 2323 2323 230a 2020 2020 2320  #########.    # 
-000257b0: 676c 6f76 655f 6669 6c65 6e61 6d65 5f77  glove_filename_w
-000257c0: 6974 685f 7061 7468 3a20 4d61 6b65 2073  ith_path: Make s
-000257d0: 7572 6520 7520 6861 7665 2064 6f77 6e6c  ure u have downl
-000257e0: 6f61 6465 6420 616e 6420 756e 7a69 7070  oaded and unzipp
-000257f0: 6564 2074 6865 2047 6c6f 5665 2022 2e74  ed the GloVe ".t
-00025800: 7874 2220 6669 6c65 2074 6f20 7468 6520  xt" file to the 
-00025810: 6c6f 6361 7469 6f6e 2068 6572 652e 0a20  location here.. 
-00025820: 2020 2023 2077 6520 6e6f 7720 6372 6561     # we now crea
-00025830: 7465 2061 2064 6963 7469 6f6e 6172 7920  te a dictionary 
-00025840: 7468 6174 206d 6170 7320 476c 6f56 6520  that maps GloVe 
-00025850: 746f 6b65 6e73 2074 6f20 3130 302c 206f  tokens to 100, o
-00025860: 7220 3230 302d 206f 7220 3330 302d 6469  r 200- or 300-di
-00025870: 6d65 6e73 696f 6e61 6c20 7265 616c 2d76  mensional real-v
-00025880: 616c 7565 6420 7665 6374 6f72 730a 2020  alued vectors.  
-00025890: 2020 2320 5468 656e 2077 6520 6c6f 6164    # Then we load
-000258a0: 2074 6865 2077 686f 6c65 2065 6d62 6564   the whole embed
-000258b0: 6469 6e67 2069 6e74 6f20 6d65 6d6f 7279  ding into memory
-000258c0: 2e20 4d61 6b65 2073 7572 6520 796f 7520  . Make sure you 
-000258d0: 6861 7665 2070 6c65 6e74 7920 6f66 206d  have plenty of m
-000258e0: 656d 6f72 7920 696e 2079 6f75 7220 6d61  emory in your ma
-000258f0: 6368 696e 6521 0a20 2020 2023 2323 2323  chine!.    #####
+00025790: 2323 2323 2323 2323 2323 2323 2323 0a20  ##############. 
+000257a0: 2020 2023 2067 6c6f 7665 5f66 696c 656e     # glove_filen
+000257b0: 616d 655f 7769 7468 5f70 6174 683a 204d  ame_with_path: M
+000257c0: 616b 6520 7375 7265 2075 2068 6176 6520  ake sure u have 
+000257d0: 646f 776e 6c6f 6164 6564 2061 6e64 2075  downloaded and u
+000257e0: 6e7a 6970 7065 6420 7468 6520 476c 6f56  nzipped the GloV
+000257f0: 6520 222e 7478 7422 2066 696c 6520 746f  e ".txt" file to
+00025800: 2074 6865 206c 6f63 6174 696f 6e20 6865   the location he
+00025810: 7265 2e0a 2020 2020 2320 7765 206e 6f77  re..    # we now
+00025820: 2063 7265 6174 6520 6120 6469 6374 696f   create a dictio
+00025830: 6e61 7279 2074 6861 7420 6d61 7073 2047  nary that maps G
+00025840: 6c6f 5665 2074 6f6b 656e 7320 746f 2031  loVe tokens to 1
+00025850: 3030 2c20 6f72 2032 3030 2d20 6f72 2033  00, or 200- or 3
+00025860: 3030 2d64 696d 656e 7369 6f6e 616c 2072  00-dimensional r
+00025870: 6561 6c2d 7661 6c75 6564 2076 6563 746f  eal-valued vecto
+00025880: 7273 0a20 2020 2023 2054 6865 6e20 7765  rs.    # Then we
+00025890: 206c 6f61 6420 7468 6520 7768 6f6c 6520   load the whole 
+000258a0: 656d 6265 6464 696e 6720 696e 746f 206d  embedding into m
+000258b0: 656d 6f72 792e 204d 616b 6520 7375 7265  emory. Make sure
+000258c0: 2079 6f75 2068 6176 6520 706c 656e 7479   you have plenty
+000258d0: 206f 6620 6d65 6d6f 7279 2069 6e20 796f   of memory in yo
+000258e0: 7572 206d 6163 6869 6e65 210a 2020 2020  ur machine!.    
+000258f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025950: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00025960: 2020 2222 220a 2020 2020 4d41 585f 4e55    """.    MAX_NU
-00025970: 4d5f 574f 5244 5320 3d20 3130 3030 3030  M_WORDS = 100000
-00025980: 0a20 2020 2067 6c6f 7665 5f70 6174 6820  .    glove_path 
-00025990: 3d20 5061 7468 2867 6c6f 7665 5f66 696c  = Path(glove_fil
-000259a0: 656e 616d 655f 7769 7468 5f70 6174 6829  ename_with_path)
-000259b0: 0a20 2020 2070 7269 6e74 2827 2020 2020  .    print('    
-000259c0: 4372 6561 7469 6e67 2065 6d62 6564 6469  Creating embeddi
-000259d0: 6e67 732e 2054 6869 7320 7769 6c6c 2074  ngs. This will t
-000259e0: 616b 6520 7469 6d65 2e2e 2e27 290a 2020  ake time...').  
-000259f0: 2020 656d 6265 6464 696e 6773 5f69 6e64    embeddings_ind
-00025a00: 6578 203d 2064 6963 7428 290a 2020 2020  ex = dict().    
-00025a10: 666f 7220 6c69 6e65 2069 6e20 676c 6f76  for line in glov
-00025a20: 655f 7061 7468 2e6f 7065 6e28 656e 636f  e_path.open(enco
-00025a30: 6469 6e67 3d27 6c61 7469 6e31 2729 3a0a  ding='latin1'):.
-00025a40: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-00025a50: 206c 696e 652e 7370 6c69 7428 290a 2020   line.split().  
-00025a60: 2020 2020 2020 776f 7264 203d 2076 616c        word = val
-00025a70: 7565 735b 305d 0a20 2020 2020 2020 2074  ues[0].        t
-00025a80: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00025a90: 636f 6566 7320 3d20 6e70 2e61 7361 7272  coefs = np.asarr
-00025aa0: 6179 2876 616c 7565 735b 313a 5d2c 2064  ay(values[1:], d
-00025ab0: 7479 7065 3d27 666c 6f61 7433 3227 290a  type='float32').
-00025ac0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00025ad0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00025ae0: 696e 7565 0a20 2020 2020 2020 2065 6d62  inue.        emb
-00025af0: 6564 6469 6e67 735f 696e 6465 785b 776f  eddings_index[wo
-00025b00: 7264 5d20 3d20 636f 6566 730a 2020 2020  rd] = coefs.    
-00025b10: 7072 696e 7428 274c 6f61 6465 6420 7b3a  print('Loaded {:
-00025b20: 2c64 7d20 476c 6f76 6520 7665 6374 6f72  ,d} Glove vector
-00025b30: 732e 272e 666f 726d 6174 286c 656e 2865  s.'.format(len(e
-00025b40: 6d62 6564 6469 6e67 735f 696e 6465 7829  mbeddings_index)
-00025b50: 2929 0a20 2020 2023 5468 6572 6520 6172  )).    #There ar
-00025b60: 6520 6172 6f75 6e64 2033 3430 2c30 3030  e around 340,000
-00025b70: 2077 6f72 6420 7665 6374 6f72 7320 7468   word vectors th
-00025b80: 6174 2077 6520 7573 6520 746f 2063 7265  at we use to cre
-00025b90: 6174 6520 616e 2065 6d62 6564 6469 6e67  ate an embedding
-00025ba0: 206d 6174 7269 780a 2020 2020 2320 7468   matrix.    # th
-00025bb0: 6174 206d 6174 6368 6573 2074 6865 2076  at matches the v
-00025bc0: 6f63 6162 756c 6172 7920 736f 2074 6861  ocabulary so tha
-00025bd0: 7420 7468 6520 524e 4e20 6d6f 6465 6c20  t the RNN model 
-00025be0: 6361 6e20 6163 6365 7373 2065 6d62 6564  can access embed
-00025bf0: 6469 6e67 7320 6279 2074 6865 2074 6f6b  dings by the tok
-00025c00: 656e 2069 6e64 6578 0a20 2020 2023 2070  en index.    # p
-00025c10: 7265 7061 7265 2065 6d62 6564 6469 6e67  repare embedding
-00025c20: 206d 6174 7269 780a 2020 2020 776f 7264   matrix.    word
-00025c30: 5f69 6e64 6578 203d 2074 6f6b 656e 697a  _index = tokeniz
-00025c40: 6564 2e77 6f72 645f 696e 6465 780a 2020  ed.word_index.  
-00025c50: 2020 656d 6265 6464 696e 675f 6d61 7472    embedding_matr
-00025c60: 6978 203d 206e 702e 7a65 726f 7328 2876  ix = np.zeros((v
-00025c70: 6f63 6162 5f73 697a 652c 2067 6c6f 7665  ocab_size, glove
-00025c80: 5f64 696d 656e 7369 6f6e 2929 0a20 2020  _dimension)).   
-00025c90: 2070 7269 6e74 2827 5072 6570 6172 696e   print('Preparin
-00025ca0: 6720 656d 6265 6464 696e 6720 6d61 7472  g embedding matr
-00025cb0: 6978 2e27 290a 2020 2020 666f 7220 776f  ix.').    for wo
-00025cc0: 7264 2c20 6920 696e 2077 6f72 645f 696e  rd, i in word_in
-00025cd0: 6465 782e 6974 656d 7328 293a 0a20 2020  dex.items():.   
-00025ce0: 2020 2020 2069 6620 6920 3e3d 204d 4158       if i >= MAX
-00025cf0: 5f4e 554d 5f57 4f52 4453 3a0a 2020 2020  _NUM_WORDS:.    
-00025d00: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00025d10: 0a20 2020 2020 2020 2065 6d62 6564 6469  .        embeddi
-00025d20: 6e67 5f76 6563 746f 7220 3d20 656d 6265  ng_vector = embe
-00025d30: 6464 696e 6773 5f69 6e64 6578 2e67 6574  ddings_index.get
-00025d40: 2877 6f72 6429 0a20 2020 2020 2020 2069  (word).        i
-00025d50: 6620 656d 6265 6464 696e 675f 7665 6374  f embedding_vect
-00025d60: 6f72 2069 7320 6e6f 7420 4e6f 6e65 3a0a  or is not None:.
-00025d70: 2020 2020 2020 2020 2020 2020 2320 776f              # wo
-00025d80: 7264 7320 6e6f 7420 666f 756e 6420 696e  rds not found in
-00025d90: 2065 6d62 6564 6469 6e67 2069 6e64 6578   embedding index
-00025da0: 2077 696c 6c20 6265 2061 6c6c 2d7a 6572   will be all-zer
-00025db0: 6f73 2e0a 2020 2020 2020 2020 2020 2020  os..            
-00025dc0: 656d 6265 6464 696e 675f 6d61 7472 6978  embedding_matrix
-00025dd0: 5b69 5d20 3d20 656d 6265 6464 696e 675f  [i] = embedding_
-00025de0: 7665 6374 6f72 0a20 2020 2070 7269 6e74  vector.    print
-00025df0: 2827 2020 2020 436f 6d70 6c65 7465 642e  ('    Completed.
-00025e00: 2729 0a20 2020 2072 6574 7572 6e20 656d  ').    return em
-00025e10: 6265 6464 696e 675f 6d61 7472 6978 2c20  bedding_matrix, 
-00025e20: 676c 6f76 655f 6469 6d65 6e73 696f 6e0a  glove_dimension.
+00025950: 2323 0a20 2020 2022 2222 0a20 2020 204d  ##.    """.    M
+00025960: 4158 5f4e 554d 5f57 4f52 4453 203d 2031  AX_NUM_WORDS = 1
+00025970: 3030 3030 300a 2020 2020 676c 6f76 655f  00000.    glove_
+00025980: 7061 7468 203d 2050 6174 6828 676c 6f76  path = Path(glov
+00025990: 655f 6669 6c65 6e61 6d65 5f77 6974 685f  e_filename_with_
+000259a0: 7061 7468 290a 2020 2020 7072 696e 7428  path).    print(
+000259b0: 2720 2020 2043 7265 6174 696e 6720 656d  '    Creating em
+000259c0: 6265 6464 696e 6773 2e20 5468 6973 2077  beddings. This w
+000259d0: 696c 6c20 7461 6b65 2074 696d 652e 2e2e  ill take time...
+000259e0: 2729 0a20 2020 2065 6d62 6564 6469 6e67  ').    embedding
+000259f0: 735f 696e 6465 7820 3d20 6469 6374 2829  s_index = dict()
+00025a00: 0a20 2020 2066 6f72 206c 696e 6520 696e  .    for line in
+00025a10: 2067 6c6f 7665 5f70 6174 682e 6f70 656e   glove_path.open
+00025a20: 2865 6e63 6f64 696e 673d 276c 6174 696e  (encoding='latin
+00025a30: 3127 293a 0a20 2020 2020 2020 2076 616c  1'):.        val
+00025a40: 7565 7320 3d20 6c69 6e65 2e73 706c 6974  ues = line.split
+00025a50: 2829 0a20 2020 2020 2020 2077 6f72 6420  ().        word 
+00025a60: 3d20 7661 6c75 6573 5b30 5d0a 2020 2020  = values[0].    
+00025a70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00025a80: 2020 2020 2063 6f65 6673 203d 206e 702e       coefs = np.
+00025a90: 6173 6172 7261 7928 7661 6c75 6573 5b31  asarray(values[1
+00025aa0: 3a5d 2c20 6474 7970 653d 2766 6c6f 6174  :], dtype='float
+00025ab0: 3332 2729 0a20 2020 2020 2020 2065 7863  32').        exc
+00025ac0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00025ad0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00025ae0: 2020 656d 6265 6464 696e 6773 5f69 6e64    embeddings_ind
+00025af0: 6578 5b77 6f72 645d 203d 2063 6f65 6673  ex[word] = coefs
+00025b00: 0a20 2020 2070 7269 6e74 2827 4c6f 6164  .    print('Load
+00025b10: 6564 207b 3a2c 647d 2047 6c6f 7665 2076  ed {:,d} Glove v
+00025b20: 6563 746f 7273 2e27 2e66 6f72 6d61 7428  ectors.'.format(
+00025b30: 6c65 6e28 656d 6265 6464 696e 6773 5f69  len(embeddings_i
+00025b40: 6e64 6578 2929 290a 2020 2020 2354 6865  ndex))).    #The
+00025b50: 7265 2061 7265 2061 726f 756e 6420 3334  re are around 34
+00025b60: 302c 3030 3020 776f 7264 2076 6563 746f  0,000 word vecto
+00025b70: 7273 2074 6861 7420 7765 2075 7365 2074  rs that we use t
+00025b80: 6f20 6372 6561 7465 2061 6e20 656d 6265  o create an embe
+00025b90: 6464 696e 6720 6d61 7472 6978 0a20 2020  dding matrix.   
+00025ba0: 2023 2074 6861 7420 6d61 7463 6865 7320   # that matches 
+00025bb0: 7468 6520 766f 6361 6275 6c61 7279 2073  the vocabulary s
+00025bc0: 6f20 7468 6174 2074 6865 2052 4e4e 206d  o that the RNN m
+00025bd0: 6f64 656c 2063 616e 2061 6363 6573 7320  odel can access 
+00025be0: 656d 6265 6464 696e 6773 2062 7920 7468  embeddings by th
+00025bf0: 6520 746f 6b65 6e20 696e 6465 780a 2020  e token index.  
+00025c00: 2020 2320 7072 6570 6172 6520 656d 6265    # prepare embe
+00025c10: 6464 696e 6720 6d61 7472 6978 0a20 2020  dding matrix.   
+00025c20: 2077 6f72 645f 696e 6465 7820 3d20 746f   word_index = to
+00025c30: 6b65 6e69 7a65 642e 776f 7264 5f69 6e64  kenized.word_ind
+00025c40: 6578 0a20 2020 2065 6d62 6564 6469 6e67  ex.    embedding
+00025c50: 5f6d 6174 7269 7820 3d20 6e70 2e7a 6572  _matrix = np.zer
+00025c60: 6f73 2828 766f 6361 625f 7369 7a65 2c20  os((vocab_size, 
+00025c70: 676c 6f76 655f 6469 6d65 6e73 696f 6e29  glove_dimension)
+00025c80: 290a 2020 2020 7072 696e 7428 2750 7265  ).    print('Pre
+00025c90: 7061 7269 6e67 2065 6d62 6564 6469 6e67  paring embedding
+00025ca0: 206d 6174 7269 782e 2729 0a20 2020 2066   matrix.').    f
+00025cb0: 6f72 2077 6f72 642c 2069 2069 6e20 776f  or word, i in wo
+00025cc0: 7264 5f69 6e64 6578 2e69 7465 6d73 2829  rd_index.items()
+00025cd0: 3a0a 2020 2020 2020 2020 6966 2069 203e  :.        if i >
+00025ce0: 3d20 4d41 585f 4e55 4d5f 574f 5244 533a  = MAX_NUM_WORDS:
+00025cf0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00025d00: 7469 6e75 650a 2020 2020 2020 2020 656d  tinue.        em
+00025d10: 6265 6464 696e 675f 7665 6374 6f72 203d  bedding_vector =
+00025d20: 2065 6d62 6564 6469 6e67 735f 696e 6465   embeddings_inde
+00025d30: 782e 6765 7428 776f 7264 290a 2020 2020  x.get(word).    
+00025d40: 2020 2020 6966 2065 6d62 6564 6469 6e67      if embedding
+00025d50: 5f76 6563 746f 7220 6973 206e 6f74 204e  _vector is not N
+00025d60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00025d70: 2023 2077 6f72 6473 206e 6f74 2066 6f75   # words not fou
+00025d80: 6e64 2069 6e20 656d 6265 6464 696e 6720  nd in embedding 
+00025d90: 696e 6465 7820 7769 6c6c 2062 6520 616c  index will be al
+00025da0: 6c2d 7a65 726f 732e 0a20 2020 2020 2020  l-zeros..       
+00025db0: 2020 2020 2065 6d62 6564 6469 6e67 5f6d       embedding_m
+00025dc0: 6174 7269 785b 695d 203d 2065 6d62 6564  atrix[i] = embed
+00025dd0: 6469 6e67 5f76 6563 746f 720a 2020 2020  ding_vector.    
+00025de0: 7072 696e 7428 2720 2020 2043 6f6d 706c  print('    Compl
+00025df0: 6574 6564 2e27 290a 2020 2020 7265 7475  eted.').    retu
+00025e00: 726e 2065 6d62 6564 6469 6e67 5f6d 6174  rn embedding_mat
+00025e10: 7269 782c 2067 6c6f 7665 5f64 696d 656e  rix, glove_dimen
+00025e20: 7369 6f6e 0a23 2323 2323 2323 2323 2323  sion.###########
 00025e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025e60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00025e70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025e80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00025e90: 2323 2323 230a 696d 706f 7274 2063 6f70  #####.import cop
-00025ea0: 790a 6465 6620 4645 5f63 6f6e 7665 7274  y.def FE_convert
-00025eb0: 5f6d 6978 6564 5f64 6174 6174 7970 6573  _mixed_datatypes
-00025ec0: 5f74 6f5f 7374 7269 6e67 2864 6629 3a0a  _to_string(df):.
-00025ed0: 2020 2020 6466 203d 2063 6f70 792e 6465      df = copy.de
-00025ee0: 6570 636f 7079 2864 6629 0a20 2020 2066  epcopy(df).    f
-00025ef0: 6f72 2063 6f6c 2069 6e20 6466 2e63 6f6c  or col in df.col
-00025f00: 756d 6e73 3a0a 2020 2020 2020 2020 6966  umns:.        if
-00025f10: 206c 656e 2864 665b 636f 6c5d 2e61 7070   len(df[col].app
-00025f20: 6c79 2874 7970 6529 2e76 616c 7565 5f63  ly(type).value_c
-00025f30: 6f75 6e74 7328 2929 203e 2031 3a0a 2020  ounts()) > 1:.  
-00025f40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00025f50: 274d 6978 6564 2064 6174 6120 7479 7065  'Mixed data type
-00025f60: 2064 6574 6563 7465 6420 696e 2025 7320   detected in %s 
-00025f70: 636f 6c75 6d6e 2e20 436f 6e76 6572 7469  column. Converti
-00025f80: 6e67 2061 6c6c 2072 6f77 7320 746f 2073  ng all rows to s
-00025f90: 7472 696e 6720 7479 7065 206e 6f77 2e2e  tring type now..
-00025fa0: 2e27 2025 636f 6c29 0a20 2020 2020 2020  .' %col).       
-00025fb0: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
-00025fc0: 665b 636f 6c5d 2e6d 6170 286c 616d 6264  f[col].map(lambd
-00025fd0: 6120 783a 2078 2069 6620 6973 696e 7374  a x: x if isinst
-00025fe0: 616e 6365 2878 2c20 7374 7229 2065 6c73  ance(x, str) els
-00025ff0: 6520 7374 7228 7829 292e 7661 6c75 6573  e str(x)).values
-00026000: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026010: 6c65 6e28 6466 5b63 6f6c 5d2e 6170 706c  len(df[col].appl
-00026020: 7928 7479 7065 292e 7661 6c75 655f 636f  y(type).value_co
-00026030: 756e 7473 2829 2920 3d3d 2031 3a0a 2020  unts()) == 1:.  
-00026040: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00026050: 696e 7428 2720 2020 2063 6f6d 706c 6574  int('    complet
-00026060: 6564 2e27 290a 2020 2020 2020 2020 2020  ed.').          
-00026070: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00026080: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-00026090: 2020 2063 6f75 6c64 206e 6f74 2063 6861     could not cha
-000260a0: 6e67 6520 636f 6c75 6d6e 2074 7970 652e  nge column type.
-000260b0: 2046 6978 2069 7420 6d61 6e75 616c 6c79   Fix it manually
-000260c0: 2061 6e64 2074 6865 6e20 7265 2d72 756e   and then re-run
-000260d0: 2045 4441 2e27 290a 2020 2020 7265 7475   EDA.').    retu
-000260e0: 726e 2064 660a 2323 2323 2323 2323 2323  rn df.##########
+00025e80: 2323 2323 2323 2323 2323 0a69 6d70 6f72  ##########.impor
+00025e90: 7420 636f 7079 0a64 6566 2046 455f 636f  t copy.def FE_co
+00025ea0: 6e76 6572 745f 6d69 7865 645f 6461 7461  nvert_mixed_data
+00025eb0: 7479 7065 735f 746f 5f73 7472 696e 6728  types_to_string(
+00025ec0: 6466 293a 0a20 2020 2064 6620 3d20 636f  df):.    df = co
+00025ed0: 7079 2e64 6565 7063 6f70 7928 6466 290a  py.deepcopy(df).
+00025ee0: 2020 2020 666f 7220 636f 6c20 696e 2064      for col in d
+00025ef0: 662e 636f 6c75 6d6e 733a 0a20 2020 2020  f.columns:.     
+00025f00: 2020 2069 6620 6c65 6e28 6466 5b63 6f6c     if len(df[col
+00025f10: 5d2e 6170 706c 7928 7479 7065 292e 7661  ].apply(type).va
+00025f20: 6c75 655f 636f 756e 7473 2829 2920 3e20  lue_counts()) > 
+00025f30: 313a 0a20 2020 2020 2020 2020 2020 2070  1:.            p
+00025f40: 7269 6e74 2827 4d69 7865 6420 6461 7461  rint('Mixed data
+00025f50: 2074 7970 6520 6465 7465 6374 6564 2069   type detected i
+00025f60: 6e20 2573 2063 6f6c 756d 6e2e 2043 6f6e  n %s column. Con
+00025f70: 7665 7274 696e 6720 616c 6c20 726f 7773  verting all rows
+00025f80: 2074 6f20 7374 7269 6e67 2074 7970 6520   to string type 
+00025f90: 6e6f 772e 2e2e 2720 2563 6f6c 290a 2020  now...' %col).  
+00025fa0: 2020 2020 2020 2020 2020 6466 5b63 6f6c            df[col
+00025fb0: 5d20 3d20 6466 5b63 6f6c 5d2e 6d61 7028  ] = df[col].map(
+00025fc0: 6c61 6d62 6461 2078 3a20 7820 6966 2069  lambda x: x if i
+00025fd0: 7369 6e73 7461 6e63 6528 782c 2073 7472  sinstance(x, str
+00025fe0: 2920 656c 7365 2073 7472 2878 2929 2e76  ) else str(x)).v
+00025ff0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
+00026000: 2020 6966 206c 656e 2864 665b 636f 6c5d    if len(df[col]
+00026010: 2e61 7070 6c79 2874 7970 6529 2e76 616c  .apply(type).val
+00026020: 7565 5f63 6f75 6e74 7328 2929 203d 3d20  ue_counts()) == 
+00026030: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00026040: 2020 2070 7269 6e74 2827 2020 2020 636f     print('    co
+00026050: 6d70 6c65 7465 642e 2729 0a20 2020 2020  mpleted.').     
+00026060: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00026070: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00026080: 6e74 2827 2020 2020 636f 756c 6420 6e6f  nt('    could no
+00026090: 7420 6368 616e 6765 2063 6f6c 756d 6e20  t change column 
+000260a0: 7479 7065 2e20 4669 7820 6974 206d 616e  type. Fix it man
+000260b0: 7561 6c6c 7920 616e 6420 7468 656e 2072  ually and then r
+000260c0: 652d 7275 6e20 4544 412e 2729 0a20 2020  e-run EDA.').   
+000260d0: 2072 6574 7572 6e20 6466 0a23 2323 2323   return df.#####
+000260e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000260f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00026100: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00026110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026130: 2323 2323 2323 2323 0a64 6566 2072 656d  ########.def rem
-00026140: 6f76 655f 6475 706c 6963 6174 655f 636f  ove_duplicate_co
-00026150: 6c73 5f69 6e5f 6461 7461 7365 7428 6466  ls_in_dataset(df
-00026160: 293a 0a20 2020 2064 6620 3d20 636f 7079  ):.    df = copy
-00026170: 2e64 6565 7063 6f70 7928 6466 290a 2020  .deepcopy(df).  
-00026180: 2020 6e75 6d62 6572 5f64 7570 6c69 6361    number_duplica
-00026190: 7465 7320 3d20 6466 2e63 6f6c 756d 6e73  tes = df.columns
-000261a0: 2e64 7570 6c69 6361 7465 6428 292e 6173  .duplicated().as
-000261b0: 7479 7065 2869 6e74 292e 7375 6d28 290a  type(int).sum().
-000261c0: 2020 2020 6475 706c 6963 6174 6573 203d      duplicates =
-000261d0: 2064 662e 636f 6c75 6d6e 735b 6466 2e63   df.columns[df.c
-000261e0: 6f6c 756d 6e73 2e64 7570 6c69 6361 7465  olumns.duplicate
-000261f0: 6428 295d 0a20 2020 2069 6620 206e 756d  d()].    if  num
-00026200: 6265 725f 6475 706c 6963 6174 6573 203e  ber_duplicates >
-00026210: 2030 3a0a 2020 2020 2020 2020 7072 696e   0:.        prin
-00026220: 7428 2752 656d 6f76 696e 6720 2564 2064  t('Removing %d d
-00026230: 7570 6c69 6361 7465 2063 6f6c 756d 6e28  uplicate column(
-00026240: 7329 206f 6620 2573 2720 2528 6e75 6d62  s) of %s' %(numb
-00026250: 6572 5f64 7570 6c69 6361 7465 732c 2064  er_duplicates, d
-00026260: 7570 6c69 6361 7465 7329 290a 2020 2020  uplicates)).    
-00026270: 2020 2020 6466 203d 2064 662e 6c6f 635b      df = df.loc[
-00026280: 3a2c 7e64 662e 636f 6c75 6d6e 732e 6475  :,~df.columns.du
-00026290: 706c 6963 6174 6564 2829 5d0a 2020 2020  plicated()].    
-000262a0: 7265 7475 726e 2064 660a 2323 2323 2323  return df.######
+00026120: 2323 2323 2323 2323 2323 2323 230a 6465  #############.de
+00026130: 6620 7265 6d6f 7665 5f64 7570 6c69 6361  f remove_duplica
+00026140: 7465 5f63 6f6c 735f 696e 5f64 6174 6173  te_cols_in_datas
+00026150: 6574 2864 6629 3a0a 2020 2020 6466 203d  et(df):.    df =
+00026160: 2063 6f70 792e 6465 6570 636f 7079 2864   copy.deepcopy(d
+00026170: 6629 0a20 2020 206e 756d 6265 725f 6475  f).    number_du
+00026180: 706c 6963 6174 6573 203d 2064 662e 636f  plicates = df.co
+00026190: 6c75 6d6e 732e 6475 706c 6963 6174 6564  lumns.duplicated
+000261a0: 2829 2e61 7374 7970 6528 696e 7429 2e73  ().astype(int).s
+000261b0: 756d 2829 0a20 2020 2064 7570 6c69 6361  um().    duplica
+000261c0: 7465 7320 3d20 6466 2e63 6f6c 756d 6e73  tes = df.columns
+000261d0: 5b64 662e 636f 6c75 6d6e 732e 6475 706c  [df.columns.dupl
+000261e0: 6963 6174 6564 2829 5d0a 2020 2020 6966  icated()].    if
+000261f0: 2020 6e75 6d62 6572 5f64 7570 6c69 6361    number_duplica
+00026200: 7465 7320 3e20 303a 0a20 2020 2020 2020  tes > 0:.       
+00026210: 2070 7269 6e74 2827 5265 6d6f 7669 6e67   print('Removing
+00026220: 2025 6420 6475 706c 6963 6174 6520 636f   %d duplicate co
+00026230: 6c75 6d6e 2873 2920 6f66 2025 7327 2025  lumn(s) of %s' %
+00026240: 286e 756d 6265 725f 6475 706c 6963 6174  (number_duplicat
+00026250: 6573 2c20 6475 706c 6963 6174 6573 2929  es, duplicates))
+00026260: 0a20 2020 2020 2020 2064 6620 3d20 6466  .        df = df
+00026270: 2e6c 6f63 5b3a 2c7e 6466 2e63 6f6c 756d  .loc[:,~df.colum
+00026280: 6e73 2e64 7570 6c69 6361 7465 6428 295d  ns.duplicated()]
+00026290: 0a20 2020 2072 6574 7572 6e20 6466 0a23  .    return df.#
+000262a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000262b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000262c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000262d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000262e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000262f0: 2323 2323 230a 6465 6620 4645 5f73 706c  #####.def FE_spl
-00026300: 6974 5f6c 6973 745f 696e 746f 5f63 6f6c  it_list_into_col
-00026310: 756d 6e73 2864 662c 2063 6f6c 2c20 636f  umns(df, col, co
-00026320: 6c73 5f69 6e3d 5b5d 293a 0a20 2020 2022  ls_in=[]):.    "
-00026330: 2222 0a20 2020 2054 6869 7320 6973 2061  "".    This is a
-00026340: 2046 6561 7475 7265 2045 6e67 696e 6565   Feature Enginee
-00026350: 7269 6e67 2066 756e 6374 696f 6e2e 2049  ring function. I
-00026360: 7420 7769 6c6c 2061 7574 6f6d 6174 6963  t will automatic
-00026370: 616c 6c79 2064 6574 6563 7420 6f62 6a65  ally detect obje
-00026380: 6374 2076 6172 6961 626c 6573 2074 6861  ct variables tha
-00026390: 7420 636f 6e74 6169 6e20 6c69 7374 730a  t contain lists.
-000263a0: 2020 2020 616e 6420 636f 6e76 6572 7420      and convert 
-000263b0: 7468 656d 2069 6e74 6f20 6e65 7720 636f  them into new co
-000263c0: 6c75 6d6e 732e 2059 6f75 206e 6565 6420  lumns. You need 
-000263d0: 746f 2070 726f 7669 6465 2074 6865 2064  to provide the d
-000263e0: 6174 6166 7261 6d65 2c20 7468 6520 6e61  ataframe, the na
-000263f0: 6d65 206f 6620 7468 6520 6f62 6a65 6374  me of the object
-00026400: 2063 6f6c 756d 6e2e 0a20 2020 204f 7074   column..    Opt
-00026410: 696f 6e61 6c6c 792c 2079 6f75 2063 616e  ionally, you can
-00026420: 2064 6563 6964 6520 746f 2073 656e 6420   decide to send 
-00026430: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
-00026440: 206e 6577 2063 6f6c 756d 6e73 2079 6f75   new columns you
-00026450: 2077 616e 7420 746f 2063 7265 6174 6520   want to create 
-00026460: 6173 2063 6f6c 735f 696e 2e0a 2020 2020  as cols_in..    
-00026470: 4974 2077 696c 6c20 7265 7475 726e 2074  It will return t
-00026480: 6865 2064 6174 6166 7261 6d65 2077 6974  he dataframe wit
-00026490: 6820 6164 6469 7469 6f6e 616c 2063 6f6c  h additional col
-000264a0: 756d 6e73 2e20 4974 2077 696c 6c20 6472  umns. It will dr
-000264b0: 6f70 2074 6865 2063 6f6c 756d 6e20 7768  op the column wh
-000264c0: 6963 6820 796f 7520 7365 6e74 2069 6e20  ich you sent in 
-000264d0: 6173 2069 6e70 7574 2e0a 0a20 2020 2049  as input...    I
-000264e0: 6e70 7574 733a 0a20 2020 202d 2d2d 2d2d  nputs:.    -----
-000264f0: 2d2d 2d0a 2020 2020 6466 3a20 7061 6e64  ---.    df: pand
-00026500: 6173 2064 6174 6166 7261 6d65 0a20 2020  as dataframe.   
-00026510: 2063 6f6c 3a20 6e61 6d65 206f 6620 7468   col: name of th
-00026520: 6520 6f62 6a65 6374 2063 6f6c 756d 6e20  e object column 
-00026530: 7468 6174 2063 6f6e 7461 696e 7320 6120  that contains a 
-00026540: 6c69 7374 2e20 5265 6d65 6d62 6572 2069  list. Remember i
-00026550: 7420 6d75 7374 2062 6520 6120 6c69 7374  t must be a list
-00026560: 2061 6e64 206e 6f74 2061 2073 7472 696e   and not a strin
-00026570: 672e 0a20 2020 2063 6f6c 735f 696e 3a20  g..    cols_in: 
-00026580: 6e61 6d65 7320 6f66 2074 6865 2063 6f6c  names of the col
-00026590: 756d 6e73 2079 6f75 2077 616e 7420 746f  umns you want to
-000265a0: 2063 7265 6174 652e 2049 6620 7468 6520   create. If the 
-000265b0: 6e75 6d62 6572 206f 6620 636f 6c75 6d6e  number of column
-000265c0: 7320 6973 206c 6573 7320 7468 616e 206c  s is less than l
-000265d0: 6973 7420 6c65 6e67 7468 2c0a 2020 2020  ist length,.    
-000265e0: 2020 2020 2020 2020 2069 7420 7769 6c6c           it will
-000265f0: 2061 7574 6f6d 6174 6963 616c 6c79 2063   automatically c
-00026600: 686f 6f73 6520 6f6e 6c79 2074 6865 2066  hoose only the f
-00026610: 6973 7420 6665 7720 6974 656d 7320 6f66  ist few items of
-00026620: 2074 6865 206c 6973 7420 746f 206d 6174   the list to mat
-00026630: 6368 2074 6865 206c 656e 6774 6820 6f66  ch the length of
-00026640: 2063 6f6c 735f 696e 2e0a 2020 2020 0a20   cols_in..    . 
-00026650: 2020 204f 7574 7075 7473 3a0a 2020 2020     Outputs:.    
-00026660: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
-00026670: 3a20 7061 6e64 6173 2064 6174 6166 7261  : pandas datafra
-00026680: 6d65 2077 6974 6820 6e65 7720 636f 6c75  me with new colu
-00026690: 6d6e 7320 616e 6420 7769 7468 6f75 7420  mns and without 
-000266a0: 7468 6520 636f 6c75 6d6e 2079 6f75 2073  the column you s
-000266b0: 656e 7420 696e 2061 7320 696e 7075 742e  ent in as input.
-000266c0: 0a20 2020 2022 2222 0a20 2020 2064 6620  .    """.    df 
-000266d0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-000266e0: 6466 290a 2020 2020 6966 2063 6f6c 735f  df).    if cols_
-000266f0: 696e 3a0a 2020 2020 2020 2020 6d61 785f  in:.        max_
-00026700: 636f 6c5f 6c65 6e67 7468 203d 206c 656e  col_length = len
-00026710: 2863 6f6c 735f 696e 290a 2020 2020 2020  (cols_in).      
-00026720: 2020 6466 5b63 6f6c 735f 696e 5d20 3d20    df[cols_in] = 
-00026730: 6466 5b63 6f6c 5d2e 6170 706c 7928 7064  df[col].apply(pd
-00026740: 2e53 6572 6965 7329 2e76 616c 7565 735b  .Series).values[
-00026750: 3a2c 3a6d 6178 5f63 6f6c 5f6c 656e 6774  :,:max_col_lengt
-00026760: 685d 0a20 2020 2020 2020 2064 6620 3d20  h].        df = 
-00026770: 6466 2e64 726f 7028 636f 6c2c 6178 6973  df.drop(col,axis
-00026780: 3d31 290a 2020 2020 656c 7365 3a0a 2020  =1).    else:.  
-00026790: 2020 2020 2020 6966 206c 656e 2864 665b        if len(df[
-000267a0: 636f 6c5d 2e6d 6170 2874 7970 6529 2e76  col].map(type).v
-000267b0: 616c 7565 5f63 6f75 6e74 7328 2929 3d3d  alue_counts())==
-000267c0: 3120 616e 6420 6466 5b63 6f6c 5d2e 6d61  1 and df[col].ma
-000267d0: 7028 7479 7065 292e 7661 6c75 655f 636f  p(type).value_co
-000267e0: 756e 7473 2829 2e69 6e64 6578 5b30 5d3d  unts().index[0]=
-000267f0: 3d6c 6973 743a 0a20 2020 2020 2020 2020  =list:.         
-00026800: 2020 2023 2323 2052 656d 656d 6265 7220     ### Remember 
-00026810: 7468 6174 2066 696c 6c6e 6120 6f6e 6c79  that fillna only
-00026820: 2077 6f72 6b73 2061 7420 6461 7461 6672   works at datafr
-00026830: 616d 6520 6c65 7665 6c21 2023 2323 0a20  ame level! ###. 
-00026840: 2020 2020 2020 2020 2020 206d 6178 5f63             max_c
-00026850: 6f6c 5f6c 656e 6774 6820 3d20 6466 5b5b  ol_length = df[[
-00026860: 636f 6c5d 5d2e 6669 6c6c 6e61 2827 6d69  col]].fillna('mi
-00026870: 7373 696e 6727 292e 6d61 7028 6c65 6e29  ssing').map(len)
-00026880: 2e6d 6178 2829 0a20 2020 2020 2020 2020  .max().         
-00026890: 2020 2063 6f6c 7320 3d20 5b63 6f6c 2b27     cols = [col+'
-000268a0: 5f27 2b73 7472 2869 2920 666f 7220 6920  _'+str(i) for i 
-000268b0: 696e 2072 616e 6765 286d 6178 5f63 6f6c  in range(max_col
-000268c0: 5f6c 656e 6774 6829 5d0a 2020 2020 2020  _length)].      
-000268d0: 2020 2020 2020 6466 5b63 6f6c 735d 203d        df[cols] =
-000268e0: 2064 665b 636f 6c5d 2e61 7070 6c79 2870   df[col].apply(p
-000268f0: 642e 5365 7269 6573 290a 2020 2020 2020  d.Series).      
-00026900: 2020 2020 2020 6466 203d 2064 662e 6472        df = df.dr
-00026910: 6f70 2863 6f6c 2c61 7869 733d 3129 0a20  op(col,axis=1). 
-00026920: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00026930: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00026940: 436f 6c75 6d6e 2025 7320 646f 6573 206e  Column %s does n
-00026950: 6f74 2063 6f6e 7461 696e 206c 6973 7473  ot contain lists
-00026960: 206f 7220 6861 7320 6d69 7865 6420 7479   or has mixed ty
-00026970: 7065 7320 6f74 6865 7220 7468 616e 206c  pes other than l
-00026980: 6973 7473 2e20 4669 7820 6974 2061 6e64  ists. Fix it and
-00026990: 2072 6572 756e 2e27 2025 636f 6c29 0a20   rerun.' %col). 
-000269a0: 2020 2072 6574 7572 6e20 6466 0a23 2323     return df.###
+000262e0: 2323 2323 2323 2323 2323 0a64 6566 2046  ##########.def F
+000262f0: 455f 7370 6c69 745f 6c69 7374 5f69 6e74  E_split_list_int
+00026300: 6f5f 636f 6c75 6d6e 7328 6466 2c20 636f  o_columns(df, co
+00026310: 6c2c 2063 6f6c 735f 696e 3d5b 5d29 3a0a  l, cols_in=[]):.
+00026320: 2020 2020 2222 220a 2020 2020 5468 6973      """.    This
+00026330: 2069 7320 6120 4665 6174 7572 6520 456e   is a Feature En
+00026340: 6769 6e65 6572 696e 6720 6675 6e63 7469  gineering functi
+00026350: 6f6e 2e20 4974 2077 696c 6c20 6175 746f  on. It will auto
+00026360: 6d61 7469 6361 6c6c 7920 6465 7465 6374  matically detect
+00026370: 206f 626a 6563 7420 7661 7269 6162 6c65   object variable
+00026380: 7320 7468 6174 2063 6f6e 7461 696e 206c  s that contain l
+00026390: 6973 7473 0a20 2020 2061 6e64 2063 6f6e  ists.    and con
+000263a0: 7665 7274 2074 6865 6d20 696e 746f 206e  vert them into n
+000263b0: 6577 2063 6f6c 756d 6e73 2e20 596f 7520  ew columns. You 
+000263c0: 6e65 6564 2074 6f20 7072 6f76 6964 6520  need to provide 
+000263d0: 7468 6520 6461 7461 6672 616d 652c 2074  the dataframe, t
+000263e0: 6865 206e 616d 6520 6f66 2074 6865 206f  he name of the o
+000263f0: 626a 6563 7420 636f 6c75 6d6e 2e0a 2020  bject column..  
+00026400: 2020 4f70 7469 6f6e 616c 6c79 2c20 796f    Optionally, yo
+00026410: 7520 6361 6e20 6465 6369 6465 2074 6f20  u can decide to 
+00026420: 7365 6e64 2074 6865 206e 616d 6573 206f  send the names o
+00026430: 6620 7468 6520 6e65 7720 636f 6c75 6d6e  f the new column
+00026440: 7320 796f 7520 7761 6e74 2074 6f20 6372  s you want to cr
+00026450: 6561 7465 2061 7320 636f 6c73 5f69 6e2e  eate as cols_in.
+00026460: 0a20 2020 2049 7420 7769 6c6c 2072 6574  .    It will ret
+00026470: 7572 6e20 7468 6520 6461 7461 6672 616d  urn the datafram
+00026480: 6520 7769 7468 2061 6464 6974 696f 6e61  e with additiona
+00026490: 6c20 636f 6c75 6d6e 732e 2049 7420 7769  l columns. It wi
+000264a0: 6c6c 2064 726f 7020 7468 6520 636f 6c75  ll drop the colu
+000264b0: 6d6e 2077 6869 6368 2079 6f75 2073 656e  mn which you sen
+000264c0: 7420 696e 2061 7320 696e 7075 742e 0a0a  t in as input...
+000264d0: 2020 2020 496e 7075 7473 3a0a 2020 2020      Inputs:.    
+000264e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 663a  --------.    df:
+000264f0: 2070 616e 6461 7320 6461 7461 6672 616d   pandas datafram
+00026500: 650a 2020 2020 636f 6c3a 206e 616d 6520  e.    col: name 
+00026510: 6f66 2074 6865 206f 626a 6563 7420 636f  of the object co
+00026520: 6c75 6d6e 2074 6861 7420 636f 6e74 6169  lumn that contai
+00026530: 6e73 2061 206c 6973 742e 2052 656d 656d  ns a list. Remem
+00026540: 6265 7220 6974 206d 7573 7420 6265 2061  ber it must be a
+00026550: 206c 6973 7420 616e 6420 6e6f 7420 6120   list and not a 
+00026560: 7374 7269 6e67 2e0a 2020 2020 636f 6c73  string..    cols
+00026570: 5f69 6e3a 206e 616d 6573 206f 6620 7468  _in: names of th
+00026580: 6520 636f 6c75 6d6e 7320 796f 7520 7761  e columns you wa
+00026590: 6e74 2074 6f20 6372 6561 7465 2e20 4966  nt to create. If
+000265a0: 2074 6865 206e 756d 6265 7220 6f66 2063   the number of c
+000265b0: 6f6c 756d 6e73 2069 7320 6c65 7373 2074  olumns is less t
+000265c0: 6861 6e20 6c69 7374 206c 656e 6774 682c  han list length,
+000265d0: 0a20 2020 2020 2020 2020 2020 2020 6974  .             it
+000265e0: 2077 696c 6c20 6175 746f 6d61 7469 6361   will automatica
+000265f0: 6c6c 7920 6368 6f6f 7365 206f 6e6c 7920  lly choose only 
+00026600: 7468 6520 6669 7374 2066 6577 2069 7465  the fist few ite
+00026610: 6d73 206f 6620 7468 6520 6c69 7374 2074  ms of the list t
+00026620: 6f20 6d61 7463 6820 7468 6520 6c65 6e67  o match the leng
+00026630: 7468 206f 6620 636f 6c73 5f69 6e2e 0a20  th of cols_in.. 
+00026640: 2020 200a 2020 2020 4f75 7470 7574 733a     .    Outputs:
+00026650: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20  .    ---------. 
+00026660: 2020 2064 663a 2070 616e 6461 7320 6461     df: pandas da
+00026670: 7461 6672 616d 6520 7769 7468 206e 6577  taframe with new
+00026680: 2063 6f6c 756d 6e73 2061 6e64 2077 6974   columns and wit
+00026690: 686f 7574 2074 6865 2063 6f6c 756d 6e20  hout the column 
+000266a0: 796f 7520 7365 6e74 2069 6e20 6173 2069  you sent in as i
+000266b0: 6e70 7574 2e0a 2020 2020 2222 220a 2020  nput..    """.  
+000266c0: 2020 6466 203d 2063 6f70 792e 6465 6570    df = copy.deep
+000266d0: 636f 7079 2864 6629 0a20 2020 2069 6620  copy(df).    if 
+000266e0: 636f 6c73 5f69 6e3a 0a20 2020 2020 2020  cols_in:.       
+000266f0: 206d 6178 5f63 6f6c 5f6c 656e 6774 6820   max_col_length 
+00026700: 3d20 6c65 6e28 636f 6c73 5f69 6e29 0a20  = len(cols_in). 
+00026710: 2020 2020 2020 2064 665b 636f 6c73 5f69         df[cols_i
+00026720: 6e5d 203d 2064 665b 636f 6c5d 2e61 7070  n] = df[col].app
+00026730: 6c79 2870 642e 5365 7269 6573 292e 7661  ly(pd.Series).va
+00026740: 6c75 6573 5b3a 2c3a 6d61 785f 636f 6c5f  lues[:,:max_col_
+00026750: 6c65 6e67 7468 5d0a 2020 2020 2020 2020  length].        
+00026760: 6466 203d 2064 662e 6472 6f70 2863 6f6c  df = df.drop(col
+00026770: 2c61 7869 733d 3129 0a20 2020 2065 6c73  ,axis=1).    els
+00026780: 653a 0a20 2020 2020 2020 2069 6620 6c65  e:.        if le
+00026790: 6e28 6466 5b63 6f6c 5d2e 6d61 7028 7479  n(df[col].map(ty
+000267a0: 7065 292e 7661 6c75 655f 636f 756e 7473  pe).value_counts
+000267b0: 2829 293d 3d31 2061 6e64 2064 665b 636f  ())==1 and df[co
+000267c0: 6c5d 2e6d 6170 2874 7970 6529 2e76 616c  l].map(type).val
+000267d0: 7565 5f63 6f75 6e74 7328 292e 696e 6465  ue_counts().inde
+000267e0: 785b 305d 3d3d 6c69 7374 3a0a 2020 2020  x[0]==list:.    
+000267f0: 2020 2020 2020 2020 2323 2320 5265 6d65          ### Reme
+00026800: 6d62 6572 2074 6861 7420 6669 6c6c 6e61  mber that fillna
+00026810: 206f 6e6c 7920 776f 726b 7320 6174 2064   only works at d
+00026820: 6174 6166 7261 6d65 206c 6576 656c 2120  ataframe level! 
+00026830: 2323 230a 2020 2020 2020 2020 2020 2020  ###.            
+00026840: 6d61 785f 636f 6c5f 6c65 6e67 7468 203d  max_col_length =
+00026850: 2064 665b 5b63 6f6c 5d5d 2e66 696c 6c6e   df[[col]].filln
+00026860: 6128 276d 6973 7369 6e67 2729 2e6d 6170  a('missing').map
+00026870: 286c 656e 292e 6d61 7828 290a 2020 2020  (len).max().    
+00026880: 2020 2020 2020 2020 636f 6c73 203d 205b          cols = [
+00026890: 636f 6c2b 275f 272b 7374 7228 6929 2066  col+'_'+str(i) f
+000268a0: 6f72 2069 2069 6e20 7261 6e67 6528 6d61  or i in range(ma
+000268b0: 785f 636f 6c5f 6c65 6e67 7468 295d 0a20  x_col_length)]. 
+000268c0: 2020 2020 2020 2020 2020 2064 665b 636f             df[co
+000268d0: 6c73 5d20 3d20 6466 5b63 6f6c 5d2e 6170  ls] = df[col].ap
+000268e0: 706c 7928 7064 2e53 6572 6965 7329 0a20  ply(pd.Series). 
+000268f0: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
+00026900: 6466 2e64 726f 7028 636f 6c2c 6178 6973  df.drop(col,axis
+00026910: 3d31 290a 2020 2020 2020 2020 656c 7365  =1).        else
+00026920: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00026930: 696e 7428 2743 6f6c 756d 6e20 2573 2064  int('Column %s d
+00026940: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00026950: 6c69 7374 7320 6f72 2068 6173 206d 6978  lists or has mix
+00026960: 6564 2074 7970 6573 206f 7468 6572 2074  ed types other t
+00026970: 6861 6e20 6c69 7374 732e 2046 6978 2069  han lists. Fix i
+00026980: 7420 616e 6420 7265 7275 6e2e 2720 2563  t and rerun.' %c
+00026990: 6f6c 290a 2020 2020 7265 7475 726e 2064  ol).    return d
+000269a0: 660a 2323 2323 2323 2323 2323 2323 2323  f.##############
 000269b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000269c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000269d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000269e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000269f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026a00: 2323 2323 2323 2323 2323 0a64 6566 2045  ##########.def E
-00026a10: 4441 5f72 616e 646f 6d6c 795f 7365 6c65  DA_randomly_sele
-00026a20: 6374 5f72 6f77 735f 6672 6f6d 5f64 6174  ct_rows_from_dat
-00026a30: 6166 7261 6d65 2874 7261 696e 5f64 6174  aframe(train_dat
-00026a40: 6166 7261 6d65 2c20 7461 7267 6574 732c  aframe, targets,
-00026a50: 206e 726f 7773 5f6c 696d 6974 2c20 4453   nrows_limit, DS
-00026a60: 5f4c 454e 3d27 2729 3a0a 2020 2020 6d61  _LEN=''):.    ma
-00026a70: 7872 6f77 7320 3d20 3130 3030 300a 2020  xrows = 10000.  
-00026a80: 2020 7472 6169 6e5f 6461 7461 6672 616d    train_datafram
-00026a90: 6520 3d20 636f 7079 2e64 6565 7063 6f70  e = copy.deepcop
-00026aa0: 7928 7472 6169 6e5f 6461 7461 6672 616d  y(train_datafram
-00026ab0: 6529 0a20 2020 2063 6f70 795f 7461 7267  e).    copy_targ
-00026ac0: 6574 7320 3d20 636f 7079 2e64 6565 7063  ets = copy.deepc
-00026ad0: 6f70 7928 7461 7267 6574 7329 0a20 2020  opy(targets).   
-00026ae0: 2069 6620 6e6f 7420 4453 5f4c 454e 3a0a   if not DS_LEN:.
-00026af0: 2020 2020 2020 2020 4453 5f4c 454e 203d          DS_LEN =
-00026b00: 2074 7261 696e 5f64 6174 6166 7261 6d65   train_dataframe
-00026b10: 2e73 6861 7065 5b30 5d0a 2020 2020 2323  .shape[0].    ##
-00026b20: 2323 2323 2320 7765 2072 616e 646f 6d6c  ##### we randoml
-00026b30: 7920 7361 6d70 6c65 2061 2073 6d61 6c6c  y sample a small
-00026b40: 2064 6174 6173 6574 2074 6f20 636c 6173   dataset to clas
-00026b50: 7369 6679 2066 6561 7475 7265 7320 2323  sify features ##
-00026b60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026b70: 2323 230a 2020 2020 7465 7374 5f73 697a  ###.    test_siz
-00026b80: 6520 3d20 6d69 6e28 302e 392c 2028 3120  e = min(0.9, (1 
-00026b90: 2d20 286d 6178 726f 7773 2f44 535f 4c45  - (maxrows/DS_LE
-00026ba0: 4e29 2929 2023 2323 206d 616b 6520 7375  N))) ### make su
-00026bb0: 7265 2074 6865 7265 2069 7320 6120 736d  re there is a sm
-00026bc0: 616c 6c20 7472 6169 6e20 7369 7a65 0a20  all train size. 
-00026bd0: 2020 2069 6620 7465 7374 5f73 697a 6520     if test_size 
-00026be0: 3c3d 2030 3a0a 2020 2020 2020 2020 7465  <= 0:.        te
-00026bf0: 7374 5f73 697a 6520 3d20 302e 390a 2020  st_size = 0.9.  
-00026c00: 2020 2323 2320 2020 466c 6f61 7420 7661    ###   Float va
-00026c10: 7269 6162 6c65 7320 6172 6520 636f 6e73  riables are cons
-00026c20: 6964 6572 6564 2052 6567 7265 7373 696f  idered Regressio
-00026c30: 6e20 2323 2323 2323 2323 2323 2323 2323  n ##############
-00026c40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00026c50: 2323 2323 2323 230a 2020 2020 6d6f 6465  #######.    mode
-00026c60: 6c74 7970 652c 205f 203d 2061 6e61 6c79  ltype, _ = analy
-00026c70: 7a65 5f70 726f 626c 656d 5f74 7970 6528  ze_problem_type(
-00026c80: 7472 6169 6e5f 6461 7461 6672 616d 655b  train_dataframe[
-00026c90: 636f 7079 5f74 6172 6765 7473 5d2c 2063  copy_targets], c
-00026ca0: 6f70 795f 7461 7267 6574 732c 2076 6572  opy_targets, ver
-00026cb0: 626f 7365 3d30 290a 2020 2020 2323 2323  bose=0).    ####
-00026cc0: 2323 2320 4966 2069 7420 6973 2061 2063  ### If it is a c
-00026cd0: 6c61 7373 6966 6963 6174 696f 6e20 7072  lassification pr
-00026ce0: 6f62 6c65 6d2c 2079 6f75 206e 6565 6420  oblem, you need 
-00026cf0: 746f 2073 7472 6174 6966 7920 616e 6420  to stratify and 
-00026d00: 7365 6c65 6374 2073 616d 706c 6520 2323  select sample ##
-00026d10: 230a 2020 2020 6966 206d 6f64 656c 7479  #.    if modelty
-00026d20: 7065 2021 3d20 2752 6567 7265 7373 696f  pe != 'Regressio
-00026d30: 6e27 3a0a 2020 2020 2020 2020 7072 696e  n':.        prin
-00026d40: 7428 2720 2020 206c 6f61 6469 6e67 2061  t('    loading a
-00026d50: 2072 616e 646f 6d20 7361 6d70 6c65 206f   random sample o
-00026d60: 6620 2564 2072 6f77 7320 696e 746f 2070  f %d rows into p
-00026d70: 616e 6461 7320 666f 7220 4544 4127 2025  andas for EDA' %
-00026d80: 6e72 6f77 735f 6c69 6d69 7429 0a20 2020  nrows_limit).   
-00026d90: 2020 2020 2066 6f72 2065 6163 685f 7461       for each_ta
-00026da0: 7267 6574 2069 6e20 636f 7079 5f74 6172  rget in copy_tar
-00026db0: 6765 7473 3a0a 2020 2020 2020 2020 2020  gets:.          
-00026dc0: 2020 2323 2320 596f 7520 6e65 6564 2074    ### You need t
-00026dd0: 6f20 7265 6d6f 7665 2072 6f77 7320 7468  o remove rows th
-00026de0: 6174 2068 6176 6520 7665 7279 2063 6c61  at have very cla
-00026df0: 7373 2073 616d 706c 6573 202d 2074 6861  ss samples - tha
-00026e00: 7420 6973 2061 2070 726f 626c 656d 2077  t is a problem w
-00026e10: 6869 6c65 2073 706c 6974 7469 6e67 2074  hile splitting t
-00026e20: 7261 696e 5f73 6d61 6c6c 0a20 2020 2020  rain_small.     
-00026e30: 2020 2020 2020 206c 6973 745f 6f66 5f66         list_of_f
-00026e40: 6577 5f63 6c61 7373 6573 203d 2074 7261  ew_classes = tra
-00026e50: 696e 5f64 6174 6166 7261 6d65 5b65 6163  in_dataframe[eac
-00026e60: 685f 7461 7267 6574 5d2e 7661 6c75 655f  h_target].value_
-00026e70: 636f 756e 7473 2829 5b74 7261 696e 5f64  counts()[train_d
-00026e80: 6174 6166 7261 6d65 5b65 6163 685f 7461  ataframe[each_ta
-00026e90: 7267 6574 5d2e 7661 6c75 655f 636f 756e  rget].value_coun
-00026ea0: 7473 2829 3c3d 335d 2e69 6e64 6578 2e74  ts()<=3].index.t
-00026eb0: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
-00026ec0: 2020 2020 7472 6169 6e5f 6461 7461 6672      train_datafr
-00026ed0: 616d 6520 3d20 7472 6169 6e5f 6461 7461  ame = train_data
-00026ee0: 6672 616d 652e 6c6f 635b 7e28 7472 6169  frame.loc[~(trai
-00026ef0: 6e5f 6461 7461 6672 616d 655b 6561 6368  n_dataframe[each
-00026f00: 5f74 6172 6765 745d 2e69 7369 6e28 6c69  _target].isin(li
-00026f10: 7374 5f6f 665f 6665 775f 636c 6173 7365  st_of_few_classe
-00026f20: 7329 295d 0a20 2020 2020 2020 2074 7279  s))].        try
-00026f30: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00026f40: 6169 6e5f 736d 616c 6c2c 205f 203d 2074  ain_small, _ = t
-00026f50: 7261 696e 5f74 6573 745f 7370 6c69 7428  rain_test_split(
-00026f60: 7472 6169 6e5f 6461 7461 6672 616d 652c  train_dataframe,
-00026f70: 2074 6573 745f 7369 7a65 3d74 6573 745f   test_size=test_
-00026f80: 7369 7a65 2c20 7374 7261 7469 6679 3d74  size, stratify=t
-00026f90: 7261 696e 5f64 6174 6166 7261 6d65 5b74  rain_dataframe[t
-00026fa0: 6172 6765 7473 5d29 0a20 2020 2020 2020  argets]).       
-00026fb0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00026fc0: 2020 2020 2023 2320 5468 6973 2073 706c       ## This spl
-00026fd0: 6974 2073 6f6d 6574 696d 6573 2065 7272  it sometimes err
-00026fe0: 6f72 732e 2049 7420 6973 2074 6865 6e20  ors. It is then 
-00026ff0: 6265 7474 6572 2074 6f20 7370 6c69 7420  better to split 
-00027000: 7573 696e 6720 6120 7261 6e64 6f6d 2073  using a random s
-00027010: 616d 706c 6520 2323 0a20 2020 2020 2020  ample ##.       
-00027020: 2020 2020 2074 7261 696e 5f73 6d61 6c6c       train_small
-00027030: 203d 2074 7261 696e 5f64 6174 6166 7261   = train_datafra
-00027040: 6d65 2e73 616d 706c 6528 6e3d 6e72 6f77  me.sample(n=nrow
-00027050: 735f 6c69 6d69 742c 2072 6570 6c61 6365  s_limit, replace
-00027060: 3d54 7275 652c 2072 616e 646f 6d5f 7374  =True, random_st
-00027070: 6174 653d 3939 290a 2020 2020 656c 7365  ate=99).    else
-00027080: 3a0a 2020 2020 2020 2020 2323 2320 466f  :.        ### Fo
-00027090: 7220 5265 6772 6573 7369 6f6e 2070 726f  r Regression pro
-000270a0: 626c 656d 733a 206c 6f61 6420 6120 736d  blems: load a sm
-000270b0: 616c 6c20 7361 6d70 6c65 206f 6620 6461  all sample of da
-000270c0: 7461 2069 6e74 6f20 6120 7061 6e64 6173  ta into a pandas
-000270d0: 2064 6174 6166 7261 6d65 2023 230a 2020   dataframe ##.  
-000270e0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-000270f0: 206c 6f61 6469 6e67 2061 2073 6571 7565   loading a seque
-00027100: 6e74 6961 6c20 7361 6d70 6c65 206f 6620  ntial sample of 
-00027110: 2564 2072 6f77 7320 696e 746f 2070 616e  %d rows into pan
-00027120: 6461 7320 666f 7220 4544 4127 2025 6e72  das for EDA' %nr
-00027130: 6f77 735f 6c69 6d69 7429 0a20 2020 2020  ows_limit).     
-00027140: 2020 2074 7261 696e 5f73 6d61 6c6c 203d     train_small =
-00027150: 2074 7261 696e 5f64 6174 6166 7261 6d65   train_dataframe
-00027160: 5b3a 6e72 6f77 735f 6c69 6d69 745d 0a20  [:nrows_limit]. 
-00027170: 2020 2072 6574 7572 6e20 7472 6169 6e5f     return train_
-00027180: 736d 616c 6c0a 2323 2323 2323 2323 2323  small.##########
+000269f0: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00026a00: 6465 6620 4544 415f 7261 6e64 6f6d 6c79  def EDA_randomly
+00026a10: 5f73 656c 6563 745f 726f 7773 5f66 726f  _select_rows_fro
+00026a20: 6d5f 6461 7461 6672 616d 6528 7472 6169  m_dataframe(trai
+00026a30: 6e5f 6461 7461 6672 616d 652c 2074 6172  n_dataframe, tar
+00026a40: 6765 7473 2c20 6e72 6f77 735f 6c69 6d69  gets, nrows_limi
+00026a50: 742c 2044 535f 4c45 4e3d 2727 293a 0a20  t, DS_LEN=''):. 
+00026a60: 2020 206d 6178 726f 7773 203d 2031 3030     maxrows = 100
+00026a70: 3030 0a20 2020 2074 7261 696e 5f64 6174  00.    train_dat
+00026a80: 6166 7261 6d65 203d 2063 6f70 792e 6465  aframe = copy.de
+00026a90: 6570 636f 7079 2874 7261 696e 5f64 6174  epcopy(train_dat
+00026aa0: 6166 7261 6d65 290a 2020 2020 636f 7079  aframe).    copy
+00026ab0: 5f74 6172 6765 7473 203d 2063 6f70 792e  _targets = copy.
+00026ac0: 6465 6570 636f 7079 2874 6172 6765 7473  deepcopy(targets
+00026ad0: 290a 2020 2020 6966 206e 6f74 2044 535f  ).    if not DS_
+00026ae0: 4c45 4e3a 0a20 2020 2020 2020 2044 535f  LEN:.        DS_
+00026af0: 4c45 4e20 3d20 7472 6169 6e5f 6461 7461  LEN = train_data
+00026b00: 6672 616d 652e 7368 6170 655b 305d 0a20  frame.shape[0]. 
+00026b10: 2020 2023 2323 2323 2323 2077 6520 7261     ####### we ra
+00026b20: 6e64 6f6d 6c79 2073 616d 706c 6520 6120  ndomly sample a 
+00026b30: 736d 616c 6c20 6461 7461 7365 7420 746f  small dataset to
+00026b40: 2063 6c61 7373 6966 7920 6665 6174 7572   classify featur
+00026b50: 6573 2023 2323 2323 2323 2323 2323 2323  es #############
+00026b60: 2323 2323 2323 2323 0a20 2020 2074 6573  ########.    tes
+00026b70: 745f 7369 7a65 203d 206d 696e 2830 2e39  t_size = min(0.9
+00026b80: 2c20 2831 202d 2028 6d61 7872 6f77 732f  , (1 - (maxrows/
+00026b90: 4453 5f4c 454e 2929 2920 2323 2320 6d61  DS_LEN))) ### ma
+00026ba0: 6b65 2073 7572 6520 7468 6572 6520 6973  ke sure there is
+00026bb0: 2061 2073 6d61 6c6c 2074 7261 696e 2073   a small train s
+00026bc0: 697a 650a 2020 2020 6966 2074 6573 745f  ize.    if test_
+00026bd0: 7369 7a65 203c 3d20 303a 0a20 2020 2020  size <= 0:.     
+00026be0: 2020 2074 6573 745f 7369 7a65 203d 2030     test_size = 0
+00026bf0: 2e39 0a20 2020 2023 2323 2020 2046 6c6f  .9.    ###   Flo
+00026c00: 6174 2076 6172 6961 626c 6573 2061 7265  at variables are
+00026c10: 2063 6f6e 7369 6465 7265 6420 5265 6772   considered Regr
+00026c20: 6573 7369 6f6e 2023 2323 2323 2323 2323  ession #########
+00026c30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00026c40: 2323 2323 2323 2323 2323 2323 0a20 2020  ############.   
+00026c50: 206d 6f64 656c 7479 7065 2c20 5f20 3d20   modeltype, _ = 
+00026c60: 616e 616c 797a 655f 7072 6f62 6c65 6d5f  analyze_problem_
+00026c70: 7479 7065 2874 7261 696e 5f64 6174 6166  type(train_dataf
+00026c80: 7261 6d65 5b63 6f70 795f 7461 7267 6574  rame[copy_target
+00026c90: 735d 2c20 636f 7079 5f74 6172 6765 7473  s], copy_targets
+00026ca0: 2c20 7665 7262 6f73 653d 3029 0a20 2020  , verbose=0).   
+00026cb0: 2023 2323 2323 2323 2049 6620 6974 2069   ####### If it i
+00026cc0: 7320 6120 636c 6173 7369 6669 6361 7469  s a classificati
+00026cd0: 6f6e 2070 726f 626c 656d 2c20 796f 7520  on problem, you 
+00026ce0: 6e65 6564 2074 6f20 7374 7261 7469 6679  need to stratify
+00026cf0: 2061 6e64 2073 656c 6563 7420 7361 6d70   and select samp
+00026d00: 6c65 2023 2323 0a20 2020 2069 6620 6d6f  le ###.    if mo
+00026d10: 6465 6c74 7970 6520 213d 2027 5265 6772  deltype != 'Regr
+00026d20: 6573 7369 6f6e 273a 0a20 2020 2020 2020  ession':.       
+00026d30: 2070 7269 6e74 2827 2020 2020 6c6f 6164   print('    load
+00026d40: 696e 6720 6120 7261 6e64 6f6d 2073 616d  ing a random sam
+00026d50: 706c 6520 6f66 2025 6420 726f 7773 2069  ple of %d rows i
+00026d60: 6e74 6f20 7061 6e64 6173 2066 6f72 2045  nto pandas for E
+00026d70: 4441 2720 256e 726f 7773 5f6c 696d 6974  DA' %nrows_limit
+00026d80: 290a 2020 2020 2020 2020 666f 7220 6561  ).        for ea
+00026d90: 6368 5f74 6172 6765 7420 696e 2063 6f70  ch_target in cop
+00026da0: 795f 7461 7267 6574 733a 0a20 2020 2020  y_targets:.     
+00026db0: 2020 2020 2020 2023 2323 2059 6f75 206e         ### You n
+00026dc0: 6565 6420 746f 2072 656d 6f76 6520 726f  eed to remove ro
+00026dd0: 7773 2074 6861 7420 6861 7665 2076 6572  ws that have ver
+00026de0: 7920 636c 6173 7320 7361 6d70 6c65 7320  y class samples 
+00026df0: 2d20 7468 6174 2069 7320 6120 7072 6f62  - that is a prob
+00026e00: 6c65 6d20 7768 696c 6520 7370 6c69 7474  lem while splitt
+00026e10: 696e 6720 7472 6169 6e5f 736d 616c 6c0a  ing train_small.
+00026e20: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+00026e30: 5f6f 665f 6665 775f 636c 6173 7365 7320  _of_few_classes 
+00026e40: 3d20 7472 6169 6e5f 6461 7461 6672 616d  = train_datafram
+00026e50: 655b 6561 6368 5f74 6172 6765 745d 2e76  e[each_target].v
+00026e60: 616c 7565 5f63 6f75 6e74 7328 295b 7472  alue_counts()[tr
+00026e70: 6169 6e5f 6461 7461 6672 616d 655b 6561  ain_dataframe[ea
+00026e80: 6368 5f74 6172 6765 745d 2e76 616c 7565  ch_target].value
+00026e90: 5f63 6f75 6e74 7328 293c 3d33 5d2e 696e  _counts()<=3].in
+00026ea0: 6465 782e 746f 6c69 7374 2829 0a20 2020  dex.tolist().   
+00026eb0: 2020 2020 2020 2020 2074 7261 696e 5f64           train_d
+00026ec0: 6174 6166 7261 6d65 203d 2074 7261 696e  ataframe = train
+00026ed0: 5f64 6174 6166 7261 6d65 2e6c 6f63 5b7e  _dataframe.loc[~
+00026ee0: 2874 7261 696e 5f64 6174 6166 7261 6d65  (train_dataframe
+00026ef0: 5b65 6163 685f 7461 7267 6574 5d2e 6973  [each_target].is
+00026f00: 696e 286c 6973 745f 6f66 5f66 6577 5f63  in(list_of_few_c
+00026f10: 6c61 7373 6573 2929 5d0a 2020 2020 2020  lasses))].      
+00026f20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00026f30: 2020 2074 7261 696e 5f73 6d61 6c6c 2c20     train_small, 
+00026f40: 5f20 3d20 7472 6169 6e5f 7465 7374 5f73  _ = train_test_s
+00026f50: 706c 6974 2874 7261 696e 5f64 6174 6166  plit(train_dataf
+00026f60: 7261 6d65 2c20 7465 7374 5f73 697a 653d  rame, test_size=
+00026f70: 7465 7374 5f73 697a 652c 2073 7472 6174  test_size, strat
+00026f80: 6966 793d 7472 6169 6e5f 6461 7461 6672  ify=train_datafr
+00026f90: 616d 655b 7461 7267 6574 735d 290a 2020  ame[targets]).  
+00026fa0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00026fb0: 2020 2020 2020 2020 2020 2323 2054 6869            ## Thi
+00026fc0: 7320 7370 6c69 7420 736f 6d65 7469 6d65  s split sometime
+00026fd0: 7320 6572 726f 7273 2e20 4974 2069 7320  s errors. It is 
+00026fe0: 7468 656e 2062 6574 7465 7220 746f 2073  then better to s
+00026ff0: 706c 6974 2075 7369 6e67 2061 2072 616e  plit using a ran
+00027000: 646f 6d20 7361 6d70 6c65 2023 230a 2020  dom sample ##.  
+00027010: 2020 2020 2020 2020 2020 7472 6169 6e5f            train_
+00027020: 736d 616c 6c20 3d20 7472 6169 6e5f 6461  small = train_da
+00027030: 7461 6672 616d 652e 7361 6d70 6c65 286e  taframe.sample(n
+00027040: 3d6e 726f 7773 5f6c 696d 6974 2c20 7265  =nrows_limit, re
+00027050: 706c 6163 653d 5472 7565 2c20 7261 6e64  place=True, rand
+00027060: 6f6d 5f73 7461 7465 3d39 3929 0a20 2020  om_state=99).   
+00027070: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+00027080: 2323 2046 6f72 2052 6567 7265 7373 696f  ## For Regressio
+00027090: 6e20 7072 6f62 6c65 6d73 3a20 6c6f 6164  n problems: load
+000270a0: 2061 2073 6d61 6c6c 2073 616d 706c 6520   a small sample 
+000270b0: 6f66 2064 6174 6120 696e 746f 2061 2070  of data into a p
+000270c0: 616e 6461 7320 6461 7461 6672 616d 6520  andas dataframe 
+000270d0: 2323 0a20 2020 2020 2020 2070 7269 6e74  ##.        print
+000270e0: 2827 2020 2020 6c6f 6164 696e 6720 6120  ('    loading a 
+000270f0: 7365 7175 656e 7469 616c 2073 616d 706c  sequential sampl
+00027100: 6520 6f66 2025 6420 726f 7773 2069 6e74  e of %d rows int
+00027110: 6f20 7061 6e64 6173 2066 6f72 2045 4441  o pandas for EDA
+00027120: 2720 256e 726f 7773 5f6c 696d 6974 290a  ' %nrows_limit).
+00027130: 2020 2020 2020 2020 7472 6169 6e5f 736d          train_sm
+00027140: 616c 6c20 3d20 7472 6169 6e5f 6461 7461  all = train_data
+00027150: 6672 616d 655b 3a6e 726f 7773 5f6c 696d  frame[:nrows_lim
+00027160: 6974 5d0a 2020 2020 7265 7475 726e 2074  it].    return t
+00027170: 7261 696e 5f73 6d61 6c6c 0a23 2323 2323  rain_small.#####
+00027180: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027190: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000271a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000271b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000271c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000271d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000271e0: 2323 2323 2323 0a63 6c61 7373 2046 6561  ######.class Fea
-000271f0: 7475 7265 5769 7a28 4261 7365 4573 7469  tureWiz(BaseEsti
-00027200: 6d61 746f 722c 2054 7261 6e73 666f 726d  mator, Transform
-00027210: 6572 4d69 7869 6e29 3a0a 2020 2020 6465  erMixin):.    de
-00027220: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00027230: 2063 6f72 725f 6c69 6d69 743d 302e 3930   corr_limit=0.90
-00027240: 2c20 7665 7262 6f73 653d 322c 2073 6570  , verbose=2, sep
-00027250: 3d27 2c27 2c20 0a20 2020 2020 2020 2068  =',', .        h
-00027260: 6561 6465 723d 302c 2066 6561 7475 7265  eader=0, feature
-00027270: 5f65 6e67 673d 2727 2c20 6361 7465 676f  _engg='', catego
-00027280: 7279 5f65 6e63 6f64 6572 733d 2727 2c0a  ry_encoders='',.
-00027290: 2020 2020 2020 2020 6461 736b 5f78 6762          dask_xgb
-000272a0: 6f6f 7374 5f66 6c61 673d 4661 6c73 652c  oost_flag=False,
-000272b0: 206e 726f 7773 3d4e 6f6e 652c 2073 6b69   nrows=None, ski
-000272c0: 705f 7375 6c6f 763d 4661 6c73 6529 3a0a  p_sulov=False):.
-000272d0: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-000272e0: 2277 697a 203d 2046 6561 7475 7265 5769  "wiz = FeatureWi
-000272f0: 7a28 7665 7262 6f73 653d 3129 0a20 2020  z(verbose=1).   
-00027300: 2020 2020 2058 5f74 7261 696e 5f73 656c       X_train_sel
-00027310: 6563 7465 6420 3d20 7769 7a2e 6669 745f  ected = wiz.fit_
-00027320: 7472 616e 7366 6f72 6d28 585f 7472 6169  transform(X_trai
-00027330: 6e2c 2079 5f74 7261 696e 290a 2020 2020  n, y_train).    
-00027340: 2020 2020 585f 7465 7374 5f73 656c 6563      X_test_selec
-00027350: 7465 6420 3d20 7769 7a2e 7472 616e 7366  ted = wiz.transf
-00027360: 6f72 6d28 585f 7465 7374 290a 2020 2020  orm(X_test).    
-00027370: 2020 2020 7769 7a2e 6665 6174 7572 6573      wiz.features
-00027380: 2020 2323 2320 7072 6f76 6964 6573 2061    ### provides a
-00027390: 206c 6973 7420 6f66 2073 656c 6563 7465   list of selecte
-000273a0: 6420 6665 6174 7572 6573 2023 2323 2020  d features ###  
-000273b0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000273c0: 2020 2022 2222 290a 2020 2020 2020 2020     """).        
-000273d0: 7365 6c66 2e66 6561 7475 7265 7320 3d20  self.features = 
-000273e0: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
-000273f0: 662e 636f 7272 5f6c 696d 6974 3d20 636f  f.corr_limit= co
-00027400: 7272 5f6c 696d 6974 0a20 2020 2020 2020  rr_limit.       
-00027410: 2073 656c 662e 7665 7262 6f73 653d 7665   self.verbose=ve
-00027420: 7262 6f73 650a 2020 2020 2020 2020 7365  rbose.        se
-00027430: 6c66 2e73 6570 3d73 6570 0a20 2020 2020  lf.sep=sep.     
-00027440: 2020 2073 656c 662e 6865 6164 6572 3d68     self.header=h
-00027450: 6561 6465 720a 2020 2020 2020 2020 7365  eader.        se
-00027460: 6c66 2e74 6573 745f 6461 7461 203d 2022  lf.test_data = "
-00027470: 2220 2323 206c 6561 7665 2074 6573 7464  " ## leave testd
-00027480: 6174 6120 7065 726d 616e 656e 746c 7920  ata permanently 
-00027490: 6173 2065 6d70 7479 2066 6f72 206e 6f77  as empty for now
-000274a0: 2023 230a 2020 2020 2020 2020 7365 6c66   ##.        self
-000274b0: 2e66 6561 7475 7265 5f65 6e67 673d 6665  .feature_engg=fe
-000274c0: 6174 7572 655f 656e 6767 0a20 2020 2020  ature_engg.     
-000274d0: 2020 2073 656c 662e 6361 7465 676f 7279     self.category
-000274e0: 5f65 6e63 6f64 6572 733d 6361 7465 676f  _encoders=catego
-000274f0: 7279 5f65 6e63 6f64 6572 730a 2020 2020  ry_encoders.    
-00027500: 2020 2020 7365 6c66 2e64 6173 6b5f 7867      self.dask_xg
-00027510: 626f 6f73 745f 666c 6167 3d64 6173 6b5f  boost_flag=dask_
-00027520: 7867 626f 6f73 745f 666c 6167 0a20 2020  xgboost_flag.   
-00027530: 2020 2020 2073 656c 662e 6e72 6f77 733d       self.nrows=
-00027540: 6e72 6f77 730a 2020 2020 2020 2020 7365  nrows.        se
-00027550: 6c66 2e73 6b69 705f 7375 6c6f 763d 736b  lf.skip_sulov=sk
-00027560: 6970 5f73 756c 6f76 0a20 2020 2020 2020  ip_sulov.       
-00027570: 2073 656c 662e 585f 7365 6c20 3d20 4e6f   self.X_sel = No
-00027580: 6e65 0a0a 2020 2020 6465 6620 6669 7428  ne..    def fit(
-00027590: 7365 6c66 2c20 582c 2079 293a 0a20 2020  self, X, y):.   
-000275a0: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
-000275b0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-000275c0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000275d0: 6e63 6528 582c 206e 702e 6e64 6172 7261  nce(X, np.ndarra
-000275e0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-000275f0: 7072 696e 7428 2758 2069 6e70 7574 206d  print('X input m
-00027600: 7573 7420 6265 2061 2064 6174 6166 7261  ust be a datafra
-00027610: 6d65 2073 696e 6365 2077 6520 7573 6520  me since we use 
-00027620: 636f 6c75 6d6e 206e 616d 6573 2074 6f20  column names to 
-00027630: 6275 696c 6420 6461 7461 2070 6970 656c  build data pipel
-00027640: 696e 6573 2e20 5265 7475 726e 696e 6727  ines. Returning'
-00027650: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00027660: 7475 726e 2058 2c20 790a 2020 2020 2020  turn X, y.      
-00027670: 2020 585f 696e 6465 7820 3d20 582e 696e    X_index = X.in
-00027680: 6465 780a 2020 2020 2020 2020 6966 2069  dex.        if i
-00027690: 7369 6e73 7461 6e63 6528 792c 206e 702e  sinstance(y, np.
-000276a0: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
-000276b0: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-000276c0: 7920 696e 7075 7420 6973 2061 6e20 6e75  y input is an nu
-000276d0: 6d70 7920 6172 7261 7920 616e 6420 6865  mpy array and he
-000276e0: 6e63 6520 636f 6e76 6572 7420 696e 746f  nce convert into
-000276f0: 2061 2073 6572 6965 7320 6f72 2064 6174   a series or dat
-00027700: 6166 7261 6d65 2061 6e64 2072 652d 7472  aframe and re-tr
-00027710: 792e 2729 0a20 2020 2020 2020 2020 2020  y.').           
-00027720: 2072 6574 7572 6e20 582c 2079 0a20 2020   return X, y.   
-00027730: 2020 2020 2079 5f69 6e64 6578 203d 2079       y_index = y
-00027740: 2e69 6e64 6578 0a20 2020 2020 2020 2069  .index.        i
-00027750: 6620 2858 5f69 6e64 6578 203d 3d20 795f  f (X_index == y_
-00027760: 696e 6465 7829 2e61 6c6c 2829 3a0a 2020  index).all():.  
-00027770: 2020 2020 2020 2020 2020 6466 203d 2070            df = p
-00027780: 642e 636f 6e63 6174 285b 582c 2079 5d2c  d.concat([X, y],
-00027790: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-000277a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000277b0: 2020 2064 6620 3d20 7064 2e63 6f6e 6361     df = pd.conca
-000277c0: 7428 5b58 2e72 6573 6574 5f69 6e64 6578  t([X.reset_index
-000277d0: 2864 726f 703d 5472 7565 292c 2079 5d2c  (drop=True), y],
-000277e0: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-000277f0: 2020 2020 2064 662e 696e 6465 7820 3d20       df.index = 
-00027800: 585f 696e 6465 780a 2020 2020 2020 2020  X_index.        
-00027810: 2323 2320 4e6f 7720 796f 7520 6361 6e20  ### Now you can 
-00027820: 7072 6f63 6573 7320 7468 6520 5820 616e  process the X an
-00027830: 6420 7920 6461 7461 7365 7473 2023 2323  d y datasets ###
-00027840: 230a 2020 2020 2020 2020 6966 2069 7369  #.        if isi
-00027850: 6e73 7461 6e63 6528 792c 2070 642e 5365  nstance(y, pd.Se
-00027860: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
-00027870: 2020 2074 6172 6765 7420 3d20 792e 6e61     target = y.na
-00027880: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
-00027890: 6620 7461 7267 6574 2069 7320 4e6f 6e65  f target is None
-000278a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000278b0: 2020 7072 696e 7428 2720 2020 7920 696e    print('   y in
-000278c0: 7075 7420 6973 2061 2070 616e 6461 7320  put is a pandas 
-000278d0: 7365 7269 6573 2077 6974 6820 6e6f 206e  series with no n
-000278e0: 616d 652e 2043 6f6e 7665 7274 2069 7420  ame. Convert it 
-000278f0: 616e 6420 7265 2d74 7279 2e27 290a 2020  and re-try.').  
-00027900: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00027910: 7475 726e 2058 2c20 7920 2020 2020 2020  turn X, y       
-00027920: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00027930: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00027940: 6528 792c 2070 642e 4461 7461 4672 616d  e(y, pd.DataFram
-00027950: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00027960: 7461 7267 6574 203d 2079 2e63 6f6c 756d  target = y.colum
-00027970: 6e73 2e74 6f6c 6973 7428 290a 2020 2020  ns.tolist().    
-00027980: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00027990: 6e63 6528 582c 206e 702e 6e64 6172 7261  nce(X, np.ndarra
-000279a0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-000279b0: 7072 696e 7428 2779 206d 7573 7420 6265  print('y must be
-000279c0: 2061 2070 642e 5365 7269 6573 206f 7220   a pd.Series or 
-000279d0: 7064 2e44 6174 6146 7261 6d65 2073 696e  pd.DataFrame sin
-000279e0: 6365 2077 6520 7573 6520 636f 6c75 6d6e  ce we use column
-000279f0: 206e 616d 6573 2074 6f20 6275 696c 6420   names to build 
-00027a00: 6461 7461 2070 6970 656c 696e 652e 2052  data pipeline. R
-00027a10: 6574 7572 6e69 6e67 2729 0a20 2020 2020  eturning').     
-00027a20: 2020 2020 2020 2072 6574 7572 6e20 7b7d         return {}
-00027a30: 2c20 7b7d 0a20 2020 2020 2020 2023 2323  , {}.        ###
-00027a40: 2320 5365 6e64 2074 6172 6765 7420 7661  # Send target va
-00027a50: 7269 6162 6c65 2061 7320 6974 2069 7320  riable as it is 
-00027a60: 736f 2074 6861 7420 795f 7472 6169 6e20  so that y_train 
-00027a70: 6973 2061 6e61 6c79 7a65 6420 7072 6f70  is analyzed prop
-00027a80: 6572 6c79 2023 2323 0a20 2020 2020 2020  erly ###.       
-00027a90: 2023 2053 656c 6563 7420 6665 6174 7572   # Select featur
-00027aa0: 6573 2075 7369 6e67 2066 6561 7475 7265  es using feature
-00027ab0: 7769 7a0a 2020 2020 2020 2020 6665 6174  wiz.        feat
-00027ac0: 7572 6573 2c20 585f 7365 6c20 3d20 6665  ures, X_sel = fe
-00027ad0: 6174 7572 6577 697a 2864 662c 2074 6172  aturewiz(df, tar
-00027ae0: 6765 742c 2073 656c 662e 636f 7272 5f6c  get, self.corr_l
-00027af0: 696d 6974 2c20 7365 6c66 2e76 6572 626f  imit, self.verbo
-00027b00: 7365 2c20 7365 6c66 2e73 6570 2c20 0a20  se, self.sep, . 
-00027b10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027b20: 656c 662e 6865 6164 6572 2c20 7365 6c66  elf.header, self
-00027b30: 2e74 6573 745f 6461 7461 2c20 7365 6c66  .test_data, self
-00027b40: 2e66 6561 7475 7265 5f65 6e67 672c 2073  .feature_engg, s
-00027b50: 656c 662e 6361 7465 676f 7279 5f65 6e63  elf.category_enc
-00027b60: 6f64 6572 732c 0a20 2020 2020 2020 2020  oders,.         
-00027b70: 2020 2020 2020 2073 656c 662e 6461 736b         self.dask
-00027b80: 5f78 6762 6f6f 7374 5f66 6c61 672c 2073  _xgboost_flag, s
-00027b90: 656c 662e 6e72 6f77 732c 2073 656c 662e  elf.nrows, self.
-00027ba0: 736b 6970 5f73 756c 6f76 290a 2020 2020  skip_sulov).    
-00027bb0: 2020 2020 2320 436f 6e76 6572 7420 7468      # Convert th
-00027bc0: 6520 7265 6d61 696e 696e 6720 636f 6c75  e remaining colu
-00027bd0: 6d6e 206e 616d 6573 2062 6163 6b20 746f  mn names back to
-00027be0: 2069 6e74 6567 6572 7320 616e 6420 6472   integers and dr
-00027bf0: 6f70 2074 6865 0a20 2020 2020 2020 2064  op the.        d
-00027c00: 6966 6674 696d 6520 3d20 6d61 7828 312c  ifftime = max(1,
-00027c10: 2069 6e74 2874 696d 652e 7469 6d65 2829   int(time.time()
-00027c20: 2d73 7461 7274 5f74 696d 6529 290a 2020  -start_time)).  
-00027c30: 2020 2020 2020 7072 696e 7428 2720 2020        print('   
-00027c40: 2054 696d 6520 7461 6b65 6e20 746f 2063   Time taken to c
-00027c50: 7265 6174 6520 656e 7469 7265 2070 6970  reate entire pip
-00027c60: 656c 696e 6520 3d20 2573 2073 6563 6f6e  eline = %s secon
-00027c70: 6428 7329 2720 2564 6966 6674 696d 6529  d(s)' %difftime)
-00027c80: 0a20 2020 2020 2020 2023 2063 6f6c 756d  .        # colum
-00027c90: 6e20 6f66 206c 6162 656c 730a 2020 2020  n of labels.    
-00027ca0: 2020 2020 7365 6c66 2e66 6561 7475 7265      self.feature
-00027cb0: 7320 3d20 6665 6174 7572 6573 0a20 2020  s = features.   
-00027cc0: 2020 2020 2073 656c 662e 585f 7365 6c20       self.X_sel 
-00027cd0: 3d20 585f 7365 6c0a 2020 2020 2020 2020  = X_sel.        
-00027ce0: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
-00027cf0: 2064 6566 2074 7261 6e73 666f 726d 2873   def transform(s
-00027d00: 656c 662c 2058 293a 0a20 2020 2020 2020  elf, X):.       
-00027d10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00027d20: 2020 7265 7475 726e 2058 5b73 656c 662e    return X[self.
-00027d30: 6665 6174 7572 6573 5d0a 2020 2020 2020  features].      
-00027d40: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00027d50: 2020 2020 2020 7072 696e 7428 2752 6574        print('Ret
-00027d60: 7572 6e69 6e67 2074 7261 6e73 666f 726d  urning transform
-00027d70: 6564 2064 6174 6166 7261 6d65 2077 6974  ed dataframe wit
-00027d80: 6820 2564 2066 6561 7475 7265 7327 2025  h %d features' %
-00027d90: 6c65 6e28 7365 6c66 2e66 6561 7475 7265  len(self.feature
-00027da0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00027db0: 7265 7475 726e 2073 656c 662e 585f 7365  return self.X_se
-00027dc0: 6c0a 2323 2323 2323 2323 2323 2323 2323  l.##############
+000271d0: 2323 2323 2323 2323 2323 230a 636c 6173  ###########.clas
+000271e0: 7320 4665 6174 7572 6557 697a 2842 6173  s FeatureWiz(Bas
+000271f0: 6545 7374 696d 6174 6f72 2c20 5472 616e  eEstimator, Tran
+00027200: 7366 6f72 6d65 724d 6978 696e 293a 0a20  sformerMixin):. 
+00027210: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00027220: 7365 6c66 2c20 636f 7272 5f6c 696d 6974  self, corr_limit
+00027230: 3d30 2e39 302c 2076 6572 626f 7365 3d32  =0.90, verbose=2
+00027240: 2c20 7365 703d 272c 272c 200a 2020 2020  , sep=',', .    
+00027250: 2020 2020 6865 6164 6572 3d30 2c20 6665      header=0, fe
+00027260: 6174 7572 655f 656e 6767 3d27 272c 2063  ature_engg='', c
+00027270: 6174 6567 6f72 795f 656e 636f 6465 7273  ategory_encoders
+00027280: 3d27 272c 0a20 2020 2020 2020 2064 6173  ='',.        das
+00027290: 6b5f 7867 626f 6f73 745f 666c 6167 3d46  k_xgboost_flag=F
+000272a0: 616c 7365 2c20 6e72 6f77 733d 4e6f 6e65  alse, nrows=None
+000272b0: 2c20 736b 6970 5f73 756c 6f76 3d46 616c  , skip_sulov=Fal
+000272c0: 7365 293a 0a20 2020 2020 2020 2070 7269  se):.        pri
+000272d0: 6e74 2822 2222 7769 7a20 3d20 4665 6174  nt("""wiz = Feat
+000272e0: 7572 6557 697a 2876 6572 626f 7365 3d31  ureWiz(verbose=1
+000272f0: 290a 2020 2020 2020 2020 585f 7472 6169  ).        X_trai
+00027300: 6e5f 7365 6c65 6374 6564 203d 2077 697a  n_selected = wiz
+00027310: 2e66 6974 5f74 7261 6e73 666f 726d 2858  .fit_transform(X
+00027320: 5f74 7261 696e 2c20 795f 7472 6169 6e29  _train, y_train)
+00027330: 0a20 2020 2020 2020 2058 5f74 6573 745f  .        X_test_
+00027340: 7365 6c65 6374 6564 203d 2077 697a 2e74  selected = wiz.t
+00027350: 7261 6e73 666f 726d 2858 5f74 6573 7429  ransform(X_test)
+00027360: 0a20 2020 2020 2020 2077 697a 2e66 6561  .        wiz.fea
+00027370: 7475 7265 7320 2023 2323 2070 726f 7669  tures  ### provi
+00027380: 6465 7320 6120 6c69 7374 206f 6620 7365  des a list of se
+00027390: 6c65 6374 6564 2066 6561 7475 7265 7320  lected features 
+000273a0: 2323 2320 2020 2020 2020 2020 2020 200a  ###            .
+000273b0: 2020 2020 2020 2020 2222 2229 0a20 2020          """).   
+000273c0: 2020 2020 2073 656c 662e 6665 6174 7572       self.featur
+000273d0: 6573 203d 204e 6f6e 650a 2020 2020 2020  es = None.      
+000273e0: 2020 7365 6c66 2e63 6f72 725f 6c69 6d69    self.corr_limi
+000273f0: 743d 2063 6f72 725f 6c69 6d69 740a 2020  t= corr_limit.  
+00027400: 2020 2020 2020 7365 6c66 2e76 6572 626f        self.verbo
+00027410: 7365 3d76 6572 626f 7365 0a20 2020 2020  se=verbose.     
+00027420: 2020 2073 656c 662e 7365 703d 7365 700a     self.sep=sep.
+00027430: 2020 2020 2020 2020 7365 6c66 2e68 6561          self.hea
+00027440: 6465 723d 6865 6164 6572 0a20 2020 2020  der=header.     
+00027450: 2020 2073 656c 662e 7465 7374 5f64 6174     self.test_dat
+00027460: 6120 3d20 2222 2023 2320 6c65 6176 6520  a = "" ## leave 
+00027470: 7465 7374 6461 7461 2070 6572 6d61 6e65  testdata permane
+00027480: 6e74 6c79 2061 7320 656d 7074 7920 666f  ntly as empty fo
+00027490: 7220 6e6f 7720 2323 0a20 2020 2020 2020  r now ##.       
+000274a0: 2073 656c 662e 6665 6174 7572 655f 656e   self.feature_en
+000274b0: 6767 3d66 6561 7475 7265 5f65 6e67 670a  gg=feature_engg.
+000274c0: 2020 2020 2020 2020 7365 6c66 2e63 6174          self.cat
+000274d0: 6567 6f72 795f 656e 636f 6465 7273 3d63  egory_encoders=c
+000274e0: 6174 6567 6f72 795f 656e 636f 6465 7273  ategory_encoders
+000274f0: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
+00027500: 736b 5f78 6762 6f6f 7374 5f66 6c61 673d  sk_xgboost_flag=
+00027510: 6461 736b 5f78 6762 6f6f 7374 5f66 6c61  dask_xgboost_fla
+00027520: 670a 2020 2020 2020 2020 7365 6c66 2e6e  g.        self.n
+00027530: 726f 7773 3d6e 726f 7773 0a20 2020 2020  rows=nrows.     
+00027540: 2020 2073 656c 662e 736b 6970 5f73 756c     self.skip_sul
+00027550: 6f76 3d73 6b69 705f 7375 6c6f 760a 2020  ov=skip_sulov.  
+00027560: 2020 2020 2020 7365 6c66 2e58 5f73 656c        self.X_sel
+00027570: 203d 204e 6f6e 650a 0a20 2020 2064 6566   = None..    def
+00027580: 2066 6974 2873 656c 662c 2058 2c20 7929   fit(self, X, y)
+00027590: 3a0a 2020 2020 2020 2020 7374 6172 745f  :.        start_
+000275a0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
+000275b0: 2829 0a20 2020 2020 2020 2069 6620 6973  ().        if is
+000275c0: 696e 7374 616e 6365 2858 2c20 6e70 2e6e  instance(X, np.n
+000275d0: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+000275e0: 2020 2020 2070 7269 6e74 2827 5820 696e       print('X in
+000275f0: 7075 7420 6d75 7374 2062 6520 6120 6461  put must be a da
+00027600: 7461 6672 616d 6520 7369 6e63 6520 7765  taframe since we
+00027610: 2075 7365 2063 6f6c 756d 6e20 6e61 6d65   use column name
+00027620: 7320 746f 2062 7569 6c64 2064 6174 6120  s to build data 
+00027630: 7069 7065 6c69 6e65 732e 2052 6574 7572  pipelines. Retur
+00027640: 6e69 6e67 2729 0a20 2020 2020 2020 2020  ning').         
+00027650: 2020 2072 6574 7572 6e20 582c 2079 0a20     return X, y. 
+00027660: 2020 2020 2020 2058 5f69 6e64 6578 203d         X_index =
+00027670: 2058 2e69 6e64 6578 0a20 2020 2020 2020   X.index.       
+00027680: 2069 6620 6973 696e 7374 616e 6365 2879   if isinstance(y
+00027690: 2c20 6e70 2e6e 6461 7272 6179 293a 0a20  , np.ndarray):. 
+000276a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000276b0: 2827 2020 2079 2069 6e70 7574 2069 7320  ('   y input is 
+000276c0: 616e 206e 756d 7079 2061 7272 6179 2061  an numpy array a
+000276d0: 6e64 2068 656e 6365 2063 6f6e 7665 7274  nd hence convert
+000276e0: 2069 6e74 6f20 6120 7365 7269 6573 206f   into a series o
+000276f0: 7220 6461 7461 6672 616d 6520 616e 6420  r dataframe and 
+00027700: 7265 2d74 7279 2e27 290a 2020 2020 2020  re-try.').      
+00027710: 2020 2020 2020 7265 7475 726e 2058 2c20        return X, 
+00027720: 790a 2020 2020 2020 2020 795f 696e 6465  y.        y_inde
+00027730: 7820 3d20 792e 696e 6465 780a 2020 2020  x = y.index.    
+00027740: 2020 2020 6966 2028 585f 696e 6465 7820      if (X_index 
+00027750: 3d3d 2079 5f69 6e64 6578 292e 616c 6c28  == y_index).all(
+00027760: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+00027770: 6620 3d20 7064 2e63 6f6e 6361 7428 5b58  f = pd.concat([X
+00027780: 2c20 795d 2c20 6178 6973 3d31 290a 2020  , y], axis=1).  
+00027790: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000277a0: 2020 2020 2020 2020 6466 203d 2070 642e          df = pd.
+000277b0: 636f 6e63 6174 285b 582e 7265 7365 745f  concat([X.reset_
+000277c0: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+000277d0: 2c20 795d 2c20 6178 6973 3d31 290a 2020  , y], axis=1).  
+000277e0: 2020 2020 2020 2020 2020 6466 2e69 6e64            df.ind
+000277f0: 6578 203d 2058 5f69 6e64 6578 0a20 2020  ex = X_index.   
+00027800: 2020 2020 2023 2323 204e 6f77 2079 6f75       ### Now you
+00027810: 2063 616e 2070 726f 6365 7373 2074 6865   can process the
+00027820: 2058 2061 6e64 2079 2064 6174 6173 6574   X and y dataset
+00027830: 7320 2323 2323 0a20 2020 2020 2020 2069  s ####.        i
+00027840: 6620 6973 696e 7374 616e 6365 2879 2c20  f isinstance(y, 
+00027850: 7064 2e53 6572 6965 7329 3a0a 2020 2020  pd.Series):.    
+00027860: 2020 2020 2020 2020 7461 7267 6574 203d          target =
+00027870: 2079 2e6e 616d 650a 2020 2020 2020 2020   y.name.        
+00027880: 2020 2020 6966 2074 6172 6765 7420 6973      if target is
+00027890: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000278a0: 2020 2020 2020 2070 7269 6e74 2827 2020         print('  
+000278b0: 2079 2069 6e70 7574 2069 7320 6120 7061   y input is a pa
+000278c0: 6e64 6173 2073 6572 6965 7320 7769 7468  ndas series with
+000278d0: 206e 6f20 6e61 6d65 2e20 436f 6e76 6572   no name. Conver
+000278e0: 7420 6974 2061 6e64 2072 652d 7472 792e  t it and re-try.
+000278f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00027900: 2020 2072 6574 7572 6e20 582c 2079 2020     return X, y  
+00027910: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00027920: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+00027930: 7374 616e 6365 2879 2c20 7064 2e44 6174  stance(y, pd.Dat
+00027940: 6146 7261 6d65 293a 0a20 2020 2020 2020  aFrame):.       
+00027950: 2020 2020 2074 6172 6765 7420 3d20 792e       target = y.
+00027960: 636f 6c75 6d6e 732e 746f 6c69 7374 2829  columns.tolist()
+00027970: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00027980: 696e 7374 616e 6365 2858 2c20 6e70 2e6e  instance(X, np.n
+00027990: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+000279a0: 2020 2020 2070 7269 6e74 2827 7920 6d75       print('y mu
+000279b0: 7374 2062 6520 6120 7064 2e53 6572 6965  st be a pd.Serie
+000279c0: 7320 6f72 2070 642e 4461 7461 4672 616d  s or pd.DataFram
+000279d0: 6520 7369 6e63 6520 7765 2075 7365 2063  e since we use c
+000279e0: 6f6c 756d 6e20 6e61 6d65 7320 746f 2062  olumn names to b
+000279f0: 7569 6c64 2064 6174 6120 7069 7065 6c69  uild data pipeli
+00027a00: 6e65 2e20 5265 7475 726e 696e 6727 290a  ne. Returning').
+00027a10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00027a20: 726e 207b 7d2c 207b 7d0a 2020 2020 2020  rn {}, {}.      
+00027a30: 2020 2323 2323 2053 656e 6420 7461 7267    #### Send targ
+00027a40: 6574 2076 6172 6961 626c 6520 6173 2069  et variable as i
+00027a50: 7420 6973 2073 6f20 7468 6174 2079 5f74  t is so that y_t
+00027a60: 7261 696e 2069 7320 616e 616c 797a 6564  rain is analyzed
+00027a70: 2070 726f 7065 726c 7920 2323 230a 2020   properly ###.  
+00027a80: 2020 2020 2020 2320 5365 6c65 6374 2066        # Select f
+00027a90: 6561 7475 7265 7320 7573 696e 6720 6665  eatures using fe
+00027aa0: 6174 7572 6577 697a 0a20 2020 2020 2020  aturewiz.       
+00027ab0: 2066 6561 7475 7265 732c 2058 5f73 656c   features, X_sel
+00027ac0: 203d 2066 6561 7475 7265 7769 7a28 6466   = featurewiz(df
+00027ad0: 2c20 7461 7267 6574 2c20 7365 6c66 2e63  , target, self.c
+00027ae0: 6f72 725f 6c69 6d69 742c 2073 656c 662e  orr_limit, self.
+00027af0: 7665 7262 6f73 652c 2073 656c 662e 7365  verbose, self.se
+00027b00: 702c 200a 2020 2020 2020 2020 2020 2020  p, .            
+00027b10: 2020 2020 7365 6c66 2e68 6561 6465 722c      self.header,
+00027b20: 2073 656c 662e 7465 7374 5f64 6174 612c   self.test_data,
+00027b30: 2073 656c 662e 6665 6174 7572 655f 656e   self.feature_en
+00027b40: 6767 2c20 7365 6c66 2e63 6174 6567 6f72  gg, self.categor
+00027b50: 795f 656e 636f 6465 7273 2c0a 2020 2020  y_encoders,.    
+00027b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00027b70: 2e64 6173 6b5f 7867 626f 6f73 745f 666c  .dask_xgboost_fl
+00027b80: 6167 2c20 7365 6c66 2e6e 726f 7773 2c20  ag, self.nrows, 
+00027b90: 7365 6c66 2e73 6b69 705f 7375 6c6f 7629  self.skip_sulov)
+00027ba0: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
+00027bb0: 7274 2074 6865 2072 656d 6169 6e69 6e67  rt the remaining
+00027bc0: 2063 6f6c 756d 6e20 6e61 6d65 7320 6261   column names ba
+00027bd0: 636b 2074 6f20 696e 7465 6765 7273 2061  ck to integers a
+00027be0: 6e64 2064 726f 7020 7468 650a 2020 2020  nd drop the.    
+00027bf0: 2020 2020 6469 6666 7469 6d65 203d 206d      difftime = m
+00027c00: 6178 2831 2c20 696e 7428 7469 6d65 2e74  ax(1, int(time.t
+00027c10: 696d 6528 292d 7374 6172 745f 7469 6d65  ime()-start_time
+00027c20: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
+00027c30: 2827 2020 2020 5469 6d65 2074 616b 656e  ('    Time taken
+00027c40: 2074 6f20 6372 6561 7465 2065 6e74 6972   to create entir
+00027c50: 6520 7069 7065 6c69 6e65 203d 2025 7320  e pipeline = %s 
+00027c60: 7365 636f 6e64 2873 2927 2025 6469 6666  second(s)' %diff
+00027c70: 7469 6d65 290a 2020 2020 2020 2020 2320  time).        # 
+00027c80: 636f 6c75 6d6e 206f 6620 6c61 6265 6c73  column of labels
+00027c90: 0a20 2020 2020 2020 2073 656c 662e 6665  .        self.fe
+00027ca0: 6174 7572 6573 203d 2066 6561 7475 7265  atures = feature
+00027cb0: 730a 2020 2020 2020 2020 7365 6c66 2e58  s.        self.X
+00027cc0: 5f73 656c 203d 2058 5f73 656c 0a20 2020  _sel = X_sel.   
+00027cd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00027ce0: 0a0a 2020 2020 6465 6620 7472 616e 7366  ..    def transf
+00027cf0: 6f72 6d28 7365 6c66 2c20 5829 3a0a 2020  orm(self, X):.  
+00027d00: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00027d10: 2020 2020 2020 2072 6574 7572 6e20 585b         return X[
+00027d20: 7365 6c66 2e66 6561 7475 7265 735d 0a20  self.features]. 
+00027d30: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+00027d40: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00027d50: 2827 5265 7475 726e 696e 6720 7472 616e  ('Returning tran
+00027d60: 7366 6f72 6d65 6420 6461 7461 6672 616d  sformed datafram
+00027d70: 6520 7769 7468 2025 6420 6665 6174 7572  e with %d featur
+00027d80: 6573 2720 256c 656e 2873 656c 662e 6665  es' %len(self.fe
+00027d90: 6174 7572 6573 2929 0a20 2020 2020 2020  atures)).       
+00027da0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00027db0: 2e58 5f73 656c 0a23 2323 2323 2323 2323  .X_sel.#########
+00027dc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027dd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027de0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027df0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00027e00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027e10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027e20: 2323 2323 230a 6465 6620 4544 415f 7265  #####.def EDA_re
-00027e30: 6d6f 7665 5f73 7065 6369 616c 5f63 6861  move_special_cha
-00027e40: 7273 2864 6629 3a0a 2020 2020 2222 220a  rs(df):.    """.
-00027e50: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-00027e60: 6e20 7265 6d6f 7665 7320 7370 6563 6961  n removes specia
-00027e70: 6c20 6368 6172 7320 6672 6f6d 2063 6f6c  l chars from col
-00027e80: 756d 6e20 6e61 6d65 7320 616e 6420 7265  umn names and re
-00027e90: 7475 726e 7320 6120 6466 2077 6974 6820  turns a df with 
-00027ea0: 6e65 7720 636f 6c75 6d6e 206e 616d 6573  new column names
-00027eb0: 2e0a 2020 2020 496e 7075 7473 2061 6e64  ..    Inputs and
-00027ec0: 206f 7574 7075 7473 2061 7265 2062 6f74   outputs are bot
-00027ed0: 6820 7468 6520 7361 6d65 2064 6174 6166  h the same dataf
-00027ee0: 7261 6d65 2065 7863 6570 7420 636f 6c75  rame except colu
-00027ef0: 6d6e 206e 616d 6573 2061 7265 2063 6861  mn names are cha
-00027f00: 6e67 6564 2e0a 2020 2020 2222 220a 2020  nged..    """.  
-00027f10: 2020 696d 706f 7274 2063 6f70 790a 2020    import copy.  
-00027f20: 2020 696d 706f 7274 2072 650a 2020 2020    import re.    
-00027f30: 636f 6c73 203d 2064 662e 636f 6c75 6d6e  cols = df.column
-00027f40: 732e 746f 6c69 7374 2829 0a20 2020 2063  s.tolist().    c
-00027f50: 6f70 795f 636f 6c73 203d 2063 6f70 792e  opy_cols = copy.
-00027f60: 6465 6570 636f 7079 2863 6f6c 7329 0a20  deepcopy(cols). 
-00027f70: 2020 2073 6572 203d 2070 642e 5365 7269     ser = pd.Seri
-00027f80: 6573 2863 6f6c 7329 0a20 2020 2023 2323  es(cols).    ###
-00027f90: 2054 6869 7320 6675 6e63 7469 6f6e 2072   This function r
-00027fa0: 656d 6f76 6573 2061 6c6c 2073 7065 6369  emoves all speci
-00027fb0: 616c 2063 6861 7273 2066 726f 6d20 6120  al chars from a 
-00027fc0: 6c69 7374 2023 2323 0a20 2020 2072 656d  list ###.    rem
-00027fd0: 6f76 655f 7370 6563 6961 6c5f 6368 6172  ove_special_char
-00027fe0: 7320 3d20 206c 616d 6264 6120 783a 7265  s =  lambda x:re
-00027ff0: 2e73 7562 2827 5b5e 412d 5a61 2d7a 302d  .sub('[^A-Za-z0-
-00028000: 395f 5d2b 272c 2027 272c 2078 290a 2020  9_]+', '', x).  
-00028010: 2020 6e65 776c 7320 3d20 7365 722e 6d61    newls = ser.ma
-00028020: 7028 7265 6d6f 7665 5f73 7065 6369 616c  p(remove_special
-00028030: 5f63 6861 7273 292e 7661 6c75 6573 2e74  _chars).values.t
-00028040: 6f6c 6973 7428 290a 2020 2020 6466 2e63  olist().    df.c
-00028050: 6f6c 756d 6e73 203d 206e 6577 6c73 0a20  olumns = newls. 
-00028060: 2020 2072 6574 7572 6e20 6466 0a23 2323     return df.###
+00027e10: 2323 2323 2323 2323 2323 0a64 6566 2045  ##########.def E
+00027e20: 4441 5f72 656d 6f76 655f 7370 6563 6961  DA_remove_specia
+00027e30: 6c5f 6368 6172 7328 6466 293a 0a20 2020  l_chars(df):.   
+00027e40: 2022 2222 0a20 2020 2054 6869 7320 6675   """.    This fu
+00027e50: 6e63 7469 6f6e 2072 656d 6f76 6573 2073  nction removes s
+00027e60: 7065 6369 616c 2063 6861 7273 2066 726f  pecial chars fro
+00027e70: 6d20 636f 6c75 6d6e 206e 616d 6573 2061  m column names a
+00027e80: 6e64 2072 6574 7572 6e73 2061 2064 6620  nd returns a df 
+00027e90: 7769 7468 206e 6577 2063 6f6c 756d 6e20  with new column 
+00027ea0: 6e61 6d65 732e 0a20 2020 2049 6e70 7574  names..    Input
+00027eb0: 7320 616e 6420 6f75 7470 7574 7320 6172  s and outputs ar
+00027ec0: 6520 626f 7468 2074 6865 2073 616d 6520  e both the same 
+00027ed0: 6461 7461 6672 616d 6520 6578 6365 7074  dataframe except
+00027ee0: 2063 6f6c 756d 6e20 6e61 6d65 7320 6172   column names ar
+00027ef0: 6520 6368 616e 6765 642e 0a20 2020 2022  e changed..    "
+00027f00: 2222 0a20 2020 2069 6d70 6f72 7420 636f  "".    import co
+00027f10: 7079 0a20 2020 2069 6d70 6f72 7420 7265  py.    import re
+00027f20: 0a20 2020 2063 6f6c 7320 3d20 6466 2e63  .    cols = df.c
+00027f30: 6f6c 756d 6e73 2e74 6f6c 6973 7428 290a  olumns.tolist().
+00027f40: 2020 2020 636f 7079 5f63 6f6c 7320 3d20      copy_cols = 
+00027f50: 636f 7079 2e64 6565 7063 6f70 7928 636f  copy.deepcopy(co
+00027f60: 6c73 290a 2020 2020 7365 7220 3d20 7064  ls).    ser = pd
+00027f70: 2e53 6572 6965 7328 636f 6c73 290a 2020  .Series(cols).  
+00027f80: 2020 2323 2320 5468 6973 2066 756e 6374    ### This funct
+00027f90: 696f 6e20 7265 6d6f 7665 7320 616c 6c20  ion removes all 
+00027fa0: 7370 6563 6961 6c20 6368 6172 7320 6672  special chars fr
+00027fb0: 6f6d 2061 206c 6973 7420 2323 230a 2020  om a list ###.  
+00027fc0: 2020 7265 6d6f 7665 5f73 7065 6369 616c    remove_special
+00027fd0: 5f63 6861 7273 203d 2020 6c61 6d62 6461  _chars =  lambda
+00027fe0: 2078 3a72 652e 7375 6228 275b 5e41 2d5a   x:re.sub('[^A-Z
+00027ff0: 612d 7a30 2d39 5f5d 2b27 2c20 2727 2c20  a-z0-9_]+', '', 
+00028000: 7829 0a20 2020 206e 6577 6c73 203d 2073  x).    newls = s
+00028010: 6572 2e6d 6170 2872 656d 6f76 655f 7370  er.map(remove_sp
+00028020: 6563 6961 6c5f 6368 6172 7329 2e76 616c  ecial_chars).val
+00028030: 7565 732e 746f 6c69 7374 2829 0a20 2020  ues.tolist().   
+00028040: 2064 662e 636f 6c75 6d6e 7320 3d20 6e65   df.columns = ne
+00028050: 776c 730a 2020 2020 7265 7475 726e 2064  wls.    return d
+00028060: 660a 2323 2323 2323 2323 2323 2323 2323  f.##############
 00028070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028090: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000280a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000280b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000280c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000280d0: 0a64 6566 2064 6173 6b5f 7867 626f 6f73  .def dask_xgboos
-000280e0: 745f 7472 6169 6e69 6e67 2858 5f74 7261  t_training(X_tra
-000280f0: 696e 782c 2079 5f74 7261 696e 782c 2070  inx, y_trainx, p
-00028100: 6172 616d 7329 3a0a 2020 2020 0a20 2020  arams):.    .   
-00028110: 2063 6c75 7374 6572 203d 2064 6173 6b2e   cluster = dask.
-00028120: 6469 7374 7269 6275 7465 642e 4c6f 6361  distributed.Loca
-00028130: 6c43 6c75 7374 6572 2829 0a20 2020 2064  lCluster().    d
-00028140: 6173 6b5f 636c 6965 6e74 203d 2064 6173  ask_client = das
-00028150: 6b2e 6469 7374 7269 6275 7465 642e 436c  k.distributed.Cl
-00028160: 6965 6e74 2863 6c75 7374 6572 290a 2020  ient(cluster).  
-00028170: 2020 585f 7472 6169 6e78 203d 2064 642e    X_trainx = dd.
-00028180: 6672 6f6d 5f70 616e 6461 7328 585f 7472  from_pandas(X_tr
-00028190: 6169 6e2c 206e 7061 7274 6974 696f 6e73  ain, npartitions
-000281a0: 3d31 290a 2020 2020 795f 7472 6169 6e78  =1).    y_trainx
-000281b0: 203d 2064 642e 6672 6f6d 5f70 616e 6461   = dd.from_panda
-000281c0: 7328 795f 7472 6169 6e2c 206e 7061 7274  s(y_train, npart
-000281d0: 6974 696f 6e73 3d31 290a 2020 2020 7072  itions=1).    pr
-000281e0: 696e 7428 2244 4153 4b20 5847 426f 6f73  int("DASK XGBoos
-000281f0: 7420 7472 6169 6e69 6e67 2e2e 2e22 290a  t training...").
-00028200: 2020 2020 6474 7261 696e 203d 2078 6762      dtrain = xgb
-00028210: 2e64 6173 6b2e 4461 736b 444d 6174 7269  .dask.DaskDMatri
-00028220: 7828 6461 736b 5f63 6c69 656e 742c 2058  x(dask_client, X
-00028230: 5f74 7261 696e 782c 2079 5f74 7261 696e  _trainx, y_train
-00028240: 7829 0a20 2020 2062 7374 203d 2078 6762  x).    bst = xgb
-00028250: 2e64 6173 6b2e 7472 6169 6e28 6461 736b  .dask.train(dask
-00028260: 5f63 6c69 656e 742c 2070 6172 616d 732c  _client, params,
-00028270: 2064 7472 6169 6e2c 206e 756d 5f62 6f6f   dtrain, num_boo
-00028280: 7374 5f72 6f75 6e64 3d31 3029 0a20 2020  st_round=10).   
-00028290: 2064 6173 6b5f 636c 6965 6e74 2e63 6c6f   dask_client.clo
-000282a0: 7365 2829 0a20 2020 2070 7269 6e74 2822  se().    print("
-000282b0: 2020 2020 7472 6169 6e69 6e67 2063 6f6d      training com
-000282c0: 706c 6574 6564 2e2e 2e22 290a 2020 2020  pleted...").    
-000282d0: 7265 7475 726e 2062 7374 0a23 2323 2323  return bst.#####
+000280c0: 2323 2323 230a 6465 6620 6461 736b 5f78  #####.def dask_x
+000280d0: 6762 6f6f 7374 5f74 7261 696e 696e 6728  gboost_training(
+000280e0: 585f 7472 6169 6e78 2c20 795f 7472 6169  X_trainx, y_trai
+000280f0: 6e78 2c20 7061 7261 6d73 293a 0a20 2020  nx, params):.   
+00028100: 200a 2020 2020 636c 7573 7465 7220 3d20   .    cluster = 
+00028110: 6461 736b 2e64 6973 7472 6962 7574 6564  dask.distributed
+00028120: 2e4c 6f63 616c 436c 7573 7465 7228 290a  .LocalCluster().
+00028130: 2020 2020 6461 736b 5f63 6c69 656e 7420      dask_client 
+00028140: 3d20 6461 736b 2e64 6973 7472 6962 7574  = dask.distribut
+00028150: 6564 2e43 6c69 656e 7428 636c 7573 7465  ed.Client(cluste
+00028160: 7229 0a20 2020 2058 5f74 7261 696e 7820  r).    X_trainx 
+00028170: 3d20 6464 2e66 726f 6d5f 7061 6e64 6173  = dd.from_pandas
+00028180: 2858 5f74 7261 696e 2c20 6e70 6172 7469  (X_train, nparti
+00028190: 7469 6f6e 733d 3129 0a20 2020 2079 5f74  tions=1).    y_t
+000281a0: 7261 696e 7820 3d20 6464 2e66 726f 6d5f  rainx = dd.from_
+000281b0: 7061 6e64 6173 2879 5f74 7261 696e 2c20  pandas(y_train, 
+000281c0: 6e70 6172 7469 7469 6f6e 733d 3129 0a20  npartitions=1). 
+000281d0: 2020 2070 7269 6e74 2822 4441 534b 2058     print("DASK X
+000281e0: 4742 6f6f 7374 2074 7261 696e 696e 672e  GBoost training.
+000281f0: 2e2e 2229 0a20 2020 2064 7472 6169 6e20  ..").    dtrain 
+00028200: 3d20 7867 622e 6461 736b 2e44 6173 6b44  = xgb.dask.DaskD
+00028210: 4d61 7472 6978 2864 6173 6b5f 636c 6965  Matrix(dask_clie
+00028220: 6e74 2c20 585f 7472 6169 6e78 2c20 795f  nt, X_trainx, y_
+00028230: 7472 6169 6e78 290a 2020 2020 6273 7420  trainx).    bst 
+00028240: 3d20 7867 622e 6461 736b 2e74 7261 696e  = xgb.dask.train
+00028250: 2864 6173 6b5f 636c 6965 6e74 2c20 7061  (dask_client, pa
+00028260: 7261 6d73 2c20 6474 7261 696e 2c20 6e75  rams, dtrain, nu
+00028270: 6d5f 626f 6f73 745f 726f 756e 643d 3130  m_boost_round=10
+00028280: 290a 2020 2020 6461 736b 5f63 6c69 656e  ).    dask_clien
+00028290: 742e 636c 6f73 6528 290a 2020 2020 7072  t.close().    pr
+000282a0: 696e 7428 2220 2020 2074 7261 696e 696e  int("    trainin
+000282b0: 6720 636f 6d70 6c65 7465 642e 2e2e 2229  g completed...")
+000282c0: 0a20 2020 2072 6574 7572 6e20 6273 740a  .    return bst.
+000282d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000282e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000282f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028320: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
-00028330: 6465 6620 4645 5f72 656d 6f76 655f 636f  def FE_remove_co
-00028340: 6d6d 6173 5f69 6e5f 6e75 6d65 7269 6373  mmas_in_numerics
-00028350: 2874 7261 696e 2c20 6e75 6d73 3d5b 5d29  (train, nums=[])
-00028360: 3a0a 2020 2020 2222 2220 0a20 2020 2054  :.    """ .    T
-00028370: 6869 7320 6675 6e63 7469 6f6e 2072 656d  his function rem
-00028380: 6f76 6573 2063 6f6d 6d61 7320 696e 206e  oves commas in n
-00028390: 756d 6572 6963 2063 6f6c 756d 6e73 2061  umeric columns a
-000283a0: 6e64 2072 6574 7572 6e73 2074 6865 2063  nd returns the c
-000283b0: 6f6c 756d 6e73 2074 7261 6e73 666f 726d  olumns transform
-000283c0: 6564 2e0a 2020 2020 596f 7520 6361 6e20  ed..    You can 
-000283d0: 7365 6e64 2069 6e20 6120 6461 7461 6672  send in a datafr
-000283e0: 616d 6520 7769 7468 206f 6e65 2063 6f6c  ame with one col
-000283f0: 756d 6e20 6e61 6d65 2061 7320 6120 7374  umn name as a st
-00028400: 7269 6e67 206f 7220 6120 6c69 7374 206f  ring or a list o
-00028410: 6620 636f 6c75 6d6e 732e 0a20 2020 2052  f columns..    R
-00028420: 6574 7572 6e73 2061 2073 696e 676c 6520  eturns a single 
-00028430: 6172 7261 7920 6966 206f 6e6c 7920 6f6e  array if only on
-00028440: 6520 636f 6c75 6d6e 2069 7320 7365 6e74  e column is sent
-00028450: 2e0a 2020 2020 5265 7475 726e 7320 7468  ..    Returns th
-00028460: 6520 656e 7469 7265 2064 6174 6166 7261  e entire datafra
-00028470: 6d65 2069 6620 6120 6c69 7374 206f 6620  me if a list of 
-00028480: 636f 6c75 6d6e 7320 6973 2073 656e 742e  columns is sent.
-00028490: 2054 6869 7320 696e 636c 7564 6573 2061   This includes a
-000284a0: 6c6c 2063 6f6c 756d 6e73 2e0a 2020 2020  ll columns..    
-000284b0: 2222 220a 2020 2020 7472 6169 6e20 3d20  """.    train = 
-000284c0: 636f 7079 2e64 6565 7063 6f70 7928 7472  copy.deepcopy(tr
-000284d0: 6169 6e29 0a20 2020 2069 6620 6973 696e  ain).    if isin
-000284e0: 7374 616e 6365 286e 756d 732c 2073 7472  stance(nums, str
-000284f0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00028500: 6e20 7472 6169 6e5b 6561 6368 5f6e 756d  n train[each_num
-00028510: 5d2e 6d61 7028 6c61 6d62 6461 2078 3a20  ].map(lambda x: 
-00028520: 666c 6f61 7428 2222 2e6a 6f69 6e28 2078  float("".join( x
-00028530: 2e73 706c 6974 2822 2c22 2929 2929 2e76  .split(",")))).v
-00028540: 616c 7565 730a 2020 2020 656c 7365 3a0a  alues.    else:.
-00028550: 2020 2020 2020 2020 666f 7220 6561 6368          for each
-00028560: 5f6e 756d 2069 6e20 6e75 6d73 3a0a 2020  _num in nums:.  
-00028570: 2020 2020 2020 2020 2020 7472 6169 6e5b            train[
-00028580: 6561 6368 5f6e 756d 5d20 3d20 7472 6169  each_num] = trai
-00028590: 6e5b 6561 6368 5f6e 756d 5d2e 6d61 7028  n[each_num].map(
-000285a0: 6c61 6d62 6461 2078 3a20 666c 6f61 7428  lambda x: float(
-000285b0: 2222 2e6a 6f69 6e28 2078 2e73 706c 6974  "".join( x.split
-000285c0: 2822 2c22 2929 2929 2e76 616c 7565 730a  (",")))).values.
-000285d0: 2020 2020 7265 7475 726e 2074 7261 696e      return train
-000285e0: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00028320: 2323 2323 0a64 6566 2046 455f 7265 6d6f  ####.def FE_remo
+00028330: 7665 5f63 6f6d 6d61 735f 696e 5f6e 756d  ve_commas_in_num
+00028340: 6572 6963 7328 7472 6169 6e2c 206e 756d  erics(train, num
+00028350: 733d 5b5d 293a 0a20 2020 2022 2222 200a  s=[]):.    """ .
+00028360: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
+00028370: 6e20 7265 6d6f 7665 7320 636f 6d6d 6173  n removes commas
+00028380: 2069 6e20 6e75 6d65 7269 6320 636f 6c75   in numeric colu
+00028390: 6d6e 7320 616e 6420 7265 7475 726e 7320  mns and returns 
+000283a0: 7468 6520 636f 6c75 6d6e 7320 7472 616e  the columns tran
+000283b0: 7366 6f72 6d65 642e 0a20 2020 2059 6f75  sformed..    You
+000283c0: 2063 616e 2073 656e 6420 696e 2061 2064   can send in a d
+000283d0: 6174 6166 7261 6d65 2077 6974 6820 6f6e  ataframe with on
+000283e0: 6520 636f 6c75 6d6e 206e 616d 6520 6173  e column name as
+000283f0: 2061 2073 7472 696e 6720 6f72 2061 206c   a string or a l
+00028400: 6973 7420 6f66 2063 6f6c 756d 6e73 2e0a  ist of columns..
+00028410: 2020 2020 5265 7475 726e 7320 6120 7369      Returns a si
+00028420: 6e67 6c65 2061 7272 6179 2069 6620 6f6e  ngle array if on
+00028430: 6c79 206f 6e65 2063 6f6c 756d 6e20 6973  ly one column is
+00028440: 2073 656e 742e 0a20 2020 2052 6574 7572   sent..    Retur
+00028450: 6e73 2074 6865 2065 6e74 6972 6520 6461  ns the entire da
+00028460: 7461 6672 616d 6520 6966 2061 206c 6973  taframe if a lis
+00028470: 7420 6f66 2063 6f6c 756d 6e73 2069 7320  t of columns is 
+00028480: 7365 6e74 2e20 5468 6973 2069 6e63 6c75  sent. This inclu
+00028490: 6465 7320 616c 6c20 636f 6c75 6d6e 732e  des all columns.
+000284a0: 0a20 2020 2022 2222 0a20 2020 2074 7261  .    """.    tra
+000284b0: 696e 203d 2063 6f70 792e 6465 6570 636f  in = copy.deepco
+000284c0: 7079 2874 7261 696e 290a 2020 2020 6966  py(train).    if
+000284d0: 2069 7369 6e73 7461 6e63 6528 6e75 6d73   isinstance(nums
+000284e0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+000284f0: 7265 7475 726e 2074 7261 696e 5b65 6163  return train[eac
+00028500: 685f 6e75 6d5d 2e6d 6170 286c 616d 6264  h_num].map(lambd
+00028510: 6120 783a 2066 6c6f 6174 2822 222e 6a6f  a x: float("".jo
+00028520: 696e 2820 782e 7370 6c69 7428 222c 2229  in( x.split(",")
+00028530: 2929 292e 7661 6c75 6573 0a20 2020 2065  ))).values.    e
+00028540: 6c73 653a 0a20 2020 2020 2020 2066 6f72  lse:.        for
+00028550: 2065 6163 685f 6e75 6d20 696e 206e 756d   each_num in num
+00028560: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+00028570: 7261 696e 5b65 6163 685f 6e75 6d5d 203d  rain[each_num] =
+00028580: 2074 7261 696e 5b65 6163 685f 6e75 6d5d   train[each_num]
+00028590: 2e6d 6170 286c 616d 6264 6120 783a 2066  .map(lambda x: f
+000285a0: 6c6f 6174 2822 222e 6a6f 696e 2820 782e  loat("".join( x.
+000285b0: 7370 6c69 7428 222c 2229 2929 292e 7661  split(",")))).va
+000285c0: 6c75 6573 0a20 2020 2072 6574 7572 6e20  lues.    return 
+000285d0: 7472 6169 6e0a 2323 2323 2323 2323 2323  train.##########
+000285e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 000285f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 00028610: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028620: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028630: 2323 2323 230a 0a0a                      #####...
+00028620: 2323 2323 2323 2323 2323 0a23 2323 2074  ##########.### t
+00028630: 6869 7320 776f 726b 7320 6f6e 6c79 206f  his works only o
+00028640: 6e20 7061 6e64 6173 2064 6174 6166 7261  n pandas datafra
+00028650: 6d65 7320 6275 7420 6974 2069 7320 6578  mes but it is ex
+00028660: 7472 656d 656c 7920 6661 7374 0a69 6d70  tremely fast.imp
+00028670: 6f72 7420 636f 7079 0a64 6566 2046 455f  ort copy.def FE_
+00028680: 6361 6c63 756c 6174 655f 6475 7261 7469  calculate_durati
+00028690: 6f6e 5f66 726f 6d5f 7469 6d65 7374 616d  on_from_timestam
+000286a0: 7028 6466 2c20 6964 5f63 6f6c 756d 6e2c  p(df, id_column,
+000286b0: 2074 696d 6573 7461 6d70 5f63 6f6c 756d   timestamp_colum
+000286c0: 6e29 3a0a 2020 2020 2222 220a 2020 2020  n):.    """.    
+000286d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000286e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000286f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028720: 2323 230a 2020 2020 4361 6c63 756c 6174  ###.    Calculat
+00028730: 6520 7468 6520 746f 7461 6c20 7469 6d65  e the total time
+00028740: 2061 6e64 2061 7665 7261 6765 2074 696d   and average tim
+00028750: 6520 7370 656e 7420 6f6e 6c69 6e65 2070  e spent online p
+00028760: 6572 2064 6179 2062 7920 7573 6572 2e20  er day by user. 
+00028770: 0a20 2020 2041 6c73 6f20 6974 2063 616c  .    Also it cal
+00028780: 6375 6c61 7465 7320 7468 6520 6e75 6d62  culates the numb
+00028790: 6572 206f 6620 6c6f 6769 6e73 2070 6572  er of logins per
+000287a0: 2075 7365 7220 7065 7220 6461 792e 0a20   user per day.. 
+000287b0: 2020 2023 2323 2020 2054 6869 7320 6973     ###   This is
+000287c0: 2076 6572 7920 7573 6566 756c 2066 6f72   very useful for
+000287d0: 206c 6f67 7320 6461 7461 2c20 494f 5420   logs data, IOT 
+000287e0: 6461 7461 2c20 616e 6420 7069 6e67 7320  data, and pings 
+000287f0: 6672 6f6d 2076 6973 6974 7320 6461 7461  from visits data
+00028800: 2023 2323 2323 0a20 2020 2054 6869 7320   #####.    This 
+00028810: 6675 6e63 7469 6f6e 2074 616b 6573 2061  function takes a
+00028820: 2044 6174 6146 7261 6d65 2077 6974 6820   DataFrame with 
+00028830: 7573 6572 2069 6473 2061 6e64 2074 696d  user ids and tim
+00028840: 6573 7461 6d70 7320 286f 6620 6c6f 6769  estamps (of logi
+00028850: 6e73 2c20 6574 632e 2920 0a20 2020 2061  ns, etc.) .    a
+00028860: 6e64 2072 6574 7572 6e73 2061 2044 6174  nd returns a Dat
+00028870: 6146 7261 6d65 2077 6974 6820 6475 7261  aFrame with dura
+00028880: 7469 6f6e 206f 7220 7468 6520 7469 6d65  tion or the time
+00028890: 2073 7065 6e74 2062 6574 7765 656e 2074   spent between t
+000288a0: 776f 2074 696d 6573 7461 6d70 732e 0a20  wo timestamps.. 
+000288b0: 2020 2054 6869 7320 6973 2063 616c 6375     This is calcu
+000288c0: 6c61 7465 6420 6279 2074 616b 696e 6720  lated by taking 
+000288d0: 7061 6972 7320 6f66 2072 6f77 7320 616e  pairs of rows an
+000288e0: 6420 6173 7375 6d69 6e67 2074 6865 2066  d assuming the f
+000288f0: 6972 7374 2072 6f77 2069 7320 6c6f 6769  irst row is logi
+00028900: 6e0a 2020 2020 616e 6420 7468 6520 7365  n.    and the se
+00028910: 636f 6e64 2072 6f77 2069 7320 6c6f 676f  cond row is logo
+00028920: 7574 2e20 5468 656e 2077 6520 7375 6274  ut. Then we subt
+00028930: 7261 6374 2074 6865 2074 696d 6573 7461  ract the timesta
+00028940: 6d70 206f 6620 7468 6520 6c6f 6769 6e20  mp of the login 
+00028950: 6672 6f6d 200a 2020 2020 7468 6520 7469  from .    the ti
+00028960: 6d65 7374 616d 7020 6f66 2074 6865 206c  mestamp of the l
+00028970: 6f67 6f75 7420 666f 7220 6561 6368 2070  ogout for each p
+00028980: 6169 7220 6f66 2072 6f77 732e 2054 6869  air of rows. Thi
+00028990: 7320 6675 6e63 7469 6f6e 2075 7365 7320  s function uses 
+000289a0: 616c 7465 726e 6174 6520 726f 7773 0a20  alternate rows. 
+000289b0: 2020 206f 6620 6120 6461 7461 6672 616d     of a datafram
+000289c0: 6520 616e 6420 7370 6c69 7473 2074 6865  e and splits the
+000289d0: 6d20 696e 746f 2073 6570 6172 6174 6520  m into separate 
+000289e0: 636f 6c75 6d6e 732e 2049 7420 7468 656e  columns. It then
+000289f0: 2073 7562 7472 6163 7473 2074 6865 2074   subtracts the t
+00028a00: 776f 200a 2020 2020 636f 6c75 6d6e 7320  wo .    columns 
+00028a10: 746f 2066 696e 6420 7469 6d65 2064 656c  to find time del
+00028a20: 7461 2069 6e20 7365 636f 6e64 7320 6475  ta in seconds du
+00028a30: 7269 6e67 2074 686f 7365 2074 776f 2074  ring those two t
+00028a40: 696d 6573 2e20 4974 2061 6c73 6f20 656c  imes. It also el
+00028a50: 696d 696e 6174 6573 0a20 2020 2061 6e79  iminates.    any
+00028a60: 2064 6174 6120 656e 7472 7920 6572 726f   data entry erro
+00028a70: 7273 2062 7920 7265 6d6f 7669 6e67 206e  rs by removing n
+00028a80: 6567 6174 6976 6520 6475 7261 7469 6f6e  egative duration
+00028a90: 732e 2054 6869 7320 6973 2074 6865 2062  s. This is the b
+00028aa0: 6573 7420 616e 6420 0a20 2020 2073 7065  est and .    spe
+00028ab0: 6564 6965 7374 2077 6179 2074 6f20 6361  ediest way to ca
+00028ac0: 6c63 756c 6174 6520 6f6e 6c69 6e65 2074  lculate online t
+00028ad0: 696d 6520 7370 656e 7420 7065 7220 7573  ime spent per us
+00028ae0: 6572 2070 6572 2064 6179 2e0a 2020 2020  er per day..    
+00028af0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028b00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028b10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028b20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028b30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028b40: 2323 230a 2020 2020 5061 7261 6d65 7465  ###.    Paramete
+00028b50: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00028b60: 2d0a 2020 2020 6466 203a 2070 616e 6461  -.    df : panda
+00028b70: 732e 4461 7461 4672 616d 650a 2020 2020  s.DataFrame.    
+00028b80: 2020 2020 5468 6520 696e 7075 7420 4461      The input Da
+00028b90: 7461 4672 616d 6520 7769 7468 2075 7365  taFrame with use
+00028ba0: 7220 6964 732c 2074 696d 6573 7461 6d70  r ids, timestamp
+00028bb0: 7320 616e 6420 7661 6c75 6573 2e0a 2020  s and values..  
+00028bc0: 2020 6964 5f63 6f6c 756d 6e20 3a20 7374    id_column : st
+00028bd0: 720a 2020 2020 2020 2020 5468 6520 6e61  r.        The na
+00028be0: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
+00028bf0: 2074 6861 7420 636f 6e74 6169 6e73 2074   that contains t
+00028c00: 6865 2075 7365 7220 6964 732e 0a20 2020  he user ids..   
+00028c10: 2074 696d 6573 7461 6d70 5f63 6f6c 756d   timestamp_colum
+00028c20: 6e20 3a20 7374 720a 2020 2020 2020 2020  n : str.        
+00028c30: 4e61 6d65 206f 6620 7468 6520 7469 6d65  Name of the time
+00028c40: 7374 616d 7020 636f 6c75 6d6e 0a0a 2020  stamp column..  
+00028c50: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00028c60: 2d2d 2d2d 2d0a 2020 2020 7265 7375 6c74  -----.    result
+00028c70: 203a 2070 616e 6461 732e 4461 7461 4672   : pandas.DataFr
+00028c80: 616d 650a 2020 2020 2020 2020 5468 6520  ame.        The 
+00028c90: 6f75 7470 7574 2044 6174 6146 7261 6d65  output DataFrame
+00028ca0: 2077 6974 6820 7573 6572 2069 6473 2c20   with user ids, 
+00028cb0: 6461 7465 732c 2061 7665 7261 6765 2074  dates, average t
+00028cc0: 696d 6520 7370 656e 7420 616e 6420 6e75  ime spent and nu
+00028cd0: 6d62 6572 206f 6620 6c6f 6769 6e73 2e0a  mber of logins..
+00028ce0: 2020 2020 2222 220a 2020 2020 6466 203d      """.    df =
+00028cf0: 2063 6f70 792e 6465 6570 636f 7079 2864   copy.deepcopy(d
+00028d00: 6629 0a20 2020 2023 2043 7265 6174 6520  f).    # Create 
+00028d10: 616e 2065 6d70 7479 2044 6174 6146 7261  an empty DataFra
+00028d20: 6d65 2074 6f20 7374 6f72 6520 7468 6520  me to store the 
+00028d30: 7265 7375 6c74 730a 2020 2020 636f 6c75  results.    colu
+00028d40: 6d6e 7320 3d20 5b69 645f 636f 6c75 6d6e  mns = [id_column
+00028d50: 2c20 7469 6d65 7374 616d 705f 636f 6c75  , timestamp_colu
+00028d60: 6d6e 5d0a 2020 2020 6466 203d 2064 665b  mn].    df = df[
+00028d70: 636f 6c75 6d6e 735d 0a20 2020 206c 656e  columns].    len
+00028d80: 6720 3d20 6c65 6e28 6466 290a 2020 2020  g = len(df).    
+00028d90: 2320 5265 7368 6170 6520 7468 6520 4461  # Reshape the Da
+00028da0: 7461 4672 616d 6520 696e 746f 2074 776f  taFrame into two
+00028db0: 2063 6f6c 756d 6e73 2062 7920 7374 6163   columns by stac
+00028dc0: 6b69 6e67 2065 7665 7279 206f 7468 6572  king every other
+00028dd0: 2072 6f77 0a20 2020 2064 6631 203d 2064   row.    df1 = d
+00028de0: 662e 696c 6f63 5b3a 3a32 5d20 2320 7365  f.iloc[::2] # se
+00028df0: 6c65 6374 2065 7665 7279 2065 7665 6e20  lect every even 
+00028e00: 726f 770a 2020 2020 6466 3220 3d20 6466  row.    df2 = df
+00028e10: 2e64 726f 7028 302c 2061 7869 733d 3029  .drop(0, axis=0)
+00028e20: 2023 2064 726f 7020 7468 6520 6669 7273   # drop the firs
+00028e30: 7420 726f 770a 2020 2020 6466 3220 3d20  t row.    df2 = 
+00028e40: 6466 322e 696c 6f63 5b3a 3a32 5d20 2320  df2.iloc[::2] # 
+00028e50: 7365 6c65 6374 2065 7665 7279 2065 7665  select every eve
+00028e60: 6e20 726f 7720 6672 6f6d 2074 6865 2072  n row from the r
+00028e70: 656d 6169 6e69 6e67 2072 6f77 730a 2020  emaining rows.  
+00028e80: 2020 2320 4966 206c 656e 6774 6820 6f66    # If length of
+00028e90: 2064 6174 6166 7261 6d65 2069 7320 6e6f   dataframe is no
+00028ea0: 7420 616e 2065 7665 6e20 6e75 6d62 6572  t an even number
+00028eb0: 2c20 7072 6f63 6573 7320 756e 7469 6c20  , process until 
+00028ec0: 7468 6520 6c61 7374 2072 6f77 0a20 2020  the last row.   
+00028ed0: 2069 6620 6c65 6e67 2532 2021 3d20 303a   if leng%2 != 0:
+00028ee0: 0a20 2020 2020 2020 206c 6173 7472 6f77  .        lastrow
+00028ef0: 203d 2064 6963 7428 6466 2e69 6c6f 635b   = dict(df.iloc[
+00028f00: 2d31 5d29 2023 2067 6574 2074 6865 206c  -1]) # get the l
+00028f10: 6173 7420 726f 7720 6173 2061 2064 6963  ast row as a dic
+00028f20: 7469 6f6e 6172 790a 2020 2020 2020 2020  tionary.        
+00028f30: 6466 3220 3d20 6466 322e 6170 7065 6e64  df2 = df2.append
+00028f40: 286c 6173 7472 6f77 2c20 6967 6e6f 7265  (lastrow, ignore
+00028f50: 5f69 6e64 6578 3d54 7275 6529 2023 2061  _index=True) # a
+00028f60: 7070 656e 6420 6974 2074 6f20 6466 320a  ppend it to df2.
+00028f70: 2020 2020 6466 3120 3d20 6466 312e 7265      df1 = df1.re
+00028f80: 6e61 6d65 2863 6f6c 756d 6e73 3d7b 7469  name(columns={ti
+00028f90: 6d65 7374 616d 705f 636f 6c75 6d6e 3a74  mestamp_column:t
+00028fa0: 696d 6573 7461 6d70 5f63 6f6c 756d 6e2b  imestamp_column+
+00028fb0: 275f 6265 6769 6e27 7d29 2023 2072 656e  '_begin'}) # ren
+00028fc0: 616d 6520 7468 6520 7469 6d65 7374 616d  ame the timestam
+00028fd0: 7020 636f 6c75 6d6e 2069 6e20 6466 310a  p column in df1.
+00028fe0: 2020 2020 6466 3220 3d20 6466 322e 7265      df2 = df2.re
+00028ff0: 6e61 6d65 2863 6f6c 756d 6e73 3d7b 7469  name(columns={ti
+00029000: 6d65 7374 616d 705f 636f 6c75 6d6e 3a74  mestamp_column:t
+00029010: 696d 6573 7461 6d70 5f63 6f6c 756d 6e2b  imestamp_column+
+00029020: 275f 656e 6427 7d29 2023 2072 656e 616d  '_end'}) # renam
+00029030: 6520 7468 6520 7469 6d65 7374 616d 7020  e the timestamp 
+00029040: 636f 6c75 6d6e 2069 6e20 6466 320a 2020  column in df2.  
+00029050: 2020 6466 3178 203d 2064 6631 2e72 6573    df1x = df1.res
+00029060: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
+00029070: 7565 2920 2320 7265 7365 7420 7468 6520  ue) # reset the 
+00029080: 696e 6465 7820 6f66 2064 6631 0a20 2020  index of df1.   
+00029090: 2064 6632 7820 3d20 6466 322e 7265 7365   df2x = df2.rese
+000290a0: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
+000290b0: 6529 2023 2072 6573 6574 2074 6865 2069  e) # reset the i
+000290c0: 6e64 6578 206f 6620 6466 320a 2020 2020  ndex of df2.    
+000290d0: 6466 3320 3d20 7064 2e63 6f6e 6361 7428  df3 = pd.concat(
+000290e0: 5b64 6631 782c 2064 6632 785d 2c20 6178  [df1x, df2x], ax
+000290f0: 6973 3d31 2920 2320 636f 6e63 6174 656e  is=1) # concaten
+00029100: 6174 6520 6466 3120 616e 6420 6466 3220  ate df1 and df2 
+00029110: 686f 7269 7a6f 6e74 616c 6c79 0a20 2020  horizontally.   
+00029120: 2072 6573 756c 7420 3d20 6466 332e 696c   result = df3.il
+00029130: 6f63 5b3a 2c5b 302c 312c 335d 5d20 2320  oc[:,[0,1,3]] # 
+00029140: 7365 6c65 6374 206f 6e6c 7920 7468 6520  select only the 
+00029150: 7265 6c65 7661 6e74 2063 6f6c 756d 6e73  relevant columns
+00029160: 2066 726f 6d20 6466 330a 2020 2020 2320   from df3.    # 
+00029170: 6361 6c63 756c 6174 6520 7468 6520 7469  calculate the ti
+00029180: 6d65 2064 6966 6665 7265 6e63 6520 6265  me difference be
+00029190: 7477 6565 6e20 6561 6368 2070 6169 7220  tween each pair 
+000291a0: 6f66 2072 6f77 730a 2020 2020 7265 7375  of rows.    resu
+000291b0: 6c74 5b22 7469 6d65 5f64 6966 6622 5d20  lt["time_diff"] 
+000291c0: 3d20 7265 7375 6c74 5b74 696d 6573 7461  = result[timesta
+000291d0: 6d70 5f63 6f6c 756d 6e2b 225f 656e 6422  mp_column+"_end"
+000291e0: 5d20 2d20 7265 7375 6c74 5b74 696d 6573  ] - result[times
+000291f0: 7461 6d70 5f63 6f6c 756d 6e2b 225f 6265  tamp_column+"_be
+00029200: 6769 6e22 5d20 0a20 2020 2023 636f 6e76  gin"] .    #conv
+00029210: 6572 7420 7468 6520 7661 6c75 655f 6469  ert the value_di
+00029220: 6666 2063 6f6c 756d 6e20 746f 2073 6563  ff column to sec
+00029230: 6f6e 6473 2075 7369 6e67 206e 702e 7469  onds using np.ti
+00029240: 6d65 6465 6c74 6136 3428 312c 2027 7327  medelta64(1, 's'
+00029250: 2920 6675 6e63 7469 6f6e 0a20 2020 2072  ) function.    r
+00029260: 6573 756c 745b 2774 696d 655f 6469 6666  esult['time_diff
+00029270: 275d 203d 2072 6573 756c 745b 2774 696d  '] = result['tim
+00029280: 655f 6469 6666 275d 202f 206e 702e 7469  e_diff'] / np.ti
+00029290: 6d65 6465 6c74 6136 3428 312c 2027 7327  medelta64(1, 's'
+000292a0: 290a 2020 2020 7265 7375 6c74 2e6c 6f63  ).    result.loc
+000292b0: 5b28 7265 7375 6c74 5b27 7469 6d65 5f64  [(result['time_d
+000292c0: 6966 6627 5d3c 3029 2c22 7469 6d65 5f64  iff']<0),"time_d
+000292d0: 6966 6622 5d20 3d20 300a 2020 2020 0a20  iff"] = 0.    . 
+000292e0: 2020 2023 7265 7475 726e 2074 6865 2072     #return the r
+000292f0: 6573 756c 740a 2020 2020 7265 7475 726e  esult.    return
+00029300: 2072 6573 756c 740a 2323 2323 2323 2323   result.########
+00029310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00029360: 2323 2323 2323 230a 0a                   #######..
```

### Comparing `featurewiz-0.3.0/featurewiz/ml_models.py` & `featurewiz-0.3.1/featurewiz/ml_models.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/my_encoders.py` & `featurewiz-0.3.1/featurewiz/my_encoders.py`

 * *Files 0% similar despite different names*

```diff
@@ -1383,21 +1383,43 @@
             self.ratios = self.train.groupby(ts_columns)[self.targets].sum()
         else:
             self.ratios = self.train.groupby(self.hier_vars+ts_columns)[self.targets].sum()
         self.fitted = True
         return self
 
     def transform(self, X, y=None):
-        X = copy.deepcopy(X)
+        self.test = copy.deepcopy(X)
         X_trans = None
         if self.fitted and y is None:
             #############################################
             ##### This is for test data #################
             #############################################
-            if not is_datetime64_any_dtype(X[self.ts_column]):
+            self.ratio_col_adds = []
+            if is_datetime64_any_dtype(X[self.ts_column]):
+                try:
+                    if self.time_period == 'daily':
+                        self.test['new_'+self.ts_column] = self.test[self.ts_column] - pd.Timedelta(days=self.lags)
+                    elif self.time_period == 'weekly':
+                        self.test['new_'+self.ts_column] = self.test[self.ts_column] - pd.Timedelta(weeks=self.lags)
+                    else:
+                        self.test['new_'+self.ts_column] = self.test[self.ts_column] - pd.Timedelta(hours=self.lags)
+                    #### Now we must transform using the new lag column ############
+                    for each_target in self.targets:
+                        newcol = each_target+'_lag_'+str(self.lags)
+                        if len(self.hier_vars) == 0:
+                            self.test[newcol] = self.test.set_index(['new_'+self.ts_column]).index.map(self.ratios[each_target].get).fillna(0)
+                        else:
+                            self.test[newcol] = self.test.set_index(self.hier_vars+['new_'+self.ts_column]).index.map(self.ratios[each_target].get).fillna(0)
+                        self.ratio_col_adds.append(newcol)
+                    X_trans = self.test[self.columns + self.ratio_col_adds ]
+                    print('After adding lag column, shape of data: %s' %(X_trans.shape,))
+                    return X_trans
+                except:
+                    print('    Error occured in adding lag feature. Trying another method...')
+            else:
                 print('%s is not a pandas date-time dtype column. Converting it now.' %self.ts_column)
                 X[self.ts_column] = pd.to_datetime(X[self.ts_column])
             numtrans = Numeric_Transformer(ts_columns = [self.ts_column])
             #new_columns = left_subtract(self.X_transformed.columns.tolist(), self.ratio_col_adds)
             new_columns = X.columns.tolist()
             for each_ratio_col_add in self.ratio_col_adds:
                 X_train_1 = numtrans.fit_transform(X[new_columns], self.y_prior)
@@ -1541,15 +1563,15 @@
     if len(features) == 0:
         features = train.columns.tolist()
     nums = [x for x in nums if x in features]
     #### We don't want to look for ID columns and deleted columns ########
     if len(nums) == 0:
         pass
     else:
-
+        
         if train[nums].isnull().sum().sum() > 0:
             null_cols = np.array(nums)[train[nums].isnull().sum()>0].tolist()
             for each_col in null_cols:
                 new_missing_col = each_col + '_Missing_Flag'
                 train[new_missing_col] = 0
                 train.loc[train[each_col].isnull(),new_missing_col]=1
                 ### Remember that fillna only works at dataframe level! ###
```

### Comparing `featurewiz-0.3.0/featurewiz/settings.py` & `featurewiz-0.3.1/featurewiz/settings.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/stacking_models.py` & `featurewiz-0.3.1/featurewiz/stacking_models.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz/sulov_method.py` & `featurewiz-0.3.1/featurewiz/sulov_method.py`

 * *Files identical despite different names*

### Comparing `featurewiz-0.3.0/featurewiz.egg-info/PKG-INFO` & `featurewiz-0.3.1/featurewiz.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,27 @@
 Metadata-Version: 2.1
 Name: featurewiz
-Version: 0.3.0
+Version: 0.3.1
 Summary: Select Best Features from your data set - any size - now with XGBoost!
 Home-page: https://github.com/AutoViML/featurewiz
 Author: Ram Seshadri
 Author-email: rsesha2001@yahoo.com
 License: Apache License 2.0
 Description: # featurewiz
         `featurewiz` is a powerful feature selection library that has a number of features that make it stand out from the competition, including:
         <ol>
         <li>It provides one of the best automatic feature selection algorithms (Minimum Redundancy Maximum Relevance (MRMR)) described by wikipedia as: <a href="https://en.wikipedia.org/wiki/Minimum_redundancy_feature_selection">"The MRMR selection has been found to be more powerful than the maximum relevance feature selection"</a> such as Boruta.</li>
         <li>It selects the best number of un-correlated features that have maximum mutual information about the target without having to specify the number of features</li>
         <li>It is fast and easy to use, and comes with a number of helpful features, such as a built-in categorical-to-numeric encoder and a powerful feature engineering module</li>
         <li>It is well-documented, and it comes with a number of <a href="https://github.com/AutoViML/featurewiz/tree/main/examples">examples</a>.</li>
         <li>It is actively maintained, and it is regularly updated with new features and bug fixes.</li>
         </ol>
-        If you are looking for a single feature selection library, we would definitely recommend checking out featurewiz. It is a powerful tool that can help you to improve the performance of your machine learning models.
+        
+        ## Latest Updates
+        If you are looking for the latest and greatest updates about the library, we would definitely recommend checking out our <a href="https://github.com/AutoViML/featurewiz/blob/main/updates.md">updates page</a> often. It is a powerful tool that can help you improve the performance of your machine learning models with constant new capabilities from featurewiz.
         
         # Table of Contents
         <ul>
         <li><a href="#introduction">What is featurewiz</a></li>
         <li><a href="#working">How it works</a></li>
         <li><a href="#tips">Tips for using featurewiz</a></li>
         <li><a href="#install">How to install featurewiz</a></li>
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: featurewiz Version: 0.3.0 Summary: Select Best
+Metadata-Version: 2.1 Name: featurewiz Version: 0.3.1 Summary: Select Best
 Features from your data set - any size - now with XGBoost! Home-page: https://
 github.com/AutoViML/featurewiz Author: Ram Seshadri Author-email:
 rsesha2001@yahoo.com License: Apache License 2.0 Description: # featurewiz
 `featurewiz` is a powerful feature selection library that has a number of
 features that make it stand out from the competition, including:
    1. It provides one of the best automatic feature selection algorithms
       (Minimum Redundancy Maximum Relevance (MRMR)) described by wikipedia as:
@@ -13,17 +13,19 @@
       of features
    3. It is fast and easy to use, and comes with a number of helpful features,
       such as a built-in categorical-to-numeric encoder and a powerful feature
       engineering module
    4. It is well-documented, and it comes with a number of examples.
    5. It is actively maintained, and it is regularly updated with new features
       and bug fixes.
-If you are looking for a single feature selection library, we would definitely
-recommend checking out featurewiz. It is a powerful tool that can help you to
-improve the performance of your machine learning models. # Table of Contents
+## Latest Updates If you are looking for the latest and greatest updates about
+the library, we would definitely recommend checking out our updates_page often.
+It is a powerful tool that can help you improve the performance of your machine
+learning models with constant new capabilities from featurewiz. # Table of
+Contents
     * What_is_featurewiz
     * How_it_works
     * Tips_for_using_featurewiz
     * How_to_install_featurewiz
     * Usage
     * API
     * Additional_Tips
```

### Comparing `featurewiz-0.3.0/setup.py` & `featurewiz-0.3.1/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 import setuptools
 
 with open("README.md", "r", encoding="utf-8") as fh:
     long_description = fh.read()
 
 setuptools.setup(
     name="featurewiz",
-    version="0.3.0",
+    version="0.3.1",
     author="Ram Seshadri",
     author_email="rsesha2001@yahoo.com",
     description="Select Best Features from your data set - any size - now with XGBoost!",
     long_description=long_description,
     long_description_content_type="text/markdown",
     license='Apache License 2.0',
     url="https://github.com/AutoViML/featurewiz",
```

